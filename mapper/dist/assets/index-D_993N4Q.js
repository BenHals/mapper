(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const u of a)if(u.type==="childList")for(const d of u.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function n(a){const u={};return a.integrity&&(u.integrity=a.integrity),a.referrerPolicy&&(u.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?u.credentials="include":a.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function s(a){if(a.ep)return;a.ep=!0;const u=n(a);fetch(a.href,u)}})();var kE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Bm(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var gS={exports:{}},Fm={},yS={exports:{}},Ot={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Yd=Symbol.for("react.element"),TE=Symbol.for("react.portal"),CE=Symbol.for("react.fragment"),ME=Symbol.for("react.strict_mode"),EE=Symbol.for("react.profiler"),IE=Symbol.for("react.provider"),PE=Symbol.for("react.context"),AE=Symbol.for("react.forward_ref"),zE=Symbol.for("react.suspense"),DE=Symbol.for("react.memo"),RE=Symbol.for("react.lazy"),V1=Symbol.iterator;function OE(e){return e===null||typeof e!="object"?null:(e=V1&&e[V1]||e["@@iterator"],typeof e=="function"?e:null)}var _S={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},vS=Object.assign,xS={};function Vu(e,t,n){this.props=e,this.context=t,this.refs=xS,this.updater=n||_S}Vu.prototype.isReactComponent={};Vu.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Vu.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function wS(){}wS.prototype=Vu.prototype;function L0(e,t,n){this.props=e,this.context=t,this.refs=xS,this.updater=n||_S}var B0=L0.prototype=new wS;B0.constructor=L0;vS(B0,Vu.prototype);B0.isPureReactComponent=!0;var $1=Array.isArray,bS=Object.prototype.hasOwnProperty,F0={current:null},SS={key:!0,ref:!0,__self:!0,__source:!0};function kS(e,t,n){var s,a={},u=null,d=null;if(t!=null)for(s in t.ref!==void 0&&(d=t.ref),t.key!==void 0&&(u=""+t.key),t)bS.call(t,s)&&!SS.hasOwnProperty(s)&&(a[s]=t[s]);var c=arguments.length-2;if(c===1)a.children=n;else if(1<c){for(var w=Array(c),k=0;k<c;k++)w[k]=arguments[k+2];a.children=w}if(e&&e.defaultProps)for(s in c=e.defaultProps,c)a[s]===void 0&&(a[s]=c[s]);return{$$typeof:Yd,type:e,key:u,ref:d,props:a,_owner:F0.current}}function LE(e,t){return{$$typeof:Yd,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function N0(e){return typeof e=="object"&&e!==null&&e.$$typeof===Yd}function BE(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var j1=/\/+/g;function Ey(e,t){return typeof e=="object"&&e!==null&&e.key!=null?BE(""+e.key):t.toString(36)}function Rf(e,t,n,s,a){var u=typeof e;(u==="undefined"||u==="boolean")&&(e=null);var d=!1;if(e===null)d=!0;else switch(u){case"string":case"number":d=!0;break;case"object":switch(e.$$typeof){case Yd:case TE:d=!0}}if(d)return d=e,a=a(d),e=s===""?"."+Ey(d,0):s,$1(a)?(n="",e!=null&&(n=e.replace(j1,"$&/")+"/"),Rf(a,t,n,"",function(k){return k})):a!=null&&(N0(a)&&(a=LE(a,n+(!a.key||d&&d.key===a.key?"":(""+a.key).replace(j1,"$&/")+"/")+e)),t.push(a)),1;if(d=0,s=s===""?".":s+":",$1(e))for(var c=0;c<e.length;c++){u=e[c];var w=s+Ey(u,c);d+=Rf(u,t,n,w,a)}else if(w=OE(e),typeof w=="function")for(e=w.call(e),c=0;!(u=e.next()).done;)u=u.value,w=s+Ey(u,c++),d+=Rf(u,t,n,w,a);else if(u==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return d}function cf(e,t,n){if(e==null)return e;var s=[],a=0;return Rf(e,s,"","",function(u){return t.call(n,u,a++)}),s}function FE(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Yi={current:null},Of={transition:null},NE={ReactCurrentDispatcher:Yi,ReactCurrentBatchConfig:Of,ReactCurrentOwner:F0};function TS(){throw Error("act(...) is not supported in production builds of React.")}Ot.Children={map:cf,forEach:function(e,t,n){cf(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return cf(e,function(){t++}),t},toArray:function(e){return cf(e,function(t){return t})||[]},only:function(e){if(!N0(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Ot.Component=Vu;Ot.Fragment=CE;Ot.Profiler=EE;Ot.PureComponent=L0;Ot.StrictMode=ME;Ot.Suspense=zE;Ot.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=NE;Ot.act=TS;Ot.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var s=vS({},e.props),a=e.key,u=e.ref,d=e._owner;if(t!=null){if(t.ref!==void 0&&(u=t.ref,d=F0.current),t.key!==void 0&&(a=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(w in t)bS.call(t,w)&&!SS.hasOwnProperty(w)&&(s[w]=t[w]===void 0&&c!==void 0?c[w]:t[w])}var w=arguments.length-2;if(w===1)s.children=n;else if(1<w){c=Array(w);for(var k=0;k<w;k++)c[k]=arguments[k+2];s.children=c}return{$$typeof:Yd,type:e.type,key:a,ref:u,props:s,_owner:d}};Ot.createContext=function(e){return e={$$typeof:PE,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:IE,_context:e},e.Consumer=e};Ot.createElement=kS;Ot.createFactory=function(e){var t=kS.bind(null,e);return t.type=e,t};Ot.createRef=function(){return{current:null}};Ot.forwardRef=function(e){return{$$typeof:AE,render:e}};Ot.isValidElement=N0;Ot.lazy=function(e){return{$$typeof:RE,_payload:{_status:-1,_result:e},_init:FE}};Ot.memo=function(e,t){return{$$typeof:DE,type:e,compare:t===void 0?null:t}};Ot.startTransition=function(e){var t=Of.transition;Of.transition={};try{e()}finally{Of.transition=t}};Ot.unstable_act=TS;Ot.useCallback=function(e,t){return Yi.current.useCallback(e,t)};Ot.useContext=function(e){return Yi.current.useContext(e)};Ot.useDebugValue=function(){};Ot.useDeferredValue=function(e){return Yi.current.useDeferredValue(e)};Ot.useEffect=function(e,t){return Yi.current.useEffect(e,t)};Ot.useId=function(){return Yi.current.useId()};Ot.useImperativeHandle=function(e,t,n){return Yi.current.useImperativeHandle(e,t,n)};Ot.useInsertionEffect=function(e,t){return Yi.current.useInsertionEffect(e,t)};Ot.useLayoutEffect=function(e,t){return Yi.current.useLayoutEffect(e,t)};Ot.useMemo=function(e,t){return Yi.current.useMemo(e,t)};Ot.useReducer=function(e,t,n){return Yi.current.useReducer(e,t,n)};Ot.useRef=function(e){return Yi.current.useRef(e)};Ot.useState=function(e){return Yi.current.useState(e)};Ot.useSyncExternalStore=function(e,t,n){return Yi.current.useSyncExternalStore(e,t,n)};Ot.useTransition=function(){return Yi.current.useTransition()};Ot.version="18.3.1";yS.exports=Ot;var gn=yS.exports;const Zi=Bm(gn);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var VE=gn,$E=Symbol.for("react.element"),jE=Symbol.for("react.fragment"),UE=Object.prototype.hasOwnProperty,qE=VE.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,HE={key:!0,ref:!0,__self:!0,__source:!0};function CS(e,t,n){var s,a={},u=null,d=null;n!==void 0&&(u=""+n),t.key!==void 0&&(u=""+t.key),t.ref!==void 0&&(d=t.ref);for(s in t)UE.call(t,s)&&!HE.hasOwnProperty(s)&&(a[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps,t)a[s]===void 0&&(a[s]=t[s]);return{$$typeof:$E,type:e,key:u,ref:d,props:a,_owner:qE.current}}Fm.Fragment=jE;Fm.jsx=CS;Fm.jsxs=CS;gS.exports=Fm;var hr=gS.exports,MS={exports:{}},$r={},ES={exports:{}},IS={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(Xe,gt){var yt=Xe.length;Xe.push(gt);e:for(;0<yt;){var zt=yt-1>>>1,jt=Xe[zt];if(0<a(jt,gt))Xe[zt]=gt,Xe[yt]=jt,yt=zt;else break e}}function n(Xe){return Xe.length===0?null:Xe[0]}function s(Xe){if(Xe.length===0)return null;var gt=Xe[0],yt=Xe.pop();if(yt!==gt){Xe[0]=yt;e:for(var zt=0,jt=Xe.length,xr=jt>>>1;zt<xr;){var qn=2*(zt+1)-1,_i=Xe[qn],vi=qn+1,An=Xe[vi];if(0>a(_i,yt))vi<jt&&0>a(An,_i)?(Xe[zt]=An,Xe[vi]=yt,zt=vi):(Xe[zt]=_i,Xe[qn]=yt,zt=qn);else if(vi<jt&&0>a(An,yt))Xe[zt]=An,Xe[vi]=yt,zt=vi;else break e}}return gt}function a(Xe,gt){var yt=Xe.sortIndex-gt.sortIndex;return yt!==0?yt:Xe.id-gt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var u=performance;e.unstable_now=function(){return u.now()}}else{var d=Date,c=d.now();e.unstable_now=function(){return d.now()-c}}var w=[],k=[],E=1,P=null,A=3,$=!1,j=!1,X=!1,he=typeof setTimeout=="function"?setTimeout:null,K=typeof clearTimeout=="function"?clearTimeout:null,J=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function le(Xe){for(var gt=n(k);gt!==null;){if(gt.callback===null)s(k);else if(gt.startTime<=Xe)s(k),gt.sortIndex=gt.expirationTime,t(w,gt);else break;gt=n(k)}}function Se(Xe){if(X=!1,le(Xe),!j)if(n(w)!==null)j=!0,Ur(Me);else{var gt=n(k);gt!==null&&yi(Se,gt.startTime-Xe)}}function Me(Xe,gt){j=!1,X&&(X=!1,K(Ze),Ze=-1),$=!0;var yt=A;try{for(le(gt),P=n(w);P!==null&&(!(P.expirationTime>gt)||Xe&&!xt());){var zt=P.callback;if(typeof zt=="function"){P.callback=null,A=P.priorityLevel;var jt=zt(P.expirationTime<=gt);gt=e.unstable_now(),typeof jt=="function"?P.callback=jt:P===n(w)&&s(w),le(gt)}else s(w);P=n(w)}if(P!==null)var xr=!0;else{var qn=n(k);qn!==null&&yi(Se,qn.startTime-gt),xr=!1}return xr}finally{P=null,A=yt,$=!1}}var Ee=!1,De=null,Ze=-1,tt=5,ft=-1;function xt(){return!(e.unstable_now()-ft<tt)}function tr(){if(De!==null){var Xe=e.unstable_now();ft=Xe;var gt=!0;try{gt=De(!0,Xe)}finally{gt?dn():(Ee=!1,De=null)}}else Ee=!1}var dn;if(typeof J=="function")dn=function(){J(tr)};else if(typeof MessageChannel<"u"){var Pn=new MessageChannel,vr=Pn.port2;Pn.port1.onmessage=tr,dn=function(){vr.postMessage(null)}}else dn=function(){he(tr,0)};function Ur(Xe){De=Xe,Ee||(Ee=!0,dn())}function yi(Xe,gt){Ze=he(function(){Xe(e.unstable_now())},gt)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(Xe){Xe.callback=null},e.unstable_continueExecution=function(){j||$||(j=!0,Ur(Me))},e.unstable_forceFrameRate=function(Xe){0>Xe||125<Xe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):tt=0<Xe?Math.floor(1e3/Xe):5},e.unstable_getCurrentPriorityLevel=function(){return A},e.unstable_getFirstCallbackNode=function(){return n(w)},e.unstable_next=function(Xe){switch(A){case 1:case 2:case 3:var gt=3;break;default:gt=A}var yt=A;A=gt;try{return Xe()}finally{A=yt}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(Xe,gt){switch(Xe){case 1:case 2:case 3:case 4:case 5:break;default:Xe=3}var yt=A;A=Xe;try{return gt()}finally{A=yt}},e.unstable_scheduleCallback=function(Xe,gt,yt){var zt=e.unstable_now();switch(typeof yt=="object"&&yt!==null?(yt=yt.delay,yt=typeof yt=="number"&&0<yt?zt+yt:zt):yt=zt,Xe){case 1:var jt=-1;break;case 2:jt=250;break;case 5:jt=1073741823;break;case 4:jt=1e4;break;default:jt=5e3}return jt=yt+jt,Xe={id:E++,callback:gt,priorityLevel:Xe,startTime:yt,expirationTime:jt,sortIndex:-1},yt>zt?(Xe.sortIndex=yt,t(k,Xe),n(w)===null&&Xe===n(k)&&(X?(K(Ze),Ze=-1):X=!0,yi(Se,yt-zt))):(Xe.sortIndex=jt,t(w,Xe),j||$||(j=!0,Ur(Me))),Xe},e.unstable_shouldYield=xt,e.unstable_wrapCallback=function(Xe){var gt=A;return function(){var yt=A;A=gt;try{return Xe.apply(this,arguments)}finally{A=yt}}}})(IS);ES.exports=IS;var ZE=ES.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var WE=gn,Vr=ZE;function Re(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var PS=new Set,Md={};function ec(e,t){Mu(e,t),Mu(e+"Capture",t)}function Mu(e,t){for(Md[e]=t,e=0;e<t.length;e++)PS.add(t[e])}var Mo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),k_=Object.prototype.hasOwnProperty,GE=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,U1={},q1={};function KE(e){return k_.call(q1,e)?!0:k_.call(U1,e)?!1:GE.test(e)?q1[e]=!0:(U1[e]=!0,!1)}function XE(e,t,n,s){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return s?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function JE(e,t,n,s){if(t===null||typeof t>"u"||XE(e,t,n,s))return!0;if(s)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Qi(e,t,n,s,a,u,d){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=s,this.attributeNamespace=a,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=u,this.removeEmptyString=d}var gi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){gi[e]=new Qi(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];gi[t]=new Qi(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){gi[e]=new Qi(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){gi[e]=new Qi(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){gi[e]=new Qi(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){gi[e]=new Qi(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){gi[e]=new Qi(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){gi[e]=new Qi(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){gi[e]=new Qi(e,5,!1,e.toLowerCase(),null,!1,!1)});var V0=/[\-:]([a-z])/g;function $0(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(V0,$0);gi[t]=new Qi(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(V0,$0);gi[t]=new Qi(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(V0,$0);gi[t]=new Qi(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){gi[e]=new Qi(e,1,!1,e.toLowerCase(),null,!1,!1)});gi.xlinkHref=new Qi("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){gi[e]=new Qi(e,1,!1,e.toLowerCase(),null,!0,!0)});function j0(e,t,n,s){var a=gi.hasOwnProperty(t)?gi[t]:null;(a!==null?a.type!==0:s||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(JE(t,n,a,s)&&(n=null),s||a===null?KE(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):a.mustUseProperty?e[a.propertyName]=n===null?a.type===3?!1:"":n:(t=a.attributeName,s=a.attributeNamespace,n===null?e.removeAttribute(t):(a=a.type,n=a===3||a===4&&n===!0?"":""+n,s?e.setAttributeNS(s,t,n):e.setAttribute(t,n))))}var Ao=WE.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,uf=Symbol.for("react.element"),iu=Symbol.for("react.portal"),ru=Symbol.for("react.fragment"),U0=Symbol.for("react.strict_mode"),T_=Symbol.for("react.profiler"),AS=Symbol.for("react.provider"),zS=Symbol.for("react.context"),q0=Symbol.for("react.forward_ref"),C_=Symbol.for("react.suspense"),M_=Symbol.for("react.suspense_list"),H0=Symbol.for("react.memo"),ga=Symbol.for("react.lazy"),DS=Symbol.for("react.offscreen"),H1=Symbol.iterator;function Yh(e){return e===null||typeof e!="object"?null:(e=H1&&e[H1]||e["@@iterator"],typeof e=="function"?e:null)}var bn=Object.assign,Iy;function ad(e){if(Iy===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);Iy=t&&t[1]||""}return`
`+Iy+e}var Py=!1;function Ay(e,t){if(!e||Py)return"";Py=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(k){var s=k}Reflect.construct(e,[],t)}else{try{t.call()}catch(k){s=k}e.call(t.prototype)}else{try{throw Error()}catch(k){s=k}e()}}catch(k){if(k&&s&&typeof k.stack=="string"){for(var a=k.stack.split(`
`),u=s.stack.split(`
`),d=a.length-1,c=u.length-1;1<=d&&0<=c&&a[d]!==u[c];)c--;for(;1<=d&&0<=c;d--,c--)if(a[d]!==u[c]){if(d!==1||c!==1)do if(d--,c--,0>c||a[d]!==u[c]){var w=`
`+a[d].replace(" at new "," at ");return e.displayName&&w.includes("<anonymous>")&&(w=w.replace("<anonymous>",e.displayName)),w}while(1<=d&&0<=c);break}}}finally{Py=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?ad(e):""}function YE(e){switch(e.tag){case 5:return ad(e.type);case 16:return ad("Lazy");case 13:return ad("Suspense");case 19:return ad("SuspenseList");case 0:case 2:case 15:return e=Ay(e.type,!1),e;case 11:return e=Ay(e.type.render,!1),e;case 1:return e=Ay(e.type,!0),e;default:return""}}function E_(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case ru:return"Fragment";case iu:return"Portal";case T_:return"Profiler";case U0:return"StrictMode";case C_:return"Suspense";case M_:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case zS:return(e.displayName||"Context")+".Consumer";case AS:return(e._context.displayName||"Context")+".Provider";case q0:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case H0:return t=e.displayName||null,t!==null?t:E_(e.type)||"Memo";case ga:t=e._payload,e=e._init;try{return E_(e(t))}catch{}}return null}function QE(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return E_(t);case 8:return t===U0?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function $a(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function RS(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function eI(e){var t=RS(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),s=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var a=n.get,u=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(d){s=""+d,u.call(this,d)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(d){s=""+d},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function hf(e){e._valueTracker||(e._valueTracker=eI(e))}function OS(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),s="";return e&&(s=RS(e)?e.checked?"true":"false":e.value),e=s,e!==n?(t.setValue(e),!0):!1}function Jf(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function I_(e,t){var n=t.checked;return bn({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function Z1(e,t){var n=t.defaultValue==null?"":t.defaultValue,s=t.checked!=null?t.checked:t.defaultChecked;n=$a(t.value!=null?t.value:n),e._wrapperState={initialChecked:s,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function LS(e,t){t=t.checked,t!=null&&j0(e,"checked",t,!1)}function P_(e,t){LS(e,t);var n=$a(t.value),s=t.type;if(n!=null)s==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(s==="submit"||s==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?A_(e,t.type,n):t.hasOwnProperty("defaultValue")&&A_(e,t.type,$a(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function W1(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var s=t.type;if(!(s!=="submit"&&s!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function A_(e,t,n){(t!=="number"||Jf(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var ld=Array.isArray;function yu(e,t,n,s){if(e=e.options,t){t={};for(var a=0;a<n.length;a++)t["$"+n[a]]=!0;for(n=0;n<e.length;n++)a=t.hasOwnProperty("$"+e[n].value),e[n].selected!==a&&(e[n].selected=a),a&&s&&(e[n].defaultSelected=!0)}else{for(n=""+$a(n),t=null,a=0;a<e.length;a++){if(e[a].value===n){e[a].selected=!0,s&&(e[a].defaultSelected=!0);return}t!==null||e[a].disabled||(t=e[a])}t!==null&&(t.selected=!0)}}function z_(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Re(91));return bn({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function G1(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(Re(92));if(ld(n)){if(1<n.length)throw Error(Re(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:$a(n)}}function BS(e,t){var n=$a(t.value),s=$a(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),s!=null&&(e.defaultValue=""+s)}function K1(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function FS(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function D_(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?FS(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var df,NS=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,s,a){MSApp.execUnsafeLocalFunction(function(){return e(t,n,s,a)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(df=df||document.createElement("div"),df.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=df.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Ed(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var fd={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},tI=["Webkit","ms","Moz","O"];Object.keys(fd).forEach(function(e){tI.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),fd[t]=fd[e]})});function VS(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||fd.hasOwnProperty(e)&&fd[e]?(""+t).trim():t+"px"}function $S(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var s=n.indexOf("--")===0,a=VS(n,t[n],s);n==="float"&&(n="cssFloat"),s?e.setProperty(n,a):e[n]=a}}var nI=bn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function R_(e,t){if(t){if(nI[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Re(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Re(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(Re(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Re(62))}}function O_(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var L_=null;function Z0(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var B_=null,_u=null,vu=null;function X1(e){if(e=tp(e)){if(typeof B_!="function")throw Error(Re(280));var t=e.stateNode;t&&(t=Um(t),B_(e.stateNode,e.type,t))}}function jS(e){_u?vu?vu.push(e):vu=[e]:_u=e}function US(){if(_u){var e=_u,t=vu;if(vu=_u=null,X1(e),t)for(e=0;e<t.length;e++)X1(t[e])}}function qS(e,t){return e(t)}function HS(){}var zy=!1;function ZS(e,t,n){if(zy)return e(t,n);zy=!0;try{return qS(e,t,n)}finally{zy=!1,(_u!==null||vu!==null)&&(HS(),US())}}function Id(e,t){var n=e.stateNode;if(n===null)return null;var s=Um(n);if(s===null)return null;n=s[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(e=e.type,s=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!s;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(Re(231,t,typeof n));return n}var F_=!1;if(Mo)try{var Qh={};Object.defineProperty(Qh,"passive",{get:function(){F_=!0}}),window.addEventListener("test",Qh,Qh),window.removeEventListener("test",Qh,Qh)}catch{F_=!1}function iI(e,t,n,s,a,u,d,c,w){var k=Array.prototype.slice.call(arguments,3);try{t.apply(n,k)}catch(E){this.onError(E)}}var md=!1,Yf=null,Qf=!1,N_=null,rI={onError:function(e){md=!0,Yf=e}};function sI(e,t,n,s,a,u,d,c,w){md=!1,Yf=null,iI.apply(rI,arguments)}function oI(e,t,n,s,a,u,d,c,w){if(sI.apply(this,arguments),md){if(md){var k=Yf;md=!1,Yf=null}else throw Error(Re(198));Qf||(Qf=!0,N_=k)}}function tc(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function WS(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function J1(e){if(tc(e)!==e)throw Error(Re(188))}function aI(e){var t=e.alternate;if(!t){if(t=tc(e),t===null)throw Error(Re(188));return t!==e?null:e}for(var n=e,s=t;;){var a=n.return;if(a===null)break;var u=a.alternate;if(u===null){if(s=a.return,s!==null){n=s;continue}break}if(a.child===u.child){for(u=a.child;u;){if(u===n)return J1(a),e;if(u===s)return J1(a),t;u=u.sibling}throw Error(Re(188))}if(n.return!==s.return)n=a,s=u;else{for(var d=!1,c=a.child;c;){if(c===n){d=!0,n=a,s=u;break}if(c===s){d=!0,s=a,n=u;break}c=c.sibling}if(!d){for(c=u.child;c;){if(c===n){d=!0,n=u,s=a;break}if(c===s){d=!0,s=u,n=a;break}c=c.sibling}if(!d)throw Error(Re(189))}}if(n.alternate!==s)throw Error(Re(190))}if(n.tag!==3)throw Error(Re(188));return n.stateNode.current===n?e:t}function GS(e){return e=aI(e),e!==null?KS(e):null}function KS(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=KS(e);if(t!==null)return t;e=e.sibling}return null}var XS=Vr.unstable_scheduleCallback,Y1=Vr.unstable_cancelCallback,lI=Vr.unstable_shouldYield,cI=Vr.unstable_requestPaint,In=Vr.unstable_now,uI=Vr.unstable_getCurrentPriorityLevel,W0=Vr.unstable_ImmediatePriority,JS=Vr.unstable_UserBlockingPriority,em=Vr.unstable_NormalPriority,hI=Vr.unstable_LowPriority,YS=Vr.unstable_IdlePriority,Nm=null,Ws=null;function dI(e){if(Ws&&typeof Ws.onCommitFiberRoot=="function")try{Ws.onCommitFiberRoot(Nm,e,void 0,(e.current.flags&128)===128)}catch{}}var ks=Math.clz32?Math.clz32:mI,pI=Math.log,fI=Math.LN2;function mI(e){return e>>>=0,e===0?32:31-(pI(e)/fI|0)|0}var pf=64,ff=4194304;function cd(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function tm(e,t){var n=e.pendingLanes;if(n===0)return 0;var s=0,a=e.suspendedLanes,u=e.pingedLanes,d=n&268435455;if(d!==0){var c=d&~a;c!==0?s=cd(c):(u&=d,u!==0&&(s=cd(u)))}else d=n&~a,d!==0?s=cd(d):u!==0&&(s=cd(u));if(s===0)return 0;if(t!==0&&t!==s&&!(t&a)&&(a=s&-s,u=t&-t,a>=u||a===16&&(u&4194240)!==0))return t;if(s&4&&(s|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=s;0<t;)n=31-ks(t),a=1<<n,s|=e[n],t&=~a;return s}function gI(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function yI(e,t){for(var n=e.suspendedLanes,s=e.pingedLanes,a=e.expirationTimes,u=e.pendingLanes;0<u;){var d=31-ks(u),c=1<<d,w=a[d];w===-1?(!(c&n)||c&s)&&(a[d]=gI(c,t)):w<=t&&(e.expiredLanes|=c),u&=~c}}function V_(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function QS(){var e=pf;return pf<<=1,!(pf&4194240)&&(pf=64),e}function Dy(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Qd(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-ks(t),e[t]=n}function _I(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var s=e.eventTimes;for(e=e.expirationTimes;0<n;){var a=31-ks(n),u=1<<a;t[a]=0,s[a]=-1,e[a]=-1,n&=~u}}function G0(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var s=31-ks(n),a=1<<s;a&t|e[s]&t&&(e[s]|=t),n&=~a}}var Jt=0;function ek(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var tk,K0,nk,ik,rk,$_=!1,mf=[],Ea=null,Ia=null,Pa=null,Pd=new Map,Ad=new Map,xa=[],vI="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Q1(e,t){switch(e){case"focusin":case"focusout":Ea=null;break;case"dragenter":case"dragleave":Ia=null;break;case"mouseover":case"mouseout":Pa=null;break;case"pointerover":case"pointerout":Pd.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ad.delete(t.pointerId)}}function ed(e,t,n,s,a,u){return e===null||e.nativeEvent!==u?(e={blockedOn:t,domEventName:n,eventSystemFlags:s,nativeEvent:u,targetContainers:[a]},t!==null&&(t=tp(t),t!==null&&K0(t)),e):(e.eventSystemFlags|=s,t=e.targetContainers,a!==null&&t.indexOf(a)===-1&&t.push(a),e)}function xI(e,t,n,s,a){switch(t){case"focusin":return Ea=ed(Ea,e,t,n,s,a),!0;case"dragenter":return Ia=ed(Ia,e,t,n,s,a),!0;case"mouseover":return Pa=ed(Pa,e,t,n,s,a),!0;case"pointerover":var u=a.pointerId;return Pd.set(u,ed(Pd.get(u)||null,e,t,n,s,a)),!0;case"gotpointercapture":return u=a.pointerId,Ad.set(u,ed(Ad.get(u)||null,e,t,n,s,a)),!0}return!1}function sk(e){var t=Dl(e.target);if(t!==null){var n=tc(t);if(n!==null){if(t=n.tag,t===13){if(t=WS(n),t!==null){e.blockedOn=t,rk(e.priority,function(){nk(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Lf(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=j_(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var s=new n.constructor(n.type,n);L_=s,n.target.dispatchEvent(s),L_=null}else return t=tp(n),t!==null&&K0(t),e.blockedOn=n,!1;t.shift()}return!0}function ew(e,t,n){Lf(e)&&n.delete(t)}function wI(){$_=!1,Ea!==null&&Lf(Ea)&&(Ea=null),Ia!==null&&Lf(Ia)&&(Ia=null),Pa!==null&&Lf(Pa)&&(Pa=null),Pd.forEach(ew),Ad.forEach(ew)}function td(e,t){e.blockedOn===t&&(e.blockedOn=null,$_||($_=!0,Vr.unstable_scheduleCallback(Vr.unstable_NormalPriority,wI)))}function zd(e){function t(a){return td(a,e)}if(0<mf.length){td(mf[0],e);for(var n=1;n<mf.length;n++){var s=mf[n];s.blockedOn===e&&(s.blockedOn=null)}}for(Ea!==null&&td(Ea,e),Ia!==null&&td(Ia,e),Pa!==null&&td(Pa,e),Pd.forEach(t),Ad.forEach(t),n=0;n<xa.length;n++)s=xa[n],s.blockedOn===e&&(s.blockedOn=null);for(;0<xa.length&&(n=xa[0],n.blockedOn===null);)sk(n),n.blockedOn===null&&xa.shift()}var xu=Ao.ReactCurrentBatchConfig,nm=!0;function bI(e,t,n,s){var a=Jt,u=xu.transition;xu.transition=null;try{Jt=1,X0(e,t,n,s)}finally{Jt=a,xu.transition=u}}function SI(e,t,n,s){var a=Jt,u=xu.transition;xu.transition=null;try{Jt=4,X0(e,t,n,s)}finally{Jt=a,xu.transition=u}}function X0(e,t,n,s){if(nm){var a=j_(e,t,n,s);if(a===null)Uy(e,t,s,im,n),Q1(e,s);else if(xI(a,e,t,n,s))s.stopPropagation();else if(Q1(e,s),t&4&&-1<vI.indexOf(e)){for(;a!==null;){var u=tp(a);if(u!==null&&tk(u),u=j_(e,t,n,s),u===null&&Uy(e,t,s,im,n),u===a)break;a=u}a!==null&&s.stopPropagation()}else Uy(e,t,s,null,n)}}var im=null;function j_(e,t,n,s){if(im=null,e=Z0(s),e=Dl(e),e!==null)if(t=tc(e),t===null)e=null;else if(n=t.tag,n===13){if(e=WS(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return im=e,null}function ok(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(uI()){case W0:return 1;case JS:return 4;case em:case hI:return 16;case YS:return 536870912;default:return 16}default:return 16}}var Sa=null,J0=null,Bf=null;function ak(){if(Bf)return Bf;var e,t=J0,n=t.length,s,a="value"in Sa?Sa.value:Sa.textContent,u=a.length;for(e=0;e<n&&t[e]===a[e];e++);var d=n-e;for(s=1;s<=d&&t[n-s]===a[u-s];s++);return Bf=a.slice(e,1<s?1-s:void 0)}function Ff(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function gf(){return!0}function tw(){return!1}function jr(e){function t(n,s,a,u,d){this._reactName=n,this._targetInst=a,this.type=s,this.nativeEvent=u,this.target=d,this.currentTarget=null;for(var c in e)e.hasOwnProperty(c)&&(n=e[c],this[c]=n?n(u):u[c]);return this.isDefaultPrevented=(u.defaultPrevented!=null?u.defaultPrevented:u.returnValue===!1)?gf:tw,this.isPropagationStopped=tw,this}return bn(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=gf)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=gf)},persist:function(){},isPersistent:gf}),t}var $u={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Y0=jr($u),ep=bn({},$u,{view:0,detail:0}),kI=jr(ep),Ry,Oy,nd,Vm=bn({},ep,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Q0,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==nd&&(nd&&e.type==="mousemove"?(Ry=e.screenX-nd.screenX,Oy=e.screenY-nd.screenY):Oy=Ry=0,nd=e),Ry)},movementY:function(e){return"movementY"in e?e.movementY:Oy}}),nw=jr(Vm),TI=bn({},Vm,{dataTransfer:0}),CI=jr(TI),MI=bn({},ep,{relatedTarget:0}),Ly=jr(MI),EI=bn({},$u,{animationName:0,elapsedTime:0,pseudoElement:0}),II=jr(EI),PI=bn({},$u,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),AI=jr(PI),zI=bn({},$u,{data:0}),iw=jr(zI),DI={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},RI={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},OI={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function LI(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=OI[e])?!!t[e]:!1}function Q0(){return LI}var BI=bn({},ep,{key:function(e){if(e.key){var t=DI[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Ff(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?RI[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Q0,charCode:function(e){return e.type==="keypress"?Ff(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Ff(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),FI=jr(BI),NI=bn({},Vm,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),rw=jr(NI),VI=bn({},ep,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Q0}),$I=jr(VI),jI=bn({},$u,{propertyName:0,elapsedTime:0,pseudoElement:0}),UI=jr(jI),qI=bn({},Vm,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),HI=jr(qI),ZI=[9,13,27,32],ev=Mo&&"CompositionEvent"in window,gd=null;Mo&&"documentMode"in document&&(gd=document.documentMode);var WI=Mo&&"TextEvent"in window&&!gd,lk=Mo&&(!ev||gd&&8<gd&&11>=gd),sw=" ",ow=!1;function ck(e,t){switch(e){case"keyup":return ZI.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function uk(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var su=!1;function GI(e,t){switch(e){case"compositionend":return uk(t);case"keypress":return t.which!==32?null:(ow=!0,sw);case"textInput":return e=t.data,e===sw&&ow?null:e;default:return null}}function KI(e,t){if(su)return e==="compositionend"||!ev&&ck(e,t)?(e=ak(),Bf=J0=Sa=null,su=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return lk&&t.locale!=="ko"?null:t.data;default:return null}}var XI={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function aw(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!XI[e.type]:t==="textarea"}function hk(e,t,n,s){jS(s),t=rm(t,"onChange"),0<t.length&&(n=new Y0("onChange","change",null,n,s),e.push({event:n,listeners:t}))}var yd=null,Dd=null;function JI(e){bk(e,0)}function $m(e){var t=lu(e);if(OS(t))return e}function YI(e,t){if(e==="change")return t}var dk=!1;if(Mo){var By;if(Mo){var Fy="oninput"in document;if(!Fy){var lw=document.createElement("div");lw.setAttribute("oninput","return;"),Fy=typeof lw.oninput=="function"}By=Fy}else By=!1;dk=By&&(!document.documentMode||9<document.documentMode)}function cw(){yd&&(yd.detachEvent("onpropertychange",pk),Dd=yd=null)}function pk(e){if(e.propertyName==="value"&&$m(Dd)){var t=[];hk(t,Dd,e,Z0(e)),ZS(JI,t)}}function QI(e,t,n){e==="focusin"?(cw(),yd=t,Dd=n,yd.attachEvent("onpropertychange",pk)):e==="focusout"&&cw()}function eP(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return $m(Dd)}function tP(e,t){if(e==="click")return $m(t)}function nP(e,t){if(e==="input"||e==="change")return $m(t)}function iP(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Ms=typeof Object.is=="function"?Object.is:iP;function Rd(e,t){if(Ms(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),s=Object.keys(t);if(n.length!==s.length)return!1;for(s=0;s<n.length;s++){var a=n[s];if(!k_.call(t,a)||!Ms(e[a],t[a]))return!1}return!0}function uw(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function hw(e,t){var n=uw(e);e=0;for(var s;n;){if(n.nodeType===3){if(s=e+n.textContent.length,e<=t&&s>=t)return{node:n,offset:t-e};e=s}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=uw(n)}}function fk(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?fk(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function mk(){for(var e=window,t=Jf();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=Jf(e.document)}return t}function tv(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function rP(e){var t=mk(),n=e.focusedElem,s=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&fk(n.ownerDocument.documentElement,n)){if(s!==null&&tv(n)){if(t=s.start,e=s.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var a=n.textContent.length,u=Math.min(s.start,a);s=s.end===void 0?u:Math.min(s.end,a),!e.extend&&u>s&&(a=s,s=u,u=a),a=hw(n,u);var d=hw(n,s);a&&d&&(e.rangeCount!==1||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==d.node||e.focusOffset!==d.offset)&&(t=t.createRange(),t.setStart(a.node,a.offset),e.removeAllRanges(),u>s?(e.addRange(t),e.extend(d.node,d.offset)):(t.setEnd(d.node,d.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var sP=Mo&&"documentMode"in document&&11>=document.documentMode,ou=null,U_=null,_d=null,q_=!1;function dw(e,t,n){var s=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;q_||ou==null||ou!==Jf(s)||(s=ou,"selectionStart"in s&&tv(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),_d&&Rd(_d,s)||(_d=s,s=rm(U_,"onSelect"),0<s.length&&(t=new Y0("onSelect","select",null,t,n),e.push({event:t,listeners:s}),t.target=ou)))}function yf(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var au={animationend:yf("Animation","AnimationEnd"),animationiteration:yf("Animation","AnimationIteration"),animationstart:yf("Animation","AnimationStart"),transitionend:yf("Transition","TransitionEnd")},Ny={},gk={};Mo&&(gk=document.createElement("div").style,"AnimationEvent"in window||(delete au.animationend.animation,delete au.animationiteration.animation,delete au.animationstart.animation),"TransitionEvent"in window||delete au.transitionend.transition);function jm(e){if(Ny[e])return Ny[e];if(!au[e])return e;var t=au[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in gk)return Ny[e]=t[n];return e}var yk=jm("animationend"),_k=jm("animationiteration"),vk=jm("animationstart"),xk=jm("transitionend"),wk=new Map,pw="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ha(e,t){wk.set(e,t),ec(t,[e])}for(var Vy=0;Vy<pw.length;Vy++){var $y=pw[Vy],oP=$y.toLowerCase(),aP=$y[0].toUpperCase()+$y.slice(1);Ha(oP,"on"+aP)}Ha(yk,"onAnimationEnd");Ha(_k,"onAnimationIteration");Ha(vk,"onAnimationStart");Ha("dblclick","onDoubleClick");Ha("focusin","onFocus");Ha("focusout","onBlur");Ha(xk,"onTransitionEnd");Mu("onMouseEnter",["mouseout","mouseover"]);Mu("onMouseLeave",["mouseout","mouseover"]);Mu("onPointerEnter",["pointerout","pointerover"]);Mu("onPointerLeave",["pointerout","pointerover"]);ec("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ec("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ec("onBeforeInput",["compositionend","keypress","textInput","paste"]);ec("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ec("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ec("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ud="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),lP=new Set("cancel close invalid load scroll toggle".split(" ").concat(ud));function fw(e,t,n){var s=e.type||"unknown-event";e.currentTarget=n,oI(s,t,void 0,e),e.currentTarget=null}function bk(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var s=e[n],a=s.event;s=s.listeners;e:{var u=void 0;if(t)for(var d=s.length-1;0<=d;d--){var c=s[d],w=c.instance,k=c.currentTarget;if(c=c.listener,w!==u&&a.isPropagationStopped())break e;fw(a,c,k),u=w}else for(d=0;d<s.length;d++){if(c=s[d],w=c.instance,k=c.currentTarget,c=c.listener,w!==u&&a.isPropagationStopped())break e;fw(a,c,k),u=w}}}if(Qf)throw e=N_,Qf=!1,N_=null,e}function un(e,t){var n=t[K_];n===void 0&&(n=t[K_]=new Set);var s=e+"__bubble";n.has(s)||(Sk(t,e,2,!1),n.add(s))}function jy(e,t,n){var s=0;t&&(s|=4),Sk(n,e,s,t)}var _f="_reactListening"+Math.random().toString(36).slice(2);function Od(e){if(!e[_f]){e[_f]=!0,PS.forEach(function(n){n!=="selectionchange"&&(lP.has(n)||jy(n,!1,e),jy(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[_f]||(t[_f]=!0,jy("selectionchange",!1,t))}}function Sk(e,t,n,s){switch(ok(t)){case 1:var a=bI;break;case 4:a=SI;break;default:a=X0}n=a.bind(null,t,n,e),a=void 0,!F_||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(a=!0),s?a!==void 0?e.addEventListener(t,n,{capture:!0,passive:a}):e.addEventListener(t,n,!0):a!==void 0?e.addEventListener(t,n,{passive:a}):e.addEventListener(t,n,!1)}function Uy(e,t,n,s,a){var u=s;if(!(t&1)&&!(t&2)&&s!==null)e:for(;;){if(s===null)return;var d=s.tag;if(d===3||d===4){var c=s.stateNode.containerInfo;if(c===a||c.nodeType===8&&c.parentNode===a)break;if(d===4)for(d=s.return;d!==null;){var w=d.tag;if((w===3||w===4)&&(w=d.stateNode.containerInfo,w===a||w.nodeType===8&&w.parentNode===a))return;d=d.return}for(;c!==null;){if(d=Dl(c),d===null)return;if(w=d.tag,w===5||w===6){s=u=d;continue e}c=c.parentNode}}s=s.return}ZS(function(){var k=u,E=Z0(n),P=[];e:{var A=wk.get(e);if(A!==void 0){var $=Y0,j=e;switch(e){case"keypress":if(Ff(n)===0)break e;case"keydown":case"keyup":$=FI;break;case"focusin":j="focus",$=Ly;break;case"focusout":j="blur",$=Ly;break;case"beforeblur":case"afterblur":$=Ly;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":$=nw;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":$=CI;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":$=$I;break;case yk:case _k:case vk:$=II;break;case xk:$=UI;break;case"scroll":$=kI;break;case"wheel":$=HI;break;case"copy":case"cut":case"paste":$=AI;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":$=rw}var X=(t&4)!==0,he=!X&&e==="scroll",K=X?A!==null?A+"Capture":null:A;X=[];for(var J=k,le;J!==null;){le=J;var Se=le.stateNode;if(le.tag===5&&Se!==null&&(le=Se,K!==null&&(Se=Id(J,K),Se!=null&&X.push(Ld(J,Se,le)))),he)break;J=J.return}0<X.length&&(A=new $(A,j,null,n,E),P.push({event:A,listeners:X}))}}if(!(t&7)){e:{if(A=e==="mouseover"||e==="pointerover",$=e==="mouseout"||e==="pointerout",A&&n!==L_&&(j=n.relatedTarget||n.fromElement)&&(Dl(j)||j[Eo]))break e;if(($||A)&&(A=E.window===E?E:(A=E.ownerDocument)?A.defaultView||A.parentWindow:window,$?(j=n.relatedTarget||n.toElement,$=k,j=j?Dl(j):null,j!==null&&(he=tc(j),j!==he||j.tag!==5&&j.tag!==6)&&(j=null)):($=null,j=k),$!==j)){if(X=nw,Se="onMouseLeave",K="onMouseEnter",J="mouse",(e==="pointerout"||e==="pointerover")&&(X=rw,Se="onPointerLeave",K="onPointerEnter",J="pointer"),he=$==null?A:lu($),le=j==null?A:lu(j),A=new X(Se,J+"leave",$,n,E),A.target=he,A.relatedTarget=le,Se=null,Dl(E)===k&&(X=new X(K,J+"enter",j,n,E),X.target=le,X.relatedTarget=he,Se=X),he=Se,$&&j)t:{for(X=$,K=j,J=0,le=X;le;le=Yc(le))J++;for(le=0,Se=K;Se;Se=Yc(Se))le++;for(;0<J-le;)X=Yc(X),J--;for(;0<le-J;)K=Yc(K),le--;for(;J--;){if(X===K||K!==null&&X===K.alternate)break t;X=Yc(X),K=Yc(K)}X=null}else X=null;$!==null&&mw(P,A,$,X,!1),j!==null&&he!==null&&mw(P,he,j,X,!0)}}e:{if(A=k?lu(k):window,$=A.nodeName&&A.nodeName.toLowerCase(),$==="select"||$==="input"&&A.type==="file")var Me=YI;else if(aw(A))if(dk)Me=nP;else{Me=eP;var Ee=QI}else($=A.nodeName)&&$.toLowerCase()==="input"&&(A.type==="checkbox"||A.type==="radio")&&(Me=tP);if(Me&&(Me=Me(e,k))){hk(P,Me,n,E);break e}Ee&&Ee(e,A,k),e==="focusout"&&(Ee=A._wrapperState)&&Ee.controlled&&A.type==="number"&&A_(A,"number",A.value)}switch(Ee=k?lu(k):window,e){case"focusin":(aw(Ee)||Ee.contentEditable==="true")&&(ou=Ee,U_=k,_d=null);break;case"focusout":_d=U_=ou=null;break;case"mousedown":q_=!0;break;case"contextmenu":case"mouseup":case"dragend":q_=!1,dw(P,n,E);break;case"selectionchange":if(sP)break;case"keydown":case"keyup":dw(P,n,E)}var De;if(ev)e:{switch(e){case"compositionstart":var Ze="onCompositionStart";break e;case"compositionend":Ze="onCompositionEnd";break e;case"compositionupdate":Ze="onCompositionUpdate";break e}Ze=void 0}else su?ck(e,n)&&(Ze="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(Ze="onCompositionStart");Ze&&(lk&&n.locale!=="ko"&&(su||Ze!=="onCompositionStart"?Ze==="onCompositionEnd"&&su&&(De=ak()):(Sa=E,J0="value"in Sa?Sa.value:Sa.textContent,su=!0)),Ee=rm(k,Ze),0<Ee.length&&(Ze=new iw(Ze,e,null,n,E),P.push({event:Ze,listeners:Ee}),De?Ze.data=De:(De=uk(n),De!==null&&(Ze.data=De)))),(De=WI?GI(e,n):KI(e,n))&&(k=rm(k,"onBeforeInput"),0<k.length&&(E=new iw("onBeforeInput","beforeinput",null,n,E),P.push({event:E,listeners:k}),E.data=De))}bk(P,t)})}function Ld(e,t,n){return{instance:e,listener:t,currentTarget:n}}function rm(e,t){for(var n=t+"Capture",s=[];e!==null;){var a=e,u=a.stateNode;a.tag===5&&u!==null&&(a=u,u=Id(e,n),u!=null&&s.unshift(Ld(e,u,a)),u=Id(e,t),u!=null&&s.push(Ld(e,u,a))),e=e.return}return s}function Yc(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function mw(e,t,n,s,a){for(var u=t._reactName,d=[];n!==null&&n!==s;){var c=n,w=c.alternate,k=c.stateNode;if(w!==null&&w===s)break;c.tag===5&&k!==null&&(c=k,a?(w=Id(n,u),w!=null&&d.unshift(Ld(n,w,c))):a||(w=Id(n,u),w!=null&&d.push(Ld(n,w,c)))),n=n.return}d.length!==0&&e.push({event:t,listeners:d})}var cP=/\r\n?/g,uP=/\u0000|\uFFFD/g;function gw(e){return(typeof e=="string"?e:""+e).replace(cP,`
`).replace(uP,"")}function vf(e,t,n){if(t=gw(t),gw(e)!==t&&n)throw Error(Re(425))}function sm(){}var H_=null,Z_=null;function W_(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var G_=typeof setTimeout=="function"?setTimeout:void 0,hP=typeof clearTimeout=="function"?clearTimeout:void 0,yw=typeof Promise=="function"?Promise:void 0,dP=typeof queueMicrotask=="function"?queueMicrotask:typeof yw<"u"?function(e){return yw.resolve(null).then(e).catch(pP)}:G_;function pP(e){setTimeout(function(){throw e})}function qy(e,t){var n=t,s=0;do{var a=n.nextSibling;if(e.removeChild(n),a&&a.nodeType===8)if(n=a.data,n==="/$"){if(s===0){e.removeChild(a),zd(t);return}s--}else n!=="$"&&n!=="$?"&&n!=="$!"||s++;n=a}while(n);zd(t)}function Aa(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function _w(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var ju=Math.random().toString(36).slice(2),Hs="__reactFiber$"+ju,Bd="__reactProps$"+ju,Eo="__reactContainer$"+ju,K_="__reactEvents$"+ju,fP="__reactListeners$"+ju,mP="__reactHandles$"+ju;function Dl(e){var t=e[Hs];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Eo]||n[Hs]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=_w(e);e!==null;){if(n=e[Hs])return n;e=_w(e)}return t}e=n,n=e.parentNode}return null}function tp(e){return e=e[Hs]||e[Eo],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function lu(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Re(33))}function Um(e){return e[Bd]||null}var X_=[],cu=-1;function Za(e){return{current:e}}function hn(e){0>cu||(e.current=X_[cu],X_[cu]=null,cu--)}function on(e,t){cu++,X_[cu]=e.current,e.current=t}var ja={},Ri=Za(ja),fr=Za(!1),Zl=ja;function Eu(e,t){var n=e.type.contextTypes;if(!n)return ja;var s=e.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===t)return s.__reactInternalMemoizedMaskedChildContext;var a={},u;for(u in n)a[u]=t[u];return s&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function mr(e){return e=e.childContextTypes,e!=null}function om(){hn(fr),hn(Ri)}function vw(e,t,n){if(Ri.current!==ja)throw Error(Re(168));on(Ri,t),on(fr,n)}function kk(e,t,n){var s=e.stateNode;if(t=t.childContextTypes,typeof s.getChildContext!="function")return n;s=s.getChildContext();for(var a in s)if(!(a in t))throw Error(Re(108,QE(e)||"Unknown",a));return bn({},n,s)}function am(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||ja,Zl=Ri.current,on(Ri,e),on(fr,fr.current),!0}function xw(e,t,n){var s=e.stateNode;if(!s)throw Error(Re(169));n?(e=kk(e,t,Zl),s.__reactInternalMemoizedMergedChildContext=e,hn(fr),hn(Ri),on(Ri,e)):hn(fr),on(fr,n)}var bo=null,qm=!1,Hy=!1;function Tk(e){bo===null?bo=[e]:bo.push(e)}function gP(e){qm=!0,Tk(e)}function Wa(){if(!Hy&&bo!==null){Hy=!0;var e=0,t=Jt;try{var n=bo;for(Jt=1;e<n.length;e++){var s=n[e];do s=s(!0);while(s!==null)}bo=null,qm=!1}catch(a){throw bo!==null&&(bo=bo.slice(e+1)),XS(W0,Wa),a}finally{Jt=t,Hy=!1}}return null}var uu=[],hu=0,lm=null,cm=0,ts=[],ns=0,Wl=null,So=1,ko="";function Il(e,t){uu[hu++]=cm,uu[hu++]=lm,lm=e,cm=t}function Ck(e,t,n){ts[ns++]=So,ts[ns++]=ko,ts[ns++]=Wl,Wl=e;var s=So;e=ko;var a=32-ks(s)-1;s&=~(1<<a),n+=1;var u=32-ks(t)+a;if(30<u){var d=a-a%5;u=(s&(1<<d)-1).toString(32),s>>=d,a-=d,So=1<<32-ks(t)+a|n<<a|s,ko=u+e}else So=1<<u|n<<a|s,ko=e}function nv(e){e.return!==null&&(Il(e,1),Ck(e,1,0))}function iv(e){for(;e===lm;)lm=uu[--hu],uu[hu]=null,cm=uu[--hu],uu[hu]=null;for(;e===Wl;)Wl=ts[--ns],ts[ns]=null,ko=ts[--ns],ts[ns]=null,So=ts[--ns],ts[ns]=null}var Nr=null,Br=null,yn=!1,ws=null;function Mk(e,t){var n=rs(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function ww(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Nr=e,Br=Aa(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Nr=e,Br=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=Wl!==null?{id:So,overflow:ko}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=rs(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,Nr=e,Br=null,!0):!1;default:return!1}}function J_(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Y_(e){if(yn){var t=Br;if(t){var n=t;if(!ww(e,t)){if(J_(e))throw Error(Re(418));t=Aa(n.nextSibling);var s=Nr;t&&ww(e,t)?Mk(s,n):(e.flags=e.flags&-4097|2,yn=!1,Nr=e)}}else{if(J_(e))throw Error(Re(418));e.flags=e.flags&-4097|2,yn=!1,Nr=e}}}function bw(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Nr=e}function xf(e){if(e!==Nr)return!1;if(!yn)return bw(e),yn=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!W_(e.type,e.memoizedProps)),t&&(t=Br)){if(J_(e))throw Ek(),Error(Re(418));for(;t;)Mk(e,t),t=Aa(t.nextSibling)}if(bw(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Re(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){Br=Aa(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}Br=null}}else Br=Nr?Aa(e.stateNode.nextSibling):null;return!0}function Ek(){for(var e=Br;e;)e=Aa(e.nextSibling)}function Iu(){Br=Nr=null,yn=!1}function rv(e){ws===null?ws=[e]:ws.push(e)}var yP=Ao.ReactCurrentBatchConfig;function id(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Re(309));var s=n.stateNode}if(!s)throw Error(Re(147,e));var a=s,u=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===u?t.ref:(t=function(d){var c=a.refs;d===null?delete c[u]:c[u]=d},t._stringRef=u,t)}if(typeof e!="string")throw Error(Re(284));if(!n._owner)throw Error(Re(290,e))}return e}function wf(e,t){throw e=Object.prototype.toString.call(t),Error(Re(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Sw(e){var t=e._init;return t(e._payload)}function Ik(e){function t(K,J){if(e){var le=K.deletions;le===null?(K.deletions=[J],K.flags|=16):le.push(J)}}function n(K,J){if(!e)return null;for(;J!==null;)t(K,J),J=J.sibling;return null}function s(K,J){for(K=new Map;J!==null;)J.key!==null?K.set(J.key,J):K.set(J.index,J),J=J.sibling;return K}function a(K,J){return K=Oa(K,J),K.index=0,K.sibling=null,K}function u(K,J,le){return K.index=le,e?(le=K.alternate,le!==null?(le=le.index,le<J?(K.flags|=2,J):le):(K.flags|=2,J)):(K.flags|=1048576,J)}function d(K){return e&&K.alternate===null&&(K.flags|=2),K}function c(K,J,le,Se){return J===null||J.tag!==6?(J=Yy(le,K.mode,Se),J.return=K,J):(J=a(J,le),J.return=K,J)}function w(K,J,le,Se){var Me=le.type;return Me===ru?E(K,J,le.props.children,Se,le.key):J!==null&&(J.elementType===Me||typeof Me=="object"&&Me!==null&&Me.$$typeof===ga&&Sw(Me)===J.type)?(Se=a(J,le.props),Se.ref=id(K,J,le),Se.return=K,Se):(Se=Hf(le.type,le.key,le.props,null,K.mode,Se),Se.ref=id(K,J,le),Se.return=K,Se)}function k(K,J,le,Se){return J===null||J.tag!==4||J.stateNode.containerInfo!==le.containerInfo||J.stateNode.implementation!==le.implementation?(J=Qy(le,K.mode,Se),J.return=K,J):(J=a(J,le.children||[]),J.return=K,J)}function E(K,J,le,Se,Me){return J===null||J.tag!==7?(J=Vl(le,K.mode,Se,Me),J.return=K,J):(J=a(J,le),J.return=K,J)}function P(K,J,le){if(typeof J=="string"&&J!==""||typeof J=="number")return J=Yy(""+J,K.mode,le),J.return=K,J;if(typeof J=="object"&&J!==null){switch(J.$$typeof){case uf:return le=Hf(J.type,J.key,J.props,null,K.mode,le),le.ref=id(K,null,J),le.return=K,le;case iu:return J=Qy(J,K.mode,le),J.return=K,J;case ga:var Se=J._init;return P(K,Se(J._payload),le)}if(ld(J)||Yh(J))return J=Vl(J,K.mode,le,null),J.return=K,J;wf(K,J)}return null}function A(K,J,le,Se){var Me=J!==null?J.key:null;if(typeof le=="string"&&le!==""||typeof le=="number")return Me!==null?null:c(K,J,""+le,Se);if(typeof le=="object"&&le!==null){switch(le.$$typeof){case uf:return le.key===Me?w(K,J,le,Se):null;case iu:return le.key===Me?k(K,J,le,Se):null;case ga:return Me=le._init,A(K,J,Me(le._payload),Se)}if(ld(le)||Yh(le))return Me!==null?null:E(K,J,le,Se,null);wf(K,le)}return null}function $(K,J,le,Se,Me){if(typeof Se=="string"&&Se!==""||typeof Se=="number")return K=K.get(le)||null,c(J,K,""+Se,Me);if(typeof Se=="object"&&Se!==null){switch(Se.$$typeof){case uf:return K=K.get(Se.key===null?le:Se.key)||null,w(J,K,Se,Me);case iu:return K=K.get(Se.key===null?le:Se.key)||null,k(J,K,Se,Me);case ga:var Ee=Se._init;return $(K,J,le,Ee(Se._payload),Me)}if(ld(Se)||Yh(Se))return K=K.get(le)||null,E(J,K,Se,Me,null);wf(J,Se)}return null}function j(K,J,le,Se){for(var Me=null,Ee=null,De=J,Ze=J=0,tt=null;De!==null&&Ze<le.length;Ze++){De.index>Ze?(tt=De,De=null):tt=De.sibling;var ft=A(K,De,le[Ze],Se);if(ft===null){De===null&&(De=tt);break}e&&De&&ft.alternate===null&&t(K,De),J=u(ft,J,Ze),Ee===null?Me=ft:Ee.sibling=ft,Ee=ft,De=tt}if(Ze===le.length)return n(K,De),yn&&Il(K,Ze),Me;if(De===null){for(;Ze<le.length;Ze++)De=P(K,le[Ze],Se),De!==null&&(J=u(De,J,Ze),Ee===null?Me=De:Ee.sibling=De,Ee=De);return yn&&Il(K,Ze),Me}for(De=s(K,De);Ze<le.length;Ze++)tt=$(De,K,Ze,le[Ze],Se),tt!==null&&(e&&tt.alternate!==null&&De.delete(tt.key===null?Ze:tt.key),J=u(tt,J,Ze),Ee===null?Me=tt:Ee.sibling=tt,Ee=tt);return e&&De.forEach(function(xt){return t(K,xt)}),yn&&Il(K,Ze),Me}function X(K,J,le,Se){var Me=Yh(le);if(typeof Me!="function")throw Error(Re(150));if(le=Me.call(le),le==null)throw Error(Re(151));for(var Ee=Me=null,De=J,Ze=J=0,tt=null,ft=le.next();De!==null&&!ft.done;Ze++,ft=le.next()){De.index>Ze?(tt=De,De=null):tt=De.sibling;var xt=A(K,De,ft.value,Se);if(xt===null){De===null&&(De=tt);break}e&&De&&xt.alternate===null&&t(K,De),J=u(xt,J,Ze),Ee===null?Me=xt:Ee.sibling=xt,Ee=xt,De=tt}if(ft.done)return n(K,De),yn&&Il(K,Ze),Me;if(De===null){for(;!ft.done;Ze++,ft=le.next())ft=P(K,ft.value,Se),ft!==null&&(J=u(ft,J,Ze),Ee===null?Me=ft:Ee.sibling=ft,Ee=ft);return yn&&Il(K,Ze),Me}for(De=s(K,De);!ft.done;Ze++,ft=le.next())ft=$(De,K,Ze,ft.value,Se),ft!==null&&(e&&ft.alternate!==null&&De.delete(ft.key===null?Ze:ft.key),J=u(ft,J,Ze),Ee===null?Me=ft:Ee.sibling=ft,Ee=ft);return e&&De.forEach(function(tr){return t(K,tr)}),yn&&Il(K,Ze),Me}function he(K,J,le,Se){if(typeof le=="object"&&le!==null&&le.type===ru&&le.key===null&&(le=le.props.children),typeof le=="object"&&le!==null){switch(le.$$typeof){case uf:e:{for(var Me=le.key,Ee=J;Ee!==null;){if(Ee.key===Me){if(Me=le.type,Me===ru){if(Ee.tag===7){n(K,Ee.sibling),J=a(Ee,le.props.children),J.return=K,K=J;break e}}else if(Ee.elementType===Me||typeof Me=="object"&&Me!==null&&Me.$$typeof===ga&&Sw(Me)===Ee.type){n(K,Ee.sibling),J=a(Ee,le.props),J.ref=id(K,Ee,le),J.return=K,K=J;break e}n(K,Ee);break}else t(K,Ee);Ee=Ee.sibling}le.type===ru?(J=Vl(le.props.children,K.mode,Se,le.key),J.return=K,K=J):(Se=Hf(le.type,le.key,le.props,null,K.mode,Se),Se.ref=id(K,J,le),Se.return=K,K=Se)}return d(K);case iu:e:{for(Ee=le.key;J!==null;){if(J.key===Ee)if(J.tag===4&&J.stateNode.containerInfo===le.containerInfo&&J.stateNode.implementation===le.implementation){n(K,J.sibling),J=a(J,le.children||[]),J.return=K,K=J;break e}else{n(K,J);break}else t(K,J);J=J.sibling}J=Qy(le,K.mode,Se),J.return=K,K=J}return d(K);case ga:return Ee=le._init,he(K,J,Ee(le._payload),Se)}if(ld(le))return j(K,J,le,Se);if(Yh(le))return X(K,J,le,Se);wf(K,le)}return typeof le=="string"&&le!==""||typeof le=="number"?(le=""+le,J!==null&&J.tag===6?(n(K,J.sibling),J=a(J,le),J.return=K,K=J):(n(K,J),J=Yy(le,K.mode,Se),J.return=K,K=J),d(K)):n(K,J)}return he}var Pu=Ik(!0),Pk=Ik(!1),um=Za(null),hm=null,du=null,sv=null;function ov(){sv=du=hm=null}function av(e){var t=um.current;hn(um),e._currentValue=t}function Q_(e,t,n){for(;e!==null;){var s=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,s!==null&&(s.childLanes|=t)):s!==null&&(s.childLanes&t)!==t&&(s.childLanes|=t),e===n)break;e=e.return}}function wu(e,t){hm=e,sv=du=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(pr=!0),e.firstContext=null)}function ls(e){var t=e._currentValue;if(sv!==e)if(e={context:e,memoizedValue:t,next:null},du===null){if(hm===null)throw Error(Re(308));du=e,hm.dependencies={lanes:0,firstContext:e}}else du=du.next=e;return t}var Rl=null;function lv(e){Rl===null?Rl=[e]:Rl.push(e)}function Ak(e,t,n,s){var a=t.interleaved;return a===null?(n.next=n,lv(t)):(n.next=a.next,a.next=n),t.interleaved=n,Io(e,s)}function Io(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var ya=!1;function cv(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function zk(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function To(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function za(e,t,n){var s=e.updateQueue;if(s===null)return null;if(s=s.shared,$t&2){var a=s.pending;return a===null?t.next=t:(t.next=a.next,a.next=t),s.pending=t,Io(e,n)}return a=s.interleaved,a===null?(t.next=t,lv(s)):(t.next=a.next,a.next=t),s.interleaved=t,Io(e,n)}function Nf(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var s=t.lanes;s&=e.pendingLanes,n|=s,t.lanes=n,G0(e,n)}}function kw(e,t){var n=e.updateQueue,s=e.alternate;if(s!==null&&(s=s.updateQueue,n===s)){var a=null,u=null;if(n=n.firstBaseUpdate,n!==null){do{var d={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};u===null?a=u=d:u=u.next=d,n=n.next}while(n!==null);u===null?a=u=t:u=u.next=t}else a=u=t;n={baseState:s.baseState,firstBaseUpdate:a,lastBaseUpdate:u,shared:s.shared,effects:s.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function dm(e,t,n,s){var a=e.updateQueue;ya=!1;var u=a.firstBaseUpdate,d=a.lastBaseUpdate,c=a.shared.pending;if(c!==null){a.shared.pending=null;var w=c,k=w.next;w.next=null,d===null?u=k:d.next=k,d=w;var E=e.alternate;E!==null&&(E=E.updateQueue,c=E.lastBaseUpdate,c!==d&&(c===null?E.firstBaseUpdate=k:c.next=k,E.lastBaseUpdate=w))}if(u!==null){var P=a.baseState;d=0,E=k=w=null,c=u;do{var A=c.lane,$=c.eventTime;if((s&A)===A){E!==null&&(E=E.next={eventTime:$,lane:0,tag:c.tag,payload:c.payload,callback:c.callback,next:null});e:{var j=e,X=c;switch(A=t,$=n,X.tag){case 1:if(j=X.payload,typeof j=="function"){P=j.call($,P,A);break e}P=j;break e;case 3:j.flags=j.flags&-65537|128;case 0:if(j=X.payload,A=typeof j=="function"?j.call($,P,A):j,A==null)break e;P=bn({},P,A);break e;case 2:ya=!0}}c.callback!==null&&c.lane!==0&&(e.flags|=64,A=a.effects,A===null?a.effects=[c]:A.push(c))}else $={eventTime:$,lane:A,tag:c.tag,payload:c.payload,callback:c.callback,next:null},E===null?(k=E=$,w=P):E=E.next=$,d|=A;if(c=c.next,c===null){if(c=a.shared.pending,c===null)break;A=c,c=A.next,A.next=null,a.lastBaseUpdate=A,a.shared.pending=null}}while(!0);if(E===null&&(w=P),a.baseState=w,a.firstBaseUpdate=k,a.lastBaseUpdate=E,t=a.shared.interleaved,t!==null){a=t;do d|=a.lane,a=a.next;while(a!==t)}else u===null&&(a.shared.lanes=0);Kl|=d,e.lanes=d,e.memoizedState=P}}function Tw(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var s=e[t],a=s.callback;if(a!==null){if(s.callback=null,s=n,typeof a!="function")throw Error(Re(191,a));a.call(s)}}}var np={},Gs=Za(np),Fd=Za(np),Nd=Za(np);function Ol(e){if(e===np)throw Error(Re(174));return e}function uv(e,t){switch(on(Nd,t),on(Fd,e),on(Gs,np),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:D_(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=D_(t,e)}hn(Gs),on(Gs,t)}function Au(){hn(Gs),hn(Fd),hn(Nd)}function Dk(e){Ol(Nd.current);var t=Ol(Gs.current),n=D_(t,e.type);t!==n&&(on(Fd,e),on(Gs,n))}function hv(e){Fd.current===e&&(hn(Gs),hn(Fd))}var xn=Za(0);function pm(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Zy=[];function dv(){for(var e=0;e<Zy.length;e++)Zy[e]._workInProgressVersionPrimary=null;Zy.length=0}var Vf=Ao.ReactCurrentDispatcher,Wy=Ao.ReactCurrentBatchConfig,Gl=0,wn=null,jn=null,Qn=null,fm=!1,vd=!1,Vd=0,_P=0;function Ii(){throw Error(Re(321))}function pv(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Ms(e[n],t[n]))return!1;return!0}function fv(e,t,n,s,a,u){if(Gl=u,wn=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Vf.current=e===null||e.memoizedState===null?bP:SP,e=n(s,a),vd){u=0;do{if(vd=!1,Vd=0,25<=u)throw Error(Re(301));u+=1,Qn=jn=null,t.updateQueue=null,Vf.current=kP,e=n(s,a)}while(vd)}if(Vf.current=mm,t=jn!==null&&jn.next!==null,Gl=0,Qn=jn=wn=null,fm=!1,t)throw Error(Re(300));return e}function mv(){var e=Vd!==0;return Vd=0,e}function Us(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Qn===null?wn.memoizedState=Qn=e:Qn=Qn.next=e,Qn}function cs(){if(jn===null){var e=wn.alternate;e=e!==null?e.memoizedState:null}else e=jn.next;var t=Qn===null?wn.memoizedState:Qn.next;if(t!==null)Qn=t,jn=e;else{if(e===null)throw Error(Re(310));jn=e,e={memoizedState:jn.memoizedState,baseState:jn.baseState,baseQueue:jn.baseQueue,queue:jn.queue,next:null},Qn===null?wn.memoizedState=Qn=e:Qn=Qn.next=e}return Qn}function $d(e,t){return typeof t=="function"?t(e):t}function Gy(e){var t=cs(),n=t.queue;if(n===null)throw Error(Re(311));n.lastRenderedReducer=e;var s=jn,a=s.baseQueue,u=n.pending;if(u!==null){if(a!==null){var d=a.next;a.next=u.next,u.next=d}s.baseQueue=a=u,n.pending=null}if(a!==null){u=a.next,s=s.baseState;var c=d=null,w=null,k=u;do{var E=k.lane;if((Gl&E)===E)w!==null&&(w=w.next={lane:0,action:k.action,hasEagerState:k.hasEagerState,eagerState:k.eagerState,next:null}),s=k.hasEagerState?k.eagerState:e(s,k.action);else{var P={lane:E,action:k.action,hasEagerState:k.hasEagerState,eagerState:k.eagerState,next:null};w===null?(c=w=P,d=s):w=w.next=P,wn.lanes|=E,Kl|=E}k=k.next}while(k!==null&&k!==u);w===null?d=s:w.next=c,Ms(s,t.memoizedState)||(pr=!0),t.memoizedState=s,t.baseState=d,t.baseQueue=w,n.lastRenderedState=s}if(e=n.interleaved,e!==null){a=e;do u=a.lane,wn.lanes|=u,Kl|=u,a=a.next;while(a!==e)}else a===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Ky(e){var t=cs(),n=t.queue;if(n===null)throw Error(Re(311));n.lastRenderedReducer=e;var s=n.dispatch,a=n.pending,u=t.memoizedState;if(a!==null){n.pending=null;var d=a=a.next;do u=e(u,d.action),d=d.next;while(d!==a);Ms(u,t.memoizedState)||(pr=!0),t.memoizedState=u,t.baseQueue===null&&(t.baseState=u),n.lastRenderedState=u}return[u,s]}function Rk(){}function Ok(e,t){var n=wn,s=cs(),a=t(),u=!Ms(s.memoizedState,a);if(u&&(s.memoizedState=a,pr=!0),s=s.queue,gv(Fk.bind(null,n,s,e),[e]),s.getSnapshot!==t||u||Qn!==null&&Qn.memoizedState.tag&1){if(n.flags|=2048,jd(9,Bk.bind(null,n,s,a,t),void 0,null),ti===null)throw Error(Re(349));Gl&30||Lk(n,t,a)}return a}function Lk(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=wn.updateQueue,t===null?(t={lastEffect:null,stores:null},wn.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function Bk(e,t,n,s){t.value=n,t.getSnapshot=s,Nk(t)&&Vk(e)}function Fk(e,t,n){return n(function(){Nk(t)&&Vk(e)})}function Nk(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Ms(e,n)}catch{return!0}}function Vk(e){var t=Io(e,1);t!==null&&Ts(t,e,1,-1)}function Cw(e){var t=Us();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:$d,lastRenderedState:e},t.queue=e,e=e.dispatch=wP.bind(null,wn,e),[t.memoizedState,e]}function jd(e,t,n,s){return e={tag:e,create:t,destroy:n,deps:s,next:null},t=wn.updateQueue,t===null?(t={lastEffect:null,stores:null},wn.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(s=n.next,n.next=e,e.next=s,t.lastEffect=e)),e}function $k(){return cs().memoizedState}function $f(e,t,n,s){var a=Us();wn.flags|=e,a.memoizedState=jd(1|t,n,void 0,s===void 0?null:s)}function Hm(e,t,n,s){var a=cs();s=s===void 0?null:s;var u=void 0;if(jn!==null){var d=jn.memoizedState;if(u=d.destroy,s!==null&&pv(s,d.deps)){a.memoizedState=jd(t,n,u,s);return}}wn.flags|=e,a.memoizedState=jd(1|t,n,u,s)}function Mw(e,t){return $f(8390656,8,e,t)}function gv(e,t){return Hm(2048,8,e,t)}function jk(e,t){return Hm(4,2,e,t)}function Uk(e,t){return Hm(4,4,e,t)}function qk(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Hk(e,t,n){return n=n!=null?n.concat([e]):null,Hm(4,4,qk.bind(null,t,e),n)}function yv(){}function Zk(e,t){var n=cs();t=t===void 0?null:t;var s=n.memoizedState;return s!==null&&t!==null&&pv(t,s[1])?s[0]:(n.memoizedState=[e,t],e)}function Wk(e,t){var n=cs();t=t===void 0?null:t;var s=n.memoizedState;return s!==null&&t!==null&&pv(t,s[1])?s[0]:(e=e(),n.memoizedState=[e,t],e)}function Gk(e,t,n){return Gl&21?(Ms(n,t)||(n=QS(),wn.lanes|=n,Kl|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,pr=!0),e.memoizedState=n)}function vP(e,t){var n=Jt;Jt=n!==0&&4>n?n:4,e(!0);var s=Wy.transition;Wy.transition={};try{e(!1),t()}finally{Jt=n,Wy.transition=s}}function Kk(){return cs().memoizedState}function xP(e,t,n){var s=Ra(e);if(n={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null},Xk(e))Jk(t,n);else if(n=Ak(e,t,n,s),n!==null){var a=Wi();Ts(n,e,s,a),Yk(n,t,s)}}function wP(e,t,n){var s=Ra(e),a={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null};if(Xk(e))Jk(t,a);else{var u=e.alternate;if(e.lanes===0&&(u===null||u.lanes===0)&&(u=t.lastRenderedReducer,u!==null))try{var d=t.lastRenderedState,c=u(d,n);if(a.hasEagerState=!0,a.eagerState=c,Ms(c,d)){var w=t.interleaved;w===null?(a.next=a,lv(t)):(a.next=w.next,w.next=a),t.interleaved=a;return}}catch{}finally{}n=Ak(e,t,a,s),n!==null&&(a=Wi(),Ts(n,e,s,a),Yk(n,t,s))}}function Xk(e){var t=e.alternate;return e===wn||t!==null&&t===wn}function Jk(e,t){vd=fm=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Yk(e,t,n){if(n&4194240){var s=t.lanes;s&=e.pendingLanes,n|=s,t.lanes=n,G0(e,n)}}var mm={readContext:ls,useCallback:Ii,useContext:Ii,useEffect:Ii,useImperativeHandle:Ii,useInsertionEffect:Ii,useLayoutEffect:Ii,useMemo:Ii,useReducer:Ii,useRef:Ii,useState:Ii,useDebugValue:Ii,useDeferredValue:Ii,useTransition:Ii,useMutableSource:Ii,useSyncExternalStore:Ii,useId:Ii,unstable_isNewReconciler:!1},bP={readContext:ls,useCallback:function(e,t){return Us().memoizedState=[e,t===void 0?null:t],e},useContext:ls,useEffect:Mw,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,$f(4194308,4,qk.bind(null,t,e),n)},useLayoutEffect:function(e,t){return $f(4194308,4,e,t)},useInsertionEffect:function(e,t){return $f(4,2,e,t)},useMemo:function(e,t){var n=Us();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var s=Us();return t=n!==void 0?n(t):t,s.memoizedState=s.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},s.queue=e,e=e.dispatch=xP.bind(null,wn,e),[s.memoizedState,e]},useRef:function(e){var t=Us();return e={current:e},t.memoizedState=e},useState:Cw,useDebugValue:yv,useDeferredValue:function(e){return Us().memoizedState=e},useTransition:function(){var e=Cw(!1),t=e[0];return e=vP.bind(null,e[1]),Us().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var s=wn,a=Us();if(yn){if(n===void 0)throw Error(Re(407));n=n()}else{if(n=t(),ti===null)throw Error(Re(349));Gl&30||Lk(s,t,n)}a.memoizedState=n;var u={value:n,getSnapshot:t};return a.queue=u,Mw(Fk.bind(null,s,u,e),[e]),s.flags|=2048,jd(9,Bk.bind(null,s,u,n,t),void 0,null),n},useId:function(){var e=Us(),t=ti.identifierPrefix;if(yn){var n=ko,s=So;n=(s&~(1<<32-ks(s)-1)).toString(32)+n,t=":"+t+"R"+n,n=Vd++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=_P++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},SP={readContext:ls,useCallback:Zk,useContext:ls,useEffect:gv,useImperativeHandle:Hk,useInsertionEffect:jk,useLayoutEffect:Uk,useMemo:Wk,useReducer:Gy,useRef:$k,useState:function(){return Gy($d)},useDebugValue:yv,useDeferredValue:function(e){var t=cs();return Gk(t,jn.memoizedState,e)},useTransition:function(){var e=Gy($d)[0],t=cs().memoizedState;return[e,t]},useMutableSource:Rk,useSyncExternalStore:Ok,useId:Kk,unstable_isNewReconciler:!1},kP={readContext:ls,useCallback:Zk,useContext:ls,useEffect:gv,useImperativeHandle:Hk,useInsertionEffect:jk,useLayoutEffect:Uk,useMemo:Wk,useReducer:Ky,useRef:$k,useState:function(){return Ky($d)},useDebugValue:yv,useDeferredValue:function(e){var t=cs();return jn===null?t.memoizedState=e:Gk(t,jn.memoizedState,e)},useTransition:function(){var e=Ky($d)[0],t=cs().memoizedState;return[e,t]},useMutableSource:Rk,useSyncExternalStore:Ok,useId:Kk,unstable_isNewReconciler:!1};function vs(e,t){if(e&&e.defaultProps){t=bn({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function e0(e,t,n,s){t=e.memoizedState,n=n(s,t),n=n==null?t:bn({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var Zm={isMounted:function(e){return(e=e._reactInternals)?tc(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var s=Wi(),a=Ra(e),u=To(s,a);u.payload=t,n!=null&&(u.callback=n),t=za(e,u,a),t!==null&&(Ts(t,e,a,s),Nf(t,e,a))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var s=Wi(),a=Ra(e),u=To(s,a);u.tag=1,u.payload=t,n!=null&&(u.callback=n),t=za(e,u,a),t!==null&&(Ts(t,e,a,s),Nf(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Wi(),s=Ra(e),a=To(n,s);a.tag=2,t!=null&&(a.callback=t),t=za(e,a,s),t!==null&&(Ts(t,e,s,n),Nf(t,e,s))}};function Ew(e,t,n,s,a,u,d){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(s,u,d):t.prototype&&t.prototype.isPureReactComponent?!Rd(n,s)||!Rd(a,u):!0}function Qk(e,t,n){var s=!1,a=ja,u=t.contextType;return typeof u=="object"&&u!==null?u=ls(u):(a=mr(t)?Zl:Ri.current,s=t.contextTypes,u=(s=s!=null)?Eu(e,a):ja),t=new t(n,u),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Zm,e.stateNode=t,t._reactInternals=e,s&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=u),t}function Iw(e,t,n,s){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,s),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,s),t.state!==e&&Zm.enqueueReplaceState(t,t.state,null)}function t0(e,t,n,s){var a=e.stateNode;a.props=n,a.state=e.memoizedState,a.refs={},cv(e);var u=t.contextType;typeof u=="object"&&u!==null?a.context=ls(u):(u=mr(t)?Zl:Ri.current,a.context=Eu(e,u)),a.state=e.memoizedState,u=t.getDerivedStateFromProps,typeof u=="function"&&(e0(e,t,u,n),a.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof a.getSnapshotBeforeUpdate=="function"||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(t=a.state,typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount(),t!==a.state&&Zm.enqueueReplaceState(a,a.state,null),dm(e,n,a,s),a.state=e.memoizedState),typeof a.componentDidMount=="function"&&(e.flags|=4194308)}function zu(e,t){try{var n="",s=t;do n+=YE(s),s=s.return;while(s);var a=n}catch(u){a=`
Error generating stack: `+u.message+`
`+u.stack}return{value:e,source:t,stack:a,digest:null}}function Xy(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function n0(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var TP=typeof WeakMap=="function"?WeakMap:Map;function e2(e,t,n){n=To(-1,n),n.tag=3,n.payload={element:null};var s=t.value;return n.callback=function(){ym||(ym=!0,d0=s),n0(e,t)},n}function t2(e,t,n){n=To(-1,n),n.tag=3;var s=e.type.getDerivedStateFromError;if(typeof s=="function"){var a=t.value;n.payload=function(){return s(a)},n.callback=function(){n0(e,t)}}var u=e.stateNode;return u!==null&&typeof u.componentDidCatch=="function"&&(n.callback=function(){n0(e,t),typeof s!="function"&&(Da===null?Da=new Set([this]):Da.add(this));var d=t.stack;this.componentDidCatch(t.value,{componentStack:d!==null?d:""})}),n}function Pw(e,t,n){var s=e.pingCache;if(s===null){s=e.pingCache=new TP;var a=new Set;s.set(t,a)}else a=s.get(t),a===void 0&&(a=new Set,s.set(t,a));a.has(n)||(a.add(n),e=NP.bind(null,e,t,n),t.then(e,e))}function Aw(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function zw(e,t,n,s,a){return e.mode&1?(e.flags|=65536,e.lanes=a,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=To(-1,1),t.tag=2,za(n,t,1))),n.lanes|=1),e)}var CP=Ao.ReactCurrentOwner,pr=!1;function Hi(e,t,n,s){t.child=e===null?Pk(t,null,n,s):Pu(t,e.child,n,s)}function Dw(e,t,n,s,a){n=n.render;var u=t.ref;return wu(t,a),s=fv(e,t,n,s,u,a),n=mv(),e!==null&&!pr?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Po(e,t,a)):(yn&&n&&nv(t),t.flags|=1,Hi(e,t,s,a),t.child)}function Rw(e,t,n,s,a){if(e===null){var u=n.type;return typeof u=="function"&&!Tv(u)&&u.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=u,n2(e,t,u,s,a)):(e=Hf(n.type,null,s,t,t.mode,a),e.ref=t.ref,e.return=t,t.child=e)}if(u=e.child,!(e.lanes&a)){var d=u.memoizedProps;if(n=n.compare,n=n!==null?n:Rd,n(d,s)&&e.ref===t.ref)return Po(e,t,a)}return t.flags|=1,e=Oa(u,s),e.ref=t.ref,e.return=t,t.child=e}function n2(e,t,n,s,a){if(e!==null){var u=e.memoizedProps;if(Rd(u,s)&&e.ref===t.ref)if(pr=!1,t.pendingProps=s=u,(e.lanes&a)!==0)e.flags&131072&&(pr=!0);else return t.lanes=e.lanes,Po(e,t,a)}return i0(e,t,n,s,a)}function i2(e,t,n){var s=t.pendingProps,a=s.children,u=e!==null?e.memoizedState:null;if(s.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},on(fu,Or),Or|=n;else{if(!(n&1073741824))return e=u!==null?u.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,on(fu,Or),Or|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=u!==null?u.baseLanes:n,on(fu,Or),Or|=s}else u!==null?(s=u.baseLanes|n,t.memoizedState=null):s=n,on(fu,Or),Or|=s;return Hi(e,t,a,n),t.child}function r2(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function i0(e,t,n,s,a){var u=mr(n)?Zl:Ri.current;return u=Eu(t,u),wu(t,a),n=fv(e,t,n,s,u,a),s=mv(),e!==null&&!pr?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Po(e,t,a)):(yn&&s&&nv(t),t.flags|=1,Hi(e,t,n,a),t.child)}function Ow(e,t,n,s,a){if(mr(n)){var u=!0;am(t)}else u=!1;if(wu(t,a),t.stateNode===null)jf(e,t),Qk(t,n,s),t0(t,n,s,a),s=!0;else if(e===null){var d=t.stateNode,c=t.memoizedProps;d.props=c;var w=d.context,k=n.contextType;typeof k=="object"&&k!==null?k=ls(k):(k=mr(n)?Zl:Ri.current,k=Eu(t,k));var E=n.getDerivedStateFromProps,P=typeof E=="function"||typeof d.getSnapshotBeforeUpdate=="function";P||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(c!==s||w!==k)&&Iw(t,d,s,k),ya=!1;var A=t.memoizedState;d.state=A,dm(t,s,d,a),w=t.memoizedState,c!==s||A!==w||fr.current||ya?(typeof E=="function"&&(e0(t,n,E,s),w=t.memoizedState),(c=ya||Ew(t,n,c,s,A,w,k))?(P||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount()),typeof d.componentDidMount=="function"&&(t.flags|=4194308)):(typeof d.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=s,t.memoizedState=w),d.props=s,d.state=w,d.context=k,s=c):(typeof d.componentDidMount=="function"&&(t.flags|=4194308),s=!1)}else{d=t.stateNode,zk(e,t),c=t.memoizedProps,k=t.type===t.elementType?c:vs(t.type,c),d.props=k,P=t.pendingProps,A=d.context,w=n.contextType,typeof w=="object"&&w!==null?w=ls(w):(w=mr(n)?Zl:Ri.current,w=Eu(t,w));var $=n.getDerivedStateFromProps;(E=typeof $=="function"||typeof d.getSnapshotBeforeUpdate=="function")||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(c!==P||A!==w)&&Iw(t,d,s,w),ya=!1,A=t.memoizedState,d.state=A,dm(t,s,d,a);var j=t.memoizedState;c!==P||A!==j||fr.current||ya?(typeof $=="function"&&(e0(t,n,$,s),j=t.memoizedState),(k=ya||Ew(t,n,k,s,A,j,w)||!1)?(E||typeof d.UNSAFE_componentWillUpdate!="function"&&typeof d.componentWillUpdate!="function"||(typeof d.componentWillUpdate=="function"&&d.componentWillUpdate(s,j,w),typeof d.UNSAFE_componentWillUpdate=="function"&&d.UNSAFE_componentWillUpdate(s,j,w)),typeof d.componentDidUpdate=="function"&&(t.flags|=4),typeof d.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof d.componentDidUpdate!="function"||c===e.memoizedProps&&A===e.memoizedState||(t.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||c===e.memoizedProps&&A===e.memoizedState||(t.flags|=1024),t.memoizedProps=s,t.memoizedState=j),d.props=s,d.state=j,d.context=w,s=k):(typeof d.componentDidUpdate!="function"||c===e.memoizedProps&&A===e.memoizedState||(t.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||c===e.memoizedProps&&A===e.memoizedState||(t.flags|=1024),s=!1)}return r0(e,t,n,s,u,a)}function r0(e,t,n,s,a,u){r2(e,t);var d=(t.flags&128)!==0;if(!s&&!d)return a&&xw(t,n,!1),Po(e,t,u);s=t.stateNode,CP.current=t;var c=d&&typeof n.getDerivedStateFromError!="function"?null:s.render();return t.flags|=1,e!==null&&d?(t.child=Pu(t,e.child,null,u),t.child=Pu(t,null,c,u)):Hi(e,t,c,u),t.memoizedState=s.state,a&&xw(t,n,!0),t.child}function s2(e){var t=e.stateNode;t.pendingContext?vw(e,t.pendingContext,t.pendingContext!==t.context):t.context&&vw(e,t.context,!1),uv(e,t.containerInfo)}function Lw(e,t,n,s,a){return Iu(),rv(a),t.flags|=256,Hi(e,t,n,s),t.child}var s0={dehydrated:null,treeContext:null,retryLane:0};function o0(e){return{baseLanes:e,cachePool:null,transitions:null}}function o2(e,t,n){var s=t.pendingProps,a=xn.current,u=!1,d=(t.flags&128)!==0,c;if((c=d)||(c=e!==null&&e.memoizedState===null?!1:(a&2)!==0),c?(u=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(a|=1),on(xn,a&1),e===null)return Y_(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(d=s.children,e=s.fallback,u?(s=t.mode,u=t.child,d={mode:"hidden",children:d},!(s&1)&&u!==null?(u.childLanes=0,u.pendingProps=d):u=Km(d,s,0,null),e=Vl(e,s,n,null),u.return=t,e.return=t,u.sibling=e,t.child=u,t.child.memoizedState=o0(n),t.memoizedState=s0,e):_v(t,d));if(a=e.memoizedState,a!==null&&(c=a.dehydrated,c!==null))return MP(e,t,d,s,c,a,n);if(u){u=s.fallback,d=t.mode,a=e.child,c=a.sibling;var w={mode:"hidden",children:s.children};return!(d&1)&&t.child!==a?(s=t.child,s.childLanes=0,s.pendingProps=w,t.deletions=null):(s=Oa(a,w),s.subtreeFlags=a.subtreeFlags&14680064),c!==null?u=Oa(c,u):(u=Vl(u,d,n,null),u.flags|=2),u.return=t,s.return=t,s.sibling=u,t.child=s,s=u,u=t.child,d=e.child.memoizedState,d=d===null?o0(n):{baseLanes:d.baseLanes|n,cachePool:null,transitions:d.transitions},u.memoizedState=d,u.childLanes=e.childLanes&~n,t.memoizedState=s0,s}return u=e.child,e=u.sibling,s=Oa(u,{mode:"visible",children:s.children}),!(t.mode&1)&&(s.lanes=n),s.return=t,s.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=s,t.memoizedState=null,s}function _v(e,t){return t=Km({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function bf(e,t,n,s){return s!==null&&rv(s),Pu(t,e.child,null,n),e=_v(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function MP(e,t,n,s,a,u,d){if(n)return t.flags&256?(t.flags&=-257,s=Xy(Error(Re(422))),bf(e,t,d,s)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(u=s.fallback,a=t.mode,s=Km({mode:"visible",children:s.children},a,0,null),u=Vl(u,a,d,null),u.flags|=2,s.return=t,u.return=t,s.sibling=u,t.child=s,t.mode&1&&Pu(t,e.child,null,d),t.child.memoizedState=o0(d),t.memoizedState=s0,u);if(!(t.mode&1))return bf(e,t,d,null);if(a.data==="$!"){if(s=a.nextSibling&&a.nextSibling.dataset,s)var c=s.dgst;return s=c,u=Error(Re(419)),s=Xy(u,s,void 0),bf(e,t,d,s)}if(c=(d&e.childLanes)!==0,pr||c){if(s=ti,s!==null){switch(d&-d){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}a=a&(s.suspendedLanes|d)?0:a,a!==0&&a!==u.retryLane&&(u.retryLane=a,Io(e,a),Ts(s,e,a,-1))}return kv(),s=Xy(Error(Re(421))),bf(e,t,d,s)}return a.data==="$?"?(t.flags|=128,t.child=e.child,t=VP.bind(null,e),a._reactRetry=t,null):(e=u.treeContext,Br=Aa(a.nextSibling),Nr=t,yn=!0,ws=null,e!==null&&(ts[ns++]=So,ts[ns++]=ko,ts[ns++]=Wl,So=e.id,ko=e.overflow,Wl=t),t=_v(t,s.children),t.flags|=4096,t)}function Bw(e,t,n){e.lanes|=t;var s=e.alternate;s!==null&&(s.lanes|=t),Q_(e.return,t,n)}function Jy(e,t,n,s,a){var u=e.memoizedState;u===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:s,tail:n,tailMode:a}:(u.isBackwards=t,u.rendering=null,u.renderingStartTime=0,u.last=s,u.tail=n,u.tailMode=a)}function a2(e,t,n){var s=t.pendingProps,a=s.revealOrder,u=s.tail;if(Hi(e,t,s.children,n),s=xn.current,s&2)s=s&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Bw(e,n,t);else if(e.tag===19)Bw(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}s&=1}if(on(xn,s),!(t.mode&1))t.memoizedState=null;else switch(a){case"forwards":for(n=t.child,a=null;n!==null;)e=n.alternate,e!==null&&pm(e)===null&&(a=n),n=n.sibling;n=a,n===null?(a=t.child,t.child=null):(a=n.sibling,n.sibling=null),Jy(t,!1,a,n,u);break;case"backwards":for(n=null,a=t.child,t.child=null;a!==null;){if(e=a.alternate,e!==null&&pm(e)===null){t.child=a;break}e=a.sibling,a.sibling=n,n=a,a=e}Jy(t,!0,n,null,u);break;case"together":Jy(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function jf(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Po(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),Kl|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(Re(153));if(t.child!==null){for(e=t.child,n=Oa(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=Oa(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function EP(e,t,n){switch(t.tag){case 3:s2(t),Iu();break;case 5:Dk(t);break;case 1:mr(t.type)&&am(t);break;case 4:uv(t,t.stateNode.containerInfo);break;case 10:var s=t.type._context,a=t.memoizedProps.value;on(um,s._currentValue),s._currentValue=a;break;case 13:if(s=t.memoizedState,s!==null)return s.dehydrated!==null?(on(xn,xn.current&1),t.flags|=128,null):n&t.child.childLanes?o2(e,t,n):(on(xn,xn.current&1),e=Po(e,t,n),e!==null?e.sibling:null);on(xn,xn.current&1);break;case 19:if(s=(n&t.childLanes)!==0,e.flags&128){if(s)return a2(e,t,n);t.flags|=128}if(a=t.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),on(xn,xn.current),s)break;return null;case 22:case 23:return t.lanes=0,i2(e,t,n)}return Po(e,t,n)}var l2,a0,c2,u2;l2=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};a0=function(){};c2=function(e,t,n,s){var a=e.memoizedProps;if(a!==s){e=t.stateNode,Ol(Gs.current);var u=null;switch(n){case"input":a=I_(e,a),s=I_(e,s),u=[];break;case"select":a=bn({},a,{value:void 0}),s=bn({},s,{value:void 0}),u=[];break;case"textarea":a=z_(e,a),s=z_(e,s),u=[];break;default:typeof a.onClick!="function"&&typeof s.onClick=="function"&&(e.onclick=sm)}R_(n,s);var d;n=null;for(k in a)if(!s.hasOwnProperty(k)&&a.hasOwnProperty(k)&&a[k]!=null)if(k==="style"){var c=a[k];for(d in c)c.hasOwnProperty(d)&&(n||(n={}),n[d]="")}else k!=="dangerouslySetInnerHTML"&&k!=="children"&&k!=="suppressContentEditableWarning"&&k!=="suppressHydrationWarning"&&k!=="autoFocus"&&(Md.hasOwnProperty(k)?u||(u=[]):(u=u||[]).push(k,null));for(k in s){var w=s[k];if(c=a!=null?a[k]:void 0,s.hasOwnProperty(k)&&w!==c&&(w!=null||c!=null))if(k==="style")if(c){for(d in c)!c.hasOwnProperty(d)||w&&w.hasOwnProperty(d)||(n||(n={}),n[d]="");for(d in w)w.hasOwnProperty(d)&&c[d]!==w[d]&&(n||(n={}),n[d]=w[d])}else n||(u||(u=[]),u.push(k,n)),n=w;else k==="dangerouslySetInnerHTML"?(w=w?w.__html:void 0,c=c?c.__html:void 0,w!=null&&c!==w&&(u=u||[]).push(k,w)):k==="children"?typeof w!="string"&&typeof w!="number"||(u=u||[]).push(k,""+w):k!=="suppressContentEditableWarning"&&k!=="suppressHydrationWarning"&&(Md.hasOwnProperty(k)?(w!=null&&k==="onScroll"&&un("scroll",e),u||c===w||(u=[])):(u=u||[]).push(k,w))}n&&(u=u||[]).push("style",n);var k=u;(t.updateQueue=k)&&(t.flags|=4)}};u2=function(e,t,n,s){n!==s&&(t.flags|=4)};function rd(e,t){if(!yn)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var s=null;n!==null;)n.alternate!==null&&(s=n),n=n.sibling;s===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:s.sibling=null}}function Pi(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,s=0;if(t)for(var a=e.child;a!==null;)n|=a.lanes|a.childLanes,s|=a.subtreeFlags&14680064,s|=a.flags&14680064,a.return=e,a=a.sibling;else for(a=e.child;a!==null;)n|=a.lanes|a.childLanes,s|=a.subtreeFlags,s|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=s,e.childLanes=n,t}function IP(e,t,n){var s=t.pendingProps;switch(iv(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Pi(t),null;case 1:return mr(t.type)&&om(),Pi(t),null;case 3:return s=t.stateNode,Au(),hn(fr),hn(Ri),dv(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(e===null||e.child===null)&&(xf(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,ws!==null&&(m0(ws),ws=null))),a0(e,t),Pi(t),null;case 5:hv(t);var a=Ol(Nd.current);if(n=t.type,e!==null&&t.stateNode!=null)c2(e,t,n,s,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!s){if(t.stateNode===null)throw Error(Re(166));return Pi(t),null}if(e=Ol(Gs.current),xf(t)){s=t.stateNode,n=t.type;var u=t.memoizedProps;switch(s[Hs]=t,s[Bd]=u,e=(t.mode&1)!==0,n){case"dialog":un("cancel",s),un("close",s);break;case"iframe":case"object":case"embed":un("load",s);break;case"video":case"audio":for(a=0;a<ud.length;a++)un(ud[a],s);break;case"source":un("error",s);break;case"img":case"image":case"link":un("error",s),un("load",s);break;case"details":un("toggle",s);break;case"input":Z1(s,u),un("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!u.multiple},un("invalid",s);break;case"textarea":G1(s,u),un("invalid",s)}R_(n,u),a=null;for(var d in u)if(u.hasOwnProperty(d)){var c=u[d];d==="children"?typeof c=="string"?s.textContent!==c&&(u.suppressHydrationWarning!==!0&&vf(s.textContent,c,e),a=["children",c]):typeof c=="number"&&s.textContent!==""+c&&(u.suppressHydrationWarning!==!0&&vf(s.textContent,c,e),a=["children",""+c]):Md.hasOwnProperty(d)&&c!=null&&d==="onScroll"&&un("scroll",s)}switch(n){case"input":hf(s),W1(s,u,!0);break;case"textarea":hf(s),K1(s);break;case"select":case"option":break;default:typeof u.onClick=="function"&&(s.onclick=sm)}s=a,t.updateQueue=s,s!==null&&(t.flags|=4)}else{d=a.nodeType===9?a:a.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=FS(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=d.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof s.is=="string"?e=d.createElement(n,{is:s.is}):(e=d.createElement(n),n==="select"&&(d=e,s.multiple?d.multiple=!0:s.size&&(d.size=s.size))):e=d.createElementNS(e,n),e[Hs]=t,e[Bd]=s,l2(e,t,!1,!1),t.stateNode=e;e:{switch(d=O_(n,s),n){case"dialog":un("cancel",e),un("close",e),a=s;break;case"iframe":case"object":case"embed":un("load",e),a=s;break;case"video":case"audio":for(a=0;a<ud.length;a++)un(ud[a],e);a=s;break;case"source":un("error",e),a=s;break;case"img":case"image":case"link":un("error",e),un("load",e),a=s;break;case"details":un("toggle",e),a=s;break;case"input":Z1(e,s),a=I_(e,s),un("invalid",e);break;case"option":a=s;break;case"select":e._wrapperState={wasMultiple:!!s.multiple},a=bn({},s,{value:void 0}),un("invalid",e);break;case"textarea":G1(e,s),a=z_(e,s),un("invalid",e);break;default:a=s}R_(n,a),c=a;for(u in c)if(c.hasOwnProperty(u)){var w=c[u];u==="style"?$S(e,w):u==="dangerouslySetInnerHTML"?(w=w?w.__html:void 0,w!=null&&NS(e,w)):u==="children"?typeof w=="string"?(n!=="textarea"||w!=="")&&Ed(e,w):typeof w=="number"&&Ed(e,""+w):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Md.hasOwnProperty(u)?w!=null&&u==="onScroll"&&un("scroll",e):w!=null&&j0(e,u,w,d))}switch(n){case"input":hf(e),W1(e,s,!1);break;case"textarea":hf(e),K1(e);break;case"option":s.value!=null&&e.setAttribute("value",""+$a(s.value));break;case"select":e.multiple=!!s.multiple,u=s.value,u!=null?yu(e,!!s.multiple,u,!1):s.defaultValue!=null&&yu(e,!!s.multiple,s.defaultValue,!0);break;default:typeof a.onClick=="function"&&(e.onclick=sm)}switch(n){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Pi(t),null;case 6:if(e&&t.stateNode!=null)u2(e,t,e.memoizedProps,s);else{if(typeof s!="string"&&t.stateNode===null)throw Error(Re(166));if(n=Ol(Nd.current),Ol(Gs.current),xf(t)){if(s=t.stateNode,n=t.memoizedProps,s[Hs]=t,(u=s.nodeValue!==n)&&(e=Nr,e!==null))switch(e.tag){case 3:vf(s.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&vf(s.nodeValue,n,(e.mode&1)!==0)}u&&(t.flags|=4)}else s=(n.nodeType===9?n:n.ownerDocument).createTextNode(s),s[Hs]=t,t.stateNode=s}return Pi(t),null;case 13:if(hn(xn),s=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(yn&&Br!==null&&t.mode&1&&!(t.flags&128))Ek(),Iu(),t.flags|=98560,u=!1;else if(u=xf(t),s!==null&&s.dehydrated!==null){if(e===null){if(!u)throw Error(Re(318));if(u=t.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(Re(317));u[Hs]=t}else Iu(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Pi(t),u=!1}else ws!==null&&(m0(ws),ws=null),u=!0;if(!u)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(s=s!==null,s!==(e!==null&&e.memoizedState!==null)&&s&&(t.child.flags|=8192,t.mode&1&&(e===null||xn.current&1?Un===0&&(Un=3):kv())),t.updateQueue!==null&&(t.flags|=4),Pi(t),null);case 4:return Au(),a0(e,t),e===null&&Od(t.stateNode.containerInfo),Pi(t),null;case 10:return av(t.type._context),Pi(t),null;case 17:return mr(t.type)&&om(),Pi(t),null;case 19:if(hn(xn),u=t.memoizedState,u===null)return Pi(t),null;if(s=(t.flags&128)!==0,d=u.rendering,d===null)if(s)rd(u,!1);else{if(Un!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(d=pm(e),d!==null){for(t.flags|=128,rd(u,!1),s=d.updateQueue,s!==null&&(t.updateQueue=s,t.flags|=4),t.subtreeFlags=0,s=n,n=t.child;n!==null;)u=n,e=s,u.flags&=14680066,d=u.alternate,d===null?(u.childLanes=0,u.lanes=e,u.child=null,u.subtreeFlags=0,u.memoizedProps=null,u.memoizedState=null,u.updateQueue=null,u.dependencies=null,u.stateNode=null):(u.childLanes=d.childLanes,u.lanes=d.lanes,u.child=d.child,u.subtreeFlags=0,u.deletions=null,u.memoizedProps=d.memoizedProps,u.memoizedState=d.memoizedState,u.updateQueue=d.updateQueue,u.type=d.type,e=d.dependencies,u.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return on(xn,xn.current&1|2),t.child}e=e.sibling}u.tail!==null&&In()>Du&&(t.flags|=128,s=!0,rd(u,!1),t.lanes=4194304)}else{if(!s)if(e=pm(d),e!==null){if(t.flags|=128,s=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),rd(u,!0),u.tail===null&&u.tailMode==="hidden"&&!d.alternate&&!yn)return Pi(t),null}else 2*In()-u.renderingStartTime>Du&&n!==1073741824&&(t.flags|=128,s=!0,rd(u,!1),t.lanes=4194304);u.isBackwards?(d.sibling=t.child,t.child=d):(n=u.last,n!==null?n.sibling=d:t.child=d,u.last=d)}return u.tail!==null?(t=u.tail,u.rendering=t,u.tail=t.sibling,u.renderingStartTime=In(),t.sibling=null,n=xn.current,on(xn,s?n&1|2:n&1),t):(Pi(t),null);case 22:case 23:return Sv(),s=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==s&&(t.flags|=8192),s&&t.mode&1?Or&1073741824&&(Pi(t),t.subtreeFlags&6&&(t.flags|=8192)):Pi(t),null;case 24:return null;case 25:return null}throw Error(Re(156,t.tag))}function PP(e,t){switch(iv(t),t.tag){case 1:return mr(t.type)&&om(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Au(),hn(fr),hn(Ri),dv(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return hv(t),null;case 13:if(hn(xn),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(Re(340));Iu()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return hn(xn),null;case 4:return Au(),null;case 10:return av(t.type._context),null;case 22:case 23:return Sv(),null;case 24:return null;default:return null}}var Sf=!1,zi=!1,AP=typeof WeakSet=="function"?WeakSet:Set,st=null;function pu(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(s){Cn(e,t,s)}else n.current=null}function l0(e,t,n){try{n()}catch(s){Cn(e,t,s)}}var Fw=!1;function zP(e,t){if(H_=nm,e=mk(),tv(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var s=n.getSelection&&n.getSelection();if(s&&s.rangeCount!==0){n=s.anchorNode;var a=s.anchorOffset,u=s.focusNode;s=s.focusOffset;try{n.nodeType,u.nodeType}catch{n=null;break e}var d=0,c=-1,w=-1,k=0,E=0,P=e,A=null;t:for(;;){for(var $;P!==n||a!==0&&P.nodeType!==3||(c=d+a),P!==u||s!==0&&P.nodeType!==3||(w=d+s),P.nodeType===3&&(d+=P.nodeValue.length),($=P.firstChild)!==null;)A=P,P=$;for(;;){if(P===e)break t;if(A===n&&++k===a&&(c=d),A===u&&++E===s&&(w=d),($=P.nextSibling)!==null)break;P=A,A=P.parentNode}P=$}n=c===-1||w===-1?null:{start:c,end:w}}else n=null}n=n||{start:0,end:0}}else n=null;for(Z_={focusedElem:e,selectionRange:n},nm=!1,st=t;st!==null;)if(t=st,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,st=e;else for(;st!==null;){t=st;try{var j=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(j!==null){var X=j.memoizedProps,he=j.memoizedState,K=t.stateNode,J=K.getSnapshotBeforeUpdate(t.elementType===t.type?X:vs(t.type,X),he);K.__reactInternalSnapshotBeforeUpdate=J}break;case 3:var le=t.stateNode.containerInfo;le.nodeType===1?le.textContent="":le.nodeType===9&&le.documentElement&&le.removeChild(le.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Re(163))}}catch(Se){Cn(t,t.return,Se)}if(e=t.sibling,e!==null){e.return=t.return,st=e;break}st=t.return}return j=Fw,Fw=!1,j}function xd(e,t,n){var s=t.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var a=s=s.next;do{if((a.tag&e)===e){var u=a.destroy;a.destroy=void 0,u!==void 0&&l0(t,n,u)}a=a.next}while(a!==s)}}function Wm(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var s=n.create;n.destroy=s()}n=n.next}while(n!==t)}}function c0(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function h2(e){var t=e.alternate;t!==null&&(e.alternate=null,h2(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Hs],delete t[Bd],delete t[K_],delete t[fP],delete t[mP])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function d2(e){return e.tag===5||e.tag===3||e.tag===4}function Nw(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||d2(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function u0(e,t,n){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=sm));else if(s!==4&&(e=e.child,e!==null))for(u0(e,t,n),e=e.sibling;e!==null;)u0(e,t,n),e=e.sibling}function h0(e,t,n){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(s!==4&&(e=e.child,e!==null))for(h0(e,t,n),e=e.sibling;e!==null;)h0(e,t,n),e=e.sibling}var hi=null,xs=!1;function fa(e,t,n){for(n=n.child;n!==null;)p2(e,t,n),n=n.sibling}function p2(e,t,n){if(Ws&&typeof Ws.onCommitFiberUnmount=="function")try{Ws.onCommitFiberUnmount(Nm,n)}catch{}switch(n.tag){case 5:zi||pu(n,t);case 6:var s=hi,a=xs;hi=null,fa(e,t,n),hi=s,xs=a,hi!==null&&(xs?(e=hi,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):hi.removeChild(n.stateNode));break;case 18:hi!==null&&(xs?(e=hi,n=n.stateNode,e.nodeType===8?qy(e.parentNode,n):e.nodeType===1&&qy(e,n),zd(e)):qy(hi,n.stateNode));break;case 4:s=hi,a=xs,hi=n.stateNode.containerInfo,xs=!0,fa(e,t,n),hi=s,xs=a;break;case 0:case 11:case 14:case 15:if(!zi&&(s=n.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){a=s=s.next;do{var u=a,d=u.destroy;u=u.tag,d!==void 0&&(u&2||u&4)&&l0(n,t,d),a=a.next}while(a!==s)}fa(e,t,n);break;case 1:if(!zi&&(pu(n,t),s=n.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=n.memoizedProps,s.state=n.memoizedState,s.componentWillUnmount()}catch(c){Cn(n,t,c)}fa(e,t,n);break;case 21:fa(e,t,n);break;case 22:n.mode&1?(zi=(s=zi)||n.memoizedState!==null,fa(e,t,n),zi=s):fa(e,t,n);break;default:fa(e,t,n)}}function Vw(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new AP),t.forEach(function(s){var a=$P.bind(null,e,s);n.has(s)||(n.add(s),s.then(a,a))})}}function _s(e,t){var n=t.deletions;if(n!==null)for(var s=0;s<n.length;s++){var a=n[s];try{var u=e,d=t,c=d;e:for(;c!==null;){switch(c.tag){case 5:hi=c.stateNode,xs=!1;break e;case 3:hi=c.stateNode.containerInfo,xs=!0;break e;case 4:hi=c.stateNode.containerInfo,xs=!0;break e}c=c.return}if(hi===null)throw Error(Re(160));p2(u,d,a),hi=null,xs=!1;var w=a.alternate;w!==null&&(w.return=null),a.return=null}catch(k){Cn(a,t,k)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)f2(t,e),t=t.sibling}function f2(e,t){var n=e.alternate,s=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(_s(t,e),js(e),s&4){try{xd(3,e,e.return),Wm(3,e)}catch(X){Cn(e,e.return,X)}try{xd(5,e,e.return)}catch(X){Cn(e,e.return,X)}}break;case 1:_s(t,e),js(e),s&512&&n!==null&&pu(n,n.return);break;case 5:if(_s(t,e),js(e),s&512&&n!==null&&pu(n,n.return),e.flags&32){var a=e.stateNode;try{Ed(a,"")}catch(X){Cn(e,e.return,X)}}if(s&4&&(a=e.stateNode,a!=null)){var u=e.memoizedProps,d=n!==null?n.memoizedProps:u,c=e.type,w=e.updateQueue;if(e.updateQueue=null,w!==null)try{c==="input"&&u.type==="radio"&&u.name!=null&&LS(a,u),O_(c,d);var k=O_(c,u);for(d=0;d<w.length;d+=2){var E=w[d],P=w[d+1];E==="style"?$S(a,P):E==="dangerouslySetInnerHTML"?NS(a,P):E==="children"?Ed(a,P):j0(a,E,P,k)}switch(c){case"input":P_(a,u);break;case"textarea":BS(a,u);break;case"select":var A=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!u.multiple;var $=u.value;$!=null?yu(a,!!u.multiple,$,!1):A!==!!u.multiple&&(u.defaultValue!=null?yu(a,!!u.multiple,u.defaultValue,!0):yu(a,!!u.multiple,u.multiple?[]:"",!1))}a[Bd]=u}catch(X){Cn(e,e.return,X)}}break;case 6:if(_s(t,e),js(e),s&4){if(e.stateNode===null)throw Error(Re(162));a=e.stateNode,u=e.memoizedProps;try{a.nodeValue=u}catch(X){Cn(e,e.return,X)}}break;case 3:if(_s(t,e),js(e),s&4&&n!==null&&n.memoizedState.isDehydrated)try{zd(t.containerInfo)}catch(X){Cn(e,e.return,X)}break;case 4:_s(t,e),js(e);break;case 13:_s(t,e),js(e),a=e.child,a.flags&8192&&(u=a.memoizedState!==null,a.stateNode.isHidden=u,!u||a.alternate!==null&&a.alternate.memoizedState!==null||(wv=In())),s&4&&Vw(e);break;case 22:if(E=n!==null&&n.memoizedState!==null,e.mode&1?(zi=(k=zi)||E,_s(t,e),zi=k):_s(t,e),js(e),s&8192){if(k=e.memoizedState!==null,(e.stateNode.isHidden=k)&&!E&&e.mode&1)for(st=e,E=e.child;E!==null;){for(P=st=E;st!==null;){switch(A=st,$=A.child,A.tag){case 0:case 11:case 14:case 15:xd(4,A,A.return);break;case 1:pu(A,A.return);var j=A.stateNode;if(typeof j.componentWillUnmount=="function"){s=A,n=A.return;try{t=s,j.props=t.memoizedProps,j.state=t.memoizedState,j.componentWillUnmount()}catch(X){Cn(s,n,X)}}break;case 5:pu(A,A.return);break;case 22:if(A.memoizedState!==null){jw(P);continue}}$!==null?($.return=A,st=$):jw(P)}E=E.sibling}e:for(E=null,P=e;;){if(P.tag===5){if(E===null){E=P;try{a=P.stateNode,k?(u=a.style,typeof u.setProperty=="function"?u.setProperty("display","none","important"):u.display="none"):(c=P.stateNode,w=P.memoizedProps.style,d=w!=null&&w.hasOwnProperty("display")?w.display:null,c.style.display=VS("display",d))}catch(X){Cn(e,e.return,X)}}}else if(P.tag===6){if(E===null)try{P.stateNode.nodeValue=k?"":P.memoizedProps}catch(X){Cn(e,e.return,X)}}else if((P.tag!==22&&P.tag!==23||P.memoizedState===null||P===e)&&P.child!==null){P.child.return=P,P=P.child;continue}if(P===e)break e;for(;P.sibling===null;){if(P.return===null||P.return===e)break e;E===P&&(E=null),P=P.return}E===P&&(E=null),P.sibling.return=P.return,P=P.sibling}}break;case 19:_s(t,e),js(e),s&4&&Vw(e);break;case 21:break;default:_s(t,e),js(e)}}function js(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(d2(n)){var s=n;break e}n=n.return}throw Error(Re(160))}switch(s.tag){case 5:var a=s.stateNode;s.flags&32&&(Ed(a,""),s.flags&=-33);var u=Nw(e);h0(e,u,a);break;case 3:case 4:var d=s.stateNode.containerInfo,c=Nw(e);u0(e,c,d);break;default:throw Error(Re(161))}}catch(w){Cn(e,e.return,w)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function DP(e,t,n){st=e,m2(e)}function m2(e,t,n){for(var s=(e.mode&1)!==0;st!==null;){var a=st,u=a.child;if(a.tag===22&&s){var d=a.memoizedState!==null||Sf;if(!d){var c=a.alternate,w=c!==null&&c.memoizedState!==null||zi;c=Sf;var k=zi;if(Sf=d,(zi=w)&&!k)for(st=a;st!==null;)d=st,w=d.child,d.tag===22&&d.memoizedState!==null?Uw(a):w!==null?(w.return=d,st=w):Uw(a);for(;u!==null;)st=u,m2(u),u=u.sibling;st=a,Sf=c,zi=k}$w(e)}else a.subtreeFlags&8772&&u!==null?(u.return=a,st=u):$w(e)}}function $w(e){for(;st!==null;){var t=st;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:zi||Wm(5,t);break;case 1:var s=t.stateNode;if(t.flags&4&&!zi)if(n===null)s.componentDidMount();else{var a=t.elementType===t.type?n.memoizedProps:vs(t.type,n.memoizedProps);s.componentDidUpdate(a,n.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var u=t.updateQueue;u!==null&&Tw(t,u,s);break;case 3:var d=t.updateQueue;if(d!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}Tw(t,d,n)}break;case 5:var c=t.stateNode;if(n===null&&t.flags&4){n=c;var w=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":w.autoFocus&&n.focus();break;case"img":w.src&&(n.src=w.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var k=t.alternate;if(k!==null){var E=k.memoizedState;if(E!==null){var P=E.dehydrated;P!==null&&zd(P)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Re(163))}zi||t.flags&512&&c0(t)}catch(A){Cn(t,t.return,A)}}if(t===e){st=null;break}if(n=t.sibling,n!==null){n.return=t.return,st=n;break}st=t.return}}function jw(e){for(;st!==null;){var t=st;if(t===e){st=null;break}var n=t.sibling;if(n!==null){n.return=t.return,st=n;break}st=t.return}}function Uw(e){for(;st!==null;){var t=st;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{Wm(4,t)}catch(w){Cn(t,n,w)}break;case 1:var s=t.stateNode;if(typeof s.componentDidMount=="function"){var a=t.return;try{s.componentDidMount()}catch(w){Cn(t,a,w)}}var u=t.return;try{c0(t)}catch(w){Cn(t,u,w)}break;case 5:var d=t.return;try{c0(t)}catch(w){Cn(t,d,w)}}}catch(w){Cn(t,t.return,w)}if(t===e){st=null;break}var c=t.sibling;if(c!==null){c.return=t.return,st=c;break}st=t.return}}var RP=Math.ceil,gm=Ao.ReactCurrentDispatcher,vv=Ao.ReactCurrentOwner,ss=Ao.ReactCurrentBatchConfig,$t=0,ti=null,Bn=null,mi=0,Or=0,fu=Za(0),Un=0,Ud=null,Kl=0,Gm=0,xv=0,wd=null,dr=null,wv=0,Du=1/0,xo=null,ym=!1,d0=null,Da=null,kf=!1,ka=null,_m=0,bd=0,p0=null,Uf=-1,qf=0;function Wi(){return $t&6?In():Uf!==-1?Uf:Uf=In()}function Ra(e){return e.mode&1?$t&2&&mi!==0?mi&-mi:yP.transition!==null?(qf===0&&(qf=QS()),qf):(e=Jt,e!==0||(e=window.event,e=e===void 0?16:ok(e.type)),e):1}function Ts(e,t,n,s){if(50<bd)throw bd=0,p0=null,Error(Re(185));Qd(e,n,s),(!($t&2)||e!==ti)&&(e===ti&&(!($t&2)&&(Gm|=n),Un===4&&wa(e,mi)),gr(e,s),n===1&&$t===0&&!(t.mode&1)&&(Du=In()+500,qm&&Wa()))}function gr(e,t){var n=e.callbackNode;yI(e,t);var s=tm(e,e===ti?mi:0);if(s===0)n!==null&&Y1(n),e.callbackNode=null,e.callbackPriority=0;else if(t=s&-s,e.callbackPriority!==t){if(n!=null&&Y1(n),t===1)e.tag===0?gP(qw.bind(null,e)):Tk(qw.bind(null,e)),dP(function(){!($t&6)&&Wa()}),n=null;else{switch(ek(s)){case 1:n=W0;break;case 4:n=JS;break;case 16:n=em;break;case 536870912:n=YS;break;default:n=em}n=S2(n,g2.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function g2(e,t){if(Uf=-1,qf=0,$t&6)throw Error(Re(327));var n=e.callbackNode;if(bu()&&e.callbackNode!==n)return null;var s=tm(e,e===ti?mi:0);if(s===0)return null;if(s&30||s&e.expiredLanes||t)t=vm(e,s);else{t=s;var a=$t;$t|=2;var u=_2();(ti!==e||mi!==t)&&(xo=null,Du=In()+500,Nl(e,t));do try{BP();break}catch(c){y2(e,c)}while(!0);ov(),gm.current=u,$t=a,Bn!==null?t=0:(ti=null,mi=0,t=Un)}if(t!==0){if(t===2&&(a=V_(e),a!==0&&(s=a,t=f0(e,a))),t===1)throw n=Ud,Nl(e,0),wa(e,s),gr(e,In()),n;if(t===6)wa(e,s);else{if(a=e.current.alternate,!(s&30)&&!OP(a)&&(t=vm(e,s),t===2&&(u=V_(e),u!==0&&(s=u,t=f0(e,u))),t===1))throw n=Ud,Nl(e,0),wa(e,s),gr(e,In()),n;switch(e.finishedWork=a,e.finishedLanes=s,t){case 0:case 1:throw Error(Re(345));case 2:Pl(e,dr,xo);break;case 3:if(wa(e,s),(s&130023424)===s&&(t=wv+500-In(),10<t)){if(tm(e,0)!==0)break;if(a=e.suspendedLanes,(a&s)!==s){Wi(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=G_(Pl.bind(null,e,dr,xo),t);break}Pl(e,dr,xo);break;case 4:if(wa(e,s),(s&4194240)===s)break;for(t=e.eventTimes,a=-1;0<s;){var d=31-ks(s);u=1<<d,d=t[d],d>a&&(a=d),s&=~u}if(s=a,s=In()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*RP(s/1960))-s,10<s){e.timeoutHandle=G_(Pl.bind(null,e,dr,xo),s);break}Pl(e,dr,xo);break;case 5:Pl(e,dr,xo);break;default:throw Error(Re(329))}}}return gr(e,In()),e.callbackNode===n?g2.bind(null,e):null}function f0(e,t){var n=wd;return e.current.memoizedState.isDehydrated&&(Nl(e,t).flags|=256),e=vm(e,t),e!==2&&(t=dr,dr=n,t!==null&&m0(t)),e}function m0(e){dr===null?dr=e:dr.push.apply(dr,e)}function OP(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var s=0;s<n.length;s++){var a=n[s],u=a.getSnapshot;a=a.value;try{if(!Ms(u(),a))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function wa(e,t){for(t&=~xv,t&=~Gm,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-ks(t),s=1<<n;e[n]=-1,t&=~s}}function qw(e){if($t&6)throw Error(Re(327));bu();var t=tm(e,0);if(!(t&1))return gr(e,In()),null;var n=vm(e,t);if(e.tag!==0&&n===2){var s=V_(e);s!==0&&(t=s,n=f0(e,s))}if(n===1)throw n=Ud,Nl(e,0),wa(e,t),gr(e,In()),n;if(n===6)throw Error(Re(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Pl(e,dr,xo),gr(e,In()),null}function bv(e,t){var n=$t;$t|=1;try{return e(t)}finally{$t=n,$t===0&&(Du=In()+500,qm&&Wa())}}function Xl(e){ka!==null&&ka.tag===0&&!($t&6)&&bu();var t=$t;$t|=1;var n=ss.transition,s=Jt;try{if(ss.transition=null,Jt=1,e)return e()}finally{Jt=s,ss.transition=n,$t=t,!($t&6)&&Wa()}}function Sv(){Or=fu.current,hn(fu)}function Nl(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,hP(n)),Bn!==null)for(n=Bn.return;n!==null;){var s=n;switch(iv(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&om();break;case 3:Au(),hn(fr),hn(Ri),dv();break;case 5:hv(s);break;case 4:Au();break;case 13:hn(xn);break;case 19:hn(xn);break;case 10:av(s.type._context);break;case 22:case 23:Sv()}n=n.return}if(ti=e,Bn=e=Oa(e.current,null),mi=Or=t,Un=0,Ud=null,xv=Gm=Kl=0,dr=wd=null,Rl!==null){for(t=0;t<Rl.length;t++)if(n=Rl[t],s=n.interleaved,s!==null){n.interleaved=null;var a=s.next,u=n.pending;if(u!==null){var d=u.next;u.next=a,s.next=d}n.pending=s}Rl=null}return e}function y2(e,t){do{var n=Bn;try{if(ov(),Vf.current=mm,fm){for(var s=wn.memoizedState;s!==null;){var a=s.queue;a!==null&&(a.pending=null),s=s.next}fm=!1}if(Gl=0,Qn=jn=wn=null,vd=!1,Vd=0,vv.current=null,n===null||n.return===null){Un=1,Ud=t,Bn=null;break}e:{var u=e,d=n.return,c=n,w=t;if(t=mi,c.flags|=32768,w!==null&&typeof w=="object"&&typeof w.then=="function"){var k=w,E=c,P=E.tag;if(!(E.mode&1)&&(P===0||P===11||P===15)){var A=E.alternate;A?(E.updateQueue=A.updateQueue,E.memoizedState=A.memoizedState,E.lanes=A.lanes):(E.updateQueue=null,E.memoizedState=null)}var $=Aw(d);if($!==null){$.flags&=-257,zw($,d,c,u,t),$.mode&1&&Pw(u,k,t),t=$,w=k;var j=t.updateQueue;if(j===null){var X=new Set;X.add(w),t.updateQueue=X}else j.add(w);break e}else{if(!(t&1)){Pw(u,k,t),kv();break e}w=Error(Re(426))}}else if(yn&&c.mode&1){var he=Aw(d);if(he!==null){!(he.flags&65536)&&(he.flags|=256),zw(he,d,c,u,t),rv(zu(w,c));break e}}u=w=zu(w,c),Un!==4&&(Un=2),wd===null?wd=[u]:wd.push(u),u=d;do{switch(u.tag){case 3:u.flags|=65536,t&=-t,u.lanes|=t;var K=e2(u,w,t);kw(u,K);break e;case 1:c=w;var J=u.type,le=u.stateNode;if(!(u.flags&128)&&(typeof J.getDerivedStateFromError=="function"||le!==null&&typeof le.componentDidCatch=="function"&&(Da===null||!Da.has(le)))){u.flags|=65536,t&=-t,u.lanes|=t;var Se=t2(u,c,t);kw(u,Se);break e}}u=u.return}while(u!==null)}x2(n)}catch(Me){t=Me,Bn===n&&n!==null&&(Bn=n=n.return);continue}break}while(!0)}function _2(){var e=gm.current;return gm.current=mm,e===null?mm:e}function kv(){(Un===0||Un===3||Un===2)&&(Un=4),ti===null||!(Kl&268435455)&&!(Gm&268435455)||wa(ti,mi)}function vm(e,t){var n=$t;$t|=2;var s=_2();(ti!==e||mi!==t)&&(xo=null,Nl(e,t));do try{LP();break}catch(a){y2(e,a)}while(!0);if(ov(),$t=n,gm.current=s,Bn!==null)throw Error(Re(261));return ti=null,mi=0,Un}function LP(){for(;Bn!==null;)v2(Bn)}function BP(){for(;Bn!==null&&!lI();)v2(Bn)}function v2(e){var t=b2(e.alternate,e,Or);e.memoizedProps=e.pendingProps,t===null?x2(e):Bn=t,vv.current=null}function x2(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=PP(n,t),n!==null){n.flags&=32767,Bn=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Un=6,Bn=null;return}}else if(n=IP(n,t,Or),n!==null){Bn=n;return}if(t=t.sibling,t!==null){Bn=t;return}Bn=t=e}while(t!==null);Un===0&&(Un=5)}function Pl(e,t,n){var s=Jt,a=ss.transition;try{ss.transition=null,Jt=1,FP(e,t,n,s)}finally{ss.transition=a,Jt=s}return null}function FP(e,t,n,s){do bu();while(ka!==null);if($t&6)throw Error(Re(327));n=e.finishedWork;var a=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(Re(177));e.callbackNode=null,e.callbackPriority=0;var u=n.lanes|n.childLanes;if(_I(e,u),e===ti&&(Bn=ti=null,mi=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||kf||(kf=!0,S2(em,function(){return bu(),null})),u=(n.flags&15990)!==0,n.subtreeFlags&15990||u){u=ss.transition,ss.transition=null;var d=Jt;Jt=1;var c=$t;$t|=4,vv.current=null,zP(e,n),f2(n,e),rP(Z_),nm=!!H_,Z_=H_=null,e.current=n,DP(n),cI(),$t=c,Jt=d,ss.transition=u}else e.current=n;if(kf&&(kf=!1,ka=e,_m=a),u=e.pendingLanes,u===0&&(Da=null),dI(n.stateNode),gr(e,In()),t!==null)for(s=e.onRecoverableError,n=0;n<t.length;n++)a=t[n],s(a.value,{componentStack:a.stack,digest:a.digest});if(ym)throw ym=!1,e=d0,d0=null,e;return _m&1&&e.tag!==0&&bu(),u=e.pendingLanes,u&1?e===p0?bd++:(bd=0,p0=e):bd=0,Wa(),null}function bu(){if(ka!==null){var e=ek(_m),t=ss.transition,n=Jt;try{if(ss.transition=null,Jt=16>e?16:e,ka===null)var s=!1;else{if(e=ka,ka=null,_m=0,$t&6)throw Error(Re(331));var a=$t;for($t|=4,st=e.current;st!==null;){var u=st,d=u.child;if(st.flags&16){var c=u.deletions;if(c!==null){for(var w=0;w<c.length;w++){var k=c[w];for(st=k;st!==null;){var E=st;switch(E.tag){case 0:case 11:case 15:xd(8,E,u)}var P=E.child;if(P!==null)P.return=E,st=P;else for(;st!==null;){E=st;var A=E.sibling,$=E.return;if(h2(E),E===k){st=null;break}if(A!==null){A.return=$,st=A;break}st=$}}}var j=u.alternate;if(j!==null){var X=j.child;if(X!==null){j.child=null;do{var he=X.sibling;X.sibling=null,X=he}while(X!==null)}}st=u}}if(u.subtreeFlags&2064&&d!==null)d.return=u,st=d;else e:for(;st!==null;){if(u=st,u.flags&2048)switch(u.tag){case 0:case 11:case 15:xd(9,u,u.return)}var K=u.sibling;if(K!==null){K.return=u.return,st=K;break e}st=u.return}}var J=e.current;for(st=J;st!==null;){d=st;var le=d.child;if(d.subtreeFlags&2064&&le!==null)le.return=d,st=le;else e:for(d=J;st!==null;){if(c=st,c.flags&2048)try{switch(c.tag){case 0:case 11:case 15:Wm(9,c)}}catch(Me){Cn(c,c.return,Me)}if(c===d){st=null;break e}var Se=c.sibling;if(Se!==null){Se.return=c.return,st=Se;break e}st=c.return}}if($t=a,Wa(),Ws&&typeof Ws.onPostCommitFiberRoot=="function")try{Ws.onPostCommitFiberRoot(Nm,e)}catch{}s=!0}return s}finally{Jt=n,ss.transition=t}}return!1}function Hw(e,t,n){t=zu(n,t),t=e2(e,t,1),e=za(e,t,1),t=Wi(),e!==null&&(Qd(e,1,t),gr(e,t))}function Cn(e,t,n){if(e.tag===3)Hw(e,e,n);else for(;t!==null;){if(t.tag===3){Hw(t,e,n);break}else if(t.tag===1){var s=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(Da===null||!Da.has(s))){e=zu(n,e),e=t2(t,e,1),t=za(t,e,1),e=Wi(),t!==null&&(Qd(t,1,e),gr(t,e));break}}t=t.return}}function NP(e,t,n){var s=e.pingCache;s!==null&&s.delete(t),t=Wi(),e.pingedLanes|=e.suspendedLanes&n,ti===e&&(mi&n)===n&&(Un===4||Un===3&&(mi&130023424)===mi&&500>In()-wv?Nl(e,0):xv|=n),gr(e,t)}function w2(e,t){t===0&&(e.mode&1?(t=ff,ff<<=1,!(ff&130023424)&&(ff=4194304)):t=1);var n=Wi();e=Io(e,t),e!==null&&(Qd(e,t,n),gr(e,n))}function VP(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),w2(e,n)}function $P(e,t){var n=0;switch(e.tag){case 13:var s=e.stateNode,a=e.memoizedState;a!==null&&(n=a.retryLane);break;case 19:s=e.stateNode;break;default:throw Error(Re(314))}s!==null&&s.delete(t),w2(e,n)}var b2;b2=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||fr.current)pr=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return pr=!1,EP(e,t,n);pr=!!(e.flags&131072)}else pr=!1,yn&&t.flags&1048576&&Ck(t,cm,t.index);switch(t.lanes=0,t.tag){case 2:var s=t.type;jf(e,t),e=t.pendingProps;var a=Eu(t,Ri.current);wu(t,n),a=fv(null,t,s,e,a,n);var u=mv();return t.flags|=1,typeof a=="object"&&a!==null&&typeof a.render=="function"&&a.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,mr(s)?(u=!0,am(t)):u=!1,t.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,cv(t),a.updater=Zm,t.stateNode=a,a._reactInternals=t,t0(t,s,e,n),t=r0(null,t,s,!0,u,n)):(t.tag=0,yn&&u&&nv(t),Hi(null,t,a,n),t=t.child),t;case 16:s=t.elementType;e:{switch(jf(e,t),e=t.pendingProps,a=s._init,s=a(s._payload),t.type=s,a=t.tag=UP(s),e=vs(s,e),a){case 0:t=i0(null,t,s,e,n);break e;case 1:t=Ow(null,t,s,e,n);break e;case 11:t=Dw(null,t,s,e,n);break e;case 14:t=Rw(null,t,s,vs(s.type,e),n);break e}throw Error(Re(306,s,""))}return t;case 0:return s=t.type,a=t.pendingProps,a=t.elementType===s?a:vs(s,a),i0(e,t,s,a,n);case 1:return s=t.type,a=t.pendingProps,a=t.elementType===s?a:vs(s,a),Ow(e,t,s,a,n);case 3:e:{if(s2(t),e===null)throw Error(Re(387));s=t.pendingProps,u=t.memoizedState,a=u.element,zk(e,t),dm(t,s,null,n);var d=t.memoizedState;if(s=d.element,u.isDehydrated)if(u={element:s,isDehydrated:!1,cache:d.cache,pendingSuspenseBoundaries:d.pendingSuspenseBoundaries,transitions:d.transitions},t.updateQueue.baseState=u,t.memoizedState=u,t.flags&256){a=zu(Error(Re(423)),t),t=Lw(e,t,s,n,a);break e}else if(s!==a){a=zu(Error(Re(424)),t),t=Lw(e,t,s,n,a);break e}else for(Br=Aa(t.stateNode.containerInfo.firstChild),Nr=t,yn=!0,ws=null,n=Pk(t,null,s,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Iu(),s===a){t=Po(e,t,n);break e}Hi(e,t,s,n)}t=t.child}return t;case 5:return Dk(t),e===null&&Y_(t),s=t.type,a=t.pendingProps,u=e!==null?e.memoizedProps:null,d=a.children,W_(s,a)?d=null:u!==null&&W_(s,u)&&(t.flags|=32),r2(e,t),Hi(e,t,d,n),t.child;case 6:return e===null&&Y_(t),null;case 13:return o2(e,t,n);case 4:return uv(t,t.stateNode.containerInfo),s=t.pendingProps,e===null?t.child=Pu(t,null,s,n):Hi(e,t,s,n),t.child;case 11:return s=t.type,a=t.pendingProps,a=t.elementType===s?a:vs(s,a),Dw(e,t,s,a,n);case 7:return Hi(e,t,t.pendingProps,n),t.child;case 8:return Hi(e,t,t.pendingProps.children,n),t.child;case 12:return Hi(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(s=t.type._context,a=t.pendingProps,u=t.memoizedProps,d=a.value,on(um,s._currentValue),s._currentValue=d,u!==null)if(Ms(u.value,d)){if(u.children===a.children&&!fr.current){t=Po(e,t,n);break e}}else for(u=t.child,u!==null&&(u.return=t);u!==null;){var c=u.dependencies;if(c!==null){d=u.child;for(var w=c.firstContext;w!==null;){if(w.context===s){if(u.tag===1){w=To(-1,n&-n),w.tag=2;var k=u.updateQueue;if(k!==null){k=k.shared;var E=k.pending;E===null?w.next=w:(w.next=E.next,E.next=w),k.pending=w}}u.lanes|=n,w=u.alternate,w!==null&&(w.lanes|=n),Q_(u.return,n,t),c.lanes|=n;break}w=w.next}}else if(u.tag===10)d=u.type===t.type?null:u.child;else if(u.tag===18){if(d=u.return,d===null)throw Error(Re(341));d.lanes|=n,c=d.alternate,c!==null&&(c.lanes|=n),Q_(d,n,t),d=u.sibling}else d=u.child;if(d!==null)d.return=u;else for(d=u;d!==null;){if(d===t){d=null;break}if(u=d.sibling,u!==null){u.return=d.return,d=u;break}d=d.return}u=d}Hi(e,t,a.children,n),t=t.child}return t;case 9:return a=t.type,s=t.pendingProps.children,wu(t,n),a=ls(a),s=s(a),t.flags|=1,Hi(e,t,s,n),t.child;case 14:return s=t.type,a=vs(s,t.pendingProps),a=vs(s.type,a),Rw(e,t,s,a,n);case 15:return n2(e,t,t.type,t.pendingProps,n);case 17:return s=t.type,a=t.pendingProps,a=t.elementType===s?a:vs(s,a),jf(e,t),t.tag=1,mr(s)?(e=!0,am(t)):e=!1,wu(t,n),Qk(t,s,a),t0(t,s,a,n),r0(null,t,s,!0,e,n);case 19:return a2(e,t,n);case 22:return i2(e,t,n)}throw Error(Re(156,t.tag))};function S2(e,t){return XS(e,t)}function jP(e,t,n,s){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function rs(e,t,n,s){return new jP(e,t,n,s)}function Tv(e){return e=e.prototype,!(!e||!e.isReactComponent)}function UP(e){if(typeof e=="function")return Tv(e)?1:0;if(e!=null){if(e=e.$$typeof,e===q0)return 11;if(e===H0)return 14}return 2}function Oa(e,t){var n=e.alternate;return n===null?(n=rs(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Hf(e,t,n,s,a,u){var d=2;if(s=e,typeof e=="function")Tv(e)&&(d=1);else if(typeof e=="string")d=5;else e:switch(e){case ru:return Vl(n.children,a,u,t);case U0:d=8,a|=8;break;case T_:return e=rs(12,n,t,a|2),e.elementType=T_,e.lanes=u,e;case C_:return e=rs(13,n,t,a),e.elementType=C_,e.lanes=u,e;case M_:return e=rs(19,n,t,a),e.elementType=M_,e.lanes=u,e;case DS:return Km(n,a,u,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case AS:d=10;break e;case zS:d=9;break e;case q0:d=11;break e;case H0:d=14;break e;case ga:d=16,s=null;break e}throw Error(Re(130,e==null?e:typeof e,""))}return t=rs(d,n,t,a),t.elementType=e,t.type=s,t.lanes=u,t}function Vl(e,t,n,s){return e=rs(7,e,s,t),e.lanes=n,e}function Km(e,t,n,s){return e=rs(22,e,s,t),e.elementType=DS,e.lanes=n,e.stateNode={isHidden:!1},e}function Yy(e,t,n){return e=rs(6,e,null,t),e.lanes=n,e}function Qy(e,t,n){return t=rs(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function qP(e,t,n,s,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Dy(0),this.expirationTimes=Dy(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Dy(0),this.identifierPrefix=s,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function Cv(e,t,n,s,a,u,d,c,w){return e=new qP(e,t,n,c,w),t===1?(t=1,u===!0&&(t|=8)):t=0,u=rs(3,null,null,t),e.current=u,u.stateNode=e,u.memoizedState={element:s,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},cv(u),e}function HP(e,t,n){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:iu,key:s==null?null:""+s,children:e,containerInfo:t,implementation:n}}function k2(e){if(!e)return ja;e=e._reactInternals;e:{if(tc(e)!==e||e.tag!==1)throw Error(Re(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(mr(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(Re(171))}if(e.tag===1){var n=e.type;if(mr(n))return kk(e,n,t)}return t}function T2(e,t,n,s,a,u,d,c,w){return e=Cv(n,s,!0,e,a,u,d,c,w),e.context=k2(null),n=e.current,s=Wi(),a=Ra(n),u=To(s,a),u.callback=t??null,za(n,u,a),e.current.lanes=a,Qd(e,a,s),gr(e,s),e}function Xm(e,t,n,s){var a=t.current,u=Wi(),d=Ra(a);return n=k2(n),t.context===null?t.context=n:t.pendingContext=n,t=To(u,d),t.payload={element:e},s=s===void 0?null:s,s!==null&&(t.callback=s),e=za(a,t,d),e!==null&&(Ts(e,a,d,u),Nf(e,a,d)),d}function xm(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function Zw(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function Mv(e,t){Zw(e,t),(e=e.alternate)&&Zw(e,t)}function ZP(){return null}var C2=typeof reportError=="function"?reportError:function(e){console.error(e)};function Ev(e){this._internalRoot=e}Jm.prototype.render=Ev.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(Re(409));Xm(e,t,null,null)};Jm.prototype.unmount=Ev.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Xl(function(){Xm(null,e,null,null)}),t[Eo]=null}};function Jm(e){this._internalRoot=e}Jm.prototype.unstable_scheduleHydration=function(e){if(e){var t=ik();e={blockedOn:null,target:e,priority:t};for(var n=0;n<xa.length&&t!==0&&t<xa[n].priority;n++);xa.splice(n,0,e),n===0&&sk(e)}};function Iv(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Ym(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function Ww(){}function WP(e,t,n,s,a){if(a){if(typeof s=="function"){var u=s;s=function(){var k=xm(d);u.call(k)}}var d=T2(t,s,e,0,null,!1,!1,"",Ww);return e._reactRootContainer=d,e[Eo]=d.current,Od(e.nodeType===8?e.parentNode:e),Xl(),d}for(;a=e.lastChild;)e.removeChild(a);if(typeof s=="function"){var c=s;s=function(){var k=xm(w);c.call(k)}}var w=Cv(e,0,!1,null,null,!1,!1,"",Ww);return e._reactRootContainer=w,e[Eo]=w.current,Od(e.nodeType===8?e.parentNode:e),Xl(function(){Xm(t,w,n,s)}),w}function Qm(e,t,n,s,a){var u=n._reactRootContainer;if(u){var d=u;if(typeof a=="function"){var c=a;a=function(){var w=xm(d);c.call(w)}}Xm(t,d,e,a)}else d=WP(n,t,e,a,s);return xm(d)}tk=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=cd(t.pendingLanes);n!==0&&(G0(t,n|1),gr(t,In()),!($t&6)&&(Du=In()+500,Wa()))}break;case 13:Xl(function(){var s=Io(e,1);if(s!==null){var a=Wi();Ts(s,e,1,a)}}),Mv(e,1)}};K0=function(e){if(e.tag===13){var t=Io(e,134217728);if(t!==null){var n=Wi();Ts(t,e,134217728,n)}Mv(e,134217728)}};nk=function(e){if(e.tag===13){var t=Ra(e),n=Io(e,t);if(n!==null){var s=Wi();Ts(n,e,t,s)}Mv(e,t)}};ik=function(){return Jt};rk=function(e,t){var n=Jt;try{return Jt=e,t()}finally{Jt=n}};B_=function(e,t,n){switch(t){case"input":if(P_(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var s=n[t];if(s!==e&&s.form===e.form){var a=Um(s);if(!a)throw Error(Re(90));OS(s),P_(s,a)}}}break;case"textarea":BS(e,n);break;case"select":t=n.value,t!=null&&yu(e,!!n.multiple,t,!1)}};qS=bv;HS=Xl;var GP={usingClientEntryPoint:!1,Events:[tp,lu,Um,jS,US,bv]},sd={findFiberByHostInstance:Dl,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},KP={bundleType:sd.bundleType,version:sd.version,rendererPackageName:sd.rendererPackageName,rendererConfig:sd.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ao.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=GS(e),e===null?null:e.stateNode},findFiberByHostInstance:sd.findFiberByHostInstance||ZP,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Tf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Tf.isDisabled&&Tf.supportsFiber)try{Nm=Tf.inject(KP),Ws=Tf}catch{}}$r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=GP;$r.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Iv(t))throw Error(Re(200));return HP(e,t,null,n)};$r.createRoot=function(e,t){if(!Iv(e))throw Error(Re(299));var n=!1,s="",a=C2;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),t=Cv(e,1,!1,null,null,n,!1,s,a),e[Eo]=t.current,Od(e.nodeType===8?e.parentNode:e),new Ev(t)};$r.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Re(188)):(e=Object.keys(e).join(","),Error(Re(268,e)));return e=GS(t),e=e===null?null:e.stateNode,e};$r.flushSync=function(e){return Xl(e)};$r.hydrate=function(e,t,n){if(!Ym(t))throw Error(Re(200));return Qm(null,e,t,!0,n)};$r.hydrateRoot=function(e,t,n){if(!Iv(e))throw Error(Re(405));var s=n!=null&&n.hydratedSources||null,a=!1,u="",d=C2;if(n!=null&&(n.unstable_strictMode===!0&&(a=!0),n.identifierPrefix!==void 0&&(u=n.identifierPrefix),n.onRecoverableError!==void 0&&(d=n.onRecoverableError)),t=T2(t,null,e,1,n??null,a,!1,u,d),e[Eo]=t.current,Od(e),s)for(e=0;e<s.length;e++)n=s[e],a=n._getVersion,a=a(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,a]:t.mutableSourceEagerHydrationData.push(n,a);return new Jm(t)};$r.render=function(e,t,n){if(!Ym(t))throw Error(Re(200));return Qm(null,e,t,!1,n)};$r.unmountComponentAtNode=function(e){if(!Ym(e))throw Error(Re(40));return e._reactRootContainer?(Xl(function(){Qm(null,null,e,!1,function(){e._reactRootContainer=null,e[Eo]=null})}),!0):!1};$r.unstable_batchedUpdates=bv;$r.unstable_renderSubtreeIntoContainer=function(e,t,n,s){if(!Ym(n))throw Error(Re(200));if(e==null||e._reactInternals===void 0)throw Error(Re(38));return Qm(e,t,n,!1,s)};$r.version="18.3.1-next-f1338f8080-20240426";function M2(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(M2)}catch(e){console.error(e)}}M2(),MS.exports=$r;var E2=MS.exports;const XP=Bm(E2);var I2,Gw=E2;I2=Gw.createRoot,Gw.hydrateRoot;function di(e){this.content=e}di.prototype={constructor:di,find:function(e){for(var t=0;t<this.content.length;t+=2)if(this.content[t]===e)return t;return-1},get:function(e){var t=this.find(e);return t==-1?void 0:this.content[t+1]},update:function(e,t,n){var s=n&&n!=e?this.remove(n):this,a=s.find(e),u=s.content.slice();return a==-1?u.push(n||e,t):(u[a+1]=t,n&&(u[a]=n)),new di(u)},remove:function(e){var t=this.find(e);if(t==-1)return this;var n=this.content.slice();return n.splice(t,2),new di(n)},addToStart:function(e,t){return new di([e,t].concat(this.remove(e).content))},addToEnd:function(e,t){var n=this.remove(e).content.slice();return n.push(e,t),new di(n)},addBefore:function(e,t,n){var s=this.remove(t),a=s.content.slice(),u=s.find(e);return a.splice(u==-1?a.length:u,0,t,n),new di(a)},forEach:function(e){for(var t=0;t<this.content.length;t+=2)e(this.content[t],this.content[t+1])},prepend:function(e){return e=di.from(e),e.size?new di(e.content.concat(this.subtract(e).content)):this},append:function(e){return e=di.from(e),e.size?new di(this.subtract(e).content.concat(e.content)):this},subtract:function(e){var t=this;e=di.from(e);for(var n=0;n<e.content.length;n+=2)t=t.remove(e.content[n]);return t},toObject:function(){var e={};return this.forEach(function(t,n){e[t]=n}),e},get size(){return this.content.length>>1}};di.from=function(e){if(e instanceof di)return e;var t=[];if(e)for(var n in e)t.push(n,e[n]);return new di(t)};function P2(e,t,n){for(let s=0;;s++){if(s==e.childCount||s==t.childCount)return e.childCount==t.childCount?null:n;let a=e.child(s),u=t.child(s);if(a==u){n+=a.nodeSize;continue}if(!a.sameMarkup(u))return n;if(a.isText&&a.text!=u.text){for(let d=0;a.text[d]==u.text[d];d++)n++;return n}if(a.content.size||u.content.size){let d=P2(a.content,u.content,n+1);if(d!=null)return d}n+=a.nodeSize}}function A2(e,t,n,s){for(let a=e.childCount,u=t.childCount;;){if(a==0||u==0)return a==u?null:{a:n,b:s};let d=e.child(--a),c=t.child(--u),w=d.nodeSize;if(d==c){n-=w,s-=w;continue}if(!d.sameMarkup(c))return{a:n,b:s};if(d.isText&&d.text!=c.text){let k=0,E=Math.min(d.text.length,c.text.length);for(;k<E&&d.text[d.text.length-k-1]==c.text[c.text.length-k-1];)k++,n--,s--;return{a:n,b:s}}if(d.content.size||c.content.size){let k=A2(d.content,c.content,n-1,s-1);if(k)return k}n-=w,s-=w}}class Ae{constructor(t,n){if(this.content=t,this.size=n||0,n==null)for(let s=0;s<t.length;s++)this.size+=t[s].nodeSize}nodesBetween(t,n,s,a=0,u){for(let d=0,c=0;c<n;d++){let w=this.content[d],k=c+w.nodeSize;if(k>t&&s(w,a+c,u||null,d)!==!1&&w.content.size){let E=c+1;w.nodesBetween(Math.max(0,t-E),Math.min(w.content.size,n-E),s,a+E)}c=k}}descendants(t){this.nodesBetween(0,this.size,t)}textBetween(t,n,s,a){let u="",d=!0;return this.nodesBetween(t,n,(c,w)=>{let k=c.isText?c.text.slice(Math.max(t,w)-w,n-w):c.isLeaf?a?typeof a=="function"?a(c):a:c.type.spec.leafText?c.type.spec.leafText(c):"":"";c.isBlock&&(c.isLeaf&&k||c.isTextblock)&&s&&(d?d=!1:u+=s),u+=k},0),u}append(t){if(!t.size)return this;if(!this.size)return t;let n=this.lastChild,s=t.firstChild,a=this.content.slice(),u=0;for(n.isText&&n.sameMarkup(s)&&(a[a.length-1]=n.withText(n.text+s.text),u=1);u<t.content.length;u++)a.push(t.content[u]);return new Ae(a,this.size+t.size)}cut(t,n=this.size){if(t==0&&n==this.size)return this;let s=[],a=0;if(n>t)for(let u=0,d=0;d<n;u++){let c=this.content[u],w=d+c.nodeSize;w>t&&((d<t||w>n)&&(c.isText?c=c.cut(Math.max(0,t-d),Math.min(c.text.length,n-d)):c=c.cut(Math.max(0,t-d-1),Math.min(c.content.size,n-d-1))),s.push(c),a+=c.nodeSize),d=w}return new Ae(s,a)}cutByIndex(t,n){return t==n?Ae.empty:t==0&&n==this.content.length?this:new Ae(this.content.slice(t,n))}replaceChild(t,n){let s=this.content[t];if(s==n)return this;let a=this.content.slice(),u=this.size+n.nodeSize-s.nodeSize;return a[t]=n,new Ae(a,u)}addToStart(t){return new Ae([t].concat(this.content),this.size+t.nodeSize)}addToEnd(t){return new Ae(this.content.concat(t),this.size+t.nodeSize)}eq(t){if(this.content.length!=t.content.length)return!1;for(let n=0;n<this.content.length;n++)if(!this.content[n].eq(t.content[n]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(t){let n=this.content[t];if(!n)throw new RangeError("Index "+t+" out of range for "+this);return n}maybeChild(t){return this.content[t]||null}forEach(t){for(let n=0,s=0;n<this.content.length;n++){let a=this.content[n];t(a,s,n),s+=a.nodeSize}}findDiffStart(t,n=0){return P2(this,t,n)}findDiffEnd(t,n=this.size,s=t.size){return A2(this,t,n,s)}findIndex(t,n=-1){if(t==0)return Cf(0,t);if(t==this.size)return Cf(this.content.length,t);if(t>this.size||t<0)throw new RangeError(`Position ${t} outside of fragment (${this})`);for(let s=0,a=0;;s++){let u=this.child(s),d=a+u.nodeSize;if(d>=t)return d==t||n>0?Cf(s+1,d):Cf(s,a);a=d}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(t=>t.toJSON()):null}static fromJSON(t,n){if(!n)return Ae.empty;if(!Array.isArray(n))throw new RangeError("Invalid input for Fragment.fromJSON");return new Ae(n.map(t.nodeFromJSON))}static fromArray(t){if(!t.length)return Ae.empty;let n,s=0;for(let a=0;a<t.length;a++){let u=t[a];s+=u.nodeSize,a&&u.isText&&t[a-1].sameMarkup(u)?(n||(n=t.slice(0,a)),n[n.length-1]=u.withText(n[n.length-1].text+u.text)):n&&n.push(u)}return new Ae(n||t,s)}static from(t){if(!t)return Ae.empty;if(t instanceof Ae)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new Ae([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}Ae.empty=new Ae([],0);const e_={index:0,offset:0};function Cf(e,t){return e_.index=e,e_.offset=t,e_}function wm(e,t){if(e===t)return!0;if(!(e&&typeof e=="object")||!(t&&typeof t=="object"))return!1;let n=Array.isArray(e);if(Array.isArray(t)!=n)return!1;if(n){if(e.length!=t.length)return!1;for(let s=0;s<e.length;s++)if(!wm(e[s],t[s]))return!1}else{for(let s in e)if(!(s in t)||!wm(e[s],t[s]))return!1;for(let s in t)if(!(s in e))return!1}return!0}let sn=class g0{constructor(t,n){this.type=t,this.attrs=n}addToSet(t){let n,s=!1;for(let a=0;a<t.length;a++){let u=t[a];if(this.eq(u))return t;if(this.type.excludes(u.type))n||(n=t.slice(0,a));else{if(u.type.excludes(this.type))return t;!s&&u.type.rank>this.type.rank&&(n||(n=t.slice(0,a)),n.push(this),s=!0),n&&n.push(u)}}return n||(n=t.slice()),s||n.push(this),n}removeFromSet(t){for(let n=0;n<t.length;n++)if(this.eq(t[n]))return t.slice(0,n).concat(t.slice(n+1));return t}isInSet(t){for(let n=0;n<t.length;n++)if(this.eq(t[n]))return!0;return!1}eq(t){return this==t||this.type==t.type&&wm(this.attrs,t.attrs)}toJSON(){let t={type:this.type.name};for(let n in this.attrs){t.attrs=this.attrs;break}return t}static fromJSON(t,n){if(!n)throw new RangeError("Invalid input for Mark.fromJSON");let s=t.marks[n.type];if(!s)throw new RangeError(`There is no mark type ${n.type} in this schema`);let a=s.create(n.attrs);return s.checkAttrs(a.attrs),a}static sameSet(t,n){if(t==n)return!0;if(t.length!=n.length)return!1;for(let s=0;s<t.length;s++)if(!t[s].eq(n[s]))return!1;return!0}static setFrom(t){if(!t||Array.isArray(t)&&t.length==0)return g0.none;if(t instanceof g0)return[t];let n=t.slice();return n.sort((s,a)=>s.type.rank-a.type.rank),n}};sn.none=[];class bm extends Error{}class Qe{constructor(t,n,s){this.content=t,this.openStart=n,this.openEnd=s}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(t,n){let s=D2(this.content,t+this.openStart,n);return s&&new Qe(s,this.openStart,this.openEnd)}removeBetween(t,n){return new Qe(z2(this.content,t+this.openStart,n+this.openStart),this.openStart,this.openEnd)}eq(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t}static fromJSON(t,n){if(!n)return Qe.empty;let s=n.openStart||0,a=n.openEnd||0;if(typeof s!="number"||typeof a!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new Qe(Ae.fromJSON(t,n.content),s,a)}static maxOpen(t,n=!0){let s=0,a=0;for(let u=t.firstChild;u&&!u.isLeaf&&(n||!u.type.spec.isolating);u=u.firstChild)s++;for(let u=t.lastChild;u&&!u.isLeaf&&(n||!u.type.spec.isolating);u=u.lastChild)a++;return new Qe(t,s,a)}}Qe.empty=new Qe(Ae.empty,0,0);function z2(e,t,n){let{index:s,offset:a}=e.findIndex(t),u=e.maybeChild(s),{index:d,offset:c}=e.findIndex(n);if(a==t||u.isText){if(c!=n&&!e.child(d).isText)throw new RangeError("Removing non-flat range");return e.cut(0,t).append(e.cut(n))}if(s!=d)throw new RangeError("Removing non-flat range");return e.replaceChild(s,u.copy(z2(u.content,t-a-1,n-a-1)))}function D2(e,t,n,s){let{index:a,offset:u}=e.findIndex(t),d=e.maybeChild(a);if(u==t||d.isText)return e.cut(0,t).append(n).append(e.cut(t));let c=D2(d.content,t-u-1,n);return c&&e.replaceChild(a,d.copy(c))}function JP(e,t,n){if(n.openStart>e.depth)throw new bm("Inserted content deeper than insertion position");if(e.depth-n.openStart!=t.depth-n.openEnd)throw new bm("Inconsistent open depths");return R2(e,t,n,0)}function R2(e,t,n,s){let a=e.index(s),u=e.node(s);if(a==t.index(s)&&s<e.depth-n.openStart){let d=R2(e,t,n,s+1);return u.copy(u.content.replaceChild(a,d))}else if(n.content.size)if(!n.openStart&&!n.openEnd&&e.depth==s&&t.depth==s){let d=e.parent,c=d.content;return jl(d,c.cut(0,e.parentOffset).append(n.content).append(c.cut(t.parentOffset)))}else{let{start:d,end:c}=YP(n,e);return jl(u,L2(e,d,c,t,s))}else return jl(u,Sm(e,t,s))}function O2(e,t){if(!t.type.compatibleContent(e.type))throw new bm("Cannot join "+t.type.name+" onto "+e.type.name)}function y0(e,t,n){let s=e.node(n);return O2(s,t.node(n)),s}function $l(e,t){let n=t.length-1;n>=0&&e.isText&&e.sameMarkup(t[n])?t[n]=e.withText(t[n].text+e.text):t.push(e)}function Sd(e,t,n,s){let a=(t||e).node(n),u=0,d=t?t.index(n):a.childCount;e&&(u=e.index(n),e.depth>n?u++:e.textOffset&&($l(e.nodeAfter,s),u++));for(let c=u;c<d;c++)$l(a.child(c),s);t&&t.depth==n&&t.textOffset&&$l(t.nodeBefore,s)}function jl(e,t){return e.type.checkContent(t),e.copy(t)}function L2(e,t,n,s,a){let u=e.depth>a&&y0(e,t,a+1),d=s.depth>a&&y0(n,s,a+1),c=[];return Sd(null,e,a,c),u&&d&&t.index(a)==n.index(a)?(O2(u,d),$l(jl(u,L2(e,t,n,s,a+1)),c)):(u&&$l(jl(u,Sm(e,t,a+1)),c),Sd(t,n,a,c),d&&$l(jl(d,Sm(n,s,a+1)),c)),Sd(s,null,a,c),new Ae(c)}function Sm(e,t,n){let s=[];if(Sd(null,e,n,s),e.depth>n){let a=y0(e,t,n+1);$l(jl(a,Sm(e,t,n+1)),s)}return Sd(t,null,n,s),new Ae(s)}function YP(e,t){let n=t.depth-e.openStart,a=t.node(n).copy(e.content);for(let u=n-1;u>=0;u--)a=t.node(u).copy(Ae.from(a));return{start:a.resolveNoCache(e.openStart+n),end:a.resolveNoCache(a.content.size-e.openEnd-n)}}class qd{constructor(t,n,s){this.pos=t,this.path=n,this.parentOffset=s,this.depth=n.length/3-1}resolveDepth(t){return t==null?this.depth:t<0?this.depth+t:t}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(t){return this.path[this.resolveDepth(t)*3]}index(t){return this.path[this.resolveDepth(t)*3+1]}indexAfter(t){return t=this.resolveDepth(t),this.index(t)+(t==this.depth&&!this.textOffset?0:1)}start(t){return t=this.resolveDepth(t),t==0?0:this.path[t*3-1]+1}end(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size}before(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[t*3-1]}after(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[t*3-1]+this.path[t*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let t=this.parent,n=this.index(this.depth);if(n==t.childCount)return null;let s=this.pos-this.path[this.path.length-1],a=t.child(n);return s?t.child(n).cut(s):a}get nodeBefore(){let t=this.index(this.depth),n=this.pos-this.path[this.path.length-1];return n?this.parent.child(t).cut(0,n):t==0?null:this.parent.child(t-1)}posAtIndex(t,n){n=this.resolveDepth(n);let s=this.path[n*3],a=n==0?0:this.path[n*3-1]+1;for(let u=0;u<t;u++)a+=s.child(u).nodeSize;return a}marks(){let t=this.parent,n=this.index();if(t.content.size==0)return sn.none;if(this.textOffset)return t.child(n).marks;let s=t.maybeChild(n-1),a=t.maybeChild(n);if(!s){let c=s;s=a,a=c}let u=s.marks;for(var d=0;d<u.length;d++)u[d].type.spec.inclusive===!1&&(!a||!u[d].isInSet(a.marks))&&(u=u[d--].removeFromSet(u));return u}marksAcross(t){let n=this.parent.maybeChild(this.index());if(!n||!n.isInline)return null;let s=n.marks,a=t.parent.maybeChild(t.index());for(var u=0;u<s.length;u++)s[u].type.spec.inclusive===!1&&(!a||!s[u].isInSet(a.marks))&&(s=s[u--].removeFromSet(s));return s}sharedDepth(t){for(let n=this.depth;n>0;n--)if(this.start(n)<=t&&this.end(n)>=t)return n;return 0}blockRange(t=this,n){if(t.pos<this.pos)return t.blockRange(this);for(let s=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);s>=0;s--)if(t.pos<=this.end(s)&&(!n||n(this.node(s))))return new km(this,t,s);return null}sameParent(t){return this.pos-this.parentOffset==t.pos-t.parentOffset}max(t){return t.pos>this.pos?t:this}min(t){return t.pos<this.pos?t:this}toString(){let t="";for(let n=1;n<=this.depth;n++)t+=(t?"/":"")+this.node(n).type.name+"_"+this.index(n-1);return t+":"+this.parentOffset}static resolve(t,n){if(!(n>=0&&n<=t.content.size))throw new RangeError("Position "+n+" out of range");let s=[],a=0,u=n;for(let d=t;;){let{index:c,offset:w}=d.content.findIndex(u),k=u-w;if(s.push(d,c,a+w),!k||(d=d.child(c),d.isText))break;u=k-1,a+=w+1}return new qd(n,s,u)}static resolveCached(t,n){let s=Kw.get(t);if(s)for(let u=0;u<s.elts.length;u++){let d=s.elts[u];if(d.pos==n)return d}else Kw.set(t,s=new QP);let a=s.elts[s.i]=qd.resolve(t,n);return s.i=(s.i+1)%eA,a}}class QP{constructor(){this.elts=[],this.i=0}}const eA=12,Kw=new WeakMap;class km{constructor(t,n,s){this.$from=t,this.$to=n,this.depth=s}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const tA=Object.create(null);let La=class _0{constructor(t,n,s,a=sn.none){this.type=t,this.attrs=n,this.marks=a,this.content=s||Ae.empty}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(t){return this.content.child(t)}maybeChild(t){return this.content.maybeChild(t)}forEach(t){this.content.forEach(t)}nodesBetween(t,n,s,a=0){this.content.nodesBetween(t,n,s,a,this)}descendants(t){this.nodesBetween(0,this.content.size,t)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(t,n,s,a){return this.content.textBetween(t,n,s,a)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)}sameMarkup(t){return this.hasMarkup(t.type,t.attrs,t.marks)}hasMarkup(t,n,s){return this.type==t&&wm(this.attrs,n||t.defaultAttrs||tA)&&sn.sameSet(this.marks,s||sn.none)}copy(t=null){return t==this.content?this:new _0(this.type,this.attrs,t,this.marks)}mark(t){return t==this.marks?this:new _0(this.type,this.attrs,this.content,t)}cut(t,n=this.content.size){return t==0&&n==this.content.size?this:this.copy(this.content.cut(t,n))}slice(t,n=this.content.size,s=!1){if(t==n)return Qe.empty;let a=this.resolve(t),u=this.resolve(n),d=s?0:a.sharedDepth(n),c=a.start(d),k=a.node(d).content.cut(a.pos-c,u.pos-c);return new Qe(k,a.depth-d,u.depth-d)}replace(t,n,s){return JP(this.resolve(t),this.resolve(n),s)}nodeAt(t){for(let n=this;;){let{index:s,offset:a}=n.content.findIndex(t);if(n=n.maybeChild(s),!n)return null;if(a==t||n.isText)return n;t-=a+1}}childAfter(t){let{index:n,offset:s}=this.content.findIndex(t);return{node:this.content.maybeChild(n),index:n,offset:s}}childBefore(t){if(t==0)return{node:null,index:0,offset:0};let{index:n,offset:s}=this.content.findIndex(t);if(s<t)return{node:this.content.child(n),index:n,offset:s};let a=this.content.child(n-1);return{node:a,index:n-1,offset:s-a.nodeSize}}resolve(t){return qd.resolveCached(this,t)}resolveNoCache(t){return qd.resolve(this,t)}rangeHasMark(t,n,s){let a=!1;return n>t&&this.nodesBetween(t,n,u=>(s.isInSet(u.marks)&&(a=!0),!a)),a}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),B2(this.marks,t)}contentMatchAt(t){let n=this.type.contentMatch.matchFragment(this.content,0,t);if(!n)throw new Error("Called contentMatchAt on a node with invalid content");return n}canReplace(t,n,s=Ae.empty,a=0,u=s.childCount){let d=this.contentMatchAt(t).matchFragment(s,a,u),c=d&&d.matchFragment(this.content,n);if(!c||!c.validEnd)return!1;for(let w=a;w<u;w++)if(!this.type.allowsMarks(s.child(w).marks))return!1;return!0}canReplaceWith(t,n,s,a){if(a&&!this.type.allowsMarks(a))return!1;let u=this.contentMatchAt(t).matchType(s),d=u&&u.matchFragment(this.content,n);return d?d.validEnd:!1}canAppend(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let t=sn.none;for(let n=0;n<this.marks.length;n++){let s=this.marks[n];s.type.checkAttrs(s.attrs),t=s.addToSet(t)}if(!sn.sameSet(t,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(n=>n.type.name)}`);this.content.forEach(n=>n.check())}toJSON(){let t={type:this.type.name};for(let n in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map(n=>n.toJSON())),t}static fromJSON(t,n){if(!n)throw new RangeError("Invalid input for Node.fromJSON");let s;if(n.marks){if(!Array.isArray(n.marks))throw new RangeError("Invalid mark data for Node.fromJSON");s=n.marks.map(t.markFromJSON)}if(n.type=="text"){if(typeof n.text!="string")throw new RangeError("Invalid text node in JSON");return t.text(n.text,s)}let a=Ae.fromJSON(t,n.content),u=t.nodeType(n.type).create(n.attrs,a,s);return u.type.checkAttrs(u.attrs),u}};La.prototype.text=void 0;class Tm extends La{constructor(t,n,s,a){if(super(t,n,null,a),!s)throw new RangeError("Empty text nodes are not allowed");this.text=s}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):B2(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(t,n){return this.text.slice(t,n)}get nodeSize(){return this.text.length}mark(t){return t==this.marks?this:new Tm(this.type,this.attrs,this.text,t)}withText(t){return t==this.text?this:new Tm(this.type,this.attrs,t,this.marks)}cut(t=0,n=this.text.length){return t==0&&n==this.text.length?this:this.withText(this.text.slice(t,n))}eq(t){return this.sameMarkup(t)&&this.text==t.text}toJSON(){let t=super.toJSON();return t.text=this.text,t}}function B2(e,t){for(let n=e.length-1;n>=0;n--)t=e[n].type.name+"("+t+")";return t}class Jl{constructor(t){this.validEnd=t,this.next=[],this.wrapCache=[]}static parse(t,n){let s=new nA(t,n);if(s.next==null)return Jl.empty;let a=F2(s);s.next&&s.err("Unexpected trailing text");let u=cA(lA(a));return uA(u,s),u}matchType(t){for(let n=0;n<this.next.length;n++)if(this.next[n].type==t)return this.next[n].next;return null}matchFragment(t,n=0,s=t.childCount){let a=this;for(let u=n;a&&u<s;u++)a=a.matchType(t.child(u).type);return a}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let t=0;t<this.next.length;t++){let{type:n}=this.next[t];if(!(n.isText||n.hasRequiredAttrs()))return n}return null}compatible(t){for(let n=0;n<this.next.length;n++)for(let s=0;s<t.next.length;s++)if(this.next[n].type==t.next[s].type)return!0;return!1}fillBefore(t,n=!1,s=0){let a=[this];function u(d,c){let w=d.matchFragment(t,s);if(w&&(!n||w.validEnd))return Ae.from(c.map(k=>k.createAndFill()));for(let k=0;k<d.next.length;k++){let{type:E,next:P}=d.next[k];if(!(E.isText||E.hasRequiredAttrs())&&a.indexOf(P)==-1){a.push(P);let A=u(P,c.concat(E));if(A)return A}}return null}return u(this,[])}findWrapping(t){for(let s=0;s<this.wrapCache.length;s+=2)if(this.wrapCache[s]==t)return this.wrapCache[s+1];let n=this.computeWrapping(t);return this.wrapCache.push(t,n),n}computeWrapping(t){let n=Object.create(null),s=[{match:this,type:null,via:null}];for(;s.length;){let a=s.shift(),u=a.match;if(u.matchType(t)){let d=[];for(let c=a;c.type;c=c.via)d.push(c.type);return d.reverse()}for(let d=0;d<u.next.length;d++){let{type:c,next:w}=u.next[d];!c.isLeaf&&!c.hasRequiredAttrs()&&!(c.name in n)&&(!a.type||w.validEnd)&&(s.push({match:c.contentMatch,type:c,via:a}),n[c.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(t){if(t>=this.next.length)throw new RangeError(`There's no ${t}th edge in this content match`);return this.next[t]}toString(){let t=[];function n(s){t.push(s);for(let a=0;a<s.next.length;a++)t.indexOf(s.next[a].next)==-1&&n(s.next[a].next)}return n(this),t.map((s,a)=>{let u=a+(s.validEnd?"*":" ")+" ";for(let d=0;d<s.next.length;d++)u+=(d?", ":"")+s.next[d].type.name+"->"+t.indexOf(s.next[d].next);return u}).join(`
`)}}Jl.empty=new Jl(!0);class nA{constructor(t,n){this.string=t,this.nodeTypes=n,this.inline=null,this.pos=0,this.tokens=t.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(t){return this.next==t&&(this.pos++||!0)}err(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")}}function F2(e){let t=[];do t.push(iA(e));while(e.eat("|"));return t.length==1?t[0]:{type:"choice",exprs:t}}function iA(e){let t=[];do t.push(rA(e));while(e.next&&e.next!=")"&&e.next!="|");return t.length==1?t[0]:{type:"seq",exprs:t}}function rA(e){let t=aA(e);for(;;)if(e.eat("+"))t={type:"plus",expr:t};else if(e.eat("*"))t={type:"star",expr:t};else if(e.eat("?"))t={type:"opt",expr:t};else if(e.eat("{"))t=sA(e,t);else break;return t}function Xw(e){/\D/.test(e.next)&&e.err("Expected number, got '"+e.next+"'");let t=Number(e.next);return e.pos++,t}function sA(e,t){let n=Xw(e),s=n;return e.eat(",")&&(e.next!="}"?s=Xw(e):s=-1),e.eat("}")||e.err("Unclosed braced range"),{type:"range",min:n,max:s,expr:t}}function oA(e,t){let n=e.nodeTypes,s=n[t];if(s)return[s];let a=[];for(let u in n){let d=n[u];d.isInGroup(t)&&a.push(d)}return a.length==0&&e.err("No node type or group '"+t+"' found"),a}function aA(e){if(e.eat("(")){let t=F2(e);return e.eat(")")||e.err("Missing closing paren"),t}else if(/\W/.test(e.next))e.err("Unexpected token '"+e.next+"'");else{let t=oA(e,e.next).map(n=>(e.inline==null?e.inline=n.isInline:e.inline!=n.isInline&&e.err("Mixing inline and block content"),{type:"name",value:n}));return e.pos++,t.length==1?t[0]:{type:"choice",exprs:t}}}function lA(e){let t=[[]];return a(u(e,0),n()),t;function n(){return t.push([])-1}function s(d,c,w){let k={term:w,to:c};return t[d].push(k),k}function a(d,c){d.forEach(w=>w.to=c)}function u(d,c){if(d.type=="choice")return d.exprs.reduce((w,k)=>w.concat(u(k,c)),[]);if(d.type=="seq")for(let w=0;;w++){let k=u(d.exprs[w],c);if(w==d.exprs.length-1)return k;a(k,c=n())}else if(d.type=="star"){let w=n();return s(c,w),a(u(d.expr,w),w),[s(w)]}else if(d.type=="plus"){let w=n();return a(u(d.expr,c),w),a(u(d.expr,w),w),[s(w)]}else{if(d.type=="opt")return[s(c)].concat(u(d.expr,c));if(d.type=="range"){let w=c;for(let k=0;k<d.min;k++){let E=n();a(u(d.expr,w),E),w=E}if(d.max==-1)a(u(d.expr,w),w);else for(let k=d.min;k<d.max;k++){let E=n();s(w,E),a(u(d.expr,w),E),w=E}return[s(w)]}else{if(d.type=="name")return[s(c,void 0,d.value)];throw new Error("Unknown expr type")}}}}function N2(e,t){return t-e}function Jw(e,t){let n=[];return s(t),n.sort(N2);function s(a){let u=e[a];if(u.length==1&&!u[0].term)return s(u[0].to);n.push(a);for(let d=0;d<u.length;d++){let{term:c,to:w}=u[d];!c&&n.indexOf(w)==-1&&s(w)}}}function cA(e){let t=Object.create(null);return n(Jw(e,0));function n(s){let a=[];s.forEach(d=>{e[d].forEach(({term:c,to:w})=>{if(!c)return;let k;for(let E=0;E<a.length;E++)a[E][0]==c&&(k=a[E][1]);Jw(e,w).forEach(E=>{k||a.push([c,k=[]]),k.indexOf(E)==-1&&k.push(E)})})});let u=t[s.join(",")]=new Jl(s.indexOf(e.length-1)>-1);for(let d=0;d<a.length;d++){let c=a[d][1].sort(N2);u.next.push({type:a[d][0],next:t[c.join(",")]||n(c)})}return u}}function uA(e,t){for(let n=0,s=[e];n<s.length;n++){let a=s[n],u=!a.validEnd,d=[];for(let c=0;c<a.next.length;c++){let{type:w,next:k}=a.next[c];d.push(w.name),u&&!(w.isText||w.hasRequiredAttrs())&&(u=!1),s.indexOf(k)==-1&&s.push(k)}u&&t.err("Only non-generatable nodes ("+d.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function V2(e){let t=Object.create(null);for(let n in e){let s=e[n];if(!s.hasDefault)return null;t[n]=s.default}return t}function $2(e,t){let n=Object.create(null);for(let s in e){let a=t&&t[s];if(a===void 0){let u=e[s];if(u.hasDefault)a=u.default;else throw new RangeError("No value supplied for attribute "+s)}n[s]=a}return n}function j2(e,t,n,s){for(let a in t)if(!(a in e))throw new RangeError(`Unsupported attribute ${a} for ${n} of type ${a}`);for(let a in e){let u=e[a];u.validate&&u.validate(t[a])}}function U2(e,t){let n=Object.create(null);if(t)for(let s in t)n[s]=new dA(e,s,t[s]);return n}let Yw=class q2{constructor(t,n,s){this.name=t,this.schema=n,this.spec=s,this.markSet=null,this.groups=s.group?s.group.split(" "):[],this.attrs=U2(t,s.attrs),this.defaultAttrs=V2(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(s.inline||t=="text"),this.isText=t=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==Jl.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(t){return this.groups.indexOf(t)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let t in this.attrs)if(this.attrs[t].isRequired)return!0;return!1}compatibleContent(t){return this==t||this.contentMatch.compatible(t.contentMatch)}computeAttrs(t){return!t&&this.defaultAttrs?this.defaultAttrs:$2(this.attrs,t)}create(t=null,n,s){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new La(this,this.computeAttrs(t),Ae.from(n),sn.setFrom(s))}createChecked(t=null,n,s){return n=Ae.from(n),this.checkContent(n),new La(this,this.computeAttrs(t),n,sn.setFrom(s))}createAndFill(t=null,n,s){if(t=this.computeAttrs(t),n=Ae.from(n),n.size){let d=this.contentMatch.fillBefore(n);if(!d)return null;n=d.append(n)}let a=this.contentMatch.matchFragment(n),u=a&&a.fillBefore(Ae.empty,!0);return u?new La(this,t,n.append(u),sn.setFrom(s)):null}validContent(t){let n=this.contentMatch.matchFragment(t);if(!n||!n.validEnd)return!1;for(let s=0;s<t.childCount;s++)if(!this.allowsMarks(t.child(s).marks))return!1;return!0}checkContent(t){if(!this.validContent(t))throw new RangeError(`Invalid content for node ${this.name}: ${t.toString().slice(0,50)}`)}checkAttrs(t){j2(this.attrs,t,"node",this.name)}allowsMarkType(t){return this.markSet==null||this.markSet.indexOf(t)>-1}allowsMarks(t){if(this.markSet==null)return!0;for(let n=0;n<t.length;n++)if(!this.allowsMarkType(t[n].type))return!1;return!0}allowedMarks(t){if(this.markSet==null)return t;let n;for(let s=0;s<t.length;s++)this.allowsMarkType(t[s].type)?n&&n.push(t[s]):n||(n=t.slice(0,s));return n?n.length?n:sn.none:t}static compile(t,n){let s=Object.create(null);t.forEach((u,d)=>s[u]=new q2(u,n,d));let a=n.spec.topNode||"doc";if(!s[a])throw new RangeError("Schema is missing its top node type ('"+a+"')");if(!s.text)throw new RangeError("Every schema needs a 'text' type");for(let u in s.text.attrs)throw new RangeError("The text node type should not have attributes");return s}};function hA(e,t,n){let s=n.split("|");return a=>{let u=a===null?"null":typeof a;if(s.indexOf(u)<0)throw new RangeError(`Expected value of type ${s} for attribute ${t} on type ${e}, got ${u}`)}}class dA{constructor(t,n,s){this.hasDefault=Object.prototype.hasOwnProperty.call(s,"default"),this.default=s.default,this.validate=typeof s.validate=="string"?hA(t,n,s.validate):s.validate}get isRequired(){return!this.hasDefault}}class eg{constructor(t,n,s,a){this.name=t,this.rank=n,this.schema=s,this.spec=a,this.attrs=U2(t,a.attrs),this.excluded=null;let u=V2(this.attrs);this.instance=u?new sn(this,u):null}create(t=null){return!t&&this.instance?this.instance:new sn(this,$2(this.attrs,t))}static compile(t,n){let s=Object.create(null),a=0;return t.forEach((u,d)=>s[u]=new eg(u,a++,n,d)),s}removeFromSet(t){for(var n=0;n<t.length;n++)t[n].type==this&&(t=t.slice(0,n).concat(t.slice(n+1)),n--);return t}isInSet(t){for(let n=0;n<t.length;n++)if(t[n].type==this)return t[n]}checkAttrs(t){j2(this.attrs,t,"mark",this.name)}excludes(t){return this.excluded.indexOf(t)>-1}}class H2{constructor(t){this.linebreakReplacement=null,this.cached=Object.create(null);let n=this.spec={};for(let a in t)n[a]=t[a];n.nodes=di.from(t.nodes),n.marks=di.from(t.marks||{}),this.nodes=Yw.compile(this.spec.nodes,this),this.marks=eg.compile(this.spec.marks,this);let s=Object.create(null);for(let a in this.nodes){if(a in this.marks)throw new RangeError(a+" can not be both a node and a mark");let u=this.nodes[a],d=u.spec.content||"",c=u.spec.marks;if(u.contentMatch=s[d]||(s[d]=Jl.parse(d,this.nodes)),u.inlineContent=u.contentMatch.inlineContent,u.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!u.isInline||!u.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=u}u.markSet=c=="_"?null:c?Qw(this,c.split(" ")):c==""||!u.inlineContent?[]:null}for(let a in this.marks){let u=this.marks[a],d=u.spec.excludes;u.excluded=d==null?[u]:d==""?[]:Qw(this,d.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(t,n=null,s,a){if(typeof t=="string")t=this.nodeType(t);else if(t instanceof Yw){if(t.schema!=this)throw new RangeError("Node type from different schema used ("+t.name+")")}else throw new RangeError("Invalid node type: "+t);return t.createChecked(n,s,a)}text(t,n){let s=this.nodes.text;return new Tm(s,s.defaultAttrs,t,sn.setFrom(n))}mark(t,n){return typeof t=="string"&&(t=this.marks[t]),t.create(n)}nodeFromJSON(t){return La.fromJSON(this,t)}markFromJSON(t){return sn.fromJSON(this,t)}nodeType(t){let n=this.nodes[t];if(!n)throw new RangeError("Unknown node type: "+t);return n}}function Qw(e,t){let n=[];for(let s=0;s<t.length;s++){let a=t[s],u=e.marks[a],d=u;if(u)n.push(u);else for(let c in e.marks){let w=e.marks[c];(a=="_"||w.spec.group&&w.spec.group.split(" ").indexOf(a)>-1)&&n.push(d=w)}if(!d)throw new SyntaxError("Unknown mark type: '"+t[s]+"'")}return n}function pA(e){return e.tag!=null}function fA(e){return e.style!=null}class Ba{constructor(t,n){this.schema=t,this.rules=n,this.tags=[],this.styles=[];let s=this.matchedStyles=[];n.forEach(a=>{if(pA(a))this.tags.push(a);else if(fA(a)){let u=/[^=]*/.exec(a.style)[0];s.indexOf(u)<0&&s.push(u),this.styles.push(a)}}),this.normalizeLists=!this.tags.some(a=>{if(!/^(ul|ol)\b/.test(a.tag)||!a.node)return!1;let u=t.nodes[a.node];return u.contentMatch.matchType(u)})}parse(t,n={}){let s=new tb(this,n,!1);return s.addAll(t,sn.none,n.from,n.to),s.finish()}parseSlice(t,n={}){let s=new tb(this,n,!0);return s.addAll(t,sn.none,n.from,n.to),Qe.maxOpen(s.finish())}matchTag(t,n,s){for(let a=s?this.tags.indexOf(s)+1:0;a<this.tags.length;a++){let u=this.tags[a];if(yA(t,u.tag)&&(u.namespace===void 0||t.namespaceURI==u.namespace)&&(!u.context||n.matchesContext(u.context))){if(u.getAttrs){let d=u.getAttrs(t);if(d===!1)continue;u.attrs=d||void 0}return u}}}matchStyle(t,n,s,a){for(let u=a?this.styles.indexOf(a)+1:0;u<this.styles.length;u++){let d=this.styles[u],c=d.style;if(!(c.indexOf(t)!=0||d.context&&!s.matchesContext(d.context)||c.length>t.length&&(c.charCodeAt(t.length)!=61||c.slice(t.length+1)!=n))){if(d.getAttrs){let w=d.getAttrs(n);if(w===!1)continue;d.attrs=w||void 0}return d}}}static schemaRules(t){let n=[];function s(a){let u=a.priority==null?50:a.priority,d=0;for(;d<n.length;d++){let c=n[d];if((c.priority==null?50:c.priority)<u)break}n.splice(d,0,a)}for(let a in t.marks){let u=t.marks[a].spec.parseDOM;u&&u.forEach(d=>{s(d=nb(d)),d.mark||d.ignore||d.clearMark||(d.mark=a)})}for(let a in t.nodes){let u=t.nodes[a].spec.parseDOM;u&&u.forEach(d=>{s(d=nb(d)),d.node||d.ignore||d.mark||(d.node=a)})}return n}static fromSchema(t){return t.cached.domParser||(t.cached.domParser=new Ba(t,Ba.schemaRules(t)))}}const Z2={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},mA={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},W2={ol:!0,ul:!0},Cm=1,Mm=2,kd=4;function eb(e,t,n){return t!=null?(t?Cm:0)|(t==="full"?Mm:0):e&&e.whitespace=="pre"?Cm|Mm:n&~kd}class Mf{constructor(t,n,s,a,u,d){this.type=t,this.attrs=n,this.marks=s,this.solid=a,this.options=d,this.content=[],this.activeMarks=sn.none,this.match=u||(d&kd?null:t.contentMatch)}findWrapping(t){if(!this.match){if(!this.type)return[];let n=this.type.contentMatch.fillBefore(Ae.from(t));if(n)this.match=this.type.contentMatch.matchFragment(n);else{let s=this.type.contentMatch,a;return(a=s.findWrapping(t.type))?(this.match=s,a):null}}return this.match.findWrapping(t.type)}finish(t){if(!(this.options&Cm)){let s=this.content[this.content.length-1],a;if(s&&s.isText&&(a=/[ \t\r\n\u000c]+$/.exec(s.text))){let u=s;s.text.length==a[0].length?this.content.pop():this.content[this.content.length-1]=u.withText(u.text.slice(0,u.text.length-a[0].length))}}let n=Ae.from(this.content);return!t&&this.match&&(n=n.append(this.match.fillBefore(Ae.empty,!0))),this.type?this.type.create(this.attrs,n,this.marks):n}inlineContext(t){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:t.parentNode&&!Z2.hasOwnProperty(t.parentNode.nodeName.toLowerCase())}}class tb{constructor(t,n,s){this.parser=t,this.options=n,this.isOpen=s,this.open=0;let a=n.topNode,u,d=eb(null,n.preserveWhitespace,0)|(s?kd:0);a?u=new Mf(a.type,a.attrs,sn.none,!0,n.topMatch||a.type.contentMatch,d):s?u=new Mf(null,null,sn.none,!0,null,d):u=new Mf(t.schema.topNodeType,null,sn.none,!0,null,d),this.nodes=[u],this.find=n.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(t,n){t.nodeType==3?this.addTextNode(t,n):t.nodeType==1&&this.addElement(t,n)}addTextNode(t,n){let s=t.nodeValue,a=this.top;if(a.options&Mm||a.inlineContext(t)||/[^ \t\r\n\u000c]/.test(s)){if(a.options&Cm)a.options&Mm?s=s.replace(/\r\n?/g,`
`):s=s.replace(/\r?\n|\r/g," ");else if(s=s.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(s)&&this.open==this.nodes.length-1){let u=a.content[a.content.length-1],d=t.previousSibling;(!u||d&&d.nodeName=="BR"||u.isText&&/[ \t\r\n\u000c]$/.test(u.text))&&(s=s.slice(1))}s&&this.insertNode(this.parser.schema.text(s),n),this.findInText(t)}else this.findInside(t)}addElement(t,n,s){let a=t.nodeName.toLowerCase(),u;W2.hasOwnProperty(a)&&this.parser.normalizeLists&&gA(t);let d=this.options.ruleFromNode&&this.options.ruleFromNode(t)||(u=this.parser.matchTag(t,this,s));if(d?d.ignore:mA.hasOwnProperty(a))this.findInside(t),this.ignoreFallback(t,n);else if(!d||d.skip||d.closeParent){d&&d.closeParent?this.open=Math.max(0,this.open-1):d&&d.skip.nodeType&&(t=d.skip);let c,w=this.top,k=this.needsBlock;if(Z2.hasOwnProperty(a))w.content.length&&w.content[0].isInline&&this.open&&(this.open--,w=this.top),c=!0,w.type||(this.needsBlock=!0);else if(!t.firstChild){this.leafFallback(t,n);return}let E=d&&d.skip?n:this.readStyles(t,n);E&&this.addAll(t,E),c&&this.sync(w),this.needsBlock=k}else{let c=this.readStyles(t,n);c&&this.addElementByRule(t,d,c,d.consuming===!1?u:void 0)}}leafFallback(t,n){t.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode(`
`),n)}ignoreFallback(t,n){t.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),n)}readStyles(t,n){let s=t.style;if(s&&s.length)for(let a=0;a<this.parser.matchedStyles.length;a++){let u=this.parser.matchedStyles[a],d=s.getPropertyValue(u);if(d)for(let c=void 0;;){let w=this.parser.matchStyle(u,d,this,c);if(!w)break;if(w.ignore)return null;if(w.clearMark?n=n.filter(k=>!w.clearMark(k)):n=n.concat(this.parser.schema.marks[w.mark].create(w.attrs)),w.consuming===!1)c=w;else break}}return n}addElementByRule(t,n,s,a){let u,d;if(n.node)if(d=this.parser.schema.nodes[n.node],d.isLeaf)this.insertNode(d.create(n.attrs),s)||this.leafFallback(t,s);else{let w=this.enter(d,n.attrs||null,s,n.preserveWhitespace);w&&(u=!0,s=w)}else{let w=this.parser.schema.marks[n.mark];s=s.concat(w.create(n.attrs))}let c=this.top;if(d&&d.isLeaf)this.findInside(t);else if(a)this.addElement(t,s,a);else if(n.getContent)this.findInside(t),n.getContent(t,this.parser.schema).forEach(w=>this.insertNode(w,s));else{let w=t;typeof n.contentElement=="string"?w=t.querySelector(n.contentElement):typeof n.contentElement=="function"?w=n.contentElement(t):n.contentElement&&(w=n.contentElement),this.findAround(t,w,!0),this.addAll(w,s),this.findAround(t,w,!1)}u&&this.sync(c)&&this.open--}addAll(t,n,s,a){let u=s||0;for(let d=s?t.childNodes[s]:t.firstChild,c=a==null?null:t.childNodes[a];d!=c;d=d.nextSibling,++u)this.findAtPoint(t,u),this.addDOM(d,n);this.findAtPoint(t,u)}findPlace(t,n){let s,a;for(let u=this.open;u>=0;u--){let d=this.nodes[u],c=d.findWrapping(t);if(c&&(!s||s.length>c.length)&&(s=c,a=d,!c.length)||d.solid)break}if(!s)return null;this.sync(a);for(let u=0;u<s.length;u++)n=this.enterInner(s[u],null,n,!1);return n}insertNode(t,n){if(t.isInline&&this.needsBlock&&!this.top.type){let a=this.textblockFromContext();a&&(n=this.enterInner(a,null,n))}let s=this.findPlace(t,n);if(s){this.closeExtra();let a=this.top;a.match&&(a.match=a.match.matchType(t.type));let u=sn.none;for(let d of s.concat(t.marks))(a.type?a.type.allowsMarkType(d.type):ib(d.type,t.type))&&(u=d.addToSet(u));return a.content.push(t.mark(u)),!0}return!1}enter(t,n,s,a){let u=this.findPlace(t.create(n),s);return u&&(u=this.enterInner(t,n,s,!0,a)),u}enterInner(t,n,s,a=!1,u){this.closeExtra();let d=this.top;d.match=d.match&&d.match.matchType(t);let c=eb(t,u,d.options);d.options&kd&&d.content.length==0&&(c|=kd);let w=sn.none;return s=s.filter(k=>(d.type?d.type.allowsMarkType(k.type):ib(k.type,t))?(w=k.addToSet(w),!1):!0),this.nodes.push(new Mf(t,n,w,a,null,c)),this.open++,s}closeExtra(t=!1){let n=this.nodes.length-1;if(n>this.open){for(;n>this.open;n--)this.nodes[n-1].content.push(this.nodes[n].finish(t));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)}sync(t){for(let n=this.open;n>=0;n--)if(this.nodes[n]==t)return this.open=n,!0;return!1}get currentPos(){this.closeExtra();let t=0;for(let n=this.open;n>=0;n--){let s=this.nodes[n].content;for(let a=s.length-1;a>=0;a--)t+=s[a].nodeSize;n&&t++}return t}findAtPoint(t,n){if(this.find)for(let s=0;s<this.find.length;s++)this.find[s].node==t&&this.find[s].offset==n&&(this.find[s].pos=this.currentPos)}findInside(t){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].pos==null&&t.nodeType==1&&t.contains(this.find[n].node)&&(this.find[n].pos=this.currentPos)}findAround(t,n,s){if(t!=n&&this.find)for(let a=0;a<this.find.length;a++)this.find[a].pos==null&&t.nodeType==1&&t.contains(this.find[a].node)&&n.compareDocumentPosition(this.find[a].node)&(s?2:4)&&(this.find[a].pos=this.currentPos)}findInText(t){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==t&&(this.find[n].pos=this.currentPos-(t.nodeValue.length-this.find[n].offset))}matchesContext(t){if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);let n=t.split("/"),s=this.options.context,a=!this.isOpen&&(!s||s.parent.type==this.nodes[0].type),u=-(s?s.depth+1:0)+(a?0:1),d=(c,w)=>{for(;c>=0;c--){let k=n[c];if(k==""){if(c==n.length-1||c==0)continue;for(;w>=u;w--)if(d(c-1,w))return!0;return!1}else{let E=w>0||w==0&&a?this.nodes[w].type:s&&w>=u?s.node(w-u).type:null;if(!E||E.name!=k&&!E.isInGroup(k))return!1;w--}}return!0};return d(n.length-1,this.open)}textblockFromContext(){let t=this.options.context;if(t)for(let n=t.depth;n>=0;n--){let s=t.node(n).contentMatchAt(t.indexAfter(n)).defaultType;if(s&&s.isTextblock&&s.defaultAttrs)return s}for(let n in this.parser.schema.nodes){let s=this.parser.schema.nodes[n];if(s.isTextblock&&s.defaultAttrs)return s}}}function gA(e){for(let t=e.firstChild,n=null;t;t=t.nextSibling){let s=t.nodeType==1?t.nodeName.toLowerCase():null;s&&W2.hasOwnProperty(s)&&n?(n.appendChild(t),t=n):s=="li"?n=t:s&&(n=null)}}function yA(e,t){return(e.matches||e.msMatchesSelector||e.webkitMatchesSelector||e.mozMatchesSelector).call(e,t)}function nb(e){let t={};for(let n in e)t[n]=e[n];return t}function ib(e,t){let n=t.schema.nodes;for(let s in n){let a=n[s];if(!a.allowsMarkType(e))continue;let u=[],d=c=>{u.push(c);for(let w=0;w<c.edgeCount;w++){let{type:k,next:E}=c.edge(w);if(k==t||u.indexOf(E)<0&&d(E))return!0}};if(d(a.contentMatch))return!0}}class nc{constructor(t,n){this.nodes=t,this.marks=n}serializeFragment(t,n={},s){s||(s=t_(n).createDocumentFragment());let a=s,u=[];return t.forEach(d=>{if(u.length||d.marks.length){let c=0,w=0;for(;c<u.length&&w<d.marks.length;){let k=d.marks[w];if(!this.marks[k.type.name]){w++;continue}if(!k.eq(u[c][0])||k.type.spec.spanning===!1)break;c++,w++}for(;c<u.length;)a=u.pop()[1];for(;w<d.marks.length;){let k=d.marks[w++],E=this.serializeMark(k,d.isInline,n);E&&(u.push([k,a]),a.appendChild(E.dom),a=E.contentDOM||E.dom)}}a.appendChild(this.serializeNodeInner(d,n))}),s}serializeNodeInner(t,n){let{dom:s,contentDOM:a}=Zf(t_(n),this.nodes[t.type.name](t),null,t.attrs);if(a){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(t.content,n,a)}return s}serializeNode(t,n={}){let s=this.serializeNodeInner(t,n);for(let a=t.marks.length-1;a>=0;a--){let u=this.serializeMark(t.marks[a],t.isInline,n);u&&((u.contentDOM||u.dom).appendChild(s),s=u.dom)}return s}serializeMark(t,n,s={}){let a=this.marks[t.type.name];return a&&Zf(t_(s),a(t,n),null,t.attrs)}static renderSpec(t,n,s=null,a){return Zf(t,n,s,a)}static fromSchema(t){return t.cached.domSerializer||(t.cached.domSerializer=new nc(this.nodesFromSchema(t),this.marksFromSchema(t)))}static nodesFromSchema(t){let n=rb(t.nodes);return n.text||(n.text=s=>s.text),n}static marksFromSchema(t){return rb(t.marks)}}function rb(e){let t={};for(let n in e){let s=e[n].spec.toDOM;s&&(t[n]=s)}return t}function t_(e){return e.document||window.document}const sb=new WeakMap;function _A(e){let t=sb.get(e);return t===void 0&&sb.set(e,t=vA(e)),t}function vA(e){let t=null;function n(s){if(s&&typeof s=="object")if(Array.isArray(s))if(typeof s[0]=="string")t||(t=[]),t.push(s);else for(let a=0;a<s.length;a++)n(s[a]);else for(let a in s)n(s[a])}return n(e),t}function Zf(e,t,n,s){if(typeof t=="string")return{dom:e.createTextNode(t)};if(t.nodeType!=null)return{dom:t};if(t.dom&&t.dom.nodeType!=null)return t;let a=t[0],u;if(typeof a!="string")throw new RangeError("Invalid array passed to renderSpec");if(s&&(u=_A(s))&&u.indexOf(t)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let d=a.indexOf(" ");d>0&&(n=a.slice(0,d),a=a.slice(d+1));let c,w=n?e.createElementNS(n,a):e.createElement(a),k=t[1],E=1;if(k&&typeof k=="object"&&k.nodeType==null&&!Array.isArray(k)){E=2;for(let P in k)if(k[P]!=null){let A=P.indexOf(" ");A>0?w.setAttributeNS(P.slice(0,A),P.slice(A+1),k[P]):w.setAttribute(P,k[P])}}for(let P=E;P<t.length;P++){let A=t[P];if(A===0){if(P<t.length-1||P>E)throw new RangeError("Content hole must be the only child of its parent node");return{dom:w,contentDOM:w}}else{let{dom:$,contentDOM:j}=Zf(e,A,n,s);if(w.appendChild($),j){if(c)throw new RangeError("Multiple content holes");c=j}}}return{dom:w,contentDOM:c}}const G2=65535,K2=Math.pow(2,16);function xA(e,t){return e+t*K2}function ob(e){return e&G2}function wA(e){return(e-(e&G2))/K2}const X2=1,J2=2,Wf=4,Y2=8;class v0{constructor(t,n,s){this.pos=t,this.delInfo=n,this.recover=s}get deleted(){return(this.delInfo&Y2)>0}get deletedBefore(){return(this.delInfo&(X2|Wf))>0}get deletedAfter(){return(this.delInfo&(J2|Wf))>0}get deletedAcross(){return(this.delInfo&Wf)>0}}class Lr{constructor(t,n=!1){if(this.ranges=t,this.inverted=n,!t.length&&Lr.empty)return Lr.empty}recover(t){let n=0,s=ob(t);if(!this.inverted)for(let a=0;a<s;a++)n+=this.ranges[a*3+2]-this.ranges[a*3+1];return this.ranges[s*3]+n+wA(t)}mapResult(t,n=1){return this._map(t,n,!1)}map(t,n=1){return this._map(t,n,!0)}_map(t,n,s){let a=0,u=this.inverted?2:1,d=this.inverted?1:2;for(let c=0;c<this.ranges.length;c+=3){let w=this.ranges[c]-(this.inverted?a:0);if(w>t)break;let k=this.ranges[c+u],E=this.ranges[c+d],P=w+k;if(t<=P){let A=k?t==w?-1:t==P?1:n:n,$=w+a+(A<0?0:E);if(s)return $;let j=t==(n<0?w:P)?null:xA(c/3,t-w),X=t==w?J2:t==P?X2:Wf;return(n<0?t!=w:t!=P)&&(X|=Y2),new v0($,X,j)}a+=E-k}return s?t+a:new v0(t+a,0,null)}touches(t,n){let s=0,a=ob(n),u=this.inverted?2:1,d=this.inverted?1:2;for(let c=0;c<this.ranges.length;c+=3){let w=this.ranges[c]-(this.inverted?s:0);if(w>t)break;let k=this.ranges[c+u],E=w+k;if(t<=E&&c==a*3)return!0;s+=this.ranges[c+d]-k}return!1}forEach(t){let n=this.inverted?2:1,s=this.inverted?1:2;for(let a=0,u=0;a<this.ranges.length;a+=3){let d=this.ranges[a],c=d-(this.inverted?u:0),w=d+(this.inverted?0:u),k=this.ranges[a+n],E=this.ranges[a+s];t(c,c+k,w,w+E),u+=E-k}}invert(){return new Lr(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(t){return t==0?Lr.empty:new Lr(t<0?[0,-t,0]:[0,0,t])}}Lr.empty=new Lr([]);class Su{constructor(t=[],n,s=0,a=t.length){this.maps=t,this.mirror=n,this.from=s,this.to=a}slice(t=0,n=this.maps.length){return new Su(this.maps,this.mirror,t,n)}copy(){return new Su(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)}appendMap(t,n){this.to=this.maps.push(t),n!=null&&this.setMirror(this.maps.length-1,n)}appendMapping(t){for(let n=0,s=this.maps.length;n<t.maps.length;n++){let a=t.getMirror(n);this.appendMap(t.maps[n],a!=null&&a<n?s+a:void 0)}}getMirror(t){if(this.mirror){for(let n=0;n<this.mirror.length;n++)if(this.mirror[n]==t)return this.mirror[n+(n%2?-1:1)]}}setMirror(t,n){this.mirror||(this.mirror=[]),this.mirror.push(t,n)}appendMappingInverted(t){for(let n=t.maps.length-1,s=this.maps.length+t.maps.length;n>=0;n--){let a=t.getMirror(n);this.appendMap(t.maps[n].invert(),a!=null&&a>n?s-a-1:void 0)}}invert(){let t=new Su;return t.appendMappingInverted(this),t}map(t,n=1){if(this.mirror)return this._map(t,n,!0);for(let s=this.from;s<this.to;s++)t=this.maps[s].map(t,n);return t}mapResult(t,n=1){return this._map(t,n,!1)}_map(t,n,s){let a=0;for(let u=this.from;u<this.to;u++){let d=this.maps[u],c=d.mapResult(t,n);if(c.recover!=null){let w=this.getMirror(u);if(w!=null&&w>u&&w<this.to){u=w,t=this.maps[w].recover(c.recover);continue}}a|=c.delInfo,t=c.pos}return s?t:new v0(t,a,null)}}const n_=Object.create(null);class Li{getMap(){return Lr.empty}merge(t){return null}static fromJSON(t,n){if(!n||!n.stepType)throw new RangeError("Invalid input for Step.fromJSON");let s=n_[n.stepType];if(!s)throw new RangeError(`No step type ${n.stepType} defined`);return s.fromJSON(t,n)}static jsonID(t,n){if(t in n_)throw new RangeError("Duplicate use of step JSON ID "+t);return n_[t]=n,n.prototype.jsonID=t,n}}class Fn{constructor(t,n){this.doc=t,this.failed=n}static ok(t){return new Fn(t,null)}static fail(t){return new Fn(null,t)}static fromReplace(t,n,s,a){try{return Fn.ok(t.replace(n,s,a))}catch(u){if(u instanceof bm)return Fn.fail(u.message);throw u}}}function Pv(e,t,n){let s=[];for(let a=0;a<e.childCount;a++){let u=e.child(a);u.content.size&&(u=u.copy(Pv(u.content,t,u))),u.isInline&&(u=t(u,n,a)),s.push(u)}return Ae.fromArray(s)}class Ta extends Li{constructor(t,n,s){super(),this.from=t,this.to=n,this.mark=s}apply(t){let n=t.slice(this.from,this.to),s=t.resolve(this.from),a=s.node(s.sharedDepth(this.to)),u=new Qe(Pv(n.content,(d,c)=>!d.isAtom||!c.type.allowsMarkType(this.mark.type)?d:d.mark(this.mark.addToSet(d.marks)),a),n.openStart,n.openEnd);return Fn.fromReplace(t,this.from,this.to,u)}invert(){return new Zs(this.from,this.to,this.mark)}map(t){let n=t.mapResult(this.from,1),s=t.mapResult(this.to,-1);return n.deleted&&s.deleted||n.pos>=s.pos?null:new Ta(n.pos,s.pos,this.mark)}merge(t){return t instanceof Ta&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new Ta(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new Ta(n.from,n.to,t.markFromJSON(n.mark))}}Li.jsonID("addMark",Ta);class Zs extends Li{constructor(t,n,s){super(),this.from=t,this.to=n,this.mark=s}apply(t){let n=t.slice(this.from,this.to),s=new Qe(Pv(n.content,a=>a.mark(this.mark.removeFromSet(a.marks)),t),n.openStart,n.openEnd);return Fn.fromReplace(t,this.from,this.to,s)}invert(){return new Ta(this.from,this.to,this.mark)}map(t){let n=t.mapResult(this.from,1),s=t.mapResult(this.to,-1);return n.deleted&&s.deleted||n.pos>=s.pos?null:new Zs(n.pos,s.pos,this.mark)}merge(t){return t instanceof Zs&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new Zs(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new Zs(n.from,n.to,t.markFromJSON(n.mark))}}Li.jsonID("removeMark",Zs);class Ca extends Li{constructor(t,n){super(),this.pos=t,this.mark=n}apply(t){let n=t.nodeAt(this.pos);if(!n)return Fn.fail("No node at mark step's position");let s=n.type.create(n.attrs,null,this.mark.addToSet(n.marks));return Fn.fromReplace(t,this.pos,this.pos+1,new Qe(Ae.from(s),0,n.isLeaf?0:1))}invert(t){let n=t.nodeAt(this.pos);if(n){let s=this.mark.addToSet(n.marks);if(s.length==n.marks.length){for(let a=0;a<n.marks.length;a++)if(!n.marks[a].isInSet(s))return new Ca(this.pos,n.marks[a]);return new Ca(this.pos,this.mark)}}return new Ru(this.pos,this.mark)}map(t){let n=t.mapResult(this.pos,1);return n.deletedAfter?null:new Ca(n.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new Ca(n.pos,t.markFromJSON(n.mark))}}Li.jsonID("addNodeMark",Ca);class Ru extends Li{constructor(t,n){super(),this.pos=t,this.mark=n}apply(t){let n=t.nodeAt(this.pos);if(!n)return Fn.fail("No node at mark step's position");let s=n.type.create(n.attrs,null,this.mark.removeFromSet(n.marks));return Fn.fromReplace(t,this.pos,this.pos+1,new Qe(Ae.from(s),0,n.isLeaf?0:1))}invert(t){let n=t.nodeAt(this.pos);return!n||!this.mark.isInSet(n.marks)?this:new Ca(this.pos,this.mark)}map(t){let n=t.mapResult(this.pos,1);return n.deletedAfter?null:new Ru(n.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new Ru(n.pos,t.markFromJSON(n.mark))}}Li.jsonID("removeNodeMark",Ru);class ei extends Li{constructor(t,n,s,a=!1){super(),this.from=t,this.to=n,this.slice=s,this.structure=a}apply(t){return this.structure&&x0(t,this.from,this.to)?Fn.fail("Structure replace would overwrite content"):Fn.fromReplace(t,this.from,this.to,this.slice)}getMap(){return new Lr([this.from,this.to-this.from,this.slice.size])}invert(t){return new ei(this.from,this.from+this.slice.size,t.slice(this.from,this.to))}map(t){let n=t.mapResult(this.from,1),s=t.mapResult(this.to,-1);return n.deletedAcross&&s.deletedAcross?null:new ei(n.pos,Math.max(n.pos,s.pos),this.slice)}merge(t){if(!(t instanceof ei)||t.structure||this.structure)return null;if(this.from+this.slice.size==t.from&&!this.slice.openEnd&&!t.slice.openStart){let n=this.slice.size+t.slice.size==0?Qe.empty:new Qe(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new ei(this.from,this.to+(t.to-t.from),n,this.structure)}else if(t.to==this.from&&!this.slice.openStart&&!t.slice.openEnd){let n=this.slice.size+t.slice.size==0?Qe.empty:new Qe(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new ei(t.from,this.to,n,this.structure)}else return null}toJSON(){let t={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new ei(n.from,n.to,Qe.fromJSON(t,n.slice),!!n.structure)}}Li.jsonID("replace",ei);class ni extends Li{constructor(t,n,s,a,u,d,c=!1){super(),this.from=t,this.to=n,this.gapFrom=s,this.gapTo=a,this.slice=u,this.insert=d,this.structure=c}apply(t){if(this.structure&&(x0(t,this.from,this.gapFrom)||x0(t,this.gapTo,this.to)))return Fn.fail("Structure gap-replace would overwrite content");let n=t.slice(this.gapFrom,this.gapTo);if(n.openStart||n.openEnd)return Fn.fail("Gap is not a flat range");let s=this.slice.insertAt(this.insert,n.content);return s?Fn.fromReplace(t,this.from,this.to,s):Fn.fail("Content does not fit in gap")}getMap(){return new Lr([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(t){let n=this.gapTo-this.gapFrom;return new ni(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(t){let n=t.mapResult(this.from,1),s=t.mapResult(this.to,-1),a=this.from==this.gapFrom?n.pos:t.map(this.gapFrom,-1),u=this.to==this.gapTo?s.pos:t.map(this.gapTo,1);return n.deletedAcross&&s.deletedAcross||a<n.pos||u>s.pos?null:new ni(n.pos,s.pos,a,u,this.slice,this.insert,this.structure)}toJSON(){let t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,n){if(typeof n.from!="number"||typeof n.to!="number"||typeof n.gapFrom!="number"||typeof n.gapTo!="number"||typeof n.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new ni(n.from,n.to,n.gapFrom,n.gapTo,Qe.fromJSON(t,n.slice),n.insert,!!n.structure)}}Li.jsonID("replaceAround",ni);function x0(e,t,n){let s=e.resolve(t),a=n-t,u=s.depth;for(;a>0&&u>0&&s.indexAfter(u)==s.node(u).childCount;)u--,a--;if(a>0){let d=s.node(u).maybeChild(s.indexAfter(u));for(;a>0;){if(!d||d.isLeaf)return!0;d=d.firstChild,a--}}return!1}function bA(e,t,n,s){let a=[],u=[],d,c;e.doc.nodesBetween(t,n,(w,k,E)=>{if(!w.isInline)return;let P=w.marks;if(!s.isInSet(P)&&E.type.allowsMarkType(s.type)){let A=Math.max(k,t),$=Math.min(k+w.nodeSize,n),j=s.addToSet(P);for(let X=0;X<P.length;X++)P[X].isInSet(j)||(d&&d.to==A&&d.mark.eq(P[X])?d.to=$:a.push(d=new Zs(A,$,P[X])));c&&c.to==A?c.to=$:u.push(c=new Ta(A,$,s))}}),a.forEach(w=>e.step(w)),u.forEach(w=>e.step(w))}function SA(e,t,n,s){let a=[],u=0;e.doc.nodesBetween(t,n,(d,c)=>{if(!d.isInline)return;u++;let w=null;if(s instanceof eg){let k=d.marks,E;for(;E=s.isInSet(k);)(w||(w=[])).push(E),k=E.removeFromSet(k)}else s?s.isInSet(d.marks)&&(w=[s]):w=d.marks;if(w&&w.length){let k=Math.min(c+d.nodeSize,n);for(let E=0;E<w.length;E++){let P=w[E],A;for(let $=0;$<a.length;$++){let j=a[$];j.step==u-1&&P.eq(a[$].style)&&(A=j)}A?(A.to=k,A.step=u):a.push({style:P,from:Math.max(c,t),to:k,step:u})}}}),a.forEach(d=>e.step(new Zs(d.from,d.to,d.style)))}function Av(e,t,n,s=n.contentMatch,a=!0){let u=e.doc.nodeAt(t),d=[],c=t+1;for(let w=0;w<u.childCount;w++){let k=u.child(w),E=c+k.nodeSize,P=s.matchType(k.type);if(!P)d.push(new ei(c,E,Qe.empty));else{s=P;for(let A=0;A<k.marks.length;A++)n.allowsMarkType(k.marks[A].type)||e.step(new Zs(c,E,k.marks[A]));if(a&&k.isText&&n.whitespace!="pre"){let A,$=/\r?\n|\r/g,j;for(;A=$.exec(k.text);)j||(j=new Qe(Ae.from(n.schema.text(" ",n.allowedMarks(k.marks))),0,0)),d.push(new ei(c+A.index,c+A.index+A[0].length,j))}}c=E}if(!s.validEnd){let w=s.fillBefore(Ae.empty,!0);e.replace(c,c,new Qe(w,0,0))}for(let w=d.length-1;w>=0;w--)e.step(d[w])}function kA(e,t,n){return(t==0||e.canReplace(t,e.childCount))&&(n==e.childCount||e.canReplace(0,n))}function Uu(e){let n=e.parent.content.cutByIndex(e.startIndex,e.endIndex);for(let s=e.depth;;--s){let a=e.$from.node(s),u=e.$from.index(s),d=e.$to.indexAfter(s);if(s<e.depth&&a.canReplace(u,d,n))return s;if(s==0||a.type.spec.isolating||!kA(a,u,d))break}return null}function TA(e,t,n){let{$from:s,$to:a,depth:u}=t,d=s.before(u+1),c=a.after(u+1),w=d,k=c,E=Ae.empty,P=0;for(let j=u,X=!1;j>n;j--)X||s.index(j)>0?(X=!0,E=Ae.from(s.node(j).copy(E)),P++):w--;let A=Ae.empty,$=0;for(let j=u,X=!1;j>n;j--)X||a.after(j+1)<a.end(j)?(X=!0,A=Ae.from(a.node(j).copy(A)),$++):k++;e.step(new ni(w,k,d,c,new Qe(E.append(A),P,$),E.size-P,!0))}function zv(e,t,n=null,s=e){let a=CA(e,t),u=a&&MA(s,t);return u?a.map(ab).concat({type:t,attrs:n}).concat(u.map(ab)):null}function ab(e){return{type:e,attrs:null}}function CA(e,t){let{parent:n,startIndex:s,endIndex:a}=e,u=n.contentMatchAt(s).findWrapping(t);if(!u)return null;let d=u.length?u[0]:t;return n.canReplaceWith(s,a,d)?u:null}function MA(e,t){let{parent:n,startIndex:s,endIndex:a}=e,u=n.child(s),d=t.contentMatch.findWrapping(u.type);if(!d)return null;let w=(d.length?d[d.length-1]:t).contentMatch;for(let k=s;w&&k<a;k++)w=w.matchType(n.child(k).type);return!w||!w.validEnd?null:d}function EA(e,t,n){let s=Ae.empty;for(let d=n.length-1;d>=0;d--){if(s.size){let c=n[d].type.contentMatch.matchFragment(s);if(!c||!c.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}s=Ae.from(n[d].type.create(n[d].attrs,s))}let a=t.start,u=t.end;e.step(new ni(a,u,a,u,new Qe(s,0,0),n.length,!0))}function IA(e,t,n,s,a){if(!s.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let u=e.steps.length;e.doc.nodesBetween(t,n,(d,c)=>{let w=typeof a=="function"?a(d):a;if(d.isTextblock&&!d.hasMarkup(s,w)&&PA(e.doc,e.mapping.slice(u).map(c),s)){let k=null;if(s.schema.linebreakReplacement){let $=s.whitespace=="pre",j=!!s.contentMatch.matchType(s.schema.linebreakReplacement);$&&!j?k=!1:!$&&j&&(k=!0)}k===!1&&eT(e,d,c,u),Av(e,e.mapping.slice(u).map(c,1),s,void 0,k===null);let E=e.mapping.slice(u),P=E.map(c,1),A=E.map(c+d.nodeSize,1);return e.step(new ni(P,A,P+1,A-1,new Qe(Ae.from(s.create(w,null,d.marks)),0,0),1,!0)),k===!0&&Q2(e,d,c,u),!1}})}function Q2(e,t,n,s){t.forEach((a,u)=>{if(a.isText){let d,c=/\r?\n|\r/g;for(;d=c.exec(a.text);){let w=e.mapping.slice(s).map(n+1+u+d.index);e.replaceWith(w,w+1,t.type.schema.linebreakReplacement.create())}}})}function eT(e,t,n,s){t.forEach((a,u)=>{if(a.type==a.type.schema.linebreakReplacement){let d=e.mapping.slice(s).map(n+1+u);e.replaceWith(d,d+1,t.type.schema.text(`
`))}})}function PA(e,t,n){let s=e.resolve(t),a=s.index();return s.parent.canReplaceWith(a,a+1,n)}function AA(e,t,n,s,a){let u=e.doc.nodeAt(t);if(!u)throw new RangeError("No node at given position");n||(n=u.type);let d=n.create(s,null,a||u.marks);if(u.isLeaf)return e.replaceWith(t,t+u.nodeSize,d);if(!n.validContent(u.content))throw new RangeError("Invalid content for node type "+n.name);e.step(new ni(t,t+u.nodeSize,t+1,t+u.nodeSize-1,new Qe(Ae.from(d),0,0),1,!0))}function ku(e,t,n=1,s){let a=e.resolve(t),u=a.depth-n,d=s&&s[s.length-1]||a.parent;if(u<0||a.parent.type.spec.isolating||!a.parent.canReplace(a.index(),a.parent.childCount)||!d.type.validContent(a.parent.content.cutByIndex(a.index(),a.parent.childCount)))return!1;for(let k=a.depth-1,E=n-2;k>u;k--,E--){let P=a.node(k),A=a.index(k);if(P.type.spec.isolating)return!1;let $=P.content.cutByIndex(A,P.childCount),j=s&&s[E+1];j&&($=$.replaceChild(0,j.type.create(j.attrs)));let X=s&&s[E]||P;if(!P.canReplace(A+1,P.childCount)||!X.type.validContent($))return!1}let c=a.indexAfter(u),w=s&&s[0];return a.node(u).canReplaceWith(c,c,w?w.type:a.node(u+1).type)}function zA(e,t,n=1,s){let a=e.doc.resolve(t),u=Ae.empty,d=Ae.empty;for(let c=a.depth,w=a.depth-n,k=n-1;c>w;c--,k--){u=Ae.from(a.node(c).copy(u));let E=s&&s[k];d=Ae.from(E?E.type.create(E.attrs,d):a.node(c).copy(d))}e.step(new ei(t,t,new Qe(u.append(d),n,n),!0))}function Ga(e,t){let n=e.resolve(t),s=n.index();return tT(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(s,s+1)}function DA(e,t){t.content.size||e.type.compatibleContent(t.type);let n=e.contentMatchAt(e.childCount),{linebreakReplacement:s}=e.type.schema;for(let a=0;a<t.childCount;a++){let u=t.child(a),d=u.type==s?e.type.schema.nodes.text:u.type;if(n=n.matchType(d),!n||!e.type.allowsMarks(u.marks))return!1}return n.validEnd}function tT(e,t){return!!(e&&t&&!e.isLeaf&&DA(e,t))}function tg(e,t,n=-1){let s=e.resolve(t);for(let a=s.depth;;a--){let u,d,c=s.index(a);if(a==s.depth?(u=s.nodeBefore,d=s.nodeAfter):n>0?(u=s.node(a+1),c++,d=s.node(a).maybeChild(c)):(u=s.node(a).maybeChild(c-1),d=s.node(a+1)),u&&!u.isTextblock&&tT(u,d)&&s.node(a).canReplace(c,c+1))return t;if(a==0)break;t=n<0?s.before(a):s.after(a)}}function RA(e,t,n){let s=null,{linebreakReplacement:a}=e.doc.type.schema,u=e.doc.resolve(t-n),d=u.node().type;if(a&&d.inlineContent){let E=d.whitespace=="pre",P=!!d.contentMatch.matchType(a);E&&!P?s=!1:!E&&P&&(s=!0)}let c=e.steps.length;if(s===!1){let E=e.doc.resolve(t+n);eT(e,E.node(),E.before(),c)}d.inlineContent&&Av(e,t+n-1,d,u.node().contentMatchAt(u.index()),s==null);let w=e.mapping.slice(c),k=w.map(t-n);if(e.step(new ei(k,w.map(t+n,-1),Qe.empty,!0)),s===!0){let E=e.doc.resolve(k);Q2(e,E.node(),E.before(),e.steps.length)}return e}function OA(e,t,n){let s=e.resolve(t);if(s.parent.canReplaceWith(s.index(),s.index(),n))return t;if(s.parentOffset==0)for(let a=s.depth-1;a>=0;a--){let u=s.index(a);if(s.node(a).canReplaceWith(u,u,n))return s.before(a+1);if(u>0)return null}if(s.parentOffset==s.parent.content.size)for(let a=s.depth-1;a>=0;a--){let u=s.indexAfter(a);if(s.node(a).canReplaceWith(u,u,n))return s.after(a+1);if(u<s.node(a).childCount)return null}return null}function nT(e,t,n){let s=e.resolve(t);if(!n.content.size)return t;let a=n.content;for(let u=0;u<n.openStart;u++)a=a.firstChild.content;for(let u=1;u<=(n.openStart==0&&n.size?2:1);u++)for(let d=s.depth;d>=0;d--){let c=d==s.depth?0:s.pos<=(s.start(d+1)+s.end(d+1))/2?-1:1,w=s.index(d)+(c>0?1:0),k=s.node(d),E=!1;if(u==1)E=k.canReplace(w,w,a);else{let P=k.contentMatchAt(w).findWrapping(a.firstChild.type);E=P&&k.canReplaceWith(w,w,P[0])}if(E)return c==0?s.pos:c<0?s.before(d+1):s.after(d+1)}return null}function ng(e,t,n=t,s=Qe.empty){if(t==n&&!s.size)return null;let a=e.resolve(t),u=e.resolve(n);return iT(a,u,s)?new ei(t,n,s):new LA(a,u,s).fit()}function iT(e,t,n){return!n.openStart&&!n.openEnd&&e.start()==t.start()&&e.parent.canReplace(e.index(),t.index(),n.content)}class LA{constructor(t,n,s){this.$from=t,this.$to=n,this.unplaced=s,this.frontier=[],this.placed=Ae.empty;for(let a=0;a<=t.depth;a++){let u=t.node(a);this.frontier.push({type:u.type,match:u.contentMatchAt(t.indexAfter(a))})}for(let a=t.depth;a>0;a--)this.placed=Ae.from(t.node(a).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let k=this.findFittable();k?this.placeNodes(k):this.openMore()||this.dropNode()}let t=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,s=this.$from,a=this.close(t<0?this.$to:s.doc.resolve(t));if(!a)return null;let u=this.placed,d=s.depth,c=a.depth;for(;d&&c&&u.childCount==1;)u=u.firstChild.content,d--,c--;let w=new Qe(u,d,c);return t>-1?new ni(s.pos,t,this.$to.pos,this.$to.end(),w,n):w.size||s.pos!=this.$to.pos?new ei(s.pos,a.pos,w):null}findFittable(){let t=this.unplaced.openStart;for(let n=this.unplaced.content,s=0,a=this.unplaced.openEnd;s<t;s++){let u=n.firstChild;if(n.childCount>1&&(a=0),u.type.spec.isolating&&a<=s){t=s;break}n=u.content}for(let n=1;n<=2;n++)for(let s=n==1?t:this.unplaced.openStart;s>=0;s--){let a,u=null;s?(u=i_(this.unplaced.content,s-1).firstChild,a=u.content):a=this.unplaced.content;let d=a.firstChild;for(let c=this.depth;c>=0;c--){let{type:w,match:k}=this.frontier[c],E,P=null;if(n==1&&(d?k.matchType(d.type)||(P=k.fillBefore(Ae.from(d),!1)):u&&w.compatibleContent(u.type)))return{sliceDepth:s,frontierDepth:c,parent:u,inject:P};if(n==2&&d&&(E=k.findWrapping(d.type)))return{sliceDepth:s,frontierDepth:c,parent:u,wrap:E};if(u&&k.matchType(u.type))break}}}openMore(){let{content:t,openStart:n,openEnd:s}=this.unplaced,a=i_(t,n);return!a.childCount||a.firstChild.isLeaf?!1:(this.unplaced=new Qe(t,n+1,Math.max(s,a.size+n>=t.size-s?n+1:0)),!0)}dropNode(){let{content:t,openStart:n,openEnd:s}=this.unplaced,a=i_(t,n);if(a.childCount<=1&&n>0){let u=t.size-n<=n+a.size;this.unplaced=new Qe(hd(t,n-1,1),n-1,u?n-1:s)}else this.unplaced=new Qe(hd(t,n,1),n,s)}placeNodes({sliceDepth:t,frontierDepth:n,parent:s,inject:a,wrap:u}){for(;this.depth>n;)this.closeFrontierNode();if(u)for(let X=0;X<u.length;X++)this.openFrontierNode(u[X]);let d=this.unplaced,c=s?s.content:d.content,w=d.openStart-t,k=0,E=[],{match:P,type:A}=this.frontier[n];if(a){for(let X=0;X<a.childCount;X++)E.push(a.child(X));P=P.matchFragment(a)}let $=c.size+t-(d.content.size-d.openEnd);for(;k<c.childCount;){let X=c.child(k),he=P.matchType(X.type);if(!he)break;k++,(k>1||w==0||X.content.size)&&(P=he,E.push(rT(X.mark(A.allowedMarks(X.marks)),k==1?w:0,k==c.childCount?$:-1)))}let j=k==c.childCount;j||($=-1),this.placed=dd(this.placed,n,Ae.from(E)),this.frontier[n].match=P,j&&$<0&&s&&s.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let X=0,he=c;X<$;X++){let K=he.lastChild;this.frontier.push({type:K.type,match:K.contentMatchAt(K.childCount)}),he=K.content}this.unplaced=j?t==0?Qe.empty:new Qe(hd(d.content,t-1,1),t-1,$<0?d.openEnd:t-1):new Qe(hd(d.content,t,k),d.openStart,d.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let t=this.frontier[this.depth],n;if(!t.type.isTextblock||!r_(this.$to,this.$to.depth,t.type,t.match,!1)||this.$to.depth==this.depth&&(n=this.findCloseLevel(this.$to))&&n.depth==this.depth)return-1;let{depth:s}=this.$to,a=this.$to.after(s);for(;s>1&&a==this.$to.end(--s);)++a;return a}findCloseLevel(t){e:for(let n=Math.min(this.depth,t.depth);n>=0;n--){let{match:s,type:a}=this.frontier[n],u=n<t.depth&&t.end(n+1)==t.pos+(t.depth-(n+1)),d=r_(t,n,a,s,u);if(d){for(let c=n-1;c>=0;c--){let{match:w,type:k}=this.frontier[c],E=r_(t,c,k,w,!0);if(!E||E.childCount)continue e}return{depth:n,fit:d,move:u?t.doc.resolve(t.after(n+1)):t}}}}close(t){let n=this.findCloseLevel(t);if(!n)return null;for(;this.depth>n.depth;)this.closeFrontierNode();n.fit.childCount&&(this.placed=dd(this.placed,n.depth,n.fit)),t=n.move;for(let s=n.depth+1;s<=t.depth;s++){let a=t.node(s),u=a.type.contentMatch.fillBefore(a.content,!0,t.index(s));this.openFrontierNode(a.type,a.attrs,u)}return t}openFrontierNode(t,n=null,s){let a=this.frontier[this.depth];a.match=a.match.matchType(t),this.placed=dd(this.placed,this.depth,Ae.from(t.create(n,s))),this.frontier.push({type:t,match:t.contentMatch})}closeFrontierNode(){let n=this.frontier.pop().match.fillBefore(Ae.empty,!0);n.childCount&&(this.placed=dd(this.placed,this.frontier.length,n))}}function hd(e,t,n){return t==0?e.cutByIndex(n,e.childCount):e.replaceChild(0,e.firstChild.copy(hd(e.firstChild.content,t-1,n)))}function dd(e,t,n){return t==0?e.append(n):e.replaceChild(e.childCount-1,e.lastChild.copy(dd(e.lastChild.content,t-1,n)))}function i_(e,t){for(let n=0;n<t;n++)e=e.firstChild.content;return e}function rT(e,t,n){if(t<=0)return e;let s=e.content;return t>1&&(s=s.replaceChild(0,rT(s.firstChild,t-1,s.childCount==1?n-1:0))),t>0&&(s=e.type.contentMatch.fillBefore(s).append(s),n<=0&&(s=s.append(e.type.contentMatch.matchFragment(s).fillBefore(Ae.empty,!0)))),e.copy(s)}function r_(e,t,n,s,a){let u=e.node(t),d=a?e.indexAfter(t):e.index(t);if(d==u.childCount&&!n.compatibleContent(u.type))return null;let c=s.fillBefore(u.content,!0,d);return c&&!BA(n,u.content,d)?c:null}function BA(e,t,n){for(let s=n;s<t.childCount;s++)if(!e.allowsMarks(t.child(s).marks))return!0;return!1}function FA(e){return e.spec.defining||e.spec.definingForContent}function NA(e,t,n,s){if(!s.size)return e.deleteRange(t,n);let a=e.doc.resolve(t),u=e.doc.resolve(n);if(iT(a,u,s))return e.step(new ei(t,n,s));let d=oT(a,e.doc.resolve(n));d[d.length-1]==0&&d.pop();let c=-(a.depth+1);d.unshift(c);for(let A=a.depth,$=a.pos-1;A>0;A--,$--){let j=a.node(A).type.spec;if(j.defining||j.definingAsContext||j.isolating)break;d.indexOf(A)>-1?c=A:a.before(A)==$&&d.splice(1,0,-A)}let w=d.indexOf(c),k=[],E=s.openStart;for(let A=s.content,$=0;;$++){let j=A.firstChild;if(k.push(j),$==s.openStart)break;A=j.content}for(let A=E-1;A>=0;A--){let $=k[A],j=FA($.type);if(j&&!$.sameMarkup(a.node(Math.abs(c)-1)))E=A;else if(j||!$.type.isTextblock)break}for(let A=s.openStart;A>=0;A--){let $=(A+E+1)%(s.openStart+1),j=k[$];if(j)for(let X=0;X<d.length;X++){let he=d[(X+w)%d.length],K=!0;he<0&&(K=!1,he=-he);let J=a.node(he-1),le=a.index(he-1);if(J.canReplaceWith(le,le,j.type,j.marks))return e.replace(a.before(he),K?u.after(he):n,new Qe(sT(s.content,0,s.openStart,$),$,s.openEnd))}}let P=e.steps.length;for(let A=d.length-1;A>=0&&(e.replace(t,n,s),!(e.steps.length>P));A--){let $=d[A];$<0||(t=a.before($),n=u.after($))}}function sT(e,t,n,s,a){if(t<n){let u=e.firstChild;e=e.replaceChild(0,u.copy(sT(u.content,t+1,n,s,u)))}if(t>s){let u=a.contentMatchAt(0),d=u.fillBefore(e).append(e);e=d.append(u.matchFragment(d).fillBefore(Ae.empty,!0))}return e}function VA(e,t,n,s){if(!s.isInline&&t==n&&e.doc.resolve(t).parent.content.size){let a=OA(e.doc,t,s.type);a!=null&&(t=n=a)}e.replaceRange(t,n,new Qe(Ae.from(s),0,0))}function $A(e,t,n){let s=e.doc.resolve(t),a=e.doc.resolve(n),u=oT(s,a);for(let d=0;d<u.length;d++){let c=u[d],w=d==u.length-1;if(w&&c==0||s.node(c).type.contentMatch.validEnd)return e.delete(s.start(c),a.end(c));if(c>0&&(w||s.node(c-1).canReplace(s.index(c-1),a.indexAfter(c-1))))return e.delete(s.before(c),a.after(c))}for(let d=1;d<=s.depth&&d<=a.depth;d++)if(t-s.start(d)==s.depth-d&&n>s.end(d)&&a.end(d)-n!=a.depth-d&&s.start(d-1)==a.start(d-1)&&s.node(d-1).canReplace(s.index(d-1),a.index(d-1)))return e.delete(s.before(d),n);e.delete(t,n)}function oT(e,t){let n=[],s=Math.min(e.depth,t.depth);for(let a=s;a>=0;a--){let u=e.start(a);if(u<e.pos-(e.depth-a)||t.end(a)>t.pos+(t.depth-a)||e.node(a).type.spec.isolating||t.node(a).type.spec.isolating)break;(u==t.start(a)||a==e.depth&&a==t.depth&&e.parent.inlineContent&&t.parent.inlineContent&&a&&t.start(a-1)==u-1)&&n.push(a)}return n}class Tu extends Li{constructor(t,n,s){super(),this.pos=t,this.attr=n,this.value=s}apply(t){let n=t.nodeAt(this.pos);if(!n)return Fn.fail("No node at attribute step's position");let s=Object.create(null);for(let u in n.attrs)s[u]=n.attrs[u];s[this.attr]=this.value;let a=n.type.create(s,null,n.marks);return Fn.fromReplace(t,this.pos,this.pos+1,new Qe(Ae.from(a),0,n.isLeaf?0:1))}getMap(){return Lr.empty}invert(t){return new Tu(this.pos,this.attr,t.nodeAt(this.pos).attrs[this.attr])}map(t){let n=t.mapResult(this.pos,1);return n.deletedAfter?null:new Tu(n.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(t,n){if(typeof n.pos!="number"||typeof n.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new Tu(n.pos,n.attr,n.value)}}Li.jsonID("attr",Tu);class Hd extends Li{constructor(t,n){super(),this.attr=t,this.value=n}apply(t){let n=Object.create(null);for(let a in t.attrs)n[a]=t.attrs[a];n[this.attr]=this.value;let s=t.type.create(n,t.content,t.marks);return Fn.ok(s)}getMap(){return Lr.empty}invert(t){return new Hd(this.attr,t.attrs[this.attr])}map(t){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(t,n){if(typeof n.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new Hd(n.attr,n.value)}}Li.jsonID("docAttr",Hd);let Ou=class extends Error{};Ou=function e(t){let n=Error.call(this,t);return n.__proto__=e.prototype,n};Ou.prototype=Object.create(Error.prototype);Ou.prototype.constructor=Ou;Ou.prototype.name="TransformError";class jA{constructor(t){this.doc=t,this.steps=[],this.docs=[],this.mapping=new Su}get before(){return this.docs.length?this.docs[0]:this.doc}step(t){let n=this.maybeStep(t);if(n.failed)throw new Ou(n.failed);return this}maybeStep(t){let n=t.apply(this.doc);return n.failed||this.addStep(t,n.doc),n}get docChanged(){return this.steps.length>0}addStep(t,n){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=n}replace(t,n=t,s=Qe.empty){let a=ng(this.doc,t,n,s);return a&&this.step(a),this}replaceWith(t,n,s){return this.replace(t,n,new Qe(Ae.from(s),0,0))}delete(t,n){return this.replace(t,n,Qe.empty)}insert(t,n){return this.replaceWith(t,t,n)}replaceRange(t,n,s){return NA(this,t,n,s),this}replaceRangeWith(t,n,s){return VA(this,t,n,s),this}deleteRange(t,n){return $A(this,t,n),this}lift(t,n){return TA(this,t,n),this}join(t,n=1){return RA(this,t,n),this}wrap(t,n){return EA(this,t,n),this}setBlockType(t,n=t,s,a=null){return IA(this,t,n,s,a),this}setNodeMarkup(t,n,s=null,a){return AA(this,t,n,s,a),this}setNodeAttribute(t,n,s){return this.step(new Tu(t,n,s)),this}setDocAttribute(t,n){return this.step(new Hd(t,n)),this}addNodeMark(t,n){return this.step(new Ca(t,n)),this}removeNodeMark(t,n){if(!(n instanceof sn)){let s=this.doc.nodeAt(t);if(!s)throw new RangeError("No node at position "+t);if(n=n.isInSet(s.marks),!n)return this}return this.step(new Ru(t,n)),this}split(t,n=1,s){return zA(this,t,n,s),this}addMark(t,n,s){return bA(this,t,n,s),this}removeMark(t,n,s){return SA(this,t,n,s),this}clearIncompatible(t,n,s){return Av(this,t,n,s),this}}const s_=Object.create(null);class Et{constructor(t,n,s){this.$anchor=t,this.$head=n,this.ranges=s||[new UA(t.min(n),t.max(n))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let t=this.ranges;for(let n=0;n<t.length;n++)if(t[n].$from.pos!=t[n].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(t,n=Qe.empty){let s=n.content.lastChild,a=null;for(let c=0;c<n.openEnd;c++)a=s,s=s.lastChild;let u=t.steps.length,d=this.ranges;for(let c=0;c<d.length;c++){let{$from:w,$to:k}=d[c],E=t.mapping.slice(u);t.replaceRange(E.map(w.pos),E.map(k.pos),c?Qe.empty:n),c==0&&ub(t,u,(s?s.isInline:a&&a.isTextblock)?-1:1)}}replaceWith(t,n){let s=t.steps.length,a=this.ranges;for(let u=0;u<a.length;u++){let{$from:d,$to:c}=a[u],w=t.mapping.slice(s),k=w.map(d.pos),E=w.map(c.pos);u?t.deleteRange(k,E):(t.replaceRangeWith(k,E,n),ub(t,s,n.isInline?-1:1))}}static findFrom(t,n,s=!1){let a=t.parent.inlineContent?new kt(t):tu(t.node(0),t.parent,t.pos,t.index(),n,s);if(a)return a;for(let u=t.depth-1;u>=0;u--){let d=n<0?tu(t.node(0),t.node(u),t.before(u+1),t.index(u),n,s):tu(t.node(0),t.node(u),t.after(u+1),t.index(u)+1,n,s);if(d)return d}return null}static near(t,n=1){return this.findFrom(t,n)||this.findFrom(t,-n)||new Cs(t.node(0))}static atStart(t){return tu(t,t,0,0,1)||new Cs(t)}static atEnd(t){return tu(t,t,t.content.size,t.childCount,-1)||new Cs(t)}static fromJSON(t,n){if(!n||!n.type)throw new RangeError("Invalid input for Selection.fromJSON");let s=s_[n.type];if(!s)throw new RangeError(`No selection type ${n.type} defined`);return s.fromJSON(t,n)}static jsonID(t,n){if(t in s_)throw new RangeError("Duplicate use of selection JSON ID "+t);return s_[t]=n,n.prototype.jsonID=t,n}getBookmark(){return kt.between(this.$anchor,this.$head).getBookmark()}}Et.prototype.visible=!0;class UA{constructor(t,n){this.$from=t,this.$to=n}}let lb=!1;function cb(e){!lb&&!e.parent.inlineContent&&(lb=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+e.parent.type.name+")"))}class kt extends Et{constructor(t,n=t){cb(t),cb(n),super(t,n)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(t,n){let s=t.resolve(n.map(this.head));if(!s.parent.inlineContent)return Et.near(s);let a=t.resolve(n.map(this.anchor));return new kt(a.parent.inlineContent?a:s,s)}replace(t,n=Qe.empty){if(super.replace(t,n),n==Qe.empty){let s=this.$from.marksAcross(this.$to);s&&t.ensureMarks(s)}}eq(t){return t instanceof kt&&t.anchor==this.anchor&&t.head==this.head}getBookmark(){return new ig(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(t,n){if(typeof n.anchor!="number"||typeof n.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new kt(t.resolve(n.anchor),t.resolve(n.head))}static create(t,n,s=n){let a=t.resolve(n);return new this(a,s==n?a:t.resolve(s))}static between(t,n,s){let a=t.pos-n.pos;if((!s||a)&&(s=a>=0?1:-1),!n.parent.inlineContent){let u=Et.findFrom(n,s,!0)||Et.findFrom(n,-s,!0);if(u)n=u.$head;else return Et.near(n,s)}return t.parent.inlineContent||(a==0?t=n:(t=(Et.findFrom(t,-s,!0)||Et.findFrom(t,s,!0)).$anchor,t.pos<n.pos!=a<0&&(t=n))),new kt(t,n)}}Et.jsonID("text",kt);class ig{constructor(t,n){this.anchor=t,this.head=n}map(t){return new ig(t.map(this.anchor),t.map(this.head))}resolve(t){return kt.between(t.resolve(this.anchor),t.resolve(this.head))}}class mt extends Et{constructor(t){let n=t.nodeAfter,s=t.node(0).resolve(t.pos+n.nodeSize);super(t,s),this.node=n}map(t,n){let{deleted:s,pos:a}=n.mapResult(this.anchor),u=t.resolve(a);return s?Et.near(u):new mt(u)}content(){return new Qe(Ae.from(this.node),0,0)}eq(t){return t instanceof mt&&t.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new Dv(this.anchor)}static fromJSON(t,n){if(typeof n.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new mt(t.resolve(n.anchor))}static create(t,n){return new mt(t.resolve(n))}static isSelectable(t){return!t.isText&&t.type.spec.selectable!==!1}}mt.prototype.visible=!1;Et.jsonID("node",mt);class Dv{constructor(t){this.anchor=t}map(t){let{deleted:n,pos:s}=t.mapResult(this.anchor);return n?new ig(s,s):new Dv(s)}resolve(t){let n=t.resolve(this.anchor),s=n.nodeAfter;return s&&mt.isSelectable(s)?new mt(n):Et.near(n)}}class Cs extends Et{constructor(t){super(t.resolve(0),t.resolve(t.content.size))}replace(t,n=Qe.empty){if(n==Qe.empty){t.delete(0,t.doc.content.size);let s=Et.atStart(t.doc);s.eq(t.selection)||t.setSelection(s)}else super.replace(t,n)}toJSON(){return{type:"all"}}static fromJSON(t){return new Cs(t)}map(t){return new Cs(t)}eq(t){return t instanceof Cs}getBookmark(){return qA}}Et.jsonID("all",Cs);const qA={map(){return this},resolve(e){return new Cs(e)}};function tu(e,t,n,s,a,u=!1){if(t.inlineContent)return kt.create(e,n);for(let d=s-(a>0?0:1);a>0?d<t.childCount:d>=0;d+=a){let c=t.child(d);if(c.isAtom){if(!u&&mt.isSelectable(c))return mt.create(e,n-(a<0?c.nodeSize:0))}else{let w=tu(e,c,n+a,a<0?c.childCount:0,a,u);if(w)return w}n+=c.nodeSize*a}return null}function ub(e,t,n){let s=e.steps.length-1;if(s<t)return;let a=e.steps[s];if(!(a instanceof ei||a instanceof ni))return;let u=e.mapping.maps[s],d;u.forEach((c,w,k,E)=>{d==null&&(d=E)}),e.setSelection(Et.near(e.doc.resolve(d),n))}const hb=1,Ef=2,db=4;class HA extends jA{constructor(t){super(t.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=t.selection,this.storedMarks=t.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(t){if(t.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=t,this.curSelectionFor=this.steps.length,this.updated=(this.updated|hb)&~Ef,this.storedMarks=null,this}get selectionSet(){return(this.updated&hb)>0}setStoredMarks(t){return this.storedMarks=t,this.updated|=Ef,this}ensureMarks(t){return sn.sameSet(this.storedMarks||this.selection.$from.marks(),t)||this.setStoredMarks(t),this}addStoredMark(t){return this.ensureMarks(t.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(t){return this.ensureMarks(t.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&Ef)>0}addStep(t,n){super.addStep(t,n),this.updated=this.updated&~Ef,this.storedMarks=null}setTime(t){return this.time=t,this}replaceSelection(t){return this.selection.replace(this,t),this}replaceSelectionWith(t,n=!0){let s=this.selection;return n&&(t=t.mark(this.storedMarks||(s.empty?s.$from.marks():s.$from.marksAcross(s.$to)||sn.none))),s.replaceWith(this,t),this}deleteSelection(){return this.selection.replace(this),this}insertText(t,n,s){let a=this.doc.type.schema;if(n==null)return t?this.replaceSelectionWith(a.text(t),!0):this.deleteSelection();{if(s==null&&(s=n),s=s??n,!t)return this.deleteRange(n,s);let u=this.storedMarks;if(!u){let d=this.doc.resolve(n);u=s==n?d.marks():d.marksAcross(this.doc.resolve(s))}return this.replaceRangeWith(n,s,a.text(t,u)),this.selection.empty||this.setSelection(Et.near(this.selection.$to)),this}}setMeta(t,n){return this.meta[typeof t=="string"?t:t.key]=n,this}getMeta(t){return this.meta[typeof t=="string"?t:t.key]}get isGeneric(){for(let t in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=db,this}get scrolledIntoView(){return(this.updated&db)>0}}function pb(e,t){return!t||!e?e:e.bind(t)}class pd{constructor(t,n,s){this.name=t,this.init=pb(n.init,s),this.apply=pb(n.apply,s)}}const ZA=[new pd("doc",{init(e){return e.doc||e.schema.topNodeType.createAndFill()},apply(e){return e.doc}}),new pd("selection",{init(e,t){return e.selection||Et.atStart(t.doc)},apply(e){return e.selection}}),new pd("storedMarks",{init(e){return e.storedMarks||null},apply(e,t,n,s){return s.selection.$cursor?e.storedMarks:null}}),new pd("scrollToSelection",{init(){return 0},apply(e,t){return e.scrolledIntoView?t+1:t}})];class o_{constructor(t,n){this.schema=t,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=ZA.slice(),n&&n.forEach(s=>{if(this.pluginsByKey[s.key])throw new RangeError("Adding different instances of a keyed plugin ("+s.key+")");this.plugins.push(s),this.pluginsByKey[s.key]=s,s.spec.state&&this.fields.push(new pd(s.key,s.spec.state,s))})}}class mu{constructor(t){this.config=t}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(t){return this.applyTransaction(t).state}filterTransaction(t,n=-1){for(let s=0;s<this.config.plugins.length;s++)if(s!=n){let a=this.config.plugins[s];if(a.spec.filterTransaction&&!a.spec.filterTransaction.call(a,t,this))return!1}return!0}applyTransaction(t){if(!this.filterTransaction(t))return{state:this,transactions:[]};let n=[t],s=this.applyInner(t),a=null;for(;;){let u=!1;for(let d=0;d<this.config.plugins.length;d++){let c=this.config.plugins[d];if(c.spec.appendTransaction){let w=a?a[d].n:0,k=a?a[d].state:this,E=w<n.length&&c.spec.appendTransaction.call(c,w?n.slice(w):n,k,s);if(E&&s.filterTransaction(E,d)){if(E.setMeta("appendedTransaction",t),!a){a=[];for(let P=0;P<this.config.plugins.length;P++)a.push(P<d?{state:s,n:n.length}:{state:this,n:0})}n.push(E),s=s.applyInner(E),u=!0}a&&(a[d]={state:s,n:n.length})}}if(!u)return{state:s,transactions:n}}}applyInner(t){if(!t.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let n=new mu(this.config),s=this.config.fields;for(let a=0;a<s.length;a++){let u=s[a];n[u.name]=u.apply(t,this[u.name],this,n)}return n}get tr(){return new HA(this)}static create(t){let n=new o_(t.doc?t.doc.type.schema:t.schema,t.plugins),s=new mu(n);for(let a=0;a<n.fields.length;a++)s[n.fields[a].name]=n.fields[a].init(t,s);return s}reconfigure(t){let n=new o_(this.schema,t.plugins),s=n.fields,a=new mu(n);for(let u=0;u<s.length;u++){let d=s[u].name;a[d]=this.hasOwnProperty(d)?this[d]:s[u].init(t,a)}return a}toJSON(t){let n={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(n.storedMarks=this.storedMarks.map(s=>s.toJSON())),t&&typeof t=="object")for(let s in t){if(s=="doc"||s=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let a=t[s],u=a.spec.state;u&&u.toJSON&&(n[s]=u.toJSON.call(a,this[a.key]))}return n}static fromJSON(t,n,s){if(!n)throw new RangeError("Invalid input for EditorState.fromJSON");if(!t.schema)throw new RangeError("Required config field 'schema' missing");let a=new o_(t.schema,t.plugins),u=new mu(a);return a.fields.forEach(d=>{if(d.name=="doc")u.doc=La.fromJSON(t.schema,n.doc);else if(d.name=="selection")u.selection=Et.fromJSON(u.doc,n.selection);else if(d.name=="storedMarks")n.storedMarks&&(u.storedMarks=n.storedMarks.map(t.schema.markFromJSON));else{if(s)for(let c in s){let w=s[c],k=w.spec.state;if(w.key==d.name&&k&&k.fromJSON&&Object.prototype.hasOwnProperty.call(n,c)){u[d.name]=k.fromJSON.call(w,t,n[c],u);return}}u[d.name]=d.init(t,u)}}),u}}function aT(e,t,n){for(let s in e){let a=e[s];a instanceof Function?a=a.bind(t):s=="handleDOMEvents"&&(a=aT(a,t,{})),n[s]=a}return n}class er{constructor(t){this.spec=t,this.props={},t.props&&aT(t.props,this,this.props),this.key=t.key?t.key.key:lT("plugin")}getState(t){return t[this.key]}}const a_=Object.create(null);function lT(e){return e in a_?e+"$"+ ++a_[e]:(a_[e]=0,e+"$")}class Js{constructor(t="key"){this.key=lT(t)}get(t){return t.config.pluginsByKey[this.key]}getState(t){return t[this.key]}}const pi=function(e){for(var t=0;;t++)if(e=e.previousSibling,!e)return t},Zd=function(e){let t=e.assignedSlot||e.parentNode;return t&&t.nodeType==11?t.host:t};let w0=null;const wo=function(e,t,n){let s=w0||(w0=document.createRange());return s.setEnd(e,n??e.nodeValue.length),s.setStart(e,t||0),s},WA=function(){w0=null},Yl=function(e,t,n,s){return n&&(fb(e,t,n,s,-1)||fb(e,t,n,s,1))},GA=/^(img|br|input|textarea|hr)$/i;function fb(e,t,n,s,a){for(;;){if(e==n&&t==s)return!0;if(t==(a<0?0:is(e))){let u=e.parentNode;if(!u||u.nodeType!=1||ip(e)||GA.test(e.nodeName)||e.contentEditable=="false")return!1;t=pi(e)+(a<0?0:1),e=u}else if(e.nodeType==1){if(e=e.childNodes[t+(a<0?-1:0)],e.contentEditable=="false")return!1;t=a<0?is(e):0}else return!1}}function is(e){return e.nodeType==3?e.nodeValue.length:e.childNodes.length}function KA(e,t){for(;;){if(e.nodeType==3&&t)return e;if(e.nodeType==1&&t>0){if(e.contentEditable=="false")return null;e=e.childNodes[t-1],t=is(e)}else if(e.parentNode&&!ip(e))t=pi(e),e=e.parentNode;else return null}}function XA(e,t){for(;;){if(e.nodeType==3&&t<e.nodeValue.length)return e;if(e.nodeType==1&&t<e.childNodes.length){if(e.contentEditable=="false")return null;e=e.childNodes[t],t=0}else if(e.parentNode&&!ip(e))t=pi(e)+1,e=e.parentNode;else return null}}function JA(e,t,n){for(let s=t==0,a=t==is(e);s||a;){if(e==n)return!0;let u=pi(e);if(e=e.parentNode,!e)return!1;s=s&&u==0,a=a&&u==is(e)}}function ip(e){let t;for(let n=e;n&&!(t=n.pmViewDesc);n=n.parentNode);return t&&t.node&&t.node.isBlock&&(t.dom==e||t.contentDOM==e)}const rg=function(e){return e.focusNode&&Yl(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset)};function Al(e,t){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=e,n.key=n.code=t,n}function YA(e){let t=e.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}function QA(e,t,n){if(e.caretPositionFromPoint)try{let s=e.caretPositionFromPoint(t,n);if(s)return{node:s.offsetNode,offset:Math.min(is(s.offsetNode),s.offset)}}catch{}if(e.caretRangeFromPoint){let s=e.caretRangeFromPoint(t,n);if(s)return{node:s.startContainer,offset:Math.min(is(s.startContainer),s.startOffset)}}}const Ks=typeof navigator<"u"?navigator:null,mb=typeof document<"u"?document:null,Ka=Ks&&Ks.userAgent||"",b0=/Edge\/(\d+)/.exec(Ka),cT=/MSIE \d/.exec(Ka),S0=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Ka),yr=!!(cT||S0||b0),Fa=cT?document.documentMode:S0?+S0[1]:b0?+b0[1]:0,Es=!yr&&/gecko\/(\d+)/i.test(Ka);Es&&+(/Firefox\/(\d+)/.exec(Ka)||[0,0])[1];const k0=!yr&&/Chrome\/(\d+)/.exec(Ka),Di=!!k0,uT=k0?+k0[1]:0,Gi=!yr&&!!Ks&&/Apple Computer/.test(Ks.vendor),Lu=Gi&&(/Mobile\/\w+/.test(Ka)||!!Ks&&Ks.maxTouchPoints>2),es=Lu||(Ks?/Mac/.test(Ks.platform):!1),ez=Ks?/Win/.test(Ks.platform):!1,bs=/Android \d/.test(Ka),rp=!!mb&&"webkitFontSmoothing"in mb.documentElement.style,tz=rp?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function nz(e){let t=e.defaultView&&e.defaultView.visualViewport;return t?{left:0,right:t.width,top:0,bottom:t.height}:{left:0,right:e.documentElement.clientWidth,top:0,bottom:e.documentElement.clientHeight}}function vo(e,t){return typeof e=="number"?e:e[t]}function iz(e){let t=e.getBoundingClientRect(),n=t.width/e.offsetWidth||1,s=t.height/e.offsetHeight||1;return{left:t.left,right:t.left+e.clientWidth*n,top:t.top,bottom:t.top+e.clientHeight*s}}function gb(e,t,n){let s=e.someProp("scrollThreshold")||0,a=e.someProp("scrollMargin")||5,u=e.dom.ownerDocument;for(let d=n||e.dom;d;d=Zd(d)){if(d.nodeType!=1)continue;let c=d,w=c==u.body,k=w?nz(u):iz(c),E=0,P=0;if(t.top<k.top+vo(s,"top")?P=-(k.top-t.top+vo(a,"top")):t.bottom>k.bottom-vo(s,"bottom")&&(P=t.bottom-t.top>k.bottom-k.top?t.top+vo(a,"top")-k.top:t.bottom-k.bottom+vo(a,"bottom")),t.left<k.left+vo(s,"left")?E=-(k.left-t.left+vo(a,"left")):t.right>k.right-vo(s,"right")&&(E=t.right-k.right+vo(a,"right")),E||P)if(w)u.defaultView.scrollBy(E,P);else{let A=c.scrollLeft,$=c.scrollTop;P&&(c.scrollTop+=P),E&&(c.scrollLeft+=E);let j=c.scrollLeft-A,X=c.scrollTop-$;t={left:t.left-j,top:t.top-X,right:t.right-j,bottom:t.bottom-X}}if(w||/^(fixed|sticky)$/.test(getComputedStyle(d).position))break}}function rz(e){let t=e.dom.getBoundingClientRect(),n=Math.max(0,t.top),s,a;for(let u=(t.left+t.right)/2,d=n+1;d<Math.min(innerHeight,t.bottom);d+=5){let c=e.root.elementFromPoint(u,d);if(!c||c==e.dom||!e.dom.contains(c))continue;let w=c.getBoundingClientRect();if(w.top>=n-20){s=c,a=w.top;break}}return{refDOM:s,refTop:a,stack:hT(e.dom)}}function hT(e){let t=[],n=e.ownerDocument;for(let s=e;s&&(t.push({dom:s,top:s.scrollTop,left:s.scrollLeft}),e!=n);s=Zd(s));return t}function sz({refDOM:e,refTop:t,stack:n}){let s=e?e.getBoundingClientRect().top:0;dT(n,s==0?0:s-t)}function dT(e,t){for(let n=0;n<e.length;n++){let{dom:s,top:a,left:u}=e[n];s.scrollTop!=a+t&&(s.scrollTop=a+t),s.scrollLeft!=u&&(s.scrollLeft=u)}}let Qc=null;function oz(e){if(e.setActive)return e.setActive();if(Qc)return e.focus(Qc);let t=hT(e);e.focus(Qc==null?{get preventScroll(){return Qc={preventScroll:!0},!0}}:void 0),Qc||(Qc=!1,dT(t,0))}function pT(e,t){let n,s=2e8,a,u=0,d=t.top,c=t.top,w,k;for(let E=e.firstChild,P=0;E;E=E.nextSibling,P++){let A;if(E.nodeType==1)A=E.getClientRects();else if(E.nodeType==3)A=wo(E).getClientRects();else continue;for(let $=0;$<A.length;$++){let j=A[$];if(j.top<=d&&j.bottom>=c){d=Math.max(j.bottom,d),c=Math.min(j.top,c);let X=j.left>t.left?j.left-t.left:j.right<t.left?t.left-j.right:0;if(X<s){n=E,s=X,a=X&&n.nodeType==3?{left:j.right<t.left?j.right:j.left,top:t.top}:t,E.nodeType==1&&X&&(u=P+(t.left>=(j.left+j.right)/2?1:0));continue}}else j.top>t.top&&!w&&j.left<=t.left&&j.right>=t.left&&(w=E,k={left:Math.max(j.left,Math.min(j.right,t.left)),top:j.top});!n&&(t.left>=j.right&&t.top>=j.top||t.left>=j.left&&t.top>=j.bottom)&&(u=P+1)}}return!n&&w&&(n=w,a=k,s=0),n&&n.nodeType==3?az(n,a):!n||s&&n.nodeType==1?{node:e,offset:u}:pT(n,a)}function az(e,t){let n=e.nodeValue.length,s=document.createRange();for(let a=0;a<n;a++){s.setEnd(e,a+1),s.setStart(e,a);let u=ma(s,1);if(u.top!=u.bottom&&Rv(t,u))return{node:e,offset:a+(t.left>=(u.left+u.right)/2?1:0)}}return{node:e,offset:0}}function Rv(e,t){return e.left>=t.left-1&&e.left<=t.right+1&&e.top>=t.top-1&&e.top<=t.bottom+1}function lz(e,t){let n=e.parentNode;return n&&/^li$/i.test(n.nodeName)&&t.left<e.getBoundingClientRect().left?n:e}function cz(e,t,n){let{node:s,offset:a}=pT(t,n),u=-1;if(s.nodeType==1&&!s.firstChild){let d=s.getBoundingClientRect();u=d.left!=d.right&&n.left>(d.left+d.right)/2?1:-1}return e.docView.posFromDOM(s,a,u)}function uz(e,t,n,s){let a=-1;for(let u=t,d=!1;u!=e.dom;){let c=e.docView.nearestDesc(u,!0);if(!c)return null;if(c.dom.nodeType==1&&(c.node.isBlock&&c.parent||!c.contentDOM)){let w=c.dom.getBoundingClientRect();if(c.node.isBlock&&c.parent&&(!d&&w.left>s.left||w.top>s.top?a=c.posBefore:(!d&&w.right<s.left||w.bottom<s.top)&&(a=c.posAfter),d=!0),!c.contentDOM&&a<0&&!c.node.isText)return(c.node.isBlock?s.top<(w.top+w.bottom)/2:s.left<(w.left+w.right)/2)?c.posBefore:c.posAfter}u=c.dom.parentNode}return a>-1?a:e.docView.posFromDOM(t,n,-1)}function fT(e,t,n){let s=e.childNodes.length;if(s&&n.top<n.bottom)for(let a=Math.max(0,Math.min(s-1,Math.floor(s*(t.top-n.top)/(n.bottom-n.top))-2)),u=a;;){let d=e.childNodes[u];if(d.nodeType==1){let c=d.getClientRects();for(let w=0;w<c.length;w++){let k=c[w];if(Rv(t,k))return fT(d,t,k)}}if((u=(u+1)%s)==a)break}return e}function hz(e,t){let n=e.dom.ownerDocument,s,a=0,u=QA(n,t.left,t.top);u&&({node:s,offset:a}=u);let d=(e.root.elementFromPoint?e.root:n).elementFromPoint(t.left,t.top),c;if(!d||!e.dom.contains(d.nodeType!=1?d.parentNode:d)){let k=e.dom.getBoundingClientRect();if(!Rv(t,k)||(d=fT(e.dom,t,k),!d))return null}if(Gi)for(let k=d;s&&k;k=Zd(k))k.draggable&&(s=void 0);if(d=lz(d,t),s){if(Es&&s.nodeType==1&&(a=Math.min(a,s.childNodes.length),a<s.childNodes.length)){let E=s.childNodes[a],P;E.nodeName=="IMG"&&(P=E.getBoundingClientRect()).right<=t.left&&P.bottom>t.top&&a++}let k;rp&&a&&s.nodeType==1&&(k=s.childNodes[a-1]).nodeType==1&&k.contentEditable=="false"&&k.getBoundingClientRect().top>=t.top&&a--,s==e.dom&&a==s.childNodes.length-1&&s.lastChild.nodeType==1&&t.top>s.lastChild.getBoundingClientRect().bottom?c=e.state.doc.content.size:(a==0||s.nodeType!=1||s.childNodes[a-1].nodeName!="BR")&&(c=uz(e,s,a,t))}c==null&&(c=cz(e,d,t));let w=e.docView.nearestDesc(d,!0);return{pos:c,inside:w?w.posAtStart-w.border:-1}}function yb(e){return e.top<e.bottom||e.left<e.right}function ma(e,t){let n=e.getClientRects();if(n.length){let s=n[t<0?0:n.length-1];if(yb(s))return s}return Array.prototype.find.call(n,yb)||e.getBoundingClientRect()}const dz=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function mT(e,t,n){let{node:s,offset:a,atom:u}=e.docView.domFromPos(t,n<0?-1:1),d=rp||Es;if(s.nodeType==3)if(d&&(dz.test(s.nodeValue)||(n<0?!a:a==s.nodeValue.length))){let w=ma(wo(s,a,a),n);if(Es&&a&&/\s/.test(s.nodeValue[a-1])&&a<s.nodeValue.length){let k=ma(wo(s,a-1,a-1),-1);if(k.top==w.top){let E=ma(wo(s,a,a+1),-1);if(E.top!=w.top)return od(E,E.left<k.left)}}return w}else{let w=a,k=a,E=n<0?1:-1;return n<0&&!a?(k++,E=-1):n>=0&&a==s.nodeValue.length?(w--,E=1):n<0?w--:k++,od(ma(wo(s,w,k),E),E<0)}if(!e.state.doc.resolve(t-(u||0)).parent.inlineContent){if(u==null&&a&&(n<0||a==is(s))){let w=s.childNodes[a-1];if(w.nodeType==1)return l_(w.getBoundingClientRect(),!1)}if(u==null&&a<is(s)){let w=s.childNodes[a];if(w.nodeType==1)return l_(w.getBoundingClientRect(),!0)}return l_(s.getBoundingClientRect(),n>=0)}if(u==null&&a&&(n<0||a==is(s))){let w=s.childNodes[a-1],k=w.nodeType==3?wo(w,is(w)-(d?0:1)):w.nodeType==1&&(w.nodeName!="BR"||!w.nextSibling)?w:null;if(k)return od(ma(k,1),!1)}if(u==null&&a<is(s)){let w=s.childNodes[a];for(;w.pmViewDesc&&w.pmViewDesc.ignoreForCoords;)w=w.nextSibling;let k=w?w.nodeType==3?wo(w,0,d?0:1):w.nodeType==1?w:null:null;if(k)return od(ma(k,-1),!0)}return od(ma(s.nodeType==3?wo(s):s,-n),n>=0)}function od(e,t){if(e.width==0)return e;let n=t?e.left:e.right;return{top:e.top,bottom:e.bottom,left:n,right:n}}function l_(e,t){if(e.height==0)return e;let n=t?e.top:e.bottom;return{top:n,bottom:n,left:e.left,right:e.right}}function gT(e,t,n){let s=e.state,a=e.root.activeElement;s!=t&&e.updateState(t),a!=e.dom&&e.focus();try{return n()}finally{s!=t&&e.updateState(s),a!=e.dom&&a&&a.focus()}}function pz(e,t,n){let s=t.selection,a=n=="up"?s.$from:s.$to;return gT(e,t,()=>{let{node:u}=e.docView.domFromPos(a.pos,n=="up"?-1:1);for(;;){let c=e.docView.nearestDesc(u,!0);if(!c)break;if(c.node.isBlock){u=c.contentDOM||c.dom;break}u=c.dom.parentNode}let d=mT(e,a.pos,1);for(let c=u.firstChild;c;c=c.nextSibling){let w;if(c.nodeType==1)w=c.getClientRects();else if(c.nodeType==3)w=wo(c,0,c.nodeValue.length).getClientRects();else continue;for(let k=0;k<w.length;k++){let E=w[k];if(E.bottom>E.top+1&&(n=="up"?d.top-E.top>(E.bottom-d.top)*2:E.bottom-d.bottom>(d.bottom-E.top)*2))return!1}}return!0})}const fz=/[\u0590-\u08ac]/;function mz(e,t,n){let{$head:s}=t.selection;if(!s.parent.isTextblock)return!1;let a=s.parentOffset,u=!a,d=a==s.parent.content.size,c=e.domSelection();return c?!fz.test(s.parent.textContent)||!c.modify?n=="left"||n=="backward"?u:d:gT(e,t,()=>{let{focusNode:w,focusOffset:k,anchorNode:E,anchorOffset:P}=e.domSelectionRange(),A=c.caretBidiLevel;c.modify("move",n,"character");let $=s.depth?e.docView.domAfterPos(s.before()):e.dom,{focusNode:j,focusOffset:X}=e.domSelectionRange(),he=j&&!$.contains(j.nodeType==1?j:j.parentNode)||w==j&&k==X;try{c.collapse(E,P),w&&(w!=E||k!=P)&&c.extend&&c.extend(w,k)}catch{}return A!=null&&(c.caretBidiLevel=A),he}):s.pos==s.start()||s.pos==s.end()}let _b=null,vb=null,xb=!1;function gz(e,t,n){return _b==t&&vb==n?xb:(_b=t,vb=n,xb=n=="up"||n=="down"?pz(e,t,n):mz(e,t,n))}const as=0,wb=1,Ll=2,Xs=3;class sp{constructor(t,n,s,a){this.parent=t,this.children=n,this.dom=s,this.contentDOM=a,this.dirty=as,s.pmViewDesc=this}matchesWidget(t){return!1}matchesMark(t){return!1}matchesNode(t,n,s){return!1}matchesHack(t){return!1}parseRule(){return null}stopEvent(t){return!1}get size(){let t=0;for(let n=0;n<this.children.length;n++)t+=this.children[n].size;return t}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let t=0;t<this.children.length;t++)this.children[t].destroy()}posBeforeChild(t){for(let n=0,s=this.posAtStart;;n++){let a=this.children[n];if(a==t)return s;s+=a.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(t,n,s){if(this.contentDOM&&this.contentDOM.contains(t.nodeType==1?t:t.parentNode))if(s<0){let u,d;if(t==this.contentDOM)u=t.childNodes[n-1];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;u=t.previousSibling}for(;u&&!((d=u.pmViewDesc)&&d.parent==this);)u=u.previousSibling;return u?this.posBeforeChild(d)+d.size:this.posAtStart}else{let u,d;if(t==this.contentDOM)u=t.childNodes[n];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;u=t.nextSibling}for(;u&&!((d=u.pmViewDesc)&&d.parent==this);)u=u.nextSibling;return u?this.posBeforeChild(d):this.posAtEnd}let a;if(t==this.dom&&this.contentDOM)a=n>pi(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))a=t.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(n==0)for(let u=t;;u=u.parentNode){if(u==this.dom){a=!1;break}if(u.previousSibling)break}if(a==null&&n==t.childNodes.length)for(let u=t;;u=u.parentNode){if(u==this.dom){a=!0;break}if(u.nextSibling)break}}return a??s>0?this.posAtEnd:this.posAtStart}nearestDesc(t,n=!1){for(let s=!0,a=t;a;a=a.parentNode){let u=this.getDesc(a),d;if(u&&(!n||u.node))if(s&&(d=u.nodeDOM)&&!(d.nodeType==1?d.contains(t.nodeType==1?t:t.parentNode):d==t))s=!1;else return u}}getDesc(t){let n=t.pmViewDesc;for(let s=n;s;s=s.parent)if(s==this)return n}posFromDOM(t,n,s){for(let a=t;a;a=a.parentNode){let u=this.getDesc(a);if(u)return u.localPosFromDOM(t,n,s)}return-1}descAt(t){for(let n=0,s=0;n<this.children.length;n++){let a=this.children[n],u=s+a.size;if(s==t&&u!=s){for(;!a.border&&a.children.length;)a=a.children[0];return a}if(t<u)return a.descAt(t-s-a.border);s=u}}domFromPos(t,n){if(!this.contentDOM)return{node:this.dom,offset:0,atom:t+1};let s=0,a=0;for(let u=0;s<this.children.length;s++){let d=this.children[s],c=u+d.size;if(c>t||d instanceof _T){a=t-u;break}u=c}if(a)return this.children[s].domFromPos(a-this.children[s].border,n);for(let u;s&&!(u=this.children[s-1]).size&&u instanceof yT&&u.side>=0;s--);if(n<=0){let u,d=!0;for(;u=s?this.children[s-1]:null,!(!u||u.dom.parentNode==this.contentDOM);s--,d=!1);return u&&n&&d&&!u.border&&!u.domAtom?u.domFromPos(u.size,n):{node:this.contentDOM,offset:u?pi(u.dom)+1:0}}else{let u,d=!0;for(;u=s<this.children.length?this.children[s]:null,!(!u||u.dom.parentNode==this.contentDOM);s++,d=!1);return u&&d&&!u.border&&!u.domAtom?u.domFromPos(0,n):{node:this.contentDOM,offset:u?pi(u.dom):this.contentDOM.childNodes.length}}}parseRange(t,n,s=0){if(this.children.length==0)return{node:this.contentDOM,from:t,to:n,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let a=-1,u=-1;for(let d=s,c=0;;c++){let w=this.children[c],k=d+w.size;if(a==-1&&t<=k){let E=d+w.border;if(t>=E&&n<=k-w.border&&w.node&&w.contentDOM&&this.contentDOM.contains(w.contentDOM))return w.parseRange(t,n,E);t=d;for(let P=c;P>0;P--){let A=this.children[P-1];if(A.size&&A.dom.parentNode==this.contentDOM&&!A.emptyChildAt(1)){a=pi(A.dom)+1;break}t-=A.size}a==-1&&(a=0)}if(a>-1&&(k>n||c==this.children.length-1)){n=k;for(let E=c+1;E<this.children.length;E++){let P=this.children[E];if(P.size&&P.dom.parentNode==this.contentDOM&&!P.emptyChildAt(-1)){u=pi(P.dom);break}n+=P.size}u==-1&&(u=this.contentDOM.childNodes.length);break}d=k}return{node:this.contentDOM,from:t,to:n,fromOffset:a,toOffset:u}}emptyChildAt(t){if(this.border||!this.contentDOM||!this.children.length)return!1;let n=this.children[t<0?0:this.children.length-1];return n.size==0||n.emptyChildAt(t)}domAfterPos(t){let{node:n,offset:s}=this.domFromPos(t,0);if(n.nodeType!=1||s==n.childNodes.length)throw new RangeError("No node after pos "+t);return n.childNodes[s]}setSelection(t,n,s,a=!1){let u=Math.min(t,n),d=Math.max(t,n);for(let $=0,j=0;$<this.children.length;$++){let X=this.children[$],he=j+X.size;if(u>j&&d<he)return X.setSelection(t-j-X.border,n-j-X.border,s,a);j=he}let c=this.domFromPos(t,t?-1:1),w=n==t?c:this.domFromPos(n,n?-1:1),k=s.root.getSelection(),E=s.domSelectionRange(),P=!1;if((Es||Gi)&&t==n){let{node:$,offset:j}=c;if($.nodeType==3){if(P=!!(j&&$.nodeValue[j-1]==`
`),P&&j==$.nodeValue.length)for(let X=$,he;X;X=X.parentNode){if(he=X.nextSibling){he.nodeName=="BR"&&(c=w={node:he.parentNode,offset:pi(he)+1});break}let K=X.pmViewDesc;if(K&&K.node&&K.node.isBlock)break}}else{let X=$.childNodes[j-1];P=X&&(X.nodeName=="BR"||X.contentEditable=="false")}}if(Es&&E.focusNode&&E.focusNode!=w.node&&E.focusNode.nodeType==1){let $=E.focusNode.childNodes[E.focusOffset];$&&$.contentEditable=="false"&&(a=!0)}if(!(a||P&&Gi)&&Yl(c.node,c.offset,E.anchorNode,E.anchorOffset)&&Yl(w.node,w.offset,E.focusNode,E.focusOffset))return;let A=!1;if((k.extend||t==n)&&!P){k.collapse(c.node,c.offset);try{t!=n&&k.extend(w.node,w.offset),A=!0}catch{}}if(!A){if(t>n){let j=c;c=w,w=j}let $=document.createRange();$.setEnd(w.node,w.offset),$.setStart(c.node,c.offset),k.removeAllRanges(),k.addRange($)}}ignoreMutation(t){return!this.contentDOM&&t.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(t,n){for(let s=0,a=0;a<this.children.length;a++){let u=this.children[a],d=s+u.size;if(s==d?t<=d&&n>=s:t<d&&n>s){let c=s+u.border,w=d-u.border;if(t>=c&&n<=w){this.dirty=t==s||n==d?Ll:wb,t==c&&n==w&&(u.contentLost||u.dom.parentNode!=this.contentDOM)?u.dirty=Xs:u.markDirty(t-c,n-c);return}else u.dirty=u.dom==u.contentDOM&&u.dom.parentNode==this.contentDOM&&!u.children.length?Ll:Xs}s=d}this.dirty=Ll}markParentsDirty(){let t=1;for(let n=this.parent;n;n=n.parent,t++){let s=t==1?Ll:wb;n.dirty<s&&(n.dirty=s)}}get domAtom(){return!1}get ignoreForCoords(){return!1}isText(t){return!1}}class yT extends sp{constructor(t,n,s,a){let u,d=n.type.toDOM;if(typeof d=="function"&&(d=d(s,()=>{if(!u)return a;if(u.parent)return u.parent.posBeforeChild(u)})),!n.type.spec.raw){if(d.nodeType!=1){let c=document.createElement("span");c.appendChild(d),d=c}d.contentEditable="false",d.classList.add("ProseMirror-widget")}super(t,[],d,null),this.widget=n,this.widget=n,u=this}matchesWidget(t){return this.dirty==as&&t.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(t){let n=this.widget.spec.stopEvent;return n?n(t):!1}ignoreMutation(t){return t.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get side(){return this.widget.type.side}}class yz extends sp{constructor(t,n,s,a){super(t,[],n,null),this.textDOM=s,this.text=a}get size(){return this.text.length}localPosFromDOM(t,n){return t!=this.textDOM?this.posAtStart+(n?this.size:0):this.posAtStart+n}domFromPos(t){return{node:this.textDOM,offset:t}}ignoreMutation(t){return t.type==="characterData"&&t.target.nodeValue==t.oldValue}}class Ql extends sp{constructor(t,n,s,a,u){super(t,[],s,a),this.mark=n,this.spec=u}static create(t,n,s,a){let u=a.nodeViews[n.type.name],d=u&&u(n,a,s);return(!d||!d.dom)&&(d=nc.renderSpec(document,n.type.spec.toDOM(n,s),null,n.attrs)),new Ql(t,n,d.dom,d.contentDOM||d.dom,d)}parseRule(){return this.dirty&Xs||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(t){return this.dirty!=Xs&&this.mark.eq(t)}markDirty(t,n){if(super.markDirty(t,n),this.dirty!=as){let s=this.parent;for(;!s.node;)s=s.parent;s.dirty<this.dirty&&(s.dirty=this.dirty),this.dirty=as}}slice(t,n,s){let a=Ql.create(this.parent,this.mark,!0,s),u=this.children,d=this.size;n<d&&(u=C0(u,n,d,s)),t>0&&(u=C0(u,0,t,s));for(let c=0;c<u.length;c++)u[c].parent=a;return a.children=u,a}ignoreMutation(t){return this.spec.ignoreMutation?this.spec.ignoreMutation(t):super.ignoreMutation(t)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class Na extends sp{constructor(t,n,s,a,u,d,c,w,k){super(t,[],u,d),this.node=n,this.outerDeco=s,this.innerDeco=a,this.nodeDOM=c}static create(t,n,s,a,u,d){let c=u.nodeViews[n.type.name],w,k=c&&c(n,u,()=>{if(!w)return d;if(w.parent)return w.parent.posBeforeChild(w)},s,a),E=k&&k.dom,P=k&&k.contentDOM;if(n.isText){if(!E)E=document.createTextNode(n.text);else if(E.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else E||({dom:E,contentDOM:P}=nc.renderSpec(document,n.type.spec.toDOM(n),null,n.attrs));!P&&!n.isText&&E.nodeName!="BR"&&(E.hasAttribute("contenteditable")||(E.contentEditable="false"),n.type.spec.draggable&&(E.draggable=!0));let A=E;return E=wT(E,s,n),k?w=new _z(t,n,s,a,E,P||null,A,k,u,d+1):n.isText?new sg(t,n,s,a,E,A,u):new Na(t,n,s,a,E,P||null,A,u,d+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let t={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(t.preserveWhitespace="full"),!this.contentDOM)t.getContent=()=>this.node.content;else if(!this.contentLost)t.contentElement=this.contentDOM;else{for(let n=this.children.length-1;n>=0;n--){let s=this.children[n];if(this.dom.contains(s.dom.parentNode)){t.contentElement=s.dom.parentNode;break}}t.contentElement||(t.getContent=()=>Ae.empty)}return t}matchesNode(t,n,s){return this.dirty==as&&t.eq(this.node)&&Em(n,this.outerDeco)&&s.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(t,n){let s=this.node.inlineContent,a=n,u=t.composing?this.localCompositionInfo(t,n):null,d=u&&u.pos>-1?u:null,c=u&&u.pos<0,w=new xz(this,d&&d.node,t);Sz(this.node,this.innerDeco,(k,E,P)=>{k.spec.marks?w.syncToMarks(k.spec.marks,s,t):k.type.side>=0&&!P&&w.syncToMarks(E==this.node.childCount?sn.none:this.node.child(E).marks,s,t),w.placeWidget(k,t,a)},(k,E,P,A)=>{w.syncToMarks(k.marks,s,t);let $;w.findNodeMatch(k,E,P,A)||c&&t.state.selection.from>a&&t.state.selection.to<a+k.nodeSize&&($=w.findIndexWithChild(u.node))>-1&&w.updateNodeAt(k,E,P,$,t)||w.updateNextNode(k,E,P,t,A,a)||w.addNode(k,E,P,t,a),a+=k.nodeSize}),w.syncToMarks([],s,t),this.node.isTextblock&&w.addTextblockHacks(),w.destroyRest(),(w.changed||this.dirty==Ll)&&(d&&this.protectLocalComposition(t,d),vT(this.contentDOM,this.children,t),Lu&&kz(this.dom))}localCompositionInfo(t,n){let{from:s,to:a}=t.state.selection;if(!(t.state.selection instanceof kt)||s<n||a>n+this.node.content.size)return null;let u=t.input.compositionNode;if(!u||!this.dom.contains(u.parentNode))return null;if(this.node.inlineContent){let d=u.nodeValue,c=Tz(this.node.content,d,s-n,a-n);return c<0?null:{node:u,pos:c,text:d}}else return{node:u,pos:-1,text:""}}protectLocalComposition(t,{node:n,pos:s,text:a}){if(this.getDesc(n))return;let u=n;for(;u.parentNode!=this.contentDOM;u=u.parentNode){for(;u.previousSibling;)u.parentNode.removeChild(u.previousSibling);for(;u.nextSibling;)u.parentNode.removeChild(u.nextSibling);u.pmViewDesc&&(u.pmViewDesc=void 0)}let d=new yz(this,u,n,a);t.input.compositionNodes.push(d),this.children=C0(this.children,s,s+a.length,t,d)}update(t,n,s,a){return this.dirty==Xs||!t.sameMarkup(this.node)?!1:(this.updateInner(t,n,s,a),!0)}updateInner(t,n,s,a){this.updateOuterDeco(n),this.node=t,this.innerDeco=s,this.contentDOM&&this.updateChildren(a,this.posAtStart),this.dirty=as}updateOuterDeco(t){if(Em(t,this.outerDeco))return;let n=this.nodeDOM.nodeType!=1,s=this.dom;this.dom=xT(this.dom,this.nodeDOM,T0(this.outerDeco,this.node,n),T0(t,this.node,n)),this.dom!=s&&(s.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=t}selectNode(){this.nodeDOM.nodeType==1&&this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function bb(e,t,n,s,a){wT(s,t,e);let u=new Na(void 0,e,t,n,s,s,s,a,0);return u.contentDOM&&u.updateChildren(a,0),u}class sg extends Na{constructor(t,n,s,a,u,d,c){super(t,n,s,a,u,null,d,c,0)}parseRule(){let t=this.nodeDOM.parentNode;for(;t&&t!=this.dom&&!t.pmIsDeco;)t=t.parentNode;return{skip:t||!0}}update(t,n,s,a){return this.dirty==Xs||this.dirty!=as&&!this.inParent()||!t.sameMarkup(this.node)?!1:(this.updateOuterDeco(n),(this.dirty!=as||t.text!=this.node.text)&&t.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=t.text,a.trackWrites==this.nodeDOM&&(a.trackWrites=null)),this.node=t,this.dirty=as,!0)}inParent(){let t=this.parent.contentDOM;for(let n=this.nodeDOM;n;n=n.parentNode)if(n==t)return!0;return!1}domFromPos(t){return{node:this.nodeDOM,offset:t}}localPosFromDOM(t,n,s){return t==this.nodeDOM?this.posAtStart+Math.min(n,this.node.text.length):super.localPosFromDOM(t,n,s)}ignoreMutation(t){return t.type!="characterData"&&t.type!="selection"}slice(t,n,s){let a=this.node.cut(t,n),u=document.createTextNode(a.text);return new sg(this.parent,a,this.outerDeco,this.innerDeco,u,u,s)}markDirty(t,n){super.markDirty(t,n),this.dom!=this.nodeDOM&&(t==0||n==this.nodeDOM.nodeValue.length)&&(this.dirty=Xs)}get domAtom(){return!1}isText(t){return this.node.text==t}}class _T extends sp{parseRule(){return{ignore:!0}}matchesHack(t){return this.dirty==as&&this.dom.nodeName==t}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class _z extends Na{constructor(t,n,s,a,u,d,c,w,k,E){super(t,n,s,a,u,d,c,k,E),this.spec=w}update(t,n,s,a){if(this.dirty==Xs)return!1;if(this.spec.update&&(this.node.type==t.type||this.spec.multiType)){let u=this.spec.update(t,n,s);return u&&this.updateInner(t,n,s,a),u}else return!this.contentDOM&&!t.isLeaf?!1:super.update(t,n,s,a)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(t,n,s,a){this.spec.setSelection?this.spec.setSelection(t,n,s.root):super.setSelection(t,n,s,a)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(t){return this.spec.stopEvent?this.spec.stopEvent(t):!1}ignoreMutation(t){return this.spec.ignoreMutation?this.spec.ignoreMutation(t):super.ignoreMutation(t)}}function vT(e,t,n){let s=e.firstChild,a=!1;for(let u=0;u<t.length;u++){let d=t[u],c=d.dom;if(c.parentNode==e){for(;c!=s;)s=Sb(s),a=!0;s=s.nextSibling}else a=!0,e.insertBefore(c,s);if(d instanceof Ql){let w=s?s.previousSibling:e.lastChild;vT(d.contentDOM,d.children,n),s=w?w.nextSibling:e.firstChild}}for(;s;)s=Sb(s),a=!0;a&&n.trackWrites==e&&(n.trackWrites=null)}const Td=function(e){e&&(this.nodeName=e)};Td.prototype=Object.create(null);const Bl=[new Td];function T0(e,t,n){if(e.length==0)return Bl;let s=n?Bl[0]:new Td,a=[s];for(let u=0;u<e.length;u++){let d=e[u].type.attrs;if(d){d.nodeName&&a.push(s=new Td(d.nodeName));for(let c in d){let w=d[c];w!=null&&(n&&a.length==1&&a.push(s=new Td(t.isInline?"span":"div")),c=="class"?s.class=(s.class?s.class+" ":"")+w:c=="style"?s.style=(s.style?s.style+";":"")+w:c!="nodeName"&&(s[c]=w))}}}return a}function xT(e,t,n,s){if(n==Bl&&s==Bl)return t;let a=t;for(let u=0;u<s.length;u++){let d=s[u],c=n[u];if(u){let w;c&&c.nodeName==d.nodeName&&a!=e&&(w=a.parentNode)&&w.nodeName.toLowerCase()==d.nodeName||(w=document.createElement(d.nodeName),w.pmIsDeco=!0,w.appendChild(a),c=Bl[0]),a=w}vz(a,c||Bl[0],d)}return a}function vz(e,t,n){for(let s in t)s!="class"&&s!="style"&&s!="nodeName"&&!(s in n)&&e.removeAttribute(s);for(let s in n)s!="class"&&s!="style"&&s!="nodeName"&&n[s]!=t[s]&&e.setAttribute(s,n[s]);if(t.class!=n.class){let s=t.class?t.class.split(" ").filter(Boolean):[],a=n.class?n.class.split(" ").filter(Boolean):[];for(let u=0;u<s.length;u++)a.indexOf(s[u])==-1&&e.classList.remove(s[u]);for(let u=0;u<a.length;u++)s.indexOf(a[u])==-1&&e.classList.add(a[u]);e.classList.length==0&&e.removeAttribute("class")}if(t.style!=n.style){if(t.style){let s=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,a;for(;a=s.exec(t.style);)e.style.removeProperty(a[1])}n.style&&(e.style.cssText+=n.style)}}function wT(e,t,n){return xT(e,e,Bl,T0(t,n,e.nodeType!=1))}function Em(e,t){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].type.eq(t[n].type))return!1;return!0}function Sb(e){let t=e.nextSibling;return e.parentNode.removeChild(e),t}class xz{constructor(t,n,s){this.lock=n,this.view=s,this.index=0,this.stack=[],this.changed=!1,this.top=t,this.preMatch=wz(t.node.content,t)}destroyBetween(t,n){if(t!=n){for(let s=t;s<n;s++)this.top.children[s].destroy();this.top.children.splice(t,n-t),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(t,n,s){let a=0,u=this.stack.length>>1,d=Math.min(u,t.length);for(;a<d&&(a==u-1?this.top:this.stack[a+1<<1]).matchesMark(t[a])&&t[a].type.spec.spanning!==!1;)a++;for(;a<u;)this.destroyRest(),this.top.dirty=as,this.index=this.stack.pop(),this.top=this.stack.pop(),u--;for(;u<t.length;){this.stack.push(this.top,this.index+1);let c=-1;for(let w=this.index;w<Math.min(this.index+3,this.top.children.length);w++){let k=this.top.children[w];if(k.matchesMark(t[u])&&!this.isLocked(k.dom)){c=w;break}}if(c>-1)c>this.index&&(this.changed=!0,this.destroyBetween(this.index,c)),this.top=this.top.children[this.index];else{let w=Ql.create(this.top,t[u],n,s);this.top.children.splice(this.index,0,w),this.top=w,this.changed=!0}this.index=0,u++}}findNodeMatch(t,n,s,a){let u=-1,d;if(a>=this.preMatch.index&&(d=this.preMatch.matches[a-this.preMatch.index]).parent==this.top&&d.matchesNode(t,n,s))u=this.top.children.indexOf(d,this.index);else for(let c=this.index,w=Math.min(this.top.children.length,c+5);c<w;c++){let k=this.top.children[c];if(k.matchesNode(t,n,s)&&!this.preMatch.matched.has(k)){u=c;break}}return u<0?!1:(this.destroyBetween(this.index,u),this.index++,!0)}updateNodeAt(t,n,s,a,u){let d=this.top.children[a];return d.dirty==Xs&&d.dom==d.contentDOM&&(d.dirty=Ll),d.update(t,n,s,u)?(this.destroyBetween(this.index,a),this.index++,!0):!1}findIndexWithChild(t){for(;;){let n=t.parentNode;if(!n)return-1;if(n==this.top.contentDOM){let s=t.pmViewDesc;if(s){for(let a=this.index;a<this.top.children.length;a++)if(this.top.children[a]==s)return a}return-1}t=n}}updateNextNode(t,n,s,a,u,d){for(let c=this.index;c<this.top.children.length;c++){let w=this.top.children[c];if(w instanceof Na){let k=this.preMatch.matched.get(w);if(k!=null&&k!=u)return!1;let E=w.dom,P,A=this.isLocked(E)&&!(t.isText&&w.node&&w.node.isText&&w.nodeDOM.nodeValue==t.text&&w.dirty!=Xs&&Em(n,w.outerDeco));if(!A&&w.update(t,n,s,a))return this.destroyBetween(this.index,c),w.dom!=E&&(this.changed=!0),this.index++,!0;if(!A&&(P=this.recreateWrapper(w,t,n,s,a,d)))return this.destroyBetween(this.index,c),this.top.children[this.index]=P,P.contentDOM&&(P.dirty=Ll,P.updateChildren(a,d+1),P.dirty=as),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(t,n,s,a,u,d){if(t.dirty||n.isAtom||!t.children.length||!t.node.content.eq(n.content)||!Em(s,t.outerDeco)||!a.eq(t.innerDeco))return null;let c=Na.create(this.top,n,s,a,u,d);if(c.contentDOM){c.children=t.children,t.children=[];for(let w of c.children)w.parent=c}return t.destroy(),c}addNode(t,n,s,a,u){let d=Na.create(this.top,t,n,s,a,u);d.contentDOM&&d.updateChildren(a,u+1),this.top.children.splice(this.index++,0,d),this.changed=!0}placeWidget(t,n,s){let a=this.index<this.top.children.length?this.top.children[this.index]:null;if(a&&a.matchesWidget(t)&&(t==a.widget||!a.widget.type.toDOM.parentNode))this.index++;else{let u=new yT(this.top,t,n,s);this.top.children.splice(this.index++,0,u),this.changed=!0}}addTextblockHacks(){let t=this.top.children[this.index-1],n=this.top;for(;t instanceof Ql;)n=t,t=n.children[n.children.length-1];(!t||!(t instanceof sg)||/\n$/.test(t.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(t.node.text))&&((Gi||Di)&&t&&t.dom.contentEditable=="false"&&this.addHackNode("IMG",n),this.addHackNode("BR",this.top))}addHackNode(t,n){if(n==this.top&&this.index<n.children.length&&n.children[this.index].matchesHack(t))this.index++;else{let s=document.createElement(t);t=="IMG"&&(s.className="ProseMirror-separator",s.alt=""),t=="BR"&&(s.className="ProseMirror-trailingBreak");let a=new _T(this.top,[],s,null);n!=this.top?n.children.push(a):n.children.splice(this.index++,0,a),this.changed=!0}}isLocked(t){return this.lock&&(t==this.lock||t.nodeType==1&&t.contains(this.lock.parentNode))}}function wz(e,t){let n=t,s=n.children.length,a=e.childCount,u=new Map,d=[];e:for(;a>0;){let c;for(;;)if(s){let k=n.children[s-1];if(k instanceof Ql)n=k,s=k.children.length;else{c=k,s--;break}}else{if(n==t)break e;s=n.parent.children.indexOf(n),n=n.parent}let w=c.node;if(w){if(w!=e.child(a-1))break;--a,u.set(c,a),d.push(c)}}return{index:a,matched:u,matches:d.reverse()}}function bz(e,t){return e.type.side-t.type.side}function Sz(e,t,n,s){let a=t.locals(e),u=0;if(a.length==0){for(let k=0;k<e.childCount;k++){let E=e.child(k);s(E,a,t.forChild(u,E),k),u+=E.nodeSize}return}let d=0,c=[],w=null;for(let k=0;;){let E,P;for(;d<a.length&&a[d].to==u;){let he=a[d++];he.widget&&(E?(P||(P=[E])).push(he):E=he)}if(E)if(P){P.sort(bz);for(let he=0;he<P.length;he++)n(P[he],k,!!w)}else n(E,k,!!w);let A,$;if(w)$=-1,A=w,w=null;else if(k<e.childCount)$=k,A=e.child(k++);else break;for(let he=0;he<c.length;he++)c[he].to<=u&&c.splice(he--,1);for(;d<a.length&&a[d].from<=u&&a[d].to>u;)c.push(a[d++]);let j=u+A.nodeSize;if(A.isText){let he=j;d<a.length&&a[d].from<he&&(he=a[d].from);for(let K=0;K<c.length;K++)c[K].to<he&&(he=c[K].to);he<j&&(w=A.cut(he-u),A=A.cut(0,he-u),j=he,$=-1)}else for(;d<a.length&&a[d].to<j;)d++;let X=A.isInline&&!A.isLeaf?c.filter(he=>!he.inline):c.slice();s(A,X,t.forChild(u,A),$),u=j}}function kz(e){if(e.nodeName=="UL"||e.nodeName=="OL"){let t=e.style.cssText;e.style.cssText=t+"; list-style: square !important",window.getComputedStyle(e).listStyle,e.style.cssText=t}}function Tz(e,t,n,s){for(let a=0,u=0;a<e.childCount&&u<=s;){let d=e.child(a++),c=u;if(u+=d.nodeSize,!d.isText)continue;let w=d.text;for(;a<e.childCount;){let k=e.child(a++);if(u+=k.nodeSize,!k.isText)break;w+=k.text}if(u>=n){if(u>=s&&w.slice(s-t.length-c,s-c)==t)return s-t.length;let k=c<s?w.lastIndexOf(t,s-c-1):-1;if(k>=0&&k+t.length+c>=n)return c+k;if(n==s&&w.length>=s+t.length-c&&w.slice(s-c,s-c+t.length)==t)return s}}return-1}function C0(e,t,n,s,a){let u=[];for(let d=0,c=0;d<e.length;d++){let w=e[d],k=c,E=c+=w.size;k>=n||E<=t?u.push(w):(k<t&&u.push(w.slice(0,t-k,s)),a&&(u.push(a),a=void 0),E>n&&u.push(w.slice(n-k,w.size,s)))}return u}function Ov(e,t=null){let n=e.domSelectionRange(),s=e.state.doc;if(!n.focusNode)return null;let a=e.docView.nearestDesc(n.focusNode),u=a&&a.size==0,d=e.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(d<0)return null;let c=s.resolve(d),w,k;if(rg(n)){for(w=d;a&&!a.node;)a=a.parent;let P=a.node;if(a&&P.isAtom&&mt.isSelectable(P)&&a.parent&&!(P.isInline&&JA(n.focusNode,n.focusOffset,a.dom))){let A=a.posBefore;k=new mt(d==A?c:s.resolve(A))}}else{if(n instanceof e.dom.ownerDocument.defaultView.Selection&&n.rangeCount>1){let P=d,A=d;for(let $=0;$<n.rangeCount;$++){let j=n.getRangeAt($);P=Math.min(P,e.docView.posFromDOM(j.startContainer,j.startOffset,1)),A=Math.max(A,e.docView.posFromDOM(j.endContainer,j.endOffset,-1))}if(P<0)return null;[w,d]=A==e.state.selection.anchor?[A,P]:[P,A],c=s.resolve(d)}else w=e.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(w<0)return null}let E=s.resolve(w);if(!k){let P=t=="pointer"||e.state.selection.head<c.pos&&!u?1:-1;k=Lv(e,E,c,P)}return k}function bT(e){return e.editable?e.hasFocus():kT(e)&&document.activeElement&&document.activeElement.contains(e.dom)}function Co(e,t=!1){let n=e.state.selection;if(ST(e,n),!!bT(e)){if(!t&&e.input.mouseDown&&e.input.mouseDown.allowDefault&&Di){let s=e.domSelectionRange(),a=e.domObserver.currentSelection;if(s.anchorNode&&a.anchorNode&&Yl(s.anchorNode,s.anchorOffset,a.anchorNode,a.anchorOffset)){e.input.mouseDown.delayedSelectionSync=!0,e.domObserver.setCurSelection();return}}if(e.domObserver.disconnectSelection(),e.cursorWrapper)Mz(e);else{let{anchor:s,head:a}=n,u,d;kb&&!(n instanceof kt)&&(n.$from.parent.inlineContent||(u=Tb(e,n.from)),!n.empty&&!n.$from.parent.inlineContent&&(d=Tb(e,n.to))),e.docView.setSelection(s,a,e,t),kb&&(u&&Cb(u),d&&Cb(d)),n.visible?e.dom.classList.remove("ProseMirror-hideselection"):(e.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&Cz(e))}e.domObserver.setCurSelection(),e.domObserver.connectSelection()}}const kb=Gi||Di&&uT<63;function Tb(e,t){let{node:n,offset:s}=e.docView.domFromPos(t,0),a=s<n.childNodes.length?n.childNodes[s]:null,u=s?n.childNodes[s-1]:null;if(Gi&&a&&a.contentEditable=="false")return c_(a);if((!a||a.contentEditable=="false")&&(!u||u.contentEditable=="false")){if(a)return c_(a);if(u)return c_(u)}}function c_(e){return e.contentEditable="true",Gi&&e.draggable&&(e.draggable=!1,e.wasDraggable=!0),e}function Cb(e){e.contentEditable="false",e.wasDraggable&&(e.draggable=!0,e.wasDraggable=null)}function Cz(e){let t=e.dom.ownerDocument;t.removeEventListener("selectionchange",e.input.hideSelectionGuard);let n=e.domSelectionRange(),s=n.anchorNode,a=n.anchorOffset;t.addEventListener("selectionchange",e.input.hideSelectionGuard=()=>{(n.anchorNode!=s||n.anchorOffset!=a)&&(t.removeEventListener("selectionchange",e.input.hideSelectionGuard),setTimeout(()=>{(!bT(e)||e.state.selection.visible)&&e.dom.classList.remove("ProseMirror-hideselection")},20))})}function Mz(e){let t=e.domSelection(),n=document.createRange();if(!t)return;let s=e.cursorWrapper.dom,a=s.nodeName=="IMG";a?n.setStart(s.parentNode,pi(s)+1):n.setStart(s,0),n.collapse(!0),t.removeAllRanges(),t.addRange(n),!a&&!e.state.selection.visible&&yr&&Fa<=11&&(s.disabled=!0,s.disabled=!1)}function ST(e,t){if(t instanceof mt){let n=e.docView.descAt(t.from);n!=e.lastSelectedViewDesc&&(Mb(e),n&&n.selectNode(),e.lastSelectedViewDesc=n)}else Mb(e)}function Mb(e){e.lastSelectedViewDesc&&(e.lastSelectedViewDesc.parent&&e.lastSelectedViewDesc.deselectNode(),e.lastSelectedViewDesc=void 0)}function Lv(e,t,n,s){return e.someProp("createSelectionBetween",a=>a(e,t,n))||kt.between(t,n,s)}function Eb(e){return e.editable&&!e.hasFocus()?!1:kT(e)}function kT(e){let t=e.domSelectionRange();if(!t.anchorNode)return!1;try{return e.dom.contains(t.anchorNode.nodeType==3?t.anchorNode.parentNode:t.anchorNode)&&(e.editable||e.dom.contains(t.focusNode.nodeType==3?t.focusNode.parentNode:t.focusNode))}catch{return!1}}function Ez(e){let t=e.docView.domFromPos(e.state.selection.anchor,0),n=e.domSelectionRange();return Yl(t.node,t.offset,n.anchorNode,n.anchorOffset)}function M0(e,t){let{$anchor:n,$head:s}=e.selection,a=t>0?n.max(s):n.min(s),u=a.parent.inlineContent?a.depth?e.doc.resolve(t>0?a.after():a.before()):null:a;return u&&Et.findFrom(u,t)}function _a(e,t){return e.dispatch(e.state.tr.setSelection(t).scrollIntoView()),!0}function Ib(e,t,n){let s=e.state.selection;if(s instanceof kt)if(n.indexOf("s")>-1){let{$head:a}=s,u=a.textOffset?null:t<0?a.nodeBefore:a.nodeAfter;if(!u||u.isText||!u.isLeaf)return!1;let d=e.state.doc.resolve(a.pos+u.nodeSize*(t<0?-1:1));return _a(e,new kt(s.$anchor,d))}else if(s.empty){if(e.endOfTextblock(t>0?"forward":"backward")){let a=M0(e.state,t);return a&&a instanceof mt?_a(e,a):!1}else if(!(es&&n.indexOf("m")>-1)){let a=s.$head,u=a.textOffset?null:t<0?a.nodeBefore:a.nodeAfter,d;if(!u||u.isText)return!1;let c=t<0?a.pos-u.nodeSize:a.pos;return u.isAtom||(d=e.docView.descAt(c))&&!d.contentDOM?mt.isSelectable(u)?_a(e,new mt(t<0?e.state.doc.resolve(a.pos-u.nodeSize):a)):rp?_a(e,new kt(e.state.doc.resolve(t<0?c:c+u.nodeSize))):!1:!1}}else return!1;else{if(s instanceof mt&&s.node.isInline)return _a(e,new kt(t>0?s.$to:s.$from));{let a=M0(e.state,t);return a?_a(e,a):!1}}}function Im(e){return e.nodeType==3?e.nodeValue.length:e.childNodes.length}function Cd(e,t){let n=e.pmViewDesc;return n&&n.size==0&&(t<0||e.nextSibling||e.nodeName!="BR")}function eu(e,t){return t<0?Iz(e):Pz(e)}function Iz(e){let t=e.domSelectionRange(),n=t.focusNode,s=t.focusOffset;if(!n)return;let a,u,d=!1;for(Es&&n.nodeType==1&&s<Im(n)&&Cd(n.childNodes[s],-1)&&(d=!0);;)if(s>0){if(n.nodeType!=1)break;{let c=n.childNodes[s-1];if(Cd(c,-1))a=n,u=--s;else if(c.nodeType==3)n=c,s=n.nodeValue.length;else break}}else{if(TT(n))break;{let c=n.previousSibling;for(;c&&Cd(c,-1);)a=n.parentNode,u=pi(c),c=c.previousSibling;if(c)n=c,s=Im(n);else{if(n=n.parentNode,n==e.dom)break;s=0}}}d?E0(e,n,s):a&&E0(e,a,u)}function Pz(e){let t=e.domSelectionRange(),n=t.focusNode,s=t.focusOffset;if(!n)return;let a=Im(n),u,d;for(;;)if(s<a){if(n.nodeType!=1)break;let c=n.childNodes[s];if(Cd(c,1))u=n,d=++s;else break}else{if(TT(n))break;{let c=n.nextSibling;for(;c&&Cd(c,1);)u=c.parentNode,d=pi(c)+1,c=c.nextSibling;if(c)n=c,s=0,a=Im(n);else{if(n=n.parentNode,n==e.dom)break;s=a=0}}}u&&E0(e,u,d)}function TT(e){let t=e.pmViewDesc;return t&&t.node&&t.node.isBlock}function Az(e,t){for(;e&&t==e.childNodes.length&&!ip(e);)t=pi(e)+1,e=e.parentNode;for(;e&&t<e.childNodes.length;){let n=e.childNodes[t];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;e=n,t=0}}function zz(e,t){for(;e&&!t&&!ip(e);)t=pi(e),e=e.parentNode;for(;e&&t;){let n=e.childNodes[t-1];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;e=n,t=e.childNodes.length}}function E0(e,t,n){if(t.nodeType!=3){let u,d;(d=Az(t,n))?(t=d,n=0):(u=zz(t,n))&&(t=u,n=u.nodeValue.length)}let s=e.domSelection();if(!s)return;if(rg(s)){let u=document.createRange();u.setEnd(t,n),u.setStart(t,n),s.removeAllRanges(),s.addRange(u)}else s.extend&&s.extend(t,n);e.domObserver.setCurSelection();let{state:a}=e;setTimeout(()=>{e.state==a&&Co(e)},50)}function Pb(e,t){let n=e.state.doc.resolve(t);if(!(Di||ez)&&n.parent.inlineContent){let a=e.coordsAtPos(t);if(t>n.start()){let u=e.coordsAtPos(t-1),d=(u.top+u.bottom)/2;if(d>a.top&&d<a.bottom&&Math.abs(u.left-a.left)>1)return u.left<a.left?"ltr":"rtl"}if(t<n.end()){let u=e.coordsAtPos(t+1),d=(u.top+u.bottom)/2;if(d>a.top&&d<a.bottom&&Math.abs(u.left-a.left)>1)return u.left>a.left?"ltr":"rtl"}}return getComputedStyle(e.dom).direction=="rtl"?"rtl":"ltr"}function Ab(e,t,n){let s=e.state.selection;if(s instanceof kt&&!s.empty||n.indexOf("s")>-1||es&&n.indexOf("m")>-1)return!1;let{$from:a,$to:u}=s;if(!a.parent.inlineContent||e.endOfTextblock(t<0?"up":"down")){let d=M0(e.state,t);if(d&&d instanceof mt)return _a(e,d)}if(!a.parent.inlineContent){let d=t<0?a:u,c=s instanceof Cs?Et.near(d,t):Et.findFrom(d,t);return c?_a(e,c):!1}return!1}function zb(e,t){if(!(e.state.selection instanceof kt))return!0;let{$head:n,$anchor:s,empty:a}=e.state.selection;if(!n.sameParent(s))return!0;if(!a)return!1;if(e.endOfTextblock(t>0?"forward":"backward"))return!0;let u=!n.textOffset&&(t<0?n.nodeBefore:n.nodeAfter);if(u&&!u.isText){let d=e.state.tr;return t<0?d.delete(n.pos-u.nodeSize,n.pos):d.delete(n.pos,n.pos+u.nodeSize),e.dispatch(d),!0}return!1}function Db(e,t,n){e.domObserver.stop(),t.contentEditable=n,e.domObserver.start()}function Dz(e){if(!Gi||e.state.selection.$head.parentOffset>0)return!1;let{focusNode:t,focusOffset:n}=e.domSelectionRange();if(t&&t.nodeType==1&&n==0&&t.firstChild&&t.firstChild.contentEditable=="false"){let s=t.firstChild;Db(e,s,"true"),setTimeout(()=>Db(e,s,"false"),20)}return!1}function Rz(e){let t="";return e.ctrlKey&&(t+="c"),e.metaKey&&(t+="m"),e.altKey&&(t+="a"),e.shiftKey&&(t+="s"),t}function Oz(e,t){let n=t.keyCode,s=Rz(t);if(n==8||es&&n==72&&s=="c")return zb(e,-1)||eu(e,-1);if(n==46&&!t.shiftKey||es&&n==68&&s=="c")return zb(e,1)||eu(e,1);if(n==13||n==27)return!0;if(n==37||es&&n==66&&s=="c"){let a=n==37?Pb(e,e.state.selection.from)=="ltr"?-1:1:-1;return Ib(e,a,s)||eu(e,a)}else if(n==39||es&&n==70&&s=="c"){let a=n==39?Pb(e,e.state.selection.from)=="ltr"?1:-1:1;return Ib(e,a,s)||eu(e,a)}else{if(n==38||es&&n==80&&s=="c")return Ab(e,-1,s)||eu(e,-1);if(n==40||es&&n==78&&s=="c")return Dz(e)||Ab(e,1,s)||eu(e,1);if(s==(es?"m":"c")&&(n==66||n==73||n==89||n==90))return!0}return!1}function CT(e,t){e.someProp("transformCopied",$=>{t=$(t,e)});let n=[],{content:s,openStart:a,openEnd:u}=t;for(;a>1&&u>1&&s.childCount==1&&s.firstChild.childCount==1;){a--,u--;let $=s.firstChild;n.push($.type.name,$.attrs!=$.type.defaultAttrs?$.attrs:null),s=$.content}let d=e.someProp("clipboardSerializer")||nc.fromSchema(e.state.schema),c=zT(),w=c.createElement("div");w.appendChild(d.serializeFragment(s,{document:c}));let k=w.firstChild,E,P=0;for(;k&&k.nodeType==1&&(E=AT[k.nodeName.toLowerCase()]);){for(let $=E.length-1;$>=0;$--){let j=c.createElement(E[$]);for(;w.firstChild;)j.appendChild(w.firstChild);w.appendChild(j),P++}k=w.firstChild}k&&k.nodeType==1&&k.setAttribute("data-pm-slice",`${a} ${u}${P?` -${P}`:""} ${JSON.stringify(n)}`);let A=e.someProp("clipboardTextSerializer",$=>$(t,e))||t.content.textBetween(0,t.content.size,`

`);return{dom:w,text:A,slice:t}}function MT(e,t,n,s,a){let u=a.parent.type.spec.code,d,c;if(!n&&!t)return null;let w=t&&(s||u||!n);if(w){if(e.someProp("transformPastedText",A=>{t=A(t,u||s,e)}),u)return t?new Qe(Ae.from(e.state.schema.text(t.replace(/\r\n?/g,`
`))),0,0):Qe.empty;let P=e.someProp("clipboardTextParser",A=>A(t,a,s,e));if(P)c=P;else{let A=a.marks(),{schema:$}=e.state,j=nc.fromSchema($);d=document.createElement("div"),t.split(/(?:\r\n?|\n)+/).forEach(X=>{let he=d.appendChild(document.createElement("p"));X&&he.appendChild(j.serializeNode($.text(X,A)))})}}else e.someProp("transformPastedHTML",P=>{n=P(n,e)}),d=Nz(n),rp&&Vz(d);let k=d&&d.querySelector("[data-pm-slice]"),E=k&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(k.getAttribute("data-pm-slice")||"");if(E&&E[3])for(let P=+E[3];P>0;P--){let A=d.firstChild;for(;A&&A.nodeType!=1;)A=A.nextSibling;if(!A)break;d=A}if(c||(c=(e.someProp("clipboardParser")||e.someProp("domParser")||Ba.fromSchema(e.state.schema)).parseSlice(d,{preserveWhitespace:!!(w||E),context:a,ruleFromNode(A){return A.nodeName=="BR"&&!A.nextSibling&&A.parentNode&&!Lz.test(A.parentNode.nodeName)?{ignore:!0}:null}})),E)c=$z(Rb(c,+E[1],+E[2]),E[4]);else if(c=Qe.maxOpen(Bz(c.content,a),!0),c.openStart||c.openEnd){let P=0,A=0;for(let $=c.content.firstChild;P<c.openStart&&!$.type.spec.isolating;P++,$=$.firstChild);for(let $=c.content.lastChild;A<c.openEnd&&!$.type.spec.isolating;A++,$=$.lastChild);c=Rb(c,P,A)}return e.someProp("transformPasted",P=>{c=P(c,e)}),c}const Lz=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function Bz(e,t){if(e.childCount<2)return e;for(let n=t.depth;n>=0;n--){let a=t.node(n).contentMatchAt(t.index(n)),u,d=[];if(e.forEach(c=>{if(!d)return;let w=a.findWrapping(c.type),k;if(!w)return d=null;if(k=d.length&&u.length&&IT(w,u,c,d[d.length-1],0))d[d.length-1]=k;else{d.length&&(d[d.length-1]=PT(d[d.length-1],u.length));let E=ET(c,w);d.push(E),a=a.matchType(E.type),u=w}}),d)return Ae.from(d)}return e}function ET(e,t,n=0){for(let s=t.length-1;s>=n;s--)e=t[s].create(null,Ae.from(e));return e}function IT(e,t,n,s,a){if(a<e.length&&a<t.length&&e[a]==t[a]){let u=IT(e,t,n,s.lastChild,a+1);if(u)return s.copy(s.content.replaceChild(s.childCount-1,u));if(s.contentMatchAt(s.childCount).matchType(a==e.length-1?n.type:e[a+1]))return s.copy(s.content.append(Ae.from(ET(n,e,a+1))))}}function PT(e,t){if(t==0)return e;let n=e.content.replaceChild(e.childCount-1,PT(e.lastChild,t-1)),s=e.contentMatchAt(e.childCount).fillBefore(Ae.empty,!0);return e.copy(n.append(s))}function I0(e,t,n,s,a,u){let d=t<0?e.firstChild:e.lastChild,c=d.content;return e.childCount>1&&(u=0),a<s-1&&(c=I0(c,t,n,s,a+1,u)),a>=n&&(c=t<0?d.contentMatchAt(0).fillBefore(c,u<=a).append(c):c.append(d.contentMatchAt(d.childCount).fillBefore(Ae.empty,!0))),e.replaceChild(t<0?0:e.childCount-1,d.copy(c))}function Rb(e,t,n){return t<e.openStart&&(e=new Qe(I0(e.content,-1,t,e.openStart,0,e.openEnd),t,e.openEnd)),n<e.openEnd&&(e=new Qe(I0(e.content,1,n,e.openEnd,0,0),e.openStart,n)),e}const AT={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let Ob=null;function zT(){return Ob||(Ob=document.implementation.createHTMLDocument("title"))}let u_=null;function Fz(e){let t=window.trustedTypes;return t?(u_||(u_=t.createPolicy("ProseMirrorClipboard",{createHTML:n=>n})),u_.createHTML(e)):e}function Nz(e){let t=/^(\s*<meta [^>]*>)*/.exec(e);t&&(e=e.slice(t[0].length));let n=zT().createElement("div"),s=/<([a-z][^>\s]+)/i.exec(e),a;if((a=s&&AT[s[1].toLowerCase()])&&(e=a.map(u=>"<"+u+">").join("")+e+a.map(u=>"</"+u+">").reverse().join("")),n.innerHTML=Fz(e),a)for(let u=0;u<a.length;u++)n=n.querySelector(a[u])||n;return n}function Vz(e){let t=e.querySelectorAll(Di?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<t.length;n++){let s=t[n];s.childNodes.length==1&&s.textContent==""&&s.parentNode&&s.parentNode.replaceChild(e.ownerDocument.createTextNode(" "),s)}}function $z(e,t){if(!e.size)return e;let n=e.content.firstChild.type.schema,s;try{s=JSON.parse(t)}catch{return e}let{content:a,openStart:u,openEnd:d}=e;for(let c=s.length-2;c>=0;c-=2){let w=n.nodes[s[c]];if(!w||w.hasRequiredAttrs())break;a=Ae.from(w.create(s[c+1],a)),u++,d++}return new Qe(a,u,d)}const Ki={},Xi={},jz={touchstart:!0,touchmove:!0};class Uz{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:""},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastAndroidDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function qz(e){for(let t in Ki){let n=Ki[t];e.dom.addEventListener(t,e.input.eventHandlers[t]=s=>{Zz(e,s)&&!Bv(e,s)&&(e.editable||!(s.type in Xi))&&n(e,s)},jz[t]?{passive:!0}:void 0)}Gi&&e.dom.addEventListener("input",()=>null),P0(e)}function Ma(e,t){e.input.lastSelectionOrigin=t,e.input.lastSelectionTime=Date.now()}function Hz(e){e.domObserver.stop();for(let t in e.input.eventHandlers)e.dom.removeEventListener(t,e.input.eventHandlers[t]);clearTimeout(e.input.composingTimeout),clearTimeout(e.input.lastIOSEnterFallbackTimeout)}function P0(e){e.someProp("handleDOMEvents",t=>{for(let n in t)e.input.eventHandlers[n]||e.dom.addEventListener(n,e.input.eventHandlers[n]=s=>Bv(e,s))})}function Bv(e,t){return e.someProp("handleDOMEvents",n=>{let s=n[t.type];return s?s(e,t)||t.defaultPrevented:!1})}function Zz(e,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let n=t.target;n!=e.dom;n=n.parentNode)if(!n||n.nodeType==11||n.pmViewDesc&&n.pmViewDesc.stopEvent(t))return!1;return!0}function Wz(e,t){!Bv(e,t)&&Ki[t.type]&&(e.editable||!(t.type in Xi))&&Ki[t.type](e,t)}Xi.keydown=(e,t)=>{let n=t;if(e.input.shiftKey=n.keyCode==16||n.shiftKey,!RT(e,n)&&(e.input.lastKeyCode=n.keyCode,e.input.lastKeyCodeTime=Date.now(),!(bs&&Di&&n.keyCode==13)))if(n.keyCode!=229&&e.domObserver.forceFlush(),Lu&&n.keyCode==13&&!n.ctrlKey&&!n.altKey&&!n.metaKey){let s=Date.now();e.input.lastIOSEnter=s,e.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{e.input.lastIOSEnter==s&&(e.someProp("handleKeyDown",a=>a(e,Al(13,"Enter"))),e.input.lastIOSEnter=0)},200)}else e.someProp("handleKeyDown",s=>s(e,n))||Oz(e,n)?n.preventDefault():Ma(e,"key")};Xi.keyup=(e,t)=>{t.keyCode==16&&(e.input.shiftKey=!1)};Xi.keypress=(e,t)=>{let n=t;if(RT(e,n)||!n.charCode||n.ctrlKey&&!n.altKey||es&&n.metaKey)return;if(e.someProp("handleKeyPress",a=>a(e,n))){n.preventDefault();return}let s=e.state.selection;if(!(s instanceof kt)||!s.$from.sameParent(s.$to)){let a=String.fromCharCode(n.charCode);!/[\r\n]/.test(a)&&!e.someProp("handleTextInput",u=>u(e,s.$from.pos,s.$to.pos,a))&&e.dispatch(e.state.tr.insertText(a).scrollIntoView()),n.preventDefault()}};function og(e){return{left:e.clientX,top:e.clientY}}function Gz(e,t){let n=t.x-e.clientX,s=t.y-e.clientY;return n*n+s*s<100}function Fv(e,t,n,s,a){if(s==-1)return!1;let u=e.state.doc.resolve(s);for(let d=u.depth+1;d>0;d--)if(e.someProp(t,c=>d>u.depth?c(e,n,u.nodeAfter,u.before(d),a,!0):c(e,n,u.node(d),u.before(d),a,!1)))return!0;return!1}function Cu(e,t,n){if(e.focused||e.focus(),e.state.selection.eq(t))return;let s=e.state.tr.setSelection(t);s.setMeta("pointer",!0),e.dispatch(s)}function Kz(e,t){if(t==-1)return!1;let n=e.state.doc.resolve(t),s=n.nodeAfter;return s&&s.isAtom&&mt.isSelectable(s)?(Cu(e,new mt(n)),!0):!1}function Xz(e,t){if(t==-1)return!1;let n=e.state.selection,s,a;n instanceof mt&&(s=n.node);let u=e.state.doc.resolve(t);for(let d=u.depth+1;d>0;d--){let c=d>u.depth?u.nodeAfter:u.node(d);if(mt.isSelectable(c)){s&&n.$from.depth>0&&d>=n.$from.depth&&u.before(n.$from.depth+1)==n.$from.pos?a=u.before(n.$from.depth):a=u.before(d);break}}return a!=null?(Cu(e,mt.create(e.state.doc,a)),!0):!1}function Jz(e,t,n,s,a){return Fv(e,"handleClickOn",t,n,s)||e.someProp("handleClick",u=>u(e,t,s))||(a?Xz(e,n):Kz(e,n))}function Yz(e,t,n,s){return Fv(e,"handleDoubleClickOn",t,n,s)||e.someProp("handleDoubleClick",a=>a(e,t,s))}function Qz(e,t,n,s){return Fv(e,"handleTripleClickOn",t,n,s)||e.someProp("handleTripleClick",a=>a(e,t,s))||eD(e,n,s)}function eD(e,t,n){if(n.button!=0)return!1;let s=e.state.doc;if(t==-1)return s.inlineContent?(Cu(e,kt.create(s,0,s.content.size)),!0):!1;let a=s.resolve(t);for(let u=a.depth+1;u>0;u--){let d=u>a.depth?a.nodeAfter:a.node(u),c=a.before(u);if(d.inlineContent)Cu(e,kt.create(s,c+1,c+1+d.content.size));else if(mt.isSelectable(d))Cu(e,mt.create(s,c));else continue;return!0}}function Nv(e){return Pm(e)}const DT=es?"metaKey":"ctrlKey";Ki.mousedown=(e,t)=>{let n=t;e.input.shiftKey=n.shiftKey;let s=Nv(e),a=Date.now(),u="singleClick";a-e.input.lastClick.time<500&&Gz(n,e.input.lastClick)&&!n[DT]&&(e.input.lastClick.type=="singleClick"?u="doubleClick":e.input.lastClick.type=="doubleClick"&&(u="tripleClick")),e.input.lastClick={time:a,x:n.clientX,y:n.clientY,type:u};let d=e.posAtCoords(og(n));d&&(u=="singleClick"?(e.input.mouseDown&&e.input.mouseDown.done(),e.input.mouseDown=new tD(e,d,n,!!s)):(u=="doubleClick"?Yz:Qz)(e,d.pos,d.inside,n)?n.preventDefault():Ma(e,"pointer"))};class tD{constructor(t,n,s,a){this.view=t,this.pos=n,this.event=s,this.flushed=a,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=t.state.doc,this.selectNode=!!s[DT],this.allowDefault=s.shiftKey;let u,d;if(n.inside>-1)u=t.state.doc.nodeAt(n.inside),d=n.inside;else{let E=t.state.doc.resolve(n.pos);u=E.parent,d=E.depth?E.before():0}const c=a?null:s.target,w=c?t.docView.nearestDesc(c,!0):null;this.target=w&&w.dom.nodeType==1?w.dom:null;let{selection:k}=t.state;(s.button==0&&u.type.spec.draggable&&u.type.spec.selectable!==!1||k instanceof mt&&k.from<=d&&k.to>d)&&(this.mightDrag={node:u,pos:d,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&Es&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),t.root.addEventListener("mouseup",this.up=this.up.bind(this)),t.root.addEventListener("mousemove",this.move=this.move.bind(this)),Ma(t,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>Co(this.view)),this.view.input.mouseDown=null}up(t){if(this.done(),!this.view.dom.contains(t.target))return;let n=this.pos;this.view.state.doc!=this.startDoc&&(n=this.view.posAtCoords(og(t))),this.updateAllowDefault(t),this.allowDefault||!n?Ma(this.view,"pointer"):Jz(this.view,n.pos,n.inside,t,this.selectNode)?t.preventDefault():t.button==0&&(this.flushed||Gi&&this.mightDrag&&!this.mightDrag.node.isAtom||Di&&!this.view.state.selection.visible&&Math.min(Math.abs(n.pos-this.view.state.selection.from),Math.abs(n.pos-this.view.state.selection.to))<=2)?(Cu(this.view,Et.near(this.view.state.doc.resolve(n.pos))),t.preventDefault()):Ma(this.view,"pointer")}move(t){this.updateAllowDefault(t),Ma(this.view,"pointer"),t.buttons==0&&this.done()}updateAllowDefault(t){!this.allowDefault&&(Math.abs(this.event.x-t.clientX)>4||Math.abs(this.event.y-t.clientY)>4)&&(this.allowDefault=!0)}}Ki.touchstart=e=>{e.input.lastTouch=Date.now(),Nv(e),Ma(e,"pointer")};Ki.touchmove=e=>{e.input.lastTouch=Date.now(),Ma(e,"pointer")};Ki.contextmenu=e=>Nv(e);function RT(e,t){return e.composing?!0:Gi&&Math.abs(t.timeStamp-e.input.compositionEndedAt)<500?(e.input.compositionEndedAt=-2e8,!0):!1}const nD=bs?5e3:-1;Xi.compositionstart=Xi.compositionupdate=e=>{if(!e.composing){e.domObserver.flush();let{state:t}=e,n=t.selection.$to;if(t.selection instanceof kt&&(t.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(s=>s.type.spec.inclusive===!1)))e.markCursor=e.state.storedMarks||n.marks(),Pm(e,!0),e.markCursor=null;else if(Pm(e,!t.selection.empty),Es&&t.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let s=e.domSelectionRange();for(let a=s.focusNode,u=s.focusOffset;a&&a.nodeType==1&&u!=0;){let d=u<0?a.lastChild:a.childNodes[u-1];if(!d)break;if(d.nodeType==3){let c=e.domSelection();c&&c.collapse(d,d.nodeValue.length);break}else a=d,u=-1}}e.input.composing=!0}OT(e,nD)};Xi.compositionend=(e,t)=>{e.composing&&(e.input.composing=!1,e.input.compositionEndedAt=t.timeStamp,e.input.compositionPendingChanges=e.domObserver.pendingRecords().length?e.input.compositionID:0,e.input.compositionNode=null,e.input.compositionPendingChanges&&Promise.resolve().then(()=>e.domObserver.flush()),e.input.compositionID++,OT(e,20))};function OT(e,t){clearTimeout(e.input.composingTimeout),t>-1&&(e.input.composingTimeout=setTimeout(()=>Pm(e),t))}function LT(e){for(e.composing&&(e.input.composing=!1,e.input.compositionEndedAt=rD());e.input.compositionNodes.length>0;)e.input.compositionNodes.pop().markParentsDirty()}function iD(e){let t=e.domSelectionRange();if(!t.focusNode)return null;let n=KA(t.focusNode,t.focusOffset),s=XA(t.focusNode,t.focusOffset);if(n&&s&&n!=s){let a=s.pmViewDesc,u=e.domObserver.lastChangedTextNode;if(n==u||s==u)return u;if(!a||!a.isText(s.nodeValue))return s;if(e.input.compositionNode==s){let d=n.pmViewDesc;if(!(!d||!d.isText(n.nodeValue)))return s}}return n||s}function rD(){let e=document.createEvent("Event");return e.initEvent("event",!0,!0),e.timeStamp}function Pm(e,t=!1){if(!(bs&&e.domObserver.flushingSoon>=0)){if(e.domObserver.forceFlush(),LT(e),t||e.docView&&e.docView.dirty){let n=Ov(e);return n&&!n.eq(e.state.selection)?e.dispatch(e.state.tr.setSelection(n)):(e.markCursor||t)&&!e.state.selection.empty?e.dispatch(e.state.tr.deleteSelection()):e.updateState(e.state),!0}return!1}}function sD(e,t){if(!e.dom.parentNode)return;let n=e.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(t),n.style.cssText="position: fixed; left: -10000px; top: 10px";let s=getSelection(),a=document.createRange();a.selectNodeContents(t),e.dom.blur(),s.removeAllRanges(),s.addRange(a),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),e.focus()},50)}const Wd=yr&&Fa<15||Lu&&tz<604;Ki.copy=Xi.cut=(e,t)=>{let n=t,s=e.state.selection,a=n.type=="cut";if(s.empty)return;let u=Wd?null:n.clipboardData,d=s.content(),{dom:c,text:w}=CT(e,d);u?(n.preventDefault(),u.clearData(),u.setData("text/html",c.innerHTML),u.setData("text/plain",w)):sD(e,c),a&&e.dispatch(e.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function oD(e){return e.openStart==0&&e.openEnd==0&&e.content.childCount==1?e.content.firstChild:null}function aD(e,t){if(!e.dom.parentNode)return;let n=e.input.shiftKey||e.state.selection.$from.parent.type.spec.code,s=e.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(s.contentEditable="true"),s.style.cssText="position: fixed; left: -10000px; top: 10px",s.focus();let a=e.input.shiftKey&&e.input.lastKeyCode!=45;setTimeout(()=>{e.focus(),s.parentNode&&s.parentNode.removeChild(s),n?Gd(e,s.value,null,a,t):Gd(e,s.textContent,s.innerHTML,a,t)},50)}function Gd(e,t,n,s,a){let u=MT(e,t,n,s,e.state.selection.$from);if(e.someProp("handlePaste",w=>w(e,a,u||Qe.empty)))return!0;if(!u)return!1;let d=oD(u),c=d?e.state.tr.replaceSelectionWith(d,s):e.state.tr.replaceSelection(u);return e.dispatch(c.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function BT(e){let t=e.getData("text/plain")||e.getData("Text");if(t)return t;let n=e.getData("text/uri-list");return n?n.replace(/\r?\n/g," "):""}Xi.paste=(e,t)=>{let n=t;if(e.composing&&!bs)return;let s=Wd?null:n.clipboardData,a=e.input.shiftKey&&e.input.lastKeyCode!=45;s&&Gd(e,BT(s),s.getData("text/html"),a,n)?n.preventDefault():aD(e,n)};class FT{constructor(t,n,s){this.slice=t,this.move=n,this.node=s}}const NT=es?"altKey":"ctrlKey";Ki.dragstart=(e,t)=>{let n=t,s=e.input.mouseDown;if(s&&s.done(),!n.dataTransfer)return;let a=e.state.selection,u=a.empty?null:e.posAtCoords(og(n)),d;if(!(u&&u.pos>=a.from&&u.pos<=(a instanceof mt?a.to-1:a.to))){if(s&&s.mightDrag)d=mt.create(e.state.doc,s.mightDrag.pos);else if(n.target&&n.target.nodeType==1){let P=e.docView.nearestDesc(n.target,!0);P&&P.node.type.spec.draggable&&P!=e.docView&&(d=mt.create(e.state.doc,P.posBefore))}}let c=(d||e.state.selection).content(),{dom:w,text:k,slice:E}=CT(e,c);(!n.dataTransfer.files.length||!Di||uT>120)&&n.dataTransfer.clearData(),n.dataTransfer.setData(Wd?"Text":"text/html",w.innerHTML),n.dataTransfer.effectAllowed="copyMove",Wd||n.dataTransfer.setData("text/plain",k),e.dragging=new FT(E,!n[NT],d)};Ki.dragend=e=>{let t=e.dragging;window.setTimeout(()=>{e.dragging==t&&(e.dragging=null)},50)};Xi.dragover=Xi.dragenter=(e,t)=>t.preventDefault();Xi.drop=(e,t)=>{let n=t,s=e.dragging;if(e.dragging=null,!n.dataTransfer)return;let a=e.posAtCoords(og(n));if(!a)return;let u=e.state.doc.resolve(a.pos),d=s&&s.slice;d?e.someProp("transformPasted",j=>{d=j(d,e)}):d=MT(e,BT(n.dataTransfer),Wd?null:n.dataTransfer.getData("text/html"),!1,u);let c=!!(s&&!n[NT]);if(e.someProp("handleDrop",j=>j(e,n,d||Qe.empty,c))){n.preventDefault();return}if(!d)return;n.preventDefault();let w=d?nT(e.state.doc,u.pos,d):u.pos;w==null&&(w=u.pos);let k=e.state.tr;if(c){let{node:j}=s;j?j.replace(k):k.deleteSelection()}let E=k.mapping.map(w),P=d.openStart==0&&d.openEnd==0&&d.content.childCount==1,A=k.doc;if(P?k.replaceRangeWith(E,E,d.content.firstChild):k.replaceRange(E,E,d),k.doc.eq(A))return;let $=k.doc.resolve(E);if(P&&mt.isSelectable(d.content.firstChild)&&$.nodeAfter&&$.nodeAfter.sameMarkup(d.content.firstChild))k.setSelection(new mt($));else{let j=k.mapping.map(w);k.mapping.maps[k.mapping.maps.length-1].forEach((X,he,K,J)=>j=J),k.setSelection(Lv(e,$,k.doc.resolve(j)))}e.focus(),e.dispatch(k.setMeta("uiEvent","drop"))};Ki.focus=e=>{e.input.lastFocus=Date.now(),e.focused||(e.domObserver.stop(),e.dom.classList.add("ProseMirror-focused"),e.domObserver.start(),e.focused=!0,setTimeout(()=>{e.docView&&e.hasFocus()&&!e.domObserver.currentSelection.eq(e.domSelectionRange())&&Co(e)},20))};Ki.blur=(e,t)=>{let n=t;e.focused&&(e.domObserver.stop(),e.dom.classList.remove("ProseMirror-focused"),e.domObserver.start(),n.relatedTarget&&e.dom.contains(n.relatedTarget)&&e.domObserver.currentSelection.clear(),e.focused=!1)};Ki.beforeinput=(e,t)=>{if(Di&&bs&&t.inputType=="deleteContentBackward"){e.domObserver.flushSoon();let{domChangeCount:s}=e.input;setTimeout(()=>{if(e.input.domChangeCount!=s||(e.dom.blur(),e.focus(),e.someProp("handleKeyDown",u=>u(e,Al(8,"Backspace")))))return;let{$cursor:a}=e.state.selection;a&&a.pos>0&&e.dispatch(e.state.tr.delete(a.pos-1,a.pos).scrollIntoView())},50)}};for(let e in Xi)Ki[e]=Xi[e];function Kd(e,t){if(e==t)return!0;for(let n in e)if(e[n]!==t[n])return!1;for(let n in t)if(!(n in e))return!1;return!0}class Am{constructor(t,n){this.toDOM=t,this.spec=n||Ul,this.side=this.spec.side||0}map(t,n,s,a){let{pos:u,deleted:d}=t.mapResult(n.from+a,this.side<0?-1:1);return d?null:new Fr(u-s,u-s,this)}valid(){return!0}eq(t){return this==t||t instanceof Am&&(this.spec.key&&this.spec.key==t.spec.key||this.toDOM==t.toDOM&&Kd(this.spec,t.spec))}destroy(t){this.spec.destroy&&this.spec.destroy(t)}}class Va{constructor(t,n){this.attrs=t,this.spec=n||Ul}map(t,n,s,a){let u=t.map(n.from+a,this.spec.inclusiveStart?-1:1)-s,d=t.map(n.to+a,this.spec.inclusiveEnd?1:-1)-s;return u>=d?null:new Fr(u,d,this)}valid(t,n){return n.from<n.to}eq(t){return this==t||t instanceof Va&&Kd(this.attrs,t.attrs)&&Kd(this.spec,t.spec)}static is(t){return t.type instanceof Va}destroy(){}}class Vv{constructor(t,n){this.attrs=t,this.spec=n||Ul}map(t,n,s,a){let u=t.mapResult(n.from+a,1);if(u.deleted)return null;let d=t.mapResult(n.to+a,-1);return d.deleted||d.pos<=u.pos?null:new Fr(u.pos-s,d.pos-s,this)}valid(t,n){let{index:s,offset:a}=t.content.findIndex(n.from),u;return a==n.from&&!(u=t.child(s)).isText&&a+u.nodeSize==n.to}eq(t){return this==t||t instanceof Vv&&Kd(this.attrs,t.attrs)&&Kd(this.spec,t.spec)}destroy(){}}class Fr{constructor(t,n,s){this.from=t,this.to=n,this.type=s}copy(t,n){return new Fr(t,n,this.type)}eq(t,n=0){return this.type.eq(t.type)&&this.from+n==t.from&&this.to+n==t.to}map(t,n,s){return this.type.map(t,this,n,s)}static widget(t,n,s){return new Fr(t,t,new Am(n,s))}static inline(t,n,s,a){return new Fr(t,n,new Va(s,a))}static node(t,n,s,a){return new Fr(t,n,new Vv(s,a))}get spec(){return this.type.spec}get inline(){return this.type instanceof Va}get widget(){return this.type instanceof Am}}const nu=[],Ul={};class Ln{constructor(t,n){this.local=t.length?t:nu,this.children=n.length?n:nu}static create(t,n){return n.length?zm(n,t,0,Ul):Ai}find(t,n,s){let a=[];return this.findInner(t??0,n??1e9,a,0,s),a}findInner(t,n,s,a,u){for(let d=0;d<this.local.length;d++){let c=this.local[d];c.from<=n&&c.to>=t&&(!u||u(c.spec))&&s.push(c.copy(c.from+a,c.to+a))}for(let d=0;d<this.children.length;d+=3)if(this.children[d]<n&&this.children[d+1]>t){let c=this.children[d]+1;this.children[d+2].findInner(t-c,n-c,s,a+c,u)}}map(t,n,s){return this==Ai||t.maps.length==0?this:this.mapInner(t,n,0,0,s||Ul)}mapInner(t,n,s,a,u){let d;for(let c=0;c<this.local.length;c++){let w=this.local[c].map(t,s,a);w&&w.type.valid(n,w)?(d||(d=[])).push(w):u.onRemove&&u.onRemove(this.local[c].spec)}return this.children.length?lD(this.children,d||[],t,n,s,a,u):d?new Ln(d.sort(ql),nu):Ai}add(t,n){return n.length?this==Ai?Ln.create(t,n):this.addInner(t,n,0):this}addInner(t,n,s){let a,u=0;t.forEach((c,w)=>{let k=w+s,E;if(E=$T(n,c,k)){for(a||(a=this.children.slice());u<a.length&&a[u]<w;)u+=3;a[u]==w?a[u+2]=a[u+2].addInner(c,E,k+1):a.splice(u,0,w,w+c.nodeSize,zm(E,c,k+1,Ul)),u+=3}});let d=VT(u?jT(n):n,-s);for(let c=0;c<d.length;c++)d[c].type.valid(t,d[c])||d.splice(c--,1);return new Ln(d.length?this.local.concat(d).sort(ql):this.local,a||this.children)}remove(t){return t.length==0||this==Ai?this:this.removeInner(t,0)}removeInner(t,n){let s=this.children,a=this.local;for(let u=0;u<s.length;u+=3){let d,c=s[u]+n,w=s[u+1]+n;for(let E=0,P;E<t.length;E++)(P=t[E])&&P.from>c&&P.to<w&&(t[E]=null,(d||(d=[])).push(P));if(!d)continue;s==this.children&&(s=this.children.slice());let k=s[u+2].removeInner(d,c+1);k!=Ai?s[u+2]=k:(s.splice(u,3),u-=3)}if(a.length){for(let u=0,d;u<t.length;u++)if(d=t[u])for(let c=0;c<a.length;c++)a[c].eq(d,n)&&(a==this.local&&(a=this.local.slice()),a.splice(c--,1))}return s==this.children&&a==this.local?this:a.length||s.length?new Ln(a,s):Ai}forChild(t,n){if(this==Ai)return this;if(n.isLeaf)return Ln.empty;let s,a;for(let c=0;c<this.children.length;c+=3)if(this.children[c]>=t){this.children[c]==t&&(s=this.children[c+2]);break}let u=t+1,d=u+n.content.size;for(let c=0;c<this.local.length;c++){let w=this.local[c];if(w.from<d&&w.to>u&&w.type instanceof Va){let k=Math.max(u,w.from)-u,E=Math.min(d,w.to)-u;k<E&&(a||(a=[])).push(w.copy(k,E))}}if(a){let c=new Ln(a.sort(ql),nu);return s?new ba([c,s]):c}return s||Ai}eq(t){if(this==t)return!0;if(!(t instanceof Ln)||this.local.length!=t.local.length||this.children.length!=t.children.length)return!1;for(let n=0;n<this.local.length;n++)if(!this.local[n].eq(t.local[n]))return!1;for(let n=0;n<this.children.length;n+=3)if(this.children[n]!=t.children[n]||this.children[n+1]!=t.children[n+1]||!this.children[n+2].eq(t.children[n+2]))return!1;return!0}locals(t){return $v(this.localsInner(t))}localsInner(t){if(this==Ai)return nu;if(t.inlineContent||!this.local.some(Va.is))return this.local;let n=[];for(let s=0;s<this.local.length;s++)this.local[s].type instanceof Va||n.push(this.local[s]);return n}forEachSet(t){t(this)}}Ln.empty=new Ln([],[]);Ln.removeOverlap=$v;const Ai=Ln.empty;class ba{constructor(t){this.members=t}map(t,n){const s=this.members.map(a=>a.map(t,n,Ul));return ba.from(s)}forChild(t,n){if(n.isLeaf)return Ln.empty;let s=[];for(let a=0;a<this.members.length;a++){let u=this.members[a].forChild(t,n);u!=Ai&&(u instanceof ba?s=s.concat(u.members):s.push(u))}return ba.from(s)}eq(t){if(!(t instanceof ba)||t.members.length!=this.members.length)return!1;for(let n=0;n<this.members.length;n++)if(!this.members[n].eq(t.members[n]))return!1;return!0}locals(t){let n,s=!0;for(let a=0;a<this.members.length;a++){let u=this.members[a].localsInner(t);if(u.length)if(!n)n=u;else{s&&(n=n.slice(),s=!1);for(let d=0;d<u.length;d++)n.push(u[d])}}return n?$v(s?n:n.sort(ql)):nu}static from(t){switch(t.length){case 0:return Ai;case 1:return t[0];default:return new ba(t.every(n=>n instanceof Ln)?t:t.reduce((n,s)=>n.concat(s instanceof Ln?s:s.members),[]))}}forEachSet(t){for(let n=0;n<this.members.length;n++)this.members[n].forEachSet(t)}}function lD(e,t,n,s,a,u,d){let c=e.slice();for(let k=0,E=u;k<n.maps.length;k++){let P=0;n.maps[k].forEach((A,$,j,X)=>{let he=X-j-($-A);for(let K=0;K<c.length;K+=3){let J=c[K+1];if(J<0||A>J+E-P)continue;let le=c[K]+E-P;$>=le?c[K+1]=A<=le?-2:-1:A>=E&&he&&(c[K]+=he,c[K+1]+=he)}P+=he}),E=n.maps[k].map(E,-1)}let w=!1;for(let k=0;k<c.length;k+=3)if(c[k+1]<0){if(c[k+1]==-2){w=!0,c[k+1]=-1;continue}let E=n.map(e[k]+u),P=E-a;if(P<0||P>=s.content.size){w=!0;continue}let A=n.map(e[k+1]+u,-1),$=A-a,{index:j,offset:X}=s.content.findIndex(P),he=s.maybeChild(j);if(he&&X==P&&X+he.nodeSize==$){let K=c[k+2].mapInner(n,he,E+1,e[k]+u+1,d);K!=Ai?(c[k]=P,c[k+1]=$,c[k+2]=K):(c[k+1]=-2,w=!0)}else w=!0}if(w){let k=cD(c,e,t,n,a,u,d),E=zm(k,s,0,d);t=E.local;for(let P=0;P<c.length;P+=3)c[P+1]<0&&(c.splice(P,3),P-=3);for(let P=0,A=0;P<E.children.length;P+=3){let $=E.children[P];for(;A<c.length&&c[A]<$;)A+=3;c.splice(A,0,E.children[P],E.children[P+1],E.children[P+2])}}return new Ln(t.sort(ql),c)}function VT(e,t){if(!t||!e.length)return e;let n=[];for(let s=0;s<e.length;s++){let a=e[s];n.push(new Fr(a.from+t,a.to+t,a.type))}return n}function cD(e,t,n,s,a,u,d){function c(w,k){for(let E=0;E<w.local.length;E++){let P=w.local[E].map(s,a,k);P?n.push(P):d.onRemove&&d.onRemove(w.local[E].spec)}for(let E=0;E<w.children.length;E+=3)c(w.children[E+2],w.children[E]+k+1)}for(let w=0;w<e.length;w+=3)e[w+1]==-1&&c(e[w+2],t[w]+u+1);return n}function $T(e,t,n){if(t.isLeaf)return null;let s=n+t.nodeSize,a=null;for(let u=0,d;u<e.length;u++)(d=e[u])&&d.from>n&&d.to<s&&((a||(a=[])).push(d),e[u]=null);return a}function jT(e){let t=[];for(let n=0;n<e.length;n++)e[n]!=null&&t.push(e[n]);return t}function zm(e,t,n,s){let a=[],u=!1;t.forEach((c,w)=>{let k=$T(e,c,w+n);if(k){u=!0;let E=zm(k,c,n+w+1,s);E!=Ai&&a.push(w,w+c.nodeSize,E)}});let d=VT(u?jT(e):e,-n).sort(ql);for(let c=0;c<d.length;c++)d[c].type.valid(t,d[c])||(s.onRemove&&s.onRemove(d[c].spec),d.splice(c--,1));return d.length||a.length?new Ln(d,a):Ai}function ql(e,t){return e.from-t.from||e.to-t.to}function $v(e){let t=e;for(let n=0;n<t.length-1;n++){let s=t[n];if(s.from!=s.to)for(let a=n+1;a<t.length;a++){let u=t[a];if(u.from==s.from){u.to!=s.to&&(t==e&&(t=e.slice()),t[a]=u.copy(u.from,s.to),Lb(t,a+1,u.copy(s.to,u.to)));continue}else{u.from<s.to&&(t==e&&(t=e.slice()),t[n]=s.copy(s.from,u.from),Lb(t,a,s.copy(u.from,s.to)));break}}}return t}function Lb(e,t,n){for(;t<e.length&&ql(n,e[t])>0;)t++;e.splice(t,0,n)}function h_(e){let t=[];return e.someProp("decorations",n=>{let s=n(e.state);s&&s!=Ai&&t.push(s)}),e.cursorWrapper&&t.push(Ln.create(e.state.doc,[e.cursorWrapper.deco])),ba.from(t)}const uD={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},hD=yr&&Fa<=11;class dD{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(t){this.anchorNode=t.anchorNode,this.anchorOffset=t.anchorOffset,this.focusNode=t.focusNode,this.focusOffset=t.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(t){return t.anchorNode==this.anchorNode&&t.anchorOffset==this.anchorOffset&&t.focusNode==this.focusNode&&t.focusOffset==this.focusOffset}}class pD{constructor(t,n){this.view=t,this.handleDOMChange=n,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new dD,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(s=>{for(let a=0;a<s.length;a++)this.queue.push(s[a]);yr&&Fa<=11&&s.some(a=>a.type=="childList"&&a.removedNodes.length||a.type=="characterData"&&a.oldValue.length>a.target.nodeValue.length)?this.flushSoon():this.flush()}),hD&&(this.onCharData=s=>{this.queue.push({target:s.target,type:"characterData",oldValue:s.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,uD)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let t=this.observer.takeRecords();if(t.length){for(let n=0;n<t.length;n++)this.queue.push(t[n]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(Eb(this.view)){if(this.suppressingSelectionUpdates)return Co(this.view);if(yr&&Fa<=11&&!this.view.state.selection.empty){let t=this.view.domSelectionRange();if(t.focusNode&&Yl(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(t){if(!t.focusNode)return!0;let n=new Set,s;for(let u=t.focusNode;u;u=Zd(u))n.add(u);for(let u=t.anchorNode;u;u=Zd(u))if(n.has(u)){s=u;break}let a=s&&this.view.docView.nearestDesc(s);if(a&&a.ignoreMutation({type:"selection",target:s.nodeType==3?s.parentNode:s}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let t of this.observer.takeRecords())this.queue.push(t);return this.queue}flush(){let{view:t}=this;if(!t.docView||this.flushingSoon>-1)return;let n=this.pendingRecords();n.length&&(this.queue=[]);let s=t.domSelectionRange(),a=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(s)&&Eb(t)&&!this.ignoreSelectionChange(s),u=-1,d=-1,c=!1,w=[];if(t.editable)for(let E=0;E<n.length;E++){let P=this.registerMutation(n[E],w);P&&(u=u<0?P.from:Math.min(P.from,u),d=d<0?P.to:Math.max(P.to,d),P.typeOver&&(c=!0))}if(Es&&w.length){let E=w.filter(P=>P.nodeName=="BR");if(E.length==2){let[P,A]=E;P.parentNode&&P.parentNode.parentNode==A.parentNode?A.remove():P.remove()}else{let{focusNode:P}=this.currentSelection;for(let A of E){let $=A.parentNode;$&&$.nodeName=="LI"&&(!P||gD(t,P)!=$)&&A.remove()}}}let k=null;u<0&&a&&t.input.lastFocus>Date.now()-200&&Math.max(t.input.lastTouch,t.input.lastClick.time)<Date.now()-300&&rg(s)&&(k=Ov(t))&&k.eq(Et.near(t.state.doc.resolve(0),1))?(t.input.lastFocus=0,Co(t),this.currentSelection.set(s),t.scrollToSelection()):(u>-1||a)&&(u>-1&&(t.docView.markDirty(u,d),fD(t)),this.handleDOMChange(u,d,c,w),t.docView&&t.docView.dirty?t.updateState(t.state):this.currentSelection.eq(s)||Co(t),this.currentSelection.set(s))}registerMutation(t,n){if(n.indexOf(t.target)>-1)return null;let s=this.view.docView.nearestDesc(t.target);if(t.type=="attributes"&&(s==this.view.docView||t.attributeName=="contenteditable"||t.attributeName=="style"&&!t.oldValue&&!t.target.getAttribute("style"))||!s||s.ignoreMutation(t))return null;if(t.type=="childList"){for(let E=0;E<t.addedNodes.length;E++){let P=t.addedNodes[E];n.push(P),P.nodeType==3&&(this.lastChangedTextNode=P)}if(s.contentDOM&&s.contentDOM!=s.dom&&!s.contentDOM.contains(t.target))return{from:s.posBefore,to:s.posAfter};let a=t.previousSibling,u=t.nextSibling;if(yr&&Fa<=11&&t.addedNodes.length)for(let E=0;E<t.addedNodes.length;E++){let{previousSibling:P,nextSibling:A}=t.addedNodes[E];(!P||Array.prototype.indexOf.call(t.addedNodes,P)<0)&&(a=P),(!A||Array.prototype.indexOf.call(t.addedNodes,A)<0)&&(u=A)}let d=a&&a.parentNode==t.target?pi(a)+1:0,c=s.localPosFromDOM(t.target,d,-1),w=u&&u.parentNode==t.target?pi(u):t.target.childNodes.length,k=s.localPosFromDOM(t.target,w,1);return{from:c,to:k}}else return t.type=="attributes"?{from:s.posAtStart-s.border,to:s.posAtEnd+s.border}:(this.lastChangedTextNode=t.target,{from:s.posAtStart,to:s.posAtEnd,typeOver:t.target.nodeValue==t.oldValue})}}let Bb=new WeakMap,Fb=!1;function fD(e){if(!Bb.has(e)&&(Bb.set(e,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(e.dom).whiteSpace)!==-1)){if(e.requiresGeckoHackNode=Es,Fb)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),Fb=!0}}function Nb(e,t){let n=t.startContainer,s=t.startOffset,a=t.endContainer,u=t.endOffset,d=e.domAtPos(e.state.selection.anchor);return Yl(d.node,d.offset,a,u)&&([n,s,a,u]=[a,u,n,s]),{anchorNode:n,anchorOffset:s,focusNode:a,focusOffset:u}}function mD(e,t){if(t.getComposedRanges){let a=t.getComposedRanges(e.root)[0];if(a)return Nb(e,a)}let n;function s(a){a.preventDefault(),a.stopImmediatePropagation(),n=a.getTargetRanges()[0]}return e.dom.addEventListener("beforeinput",s,!0),document.execCommand("indent"),e.dom.removeEventListener("beforeinput",s,!0),n?Nb(e,n):null}function gD(e,t){for(let n=t.parentNode;n&&n!=e.dom;n=n.parentNode){let s=e.docView.nearestDesc(n,!0);if(s&&s.node.isBlock)return n}return null}function yD(e,t,n){let{node:s,fromOffset:a,toOffset:u,from:d,to:c}=e.docView.parseRange(t,n),w=e.domSelectionRange(),k,E=w.anchorNode;if(E&&e.dom.contains(E.nodeType==1?E:E.parentNode)&&(k=[{node:E,offset:w.anchorOffset}],rg(w)||k.push({node:w.focusNode,offset:w.focusOffset})),Di&&e.input.lastKeyCode===8)for(let he=u;he>a;he--){let K=s.childNodes[he-1],J=K.pmViewDesc;if(K.nodeName=="BR"&&!J){u=he;break}if(!J||J.size)break}let P=e.state.doc,A=e.someProp("domParser")||Ba.fromSchema(e.state.schema),$=P.resolve(d),j=null,X=A.parse(s,{topNode:$.parent,topMatch:$.parent.contentMatchAt($.index()),topOpen:!0,from:a,to:u,preserveWhitespace:$.parent.type.whitespace=="pre"?"full":!0,findPositions:k,ruleFromNode:_D,context:$});if(k&&k[0].pos!=null){let he=k[0].pos,K=k[1]&&k[1].pos;K==null&&(K=he),j={anchor:he+d,head:K+d}}return{doc:X,sel:j,from:d,to:c}}function _D(e){let t=e.pmViewDesc;if(t)return t.parseRule();if(e.nodeName=="BR"&&e.parentNode){if(Gi&&/^(ul|ol)$/i.test(e.parentNode.nodeName)){let n=document.createElement("div");return n.appendChild(document.createElement("li")),{skip:n}}else if(e.parentNode.lastChild==e||Gi&&/^(tr|table)$/i.test(e.parentNode.nodeName))return{ignore:!0}}else if(e.nodeName=="IMG"&&e.getAttribute("mark-placeholder"))return{ignore:!0};return null}const vD=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function xD(e,t,n,s,a){let u=e.input.compositionPendingChanges||(e.composing?e.input.compositionID:0);if(e.input.compositionPendingChanges=0,t<0){let tt=e.input.lastSelectionTime>Date.now()-50?e.input.lastSelectionOrigin:null,ft=Ov(e,tt);if(ft&&!e.state.selection.eq(ft)){if(Di&&bs&&e.input.lastKeyCode===13&&Date.now()-100<e.input.lastKeyCodeTime&&e.someProp("handleKeyDown",tr=>tr(e,Al(13,"Enter"))))return;let xt=e.state.tr.setSelection(ft);tt=="pointer"?xt.setMeta("pointer",!0):tt=="key"&&xt.scrollIntoView(),u&&xt.setMeta("composition",u),e.dispatch(xt)}return}let d=e.state.doc.resolve(t),c=d.sharedDepth(n);t=d.before(c+1),n=e.state.doc.resolve(n).after(c+1);let w=e.state.selection,k=yD(e,t,n),E=e.state.doc,P=E.slice(k.from,k.to),A,$;e.input.lastKeyCode===8&&Date.now()-100<e.input.lastKeyCodeTime?(A=e.state.selection.to,$="end"):(A=e.state.selection.from,$="start"),e.input.lastKeyCode=null;let j=SD(P.content,k.doc.content,k.from,A,$);if(j&&e.input.domChangeCount++,(Lu&&e.input.lastIOSEnter>Date.now()-225||bs)&&a.some(tt=>tt.nodeType==1&&!vD.test(tt.nodeName))&&(!j||j.endA>=j.endB)&&e.someProp("handleKeyDown",tt=>tt(e,Al(13,"Enter")))){e.input.lastIOSEnter=0;return}if(!j)if(s&&w instanceof kt&&!w.empty&&w.$head.sameParent(w.$anchor)&&!e.composing&&!(k.sel&&k.sel.anchor!=k.sel.head))j={start:w.from,endA:w.to,endB:w.to};else{if(k.sel){let tt=Vb(e,e.state.doc,k.sel);if(tt&&!tt.eq(e.state.selection)){let ft=e.state.tr.setSelection(tt);u&&ft.setMeta("composition",u),e.dispatch(ft)}}return}e.state.selection.from<e.state.selection.to&&j.start==j.endB&&e.state.selection instanceof kt&&(j.start>e.state.selection.from&&j.start<=e.state.selection.from+2&&e.state.selection.from>=k.from?j.start=e.state.selection.from:j.endA<e.state.selection.to&&j.endA>=e.state.selection.to-2&&e.state.selection.to<=k.to&&(j.endB+=e.state.selection.to-j.endA,j.endA=e.state.selection.to)),yr&&Fa<=11&&j.endB==j.start+1&&j.endA==j.start&&j.start>k.from&&k.doc.textBetween(j.start-k.from-1,j.start-k.from+1)==" "&&(j.start--,j.endA--,j.endB--);let X=k.doc.resolveNoCache(j.start-k.from),he=k.doc.resolveNoCache(j.endB-k.from),K=E.resolve(j.start),J=X.sameParent(he)&&X.parent.inlineContent&&K.end()>=j.endA,le;if((Lu&&e.input.lastIOSEnter>Date.now()-225&&(!J||a.some(tt=>tt.nodeName=="DIV"||tt.nodeName=="P"))||!J&&X.pos<k.doc.content.size&&!X.sameParent(he)&&(le=Et.findFrom(k.doc.resolve(X.pos+1),1,!0))&&le.head==he.pos)&&e.someProp("handleKeyDown",tt=>tt(e,Al(13,"Enter")))){e.input.lastIOSEnter=0;return}if(e.state.selection.anchor>j.start&&bD(E,j.start,j.endA,X,he)&&e.someProp("handleKeyDown",tt=>tt(e,Al(8,"Backspace")))){bs&&Di&&e.domObserver.suppressSelectionUpdates();return}Di&&bs&&j.endB==j.start&&(e.input.lastAndroidDelete=Date.now()),bs&&!J&&X.start()!=he.start()&&he.parentOffset==0&&X.depth==he.depth&&k.sel&&k.sel.anchor==k.sel.head&&k.sel.head==j.endA&&(j.endB-=2,he=k.doc.resolveNoCache(j.endB-k.from),setTimeout(()=>{e.someProp("handleKeyDown",function(tt){return tt(e,Al(13,"Enter"))})},20));let Se=j.start,Me=j.endA,Ee,De,Ze;if(J){if(X.pos==he.pos)yr&&Fa<=11&&X.parentOffset==0&&(e.domObserver.suppressSelectionUpdates(),setTimeout(()=>Co(e),20)),Ee=e.state.tr.delete(Se,Me),De=E.resolve(j.start).marksAcross(E.resolve(j.endA));else if(j.endA==j.endB&&(Ze=wD(X.parent.content.cut(X.parentOffset,he.parentOffset),K.parent.content.cut(K.parentOffset,j.endA-K.start()))))Ee=e.state.tr,Ze.type=="add"?Ee.addMark(Se,Me,Ze.mark):Ee.removeMark(Se,Me,Ze.mark);else if(X.parent.child(X.index()).isText&&X.index()==he.index()-(he.textOffset?0:1)){let tt=X.parent.textBetween(X.parentOffset,he.parentOffset);if(e.someProp("handleTextInput",ft=>ft(e,Se,Me,tt)))return;Ee=e.state.tr.insertText(tt,Se,Me)}}if(Ee||(Ee=e.state.tr.replace(Se,Me,k.doc.slice(j.start-k.from,j.endB-k.from))),k.sel){let tt=Vb(e,Ee.doc,k.sel);tt&&!(Di&&bs&&e.composing&&tt.empty&&(j.start!=j.endB||e.input.lastAndroidDelete<Date.now()-100)&&(tt.head==Se||tt.head==Ee.mapping.map(Me)-1)||yr&&tt.empty&&tt.head==Se)&&Ee.setSelection(tt)}De&&Ee.ensureMarks(De),u&&Ee.setMeta("composition",u),e.dispatch(Ee.scrollIntoView())}function Vb(e,t,n){return Math.max(n.anchor,n.head)>t.content.size?null:Lv(e,t.resolve(n.anchor),t.resolve(n.head))}function wD(e,t){let n=e.firstChild.marks,s=t.firstChild.marks,a=n,u=s,d,c,w;for(let E=0;E<s.length;E++)a=s[E].removeFromSet(a);for(let E=0;E<n.length;E++)u=n[E].removeFromSet(u);if(a.length==1&&u.length==0)c=a[0],d="add",w=E=>E.mark(c.addToSet(E.marks));else if(a.length==0&&u.length==1)c=u[0],d="remove",w=E=>E.mark(c.removeFromSet(E.marks));else return null;let k=[];for(let E=0;E<t.childCount;E++)k.push(w(t.child(E)));if(Ae.from(k).eq(e))return{mark:c,type:d}}function bD(e,t,n,s,a){if(n-t<=a.pos-s.pos||d_(s,!0,!1)<a.pos)return!1;let u=e.resolve(t);if(!s.parent.isTextblock){let c=u.nodeAfter;return c!=null&&n==t+c.nodeSize}if(u.parentOffset<u.parent.content.size||!u.parent.isTextblock)return!1;let d=e.resolve(d_(u,!0,!0));return!d.parent.isTextblock||d.pos>n||d_(d,!0,!1)<n?!1:s.parent.content.cut(s.parentOffset).eq(d.parent.content)}function d_(e,t,n){let s=e.depth,a=t?e.end():e.pos;for(;s>0&&(t||e.indexAfter(s)==e.node(s).childCount);)s--,a++,t=!1;if(n){let u=e.node(s).maybeChild(e.indexAfter(s));for(;u&&!u.isLeaf;)u=u.firstChild,a++}return a}function SD(e,t,n,s,a){let u=e.findDiffStart(t,n);if(u==null)return null;let{a:d,b:c}=e.findDiffEnd(t,n+e.size,n+t.size);if(a=="end"){let w=Math.max(0,u-Math.min(d,c));s-=d+w-u}if(d<u&&e.size<t.size){let w=s<=u&&s>=d?u-s:0;u-=w,u&&u<t.size&&$b(t.textBetween(u-1,u+1))&&(u+=w?1:-1),c=u+(c-d),d=u}else if(c<u){let w=s<=u&&s>=c?u-s:0;u-=w,u&&u<e.size&&$b(e.textBetween(u-1,u+1))&&(u+=w?1:-1),d=u+(d-c),c=u}return{start:u,endA:d,endB:c}}function $b(e){if(e.length!=2)return!1;let t=e.charCodeAt(0),n=e.charCodeAt(1);return t>=56320&&t<=57343&&n>=55296&&n<=56319}class kD{constructor(t,n){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new Uz,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=n,this.state=n.state,this.directPlugins=n.plugins||[],this.directPlugins.forEach(Zb),this.dispatch=this.dispatch.bind(this),this.dom=t&&t.mount||document.createElement("div"),t&&(t.appendChild?t.appendChild(this.dom):typeof t=="function"?t(this.dom):t.mount&&(this.mounted=!0)),this.editable=qb(this),Ub(this),this.nodeViews=Hb(this),this.docView=bb(this.state.doc,jb(this),h_(this),this.dom,this),this.domObserver=new pD(this,(s,a,u,d)=>xD(this,s,a,u,d)),this.domObserver.start(),qz(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let t=this._props;this._props={};for(let n in t)this._props[n]=t[n];this._props.state=this.state}return this._props}update(t){t.handleDOMEvents!=this._props.handleDOMEvents&&P0(this);let n=this._props;this._props=t,t.plugins&&(t.plugins.forEach(Zb),this.directPlugins=t.plugins),this.updateStateInner(t.state,n)}setProps(t){let n={};for(let s in this._props)n[s]=this._props[s];n.state=this.state;for(let s in t)n[s]=t[s];this.update(n)}updateState(t){this.updateStateInner(t,this._props)}updateStateInner(t,n){var s;let a=this.state,u=!1,d=!1;t.storedMarks&&this.composing&&(LT(this),d=!0),this.state=t;let c=a.plugins!=t.plugins||this._props.plugins!=n.plugins;if(c||this._props.plugins!=n.plugins||this._props.nodeViews!=n.nodeViews){let $=Hb(this);CD($,this.nodeViews)&&(this.nodeViews=$,u=!0)}(c||n.handleDOMEvents!=this._props.handleDOMEvents)&&P0(this),this.editable=qb(this),Ub(this);let w=h_(this),k=jb(this),E=a.plugins!=t.plugins&&!a.doc.eq(t.doc)?"reset":t.scrollToSelection>a.scrollToSelection?"to selection":"preserve",P=u||!this.docView.matchesNode(t.doc,k,w);(P||!t.selection.eq(a.selection))&&(d=!0);let A=E=="preserve"&&d&&this.dom.style.overflowAnchor==null&&rz(this);if(d){this.domObserver.stop();let $=P&&(yr||Di)&&!this.composing&&!a.selection.empty&&!t.selection.empty&&TD(a.selection,t.selection);if(P){let j=Di?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=iD(this)),(u||!this.docView.update(t.doc,k,w,this))&&(this.docView.updateOuterDeco(k),this.docView.destroy(),this.docView=bb(t.doc,k,w,this.dom,this)),j&&!this.trackWrites&&($=!0)}$||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&Ez(this))?Co(this,$):(ST(this,t.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(a),!((s=this.dragging)===null||s===void 0)&&s.node&&!a.doc.eq(t.doc)&&this.updateDraggedNode(this.dragging,a),E=="reset"?this.dom.scrollTop=0:E=="to selection"?this.scrollToSelection():A&&sz(A)}scrollToSelection(){let t=this.domSelectionRange().focusNode;if(!this.someProp("handleScrollToSelection",n=>n(this)))if(this.state.selection instanceof mt){let n=this.docView.domAfterPos(this.state.selection.from);n.nodeType==1&&gb(this,n.getBoundingClientRect(),t)}else gb(this,this.coordsAtPos(this.state.selection.head,1),t)}destroyPluginViews(){let t;for(;t=this.pluginViews.pop();)t.destroy&&t.destroy()}updatePluginViews(t){if(!t||t.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let n=0;n<this.directPlugins.length;n++){let s=this.directPlugins[n];s.spec.view&&this.pluginViews.push(s.spec.view(this))}for(let n=0;n<this.state.plugins.length;n++){let s=this.state.plugins[n];s.spec.view&&this.pluginViews.push(s.spec.view(this))}}else for(let n=0;n<this.pluginViews.length;n++){let s=this.pluginViews[n];s.update&&s.update(this,t)}}updateDraggedNode(t,n){let s=t.node,a=-1;if(this.state.doc.nodeAt(s.from)==s.node)a=s.from;else{let u=s.from+(this.state.doc.content.size-n.doc.content.size);(u>0&&this.state.doc.nodeAt(u))==s.node&&(a=u)}this.dragging=new FT(t.slice,t.move,a<0?void 0:mt.create(this.state.doc,a))}someProp(t,n){let s=this._props&&this._props[t],a;if(s!=null&&(a=n?n(s):s))return a;for(let d=0;d<this.directPlugins.length;d++){let c=this.directPlugins[d].props[t];if(c!=null&&(a=n?n(c):c))return a}let u=this.state.plugins;if(u)for(let d=0;d<u.length;d++){let c=u[d].props[t];if(c!=null&&(a=n?n(c):c))return a}}hasFocus(){if(yr){let t=this.root.activeElement;if(t==this.dom)return!0;if(!t||!this.dom.contains(t))return!1;for(;t&&this.dom!=t&&this.dom.contains(t);){if(t.contentEditable=="false")return!1;t=t.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&oz(this.dom),Co(this),this.domObserver.start()}get root(){let t=this._root;if(t==null){for(let n=this.dom.parentNode;n;n=n.parentNode)if(n.nodeType==9||n.nodeType==11&&n.host)return n.getSelection||(Object.getPrototypeOf(n).getSelection=()=>n.ownerDocument.getSelection()),this._root=n}return t||document}updateRoot(){this._root=null}posAtCoords(t){return hz(this,t)}coordsAtPos(t,n=1){return mT(this,t,n)}domAtPos(t,n=0){return this.docView.domFromPos(t,n)}nodeDOM(t){let n=this.docView.descAt(t);return n?n.nodeDOM:null}posAtDOM(t,n,s=-1){let a=this.docView.posFromDOM(t,n,s);if(a==null)throw new RangeError("DOM position not inside the editor");return a}endOfTextblock(t,n){return gz(this,n||this.state,t)}pasteHTML(t,n){return Gd(this,"",t,!1,n||new ClipboardEvent("paste"))}pasteText(t,n){return Gd(this,t,null,!0,n||new ClipboardEvent("paste"))}destroy(){this.docView&&(Hz(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],h_(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,WA())}get isDestroyed(){return this.docView==null}dispatchEvent(t){return Wz(this,t)}dispatch(t){let n=this._props.dispatchTransaction;n?n.call(this,t):this.updateState(this.state.apply(t))}domSelectionRange(){let t=this.domSelection();return t?Gi&&this.root.nodeType===11&&YA(this.dom.ownerDocument)==this.dom&&mD(this,t)||t:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}function jb(e){let t=Object.create(null);return t.class="ProseMirror",t.contenteditable=String(e.editable),e.someProp("attributes",n=>{if(typeof n=="function"&&(n=n(e.state)),n)for(let s in n)s=="class"?t.class+=" "+n[s]:s=="style"?t.style=(t.style?t.style+";":"")+n[s]:!t[s]&&s!="contenteditable"&&s!="nodeName"&&(t[s]=String(n[s]))}),t.translate||(t.translate="no"),[Fr.node(0,e.state.doc.content.size,t)]}function Ub(e){if(e.markCursor){let t=document.createElement("img");t.className="ProseMirror-separator",t.setAttribute("mark-placeholder","true"),t.setAttribute("alt",""),e.cursorWrapper={dom:t,deco:Fr.widget(e.state.selection.from,t,{raw:!0,marks:e.markCursor})}}else e.cursorWrapper=null}function qb(e){return!e.someProp("editable",t=>t(e.state)===!1)}function TD(e,t){let n=Math.min(e.$anchor.sharedDepth(e.head),t.$anchor.sharedDepth(t.head));return e.$anchor.start(n)!=t.$anchor.start(n)}function Hb(e){let t=Object.create(null);function n(s){for(let a in s)Object.prototype.hasOwnProperty.call(t,a)||(t[a]=s[a])}return e.someProp("nodeViews",n),e.someProp("markViews",n),t}function CD(e,t){let n=0,s=0;for(let a in e){if(e[a]!=t[a])return!0;n++}for(let a in t)s++;return n!=s}function Zb(e){if(e.spec.state||e.spec.filterTransaction||e.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var Ua={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Dm={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},MD=typeof navigator<"u"&&/Mac/.test(navigator.platform),ED=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var fi=0;fi<10;fi++)Ua[48+fi]=Ua[96+fi]=String(fi);for(var fi=1;fi<=24;fi++)Ua[fi+111]="F"+fi;for(var fi=65;fi<=90;fi++)Ua[fi]=String.fromCharCode(fi+32),Dm[fi]=String.fromCharCode(fi);for(var p_ in Ua)Dm.hasOwnProperty(p_)||(Dm[p_]=Ua[p_]);function ID(e){var t=MD&&e.metaKey&&e.shiftKey&&!e.ctrlKey&&!e.altKey||ED&&e.shiftKey&&e.key&&e.key.length==1||e.key=="Unidentified",n=!t&&e.key||(e.shiftKey?Dm:Ua)[e.keyCode]||e.key||"Unidentified";return n=="Esc"&&(n="Escape"),n=="Del"&&(n="Delete"),n=="Left"&&(n="ArrowLeft"),n=="Up"&&(n="ArrowUp"),n=="Right"&&(n="ArrowRight"),n=="Down"&&(n="ArrowDown"),n}const PD=typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!1;function AD(e){let t=e.split(/-(?!$)/),n=t[t.length-1];n=="Space"&&(n=" ");let s,a,u,d;for(let c=0;c<t.length-1;c++){let w=t[c];if(/^(cmd|meta|m)$/i.test(w))d=!0;else if(/^a(lt)?$/i.test(w))s=!0;else if(/^(c|ctrl|control)$/i.test(w))a=!0;else if(/^s(hift)?$/i.test(w))u=!0;else if(/^mod$/i.test(w))PD?d=!0:a=!0;else throw new Error("Unrecognized modifier name: "+w)}return s&&(n="Alt-"+n),a&&(n="Ctrl-"+n),d&&(n="Meta-"+n),u&&(n="Shift-"+n),n}function zD(e){let t=Object.create(null);for(let n in e)t[AD(n)]=e[n];return t}function f_(e,t,n=!0){return t.altKey&&(e="Alt-"+e),t.ctrlKey&&(e="Ctrl-"+e),t.metaKey&&(e="Meta-"+e),n&&t.shiftKey&&(e="Shift-"+e),e}function DD(e){return new er({props:{handleKeyDown:UT(e)}})}function UT(e){let t=zD(e);return function(n,s){let a=ID(s),u,d=t[f_(a,s)];if(d&&d(n.state,n.dispatch,n))return!0;if(a.length==1&&a!=" "){if(s.shiftKey){let c=t[f_(a,s,!1)];if(c&&c(n.state,n.dispatch,n))return!0}if((s.shiftKey||s.altKey||s.metaKey||a.charCodeAt(0)>127)&&(u=Ua[s.keyCode])&&u!=a){let c=t[f_(u,s)];if(c&&c(n.state,n.dispatch,n))return!0}}return!1}}const RD=(e,t)=>e.selection.empty?!1:(t&&t(e.tr.deleteSelection().scrollIntoView()),!0);function qT(e,t){let{$cursor:n}=e.selection;return!n||(t?!t.endOfTextblock("backward",e):n.parentOffset>0)?null:n}const OD=(e,t,n)=>{let s=qT(e,n);if(!s)return!1;let a=jv(s);if(!a){let d=s.blockRange(),c=d&&Uu(d);return c==null?!1:(t&&t(e.tr.lift(d,c).scrollIntoView()),!0)}let u=a.nodeBefore;if(GT(e,a,t,-1))return!0;if(s.parent.content.size==0&&(Bu(u,"end")||mt.isSelectable(u)))for(let d=s.depth;;d--){let c=ng(e.doc,s.before(d),s.after(d),Qe.empty);if(c&&c.slice.size<c.to-c.from){if(t){let w=e.tr.step(c);w.setSelection(Bu(u,"end")?Et.findFrom(w.doc.resolve(w.mapping.map(a.pos,-1)),-1):mt.create(w.doc,a.pos-u.nodeSize)),t(w.scrollIntoView())}return!0}if(d==1||s.node(d-1).childCount>1)break}return u.isAtom&&a.depth==s.depth-1?(t&&t(e.tr.delete(a.pos-u.nodeSize,a.pos).scrollIntoView()),!0):!1},LD=(e,t,n)=>{let s=qT(e,n);if(!s)return!1;let a=jv(s);return a?HT(e,a,t):!1},BD=(e,t,n)=>{let s=ZT(e,n);if(!s)return!1;let a=Uv(s);return a?HT(e,a,t):!1};function HT(e,t,n){let s=t.nodeBefore,a=s,u=t.pos-1;for(;!a.isTextblock;u--){if(a.type.spec.isolating)return!1;let E=a.lastChild;if(!E)return!1;a=E}let d=t.nodeAfter,c=d,w=t.pos+1;for(;!c.isTextblock;w++){if(c.type.spec.isolating)return!1;let E=c.firstChild;if(!E)return!1;c=E}let k=ng(e.doc,u,w,Qe.empty);if(!k||k.from!=u||k instanceof ei&&k.slice.size>=w-u)return!1;if(n){let E=e.tr.step(k);E.setSelection(kt.create(E.doc,u)),n(E.scrollIntoView())}return!0}function Bu(e,t,n=!1){for(let s=e;s;s=t=="start"?s.firstChild:s.lastChild){if(s.isTextblock)return!0;if(n&&s.childCount!=1)return!1}return!1}const FD=(e,t,n)=>{let{$head:s,empty:a}=e.selection,u=s;if(!a)return!1;if(s.parent.isTextblock){if(n?!n.endOfTextblock("backward",e):s.parentOffset>0)return!1;u=jv(s)}let d=u&&u.nodeBefore;return!d||!mt.isSelectable(d)?!1:(t&&t(e.tr.setSelection(mt.create(e.doc,u.pos-d.nodeSize)).scrollIntoView()),!0)};function jv(e){if(!e.parent.type.spec.isolating)for(let t=e.depth-1;t>=0;t--){if(e.index(t)>0)return e.doc.resolve(e.before(t+1));if(e.node(t).type.spec.isolating)break}return null}function ZT(e,t){let{$cursor:n}=e.selection;return!n||(t?!t.endOfTextblock("forward",e):n.parentOffset<n.parent.content.size)?null:n}const ND=(e,t,n)=>{let s=ZT(e,n);if(!s)return!1;let a=Uv(s);if(!a)return!1;let u=a.nodeAfter;if(GT(e,a,t,1))return!0;if(s.parent.content.size==0&&(Bu(u,"start")||mt.isSelectable(u))){let d=ng(e.doc,s.before(),s.after(),Qe.empty);if(d&&d.slice.size<d.to-d.from){if(t){let c=e.tr.step(d);c.setSelection(Bu(u,"start")?Et.findFrom(c.doc.resolve(c.mapping.map(a.pos)),1):mt.create(c.doc,c.mapping.map(a.pos))),t(c.scrollIntoView())}return!0}}return u.isAtom&&a.depth==s.depth-1?(t&&t(e.tr.delete(a.pos,a.pos+u.nodeSize).scrollIntoView()),!0):!1},VD=(e,t,n)=>{let{$head:s,empty:a}=e.selection,u=s;if(!a)return!1;if(s.parent.isTextblock){if(n?!n.endOfTextblock("forward",e):s.parentOffset<s.parent.content.size)return!1;u=Uv(s)}let d=u&&u.nodeAfter;return!d||!mt.isSelectable(d)?!1:(t&&t(e.tr.setSelection(mt.create(e.doc,u.pos)).scrollIntoView()),!0)};function Uv(e){if(!e.parent.type.spec.isolating)for(let t=e.depth-1;t>=0;t--){let n=e.node(t);if(e.index(t)+1<n.childCount)return e.doc.resolve(e.after(t+1));if(n.type.spec.isolating)break}return null}const $D=(e,t)=>{let n=e.selection,s=n instanceof mt,a;if(s){if(n.node.isTextblock||!Ga(e.doc,n.from))return!1;a=n.from}else if(a=tg(e.doc,n.from,-1),a==null)return!1;if(t){let u=e.tr.join(a);s&&u.setSelection(mt.create(u.doc,a-e.doc.resolve(a).nodeBefore.nodeSize)),t(u.scrollIntoView())}return!0},jD=(e,t)=>{let n=e.selection,s;if(n instanceof mt){if(n.node.isTextblock||!Ga(e.doc,n.to))return!1;s=n.to}else if(s=tg(e.doc,n.to,1),s==null)return!1;return t&&t(e.tr.join(s).scrollIntoView()),!0},UD=(e,t)=>{let{$from:n,$to:s}=e.selection,a=n.blockRange(s),u=a&&Uu(a);return u==null?!1:(t&&t(e.tr.lift(a,u).scrollIntoView()),!0)},qD=(e,t)=>{let{$head:n,$anchor:s}=e.selection;return!n.parent.type.spec.code||!n.sameParent(s)?!1:(t&&t(e.tr.insertText(`
`).scrollIntoView()),!0)};function WT(e){for(let t=0;t<e.edgeCount;t++){let{type:n}=e.edge(t);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}const HD=(e,t)=>{let{$head:n,$anchor:s}=e.selection;if(!n.parent.type.spec.code||!n.sameParent(s))return!1;let a=n.node(-1),u=n.indexAfter(-1),d=WT(a.contentMatchAt(u));if(!d||!a.canReplaceWith(u,u,d))return!1;if(t){let c=n.after(),w=e.tr.replaceWith(c,c,d.createAndFill());w.setSelection(Et.near(w.doc.resolve(c),1)),t(w.scrollIntoView())}return!0},ZD=(e,t)=>{let n=e.selection,{$from:s,$to:a}=n;if(n instanceof Cs||s.parent.inlineContent||a.parent.inlineContent)return!1;let u=WT(a.parent.contentMatchAt(a.indexAfter()));if(!u||!u.isTextblock)return!1;if(t){let d=(!s.parentOffset&&a.index()<a.parent.childCount?s:a).pos,c=e.tr.insert(d,u.createAndFill());c.setSelection(kt.create(c.doc,d+1)),t(c.scrollIntoView())}return!0},WD=(e,t)=>{let{$cursor:n}=e.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let u=n.before();if(ku(e.doc,u))return t&&t(e.tr.split(u).scrollIntoView()),!0}let s=n.blockRange(),a=s&&Uu(s);return a==null?!1:(t&&t(e.tr.lift(s,a).scrollIntoView()),!0)},GD=(e,t)=>{let{$from:n,to:s}=e.selection,a,u=n.sharedDepth(s);return u==0?!1:(a=n.before(u),t&&t(e.tr.setSelection(mt.create(e.doc,a))),!0)};function KD(e,t,n){let s=t.nodeBefore,a=t.nodeAfter,u=t.index();return!s||!a||!s.type.compatibleContent(a.type)?!1:!s.content.size&&t.parent.canReplace(u-1,u)?(n&&n(e.tr.delete(t.pos-s.nodeSize,t.pos).scrollIntoView()),!0):!t.parent.canReplace(u,u+1)||!(a.isTextblock||Ga(e.doc,t.pos))?!1:(n&&n(e.tr.join(t.pos).scrollIntoView()),!0)}function GT(e,t,n,s){let a=t.nodeBefore,u=t.nodeAfter,d,c,w=a.type.spec.isolating||u.type.spec.isolating;if(!w&&KD(e,t,n))return!0;let k=!w&&t.parent.canReplace(t.index(),t.index()+1);if(k&&(d=(c=a.contentMatchAt(a.childCount)).findWrapping(u.type))&&c.matchType(d[0]||u.type).validEnd){if(n){let $=t.pos+u.nodeSize,j=Ae.empty;for(let K=d.length-1;K>=0;K--)j=Ae.from(d[K].create(null,j));j=Ae.from(a.copy(j));let X=e.tr.step(new ni(t.pos-1,$,t.pos,$,new Qe(j,1,0),d.length,!0)),he=X.doc.resolve($+2*d.length);he.nodeAfter&&he.nodeAfter.type==a.type&&Ga(X.doc,he.pos)&&X.join(he.pos),n(X.scrollIntoView())}return!0}let E=u.type.spec.isolating||s>0&&w?null:Et.findFrom(t,1),P=E&&E.$from.blockRange(E.$to),A=P&&Uu(P);if(A!=null&&A>=t.depth)return n&&n(e.tr.lift(P,A).scrollIntoView()),!0;if(k&&Bu(u,"start",!0)&&Bu(a,"end")){let $=a,j=[];for(;j.push($),!$.isTextblock;)$=$.lastChild;let X=u,he=1;for(;!X.isTextblock;X=X.firstChild)he++;if($.canReplace($.childCount,$.childCount,X.content)){if(n){let K=Ae.empty;for(let le=j.length-1;le>=0;le--)K=Ae.from(j[le].copy(K));let J=e.tr.step(new ni(t.pos-j.length,t.pos+u.nodeSize,t.pos+he,t.pos+u.nodeSize-he,new Qe(K,j.length,0),0,!0));n(J.scrollIntoView())}return!0}}return!1}function KT(e){return function(t,n){let s=t.selection,a=e<0?s.$from:s.$to,u=a.depth;for(;a.node(u).isInline;){if(!u)return!1;u--}return a.node(u).isTextblock?(n&&n(t.tr.setSelection(kt.create(t.doc,e<0?a.start(u):a.end(u)))),!0):!1}}const XD=KT(-1),JD=KT(1);function YD(e,t=null){return function(n,s){let{$from:a,$to:u}=n.selection,d=a.blockRange(u),c=d&&zv(d,e,t);return c?(s&&s(n.tr.wrap(d,c).scrollIntoView()),!0):!1}}function Wb(e,t=null){return function(n,s){let a=!1;for(let u=0;u<n.selection.ranges.length&&!a;u++){let{$from:{pos:d},$to:{pos:c}}=n.selection.ranges[u];n.doc.nodesBetween(d,c,(w,k)=>{if(a)return!1;if(!(!w.isTextblock||w.hasMarkup(e,t)))if(w.type==e)a=!0;else{let E=n.doc.resolve(k),P=E.index();a=E.parent.canReplaceWith(P,P+1,e)}})}if(!a)return!1;if(s){let u=n.tr;for(let d=0;d<n.selection.ranges.length;d++){let{$from:{pos:c},$to:{pos:w}}=n.selection.ranges[d];u.setBlockType(c,w,e,t)}s(u.scrollIntoView())}return!0}}typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function QD(e,t=null){return function(n,s){let{$from:a,$to:u}=n.selection,d=a.blockRange(u),c=!1,w=d;if(!d)return!1;if(d.depth>=2&&a.node(d.depth-1).type.compatibleContent(e)&&d.startIndex==0){if(a.index(d.depth-1)==0)return!1;let E=n.doc.resolve(d.start-2);w=new km(E,E,d.depth),d.endIndex<d.parent.childCount&&(d=new km(a,n.doc.resolve(u.end(d.depth)),d.depth)),c=!0}let k=zv(w,e,t,d);return k?(s&&s(eR(n.tr,d,k,c,e).scrollIntoView()),!0):!1}}function eR(e,t,n,s,a){let u=Ae.empty;for(let E=n.length-1;E>=0;E--)u=Ae.from(n[E].type.create(n[E].attrs,u));e.step(new ni(t.start-(s?2:0),t.end,t.start,t.end,new Qe(u,0,0),n.length,!0));let d=0;for(let E=0;E<n.length;E++)n[E].type==a&&(d=E+1);let c=n.length-d,w=t.start+n.length-(s?2:0),k=t.parent;for(let E=t.startIndex,P=t.endIndex,A=!0;E<P;E++,A=!1)!A&&ku(e.doc,w,c)&&(e.split(w,c),w+=2*c),w+=k.child(E).nodeSize;return e}function tR(e){return function(t,n){let{$from:s,$to:a}=t.selection,u=s.blockRange(a,d=>d.childCount>0&&d.firstChild.type==e);return u?n?s.node(u.depth-1).type==e?nR(t,n,e,u):iR(t,n,u):!0:!1}}function nR(e,t,n,s){let a=e.tr,u=s.end,d=s.$to.end(s.depth);u<d&&(a.step(new ni(u-1,d,u,d,new Qe(Ae.from(n.create(null,s.parent.copy())),1,0),1,!0)),s=new km(a.doc.resolve(s.$from.pos),a.doc.resolve(d),s.depth));const c=Uu(s);if(c==null)return!1;a.lift(s,c);let w=a.mapping.map(u,-1)-1;return Ga(a.doc,w)&&a.join(w),t(a.scrollIntoView()),!0}function iR(e,t,n){let s=e.tr,a=n.parent;for(let $=n.end,j=n.endIndex-1,X=n.startIndex;j>X;j--)$-=a.child(j).nodeSize,s.delete($-1,$+1);let u=s.doc.resolve(n.start),d=u.nodeAfter;if(s.mapping.map(n.end)!=n.start+u.nodeAfter.nodeSize)return!1;let c=n.startIndex==0,w=n.endIndex==a.childCount,k=u.node(-1),E=u.index(-1);if(!k.canReplace(E+(c?0:1),E+1,d.content.append(w?Ae.empty:Ae.from(a))))return!1;let P=u.pos,A=P+d.nodeSize;return s.step(new ni(P-(c?1:0),A+(w?1:0),P+1,A-1,new Qe((c?Ae.empty:Ae.from(a.copy(Ae.empty))).append(w?Ae.empty:Ae.from(a.copy(Ae.empty))),c?0:1,w?0:1),c?0:1)),t(s.scrollIntoView()),!0}function rR(e){return function(t,n){let{$from:s,$to:a}=t.selection,u=s.blockRange(a,k=>k.childCount>0&&k.firstChild.type==e);if(!u)return!1;let d=u.startIndex;if(d==0)return!1;let c=u.parent,w=c.child(d-1);if(w.type!=e)return!1;if(n){let k=w.lastChild&&w.lastChild.type==c.type,E=Ae.from(k?e.create():null),P=new Qe(Ae.from(e.create(null,Ae.from(c.type.create(null,E)))),k?3:1,0),A=u.start,$=u.end;n(t.tr.step(new ni(A-(k?3:1),$,A,$,P,1,!0)).scrollIntoView())}return!0}}function ag(e){const{state:t,transaction:n}=e;let{selection:s}=n,{doc:a}=n,{storedMarks:u}=n;return{...t,apply:t.apply.bind(t),applyTransaction:t.applyTransaction.bind(t),plugins:t.plugins,schema:t.schema,reconfigure:t.reconfigure.bind(t),toJSON:t.toJSON.bind(t),get storedMarks(){return u},get selection(){return s},get doc(){return a},get tr(){return s=n.selection,a=n.doc,u=n.storedMarks,n}}}class lg{constructor(t){this.editor=t.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=t.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:t,editor:n,state:s}=this,{view:a}=n,{tr:u}=s,d=this.buildProps(u);return Object.fromEntries(Object.entries(t).map(([c,w])=>[c,(...E)=>{const P=w(...E)(d);return!u.getMeta("preventDispatch")&&!this.hasCustomState&&a.dispatch(u),P}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(t,n=!0){const{rawCommands:s,editor:a,state:u}=this,{view:d}=a,c=[],w=!!t,k=t||u.tr,E=()=>(!w&&n&&!k.getMeta("preventDispatch")&&!this.hasCustomState&&d.dispatch(k),c.every(A=>A===!0)),P={...Object.fromEntries(Object.entries(s).map(([A,$])=>[A,(...X)=>{const he=this.buildProps(k,n),K=$(...X)(he);return c.push(K),P}])),run:E};return P}createCan(t){const{rawCommands:n,state:s}=this,a=!1,u=t||s.tr,d=this.buildProps(u,a);return{...Object.fromEntries(Object.entries(n).map(([w,k])=>[w,(...E)=>k(...E)({...d,dispatch:void 0})])),chain:()=>this.createChain(u,a)}}buildProps(t,n=!0){const{rawCommands:s,editor:a,state:u}=this,{view:d}=a,c={tr:t,editor:a,view:d,state:ag({state:u,transaction:t}),dispatch:n?()=>{}:void 0,chain:()=>this.createChain(t,n),can:()=>this.createCan(t),get commands(){return Object.fromEntries(Object.entries(s).map(([w,k])=>[w,(...E)=>k(...E)(c)]))}};return c}}class sR{constructor(){this.callbacks={}}on(t,n){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(n),this}emit(t,...n){const s=this.callbacks[t];return s&&s.forEach(a=>a.apply(this,n)),this}off(t,n){const s=this.callbacks[t];return s&&(n?this.callbacks[t]=s.filter(a=>a!==n):delete this.callbacks[t]),this}once(t,n){const s=(...a)=>{this.off(t,s),n.apply(this,a)};return this.on(t,s)}removeAllListeners(){this.callbacks={}}}function ot(e,t,n){return e.config[t]===void 0&&e.parent?ot(e.parent,t,n):typeof e.config[t]=="function"?e.config[t].bind({...n,parent:e.parent?ot(e.parent,t,n):null}):e.config[t]}function cg(e){const t=e.filter(a=>a.type==="extension"),n=e.filter(a=>a.type==="node"),s=e.filter(a=>a.type==="mark");return{baseExtensions:t,nodeExtensions:n,markExtensions:s}}function XT(e){const t=[],{nodeExtensions:n,markExtensions:s}=cg(e),a=[...n,...s],u={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return e.forEach(d=>{const c={name:d.name,options:d.options,storage:d.storage,extensions:a},w=ot(d,"addGlobalAttributes",c);if(!w)return;w().forEach(E=>{E.types.forEach(P=>{Object.entries(E.attributes).forEach(([A,$])=>{t.push({type:P,name:A,attribute:{...u,...$}})})})})}),a.forEach(d=>{const c={name:d.name,options:d.options,storage:d.storage},w=ot(d,"addAttributes",c);if(!w)return;const k=w();Object.entries(k).forEach(([E,P])=>{const A={...u,...P};typeof(A==null?void 0:A.default)=="function"&&(A.default=A.default()),A!=null&&A.isRequired&&(A==null?void 0:A.default)===void 0&&delete A.default,t.push({type:d.name,name:E,attribute:A})})}),t}function ri(e,t){if(typeof e=="string"){if(!t.nodes[e])throw Error(`There is no node type named '${e}'. Maybe you forgot to add the extension?`);return t.nodes[e]}return e}function Ji(...e){return e.filter(t=>!!t).reduce((t,n)=>{const s={...t};return Object.entries(n).forEach(([a,u])=>{if(!s[a]){s[a]=u;return}if(a==="class"){const c=u?u.split(" "):[],w=s[a]?s[a].split(" "):[],k=c.filter(E=>!w.includes(E));s[a]=[...w,...k].join(" ")}else if(a==="style"){const c=u?u.split(";").map(E=>E.trim()).filter(Boolean):[],w=s[a]?s[a].split(";").map(E=>E.trim()).filter(Boolean):[],k=new Map;w.forEach(E=>{const[P,A]=E.split(":").map($=>$.trim());k.set(P,A)}),c.forEach(E=>{const[P,A]=E.split(":").map($=>$.trim());k.set(P,A)}),s[a]=Array.from(k.entries()).map(([E,P])=>`${E}: ${P}`).join("; ")}else s[a]=u}),s},{})}function A0(e,t){return t.filter(n=>n.type===e.type.name).filter(n=>n.attribute.rendered).map(n=>n.attribute.renderHTML?n.attribute.renderHTML(e.attrs)||{}:{[n.name]:e.attrs[n.name]}).reduce((n,s)=>Ji(n,s),{})}function JT(e){return typeof e=="function"}function At(e,t=void 0,...n){return JT(e)?t?e.bind(t)(...n):e(...n):e}function oR(e={}){return Object.keys(e).length===0&&e.constructor===Object}function aR(e){return typeof e!="string"?e:e.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(e):e==="true"?!0:e==="false"?!1:e}function Gb(e,t){return"style"in e?e:{...e,getAttrs:n=>{const s=e.getAttrs?e.getAttrs(n):e.attrs;if(s===!1)return!1;const a=t.reduce((u,d)=>{const c=d.attribute.parseHTML?d.attribute.parseHTML(n):aR(n.getAttribute(d.name));return c==null?u:{...u,[d.name]:c}},{});return{...s,...a}}}}function Kb(e){return Object.fromEntries(Object.entries(e).filter(([t,n])=>t==="attrs"&&oR(n)?!1:n!=null))}function lR(e,t){var n;const s=XT(e),{nodeExtensions:a,markExtensions:u}=cg(e),d=(n=a.find(k=>ot(k,"topNode")))===null||n===void 0?void 0:n.name,c=Object.fromEntries(a.map(k=>{const E=s.filter(K=>K.type===k.name),P={name:k.name,options:k.options,storage:k.storage,editor:t},A=e.reduce((K,J)=>{const le=ot(J,"extendNodeSchema",P);return{...K,...le?le(k):{}}},{}),$=Kb({...A,content:At(ot(k,"content",P)),marks:At(ot(k,"marks",P)),group:At(ot(k,"group",P)),inline:At(ot(k,"inline",P)),atom:At(ot(k,"atom",P)),selectable:At(ot(k,"selectable",P)),draggable:At(ot(k,"draggable",P)),code:At(ot(k,"code",P)),whitespace:At(ot(k,"whitespace",P)),linebreakReplacement:At(ot(k,"linebreakReplacement",P)),defining:At(ot(k,"defining",P)),isolating:At(ot(k,"isolating",P)),attrs:Object.fromEntries(E.map(K=>{var J;return[K.name,{default:(J=K==null?void 0:K.attribute)===null||J===void 0?void 0:J.default}]}))}),j=At(ot(k,"parseHTML",P));j&&($.parseDOM=j.map(K=>Gb(K,E)));const X=ot(k,"renderHTML",P);X&&($.toDOM=K=>X({node:K,HTMLAttributes:A0(K,E)}));const he=ot(k,"renderText",P);return he&&($.toText=he),[k.name,$]})),w=Object.fromEntries(u.map(k=>{const E=s.filter(he=>he.type===k.name),P={name:k.name,options:k.options,storage:k.storage,editor:t},A=e.reduce((he,K)=>{const J=ot(K,"extendMarkSchema",P);return{...he,...J?J(k):{}}},{}),$=Kb({...A,inclusive:At(ot(k,"inclusive",P)),excludes:At(ot(k,"excludes",P)),group:At(ot(k,"group",P)),spanning:At(ot(k,"spanning",P)),code:At(ot(k,"code",P)),attrs:Object.fromEntries(E.map(he=>{var K;return[he.name,{default:(K=he==null?void 0:he.attribute)===null||K===void 0?void 0:K.default}]}))}),j=At(ot(k,"parseHTML",P));j&&($.parseDOM=j.map(he=>Gb(he,E)));const X=ot(k,"renderHTML",P);return X&&($.toDOM=he=>X({mark:he,HTMLAttributes:A0(he,E)})),[k.name,$]}));return new H2({topNode:d,nodes:c,marks:w})}function m_(e,t){return t.nodes[e]||t.marks[e]||null}function Xb(e,t){return Array.isArray(t)?t.some(n=>(typeof n=="string"?n:n.name)===e.name):t}function qv(e,t){const n=nc.fromSchema(t).serializeFragment(e),a=document.implementation.createHTMLDocument().createElement("div");return a.appendChild(n),a.innerHTML}const cR=(e,t=500)=>{let n="";const s=e.parentOffset;return e.parent.nodesBetween(Math.max(0,s-t),s,(a,u,d,c)=>{var w,k;const E=((k=(w=a.type.spec).toText)===null||k===void 0?void 0:k.call(w,{node:a,pos:u,parent:d,index:c}))||a.textContent||"%leaf%";n+=a.isAtom&&!a.isText?E:E.slice(0,Math.max(0,s-u))}),n};function Hv(e){return Object.prototype.toString.call(e)==="[object RegExp]"}class ug{constructor(t){this.find=t.find,this.handler=t.handler}}const uR=(e,t)=>{if(Hv(t))return t.exec(e);const n=t(e);if(!n)return null;const s=[n.text];return s.index=n.index,s.input=e,s.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),s.push(n.replaceWith)),s};function If(e){var t;const{editor:n,from:s,to:a,text:u,rules:d,plugin:c}=e,{view:w}=n;if(w.composing)return!1;const k=w.state.doc.resolve(s);if(k.parent.type.spec.code||!((t=k.nodeBefore||k.nodeAfter)===null||t===void 0)&&t.marks.find(A=>A.type.spec.code))return!1;let E=!1;const P=cR(k)+u;return d.forEach(A=>{if(E)return;const $=uR(P,A.find);if(!$)return;const j=w.state.tr,X=ag({state:w.state,transaction:j}),he={from:s-($[0].length-u.length),to:a},{commands:K,chain:J,can:le}=new lg({editor:n,state:X});A.handler({state:X,range:he,match:$,commands:K,chain:J,can:le})===null||!j.steps.length||(j.setMeta(c,{transform:j,from:s,to:a,text:u}),w.dispatch(j),E=!0)}),E}function hR(e){const{editor:t,rules:n}=e,s=new er({state:{init(){return null},apply(a,u,d){const c=a.getMeta(s);if(c)return c;const w=a.getMeta("applyInputRules");return!!w&&setTimeout(()=>{let{text:E}=w;typeof E=="string"?E=E:E=qv(Ae.from(E),d.schema);const{from:P}=w,A=P+E.length;If({editor:t,from:P,to:A,text:E,rules:n,plugin:s})}),a.selectionSet||a.docChanged?null:u}},props:{handleTextInput(a,u,d,c){return If({editor:t,from:u,to:d,text:c,rules:n,plugin:s})},handleDOMEvents:{compositionend:a=>(setTimeout(()=>{const{$cursor:u}=a.state.selection;u&&If({editor:t,from:u.pos,to:u.pos,text:"",rules:n,plugin:s})}),!1)},handleKeyDown(a,u){if(u.key!=="Enter")return!1;const{$cursor:d}=a.state.selection;return d?If({editor:t,from:d.pos,to:d.pos,text:`
`,rules:n,plugin:s}):!1}},isInputRules:!0});return s}function dR(e){return Object.prototype.toString.call(e).slice(8,-1)}function Pf(e){return dR(e)!=="Object"?!1:e.constructor===Object&&Object.getPrototypeOf(e)===Object.prototype}function hg(e,t){const n={...e};return Pf(e)&&Pf(t)&&Object.keys(t).forEach(s=>{Pf(t[s])&&Pf(e[s])?n[s]=hg(e[s],t[s]):n[s]=t[s]}),n}class qa{constructor(t={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...t},this.name=this.config.name,t.defaultOptions&&Object.keys(t.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=At(ot(this,"addOptions",{name:this.name}))),this.storage=At(ot(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(t={}){return new qa(t)}configure(t={}){const n=this.extend({...this.config,addOptions:()=>hg(this.options,t)});return n.name=this.name,n.parent=this.parent,n}extend(t={}){const n=new qa(t);return n.parent=this,this.child=n,n.name=t.name?t.name:n.parent.name,t.defaultOptions&&Object.keys(t.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=At(ot(n,"addOptions",{name:n.name})),n.storage=At(ot(n,"addStorage",{name:n.name,options:n.options})),n}static handleExit({editor:t,mark:n}){const{tr:s}=t.state,a=t.state.selection.$from;if(a.pos===a.end()){const d=a.marks();if(!!!d.find(k=>(k==null?void 0:k.type.name)===n.name))return!1;const w=d.find(k=>(k==null?void 0:k.type.name)===n.name);return w&&s.removeStoredMark(w),s.insertText(" ",a.pos),t.view.dispatch(s),!0}return!1}}function pR(e){return typeof e=="number"}class fR{constructor(t){this.find=t.find,this.handler=t.handler}}const mR=(e,t,n)=>{if(Hv(t))return[...e.matchAll(t)];const s=t(e,n);return s?s.map(a=>{const u=[a.text];return u.index=a.index,u.input=e,u.data=a.data,a.replaceWith&&(a.text.includes(a.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),u.push(a.replaceWith)),u}):[]};function gR(e){const{editor:t,state:n,from:s,to:a,rule:u,pasteEvent:d,dropEvent:c}=e,{commands:w,chain:k,can:E}=new lg({editor:t,state:n}),P=[];return n.doc.nodesBetween(s,a,($,j)=>{if(!$.isTextblock||$.type.spec.code)return;const X=Math.max(s,j),he=Math.min(a,j+$.content.size),K=$.textBetween(X-j,he-j,void 0,"");mR(K,u.find,d).forEach(le=>{if(le.index===void 0)return;const Se=X+le.index+1,Me=Se+le[0].length,Ee={from:n.tr.mapping.map(Se),to:n.tr.mapping.map(Me)},De=u.handler({state:n,range:Ee,match:le,commands:w,chain:k,can:E,pasteEvent:d,dropEvent:c});P.push(De)})}),P.every($=>$!==null)}const yR=e=>{var t;const n=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(t=n.clipboardData)===null||t===void 0||t.setData("text/html",e),n};function _R(e){const{editor:t,rules:n}=e;let s=null,a=!1,u=!1,d=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,c;try{c=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{c=null}const w=({state:E,from:P,to:A,rule:$,pasteEvt:j})=>{const X=E.tr,he=ag({state:E,transaction:X});if(!(!gR({editor:t,state:he,from:Math.max(P-1,0),to:A.b-1,rule:$,pasteEvent:j,dropEvent:c})||!X.steps.length)){try{c=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{c=null}return d=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,X}};return n.map(E=>new er({view(P){const A=$=>{var j;s=!((j=P.dom.parentElement)===null||j===void 0)&&j.contains($.target)?P.dom.parentElement:null};return window.addEventListener("dragstart",A),{destroy(){window.removeEventListener("dragstart",A)}}},props:{handleDOMEvents:{drop:(P,A)=>(u=s===P.dom.parentElement,c=A,!1),paste:(P,A)=>{var $;const j=($=A.clipboardData)===null||$===void 0?void 0:$.getData("text/html");return d=A,a=!!(j!=null&&j.includes("data-pm-slice")),!1}}},appendTransaction:(P,A,$)=>{const j=P[0],X=j.getMeta("uiEvent")==="paste"&&!a,he=j.getMeta("uiEvent")==="drop"&&!u,K=j.getMeta("applyPasteRules"),J=!!K;if(!X&&!he&&!J)return;if(J){let{text:Me}=K;typeof Me=="string"?Me=Me:Me=qv(Ae.from(Me),$.schema);const{from:Ee}=K,De=Ee+Me.length,Ze=yR(Me);return w({rule:E,state:$,from:Ee,to:{b:De},pasteEvt:Ze})}const le=A.doc.content.findDiffStart($.doc.content),Se=A.doc.content.findDiffEnd($.doc.content);if(!(!pR(le)||!Se||le===Se.b))return w({rule:E,state:$,from:le,to:Se,pasteEvt:d})}}))}function vR(e){const t=e.filter((n,s)=>e.indexOf(n)!==s);return Array.from(new Set(t))}class gu{constructor(t,n){this.splittableMarks=[],this.editor=n,this.extensions=gu.resolve(t),this.schema=lR(this.extensions,n),this.setupExtensions()}static resolve(t){const n=gu.sort(gu.flatten(t)),s=vR(n.map(a=>a.name));return s.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${s.map(a=>`'${a}'`).join(", ")}]. This can lead to issues.`),n}static flatten(t){return t.map(n=>{const s={name:n.name,options:n.options,storage:n.storage},a=ot(n,"addExtensions",s);return a?[n,...this.flatten(a())]:n}).flat(10)}static sort(t){return t.sort((s,a)=>{const u=ot(s,"priority")||100,d=ot(a,"priority")||100;return u>d?-1:u<d?1:0})}get commands(){return this.extensions.reduce((t,n)=>{const s={name:n.name,options:n.options,storage:n.storage,editor:this.editor,type:m_(n.name,this.schema)},a=ot(n,"addCommands",s);return a?{...t,...a()}:t},{})}get plugins(){const{editor:t}=this,n=gu.sort([...this.extensions].reverse()),s=[],a=[],u=n.map(d=>{const c={name:d.name,options:d.options,storage:d.storage,editor:t,type:m_(d.name,this.schema)},w=[],k=ot(d,"addKeyboardShortcuts",c);let E={};if(d.type==="mark"&&ot(d,"exitable",c)&&(E.ArrowRight=()=>qa.handleExit({editor:t,mark:d})),k){const X=Object.fromEntries(Object.entries(k()).map(([he,K])=>[he,()=>K({editor:t})]));E={...E,...X}}const P=DD(E);w.push(P);const A=ot(d,"addInputRules",c);Xb(d,t.options.enableInputRules)&&A&&s.push(...A());const $=ot(d,"addPasteRules",c);Xb(d,t.options.enablePasteRules)&&$&&a.push(...$());const j=ot(d,"addProseMirrorPlugins",c);if(j){const X=j();w.push(...X)}return w}).flat();return[hR({editor:t,rules:s}),..._R({editor:t,rules:a}),...u]}get attributes(){return XT(this.extensions)}get nodeViews(){const{editor:t}=this,{nodeExtensions:n}=cg(this.extensions);return Object.fromEntries(n.filter(s=>!!ot(s,"addNodeView")).map(s=>{const a=this.attributes.filter(w=>w.type===s.name),u={name:s.name,options:s.options,storage:s.storage,editor:t,type:ri(s.name,this.schema)},d=ot(s,"addNodeView",u);if(!d)return[];const c=(w,k,E,P,A)=>{const $=A0(w,a);return d()({node:w,view:k,getPos:E,decorations:P,innerDecorations:A,editor:t,extension:s,HTMLAttributes:$})};return[s.name,c]}))}setupExtensions(){this.extensions.forEach(t=>{var n;this.editor.extensionStorage[t.name]=t.storage;const s={name:t.name,options:t.options,storage:t.storage,editor:this.editor,type:m_(t.name,this.schema)};t.type==="mark"&&(!((n=At(ot(t,"keepOnSplit",s)))!==null&&n!==void 0)||n)&&this.splittableMarks.push(t.name);const a=ot(t,"onBeforeCreate",s),u=ot(t,"onCreate",s),d=ot(t,"onUpdate",s),c=ot(t,"onSelectionUpdate",s),w=ot(t,"onTransaction",s),k=ot(t,"onFocus",s),E=ot(t,"onBlur",s),P=ot(t,"onDestroy",s);a&&this.editor.on("beforeCreate",a),u&&this.editor.on("create",u),d&&this.editor.on("update",d),c&&this.editor.on("selectionUpdate",c),w&&this.editor.on("transaction",w),k&&this.editor.on("focus",k),E&&this.editor.on("blur",E),P&&this.editor.on("destroy",P)})}}class Oi{constructor(t={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...t},this.name=this.config.name,t.defaultOptions&&Object.keys(t.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=At(ot(this,"addOptions",{name:this.name}))),this.storage=At(ot(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(t={}){return new Oi(t)}configure(t={}){const n=this.extend({...this.config,addOptions:()=>hg(this.options,t)});return n.name=this.name,n.parent=this.parent,n}extend(t={}){const n=new Oi({...this.config,...t});return n.parent=this,this.child=n,n.name=t.name?t.name:n.parent.name,t.defaultOptions&&Object.keys(t.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=At(ot(n,"addOptions",{name:n.name})),n.storage=At(ot(n,"addStorage",{name:n.name,options:n.options})),n}}function YT(e,t,n){const{from:s,to:a}=t,{blockSeparator:u=`

`,textSerializers:d={}}=n||{};let c="";return e.nodesBetween(s,a,(w,k,E,P)=>{var A;w.isBlock&&k>s&&(c+=u);const $=d==null?void 0:d[w.type.name];if($)return E&&(c+=$({node:w,pos:k,parent:E,index:P,range:t})),!1;w.isText&&(c+=(A=w==null?void 0:w.text)===null||A===void 0?void 0:A.slice(Math.max(s,k)-k,a-k))}),c}function QT(e){return Object.fromEntries(Object.entries(e.nodes).filter(([,t])=>t.spec.toText).map(([t,n])=>[t,n.spec.toText]))}const xR=Oi.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new er({key:new Js("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:e}=this,{state:t,schema:n}=e,{doc:s,selection:a}=t,{ranges:u}=a,d=Math.min(...u.map(E=>E.$from.pos)),c=Math.max(...u.map(E=>E.$to.pos)),w=QT(n);return YT(s,{from:d,to:c},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:w})}}})]}}),wR=()=>({editor:e,view:t})=>(requestAnimationFrame(()=>{var n;e.isDestroyed||(t.dom.blur(),(n=window==null?void 0:window.getSelection())===null||n===void 0||n.removeAllRanges())}),!0),bR=(e=!1)=>({commands:t})=>t.setContent("",e),SR=()=>({state:e,tr:t,dispatch:n})=>{const{selection:s}=t,{ranges:a}=s;return n&&a.forEach(({$from:u,$to:d})=>{e.doc.nodesBetween(u.pos,d.pos,(c,w)=>{if(c.type.isText)return;const{doc:k,mapping:E}=t,P=k.resolve(E.map(w)),A=k.resolve(E.map(w+c.nodeSize)),$=P.blockRange(A);if(!$)return;const j=Uu($);if(c.type.isTextblock){const{defaultType:X}=P.parent.contentMatchAt(P.index());t.setNodeMarkup($.start,X)}(j||j===0)&&t.lift($,j)})}),!0},kR=e=>t=>e(t),TR=()=>({state:e,dispatch:t})=>ZD(e,t),CR=(e,t)=>({editor:n,tr:s})=>{const{state:a}=n,u=a.doc.slice(e.from,e.to);s.deleteRange(e.from,e.to);const d=s.mapping.map(t);return s.insert(d,u.content),s.setSelection(new kt(s.doc.resolve(d-1))),!0},MR=()=>({tr:e,dispatch:t})=>{const{selection:n}=e,s=n.$anchor.node();if(s.content.size>0)return!1;const a=e.selection.$anchor;for(let u=a.depth;u>0;u-=1)if(a.node(u).type===s.type){if(t){const c=a.before(u),w=a.after(u);e.delete(c,w).scrollIntoView()}return!0}return!1},ER=e=>({tr:t,state:n,dispatch:s})=>{const a=ri(e,n.schema),u=t.selection.$anchor;for(let d=u.depth;d>0;d-=1)if(u.node(d).type===a){if(s){const w=u.before(d),k=u.after(d);t.delete(w,k).scrollIntoView()}return!0}return!1},IR=e=>({tr:t,dispatch:n})=>{const{from:s,to:a}=e;return n&&t.delete(s,a),!0},PR=()=>({state:e,dispatch:t})=>RD(e,t),AR=()=>({commands:e})=>e.keyboardShortcut("Enter"),zR=()=>({state:e,dispatch:t})=>HD(e,t);function Rm(e,t,n={strict:!0}){const s=Object.keys(t);return s.length?s.every(a=>n.strict?t[a]===e[a]:Hv(t[a])?t[a].test(e[a]):t[a]===e[a]):!0}function eC(e,t,n={}){return e.find(s=>s.type===t&&Rm(Object.fromEntries(Object.keys(n).map(a=>[a,s.attrs[a]])),n))}function Jb(e,t,n={}){return!!eC(e,t,n)}function Zv(e,t,n){var s;if(!e||!t)return;let a=e.parent.childAfter(e.parentOffset);if((!a.node||!a.node.marks.some(E=>E.type===t))&&(a=e.parent.childBefore(e.parentOffset)),!a.node||!a.node.marks.some(E=>E.type===t)||(n=n||((s=a.node.marks[0])===null||s===void 0?void 0:s.attrs),!eC([...a.node.marks],t,n)))return;let d=a.index,c=e.start()+a.offset,w=d+1,k=c+a.node.nodeSize;for(;d>0&&Jb([...e.parent.child(d-1).marks],t,n);)d-=1,c-=e.parent.child(d).nodeSize;for(;w<e.parent.childCount&&Jb([...e.parent.child(w).marks],t,n);)k+=e.parent.child(w).nodeSize,w+=1;return{from:c,to:k}}function Xa(e,t){if(typeof e=="string"){if(!t.marks[e])throw Error(`There is no mark type named '${e}'. Maybe you forgot to add the extension?`);return t.marks[e]}return e}const DR=(e,t={})=>({tr:n,state:s,dispatch:a})=>{const u=Xa(e,s.schema),{doc:d,selection:c}=n,{$from:w,from:k,to:E}=c;if(a){const P=Zv(w,u,t);if(P&&P.from<=k&&P.to>=E){const A=kt.create(d,P.from,P.to);n.setSelection(A)}}return!0},RR=e=>t=>{const n=typeof e=="function"?e(t):e;for(let s=0;s<n.length;s+=1)if(n[s](t))return!0;return!1};function tC(e){return e instanceof kt}function Fl(e=0,t=0,n=0){return Math.min(Math.max(e,t),n)}function nC(e,t=null){if(!t)return null;const n=Et.atStart(e),s=Et.atEnd(e);if(t==="start"||t===!0)return n;if(t==="end")return s;const a=n.from,u=s.to;return t==="all"?kt.create(e,Fl(0,a,u),Fl(e.content.size,a,u)):kt.create(e,Fl(t,a,u),Fl(t,a,u))}function Wv(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}const OR=(e=null,t={})=>({editor:n,view:s,tr:a,dispatch:u})=>{t={scrollIntoView:!0,...t};const d=()=>{Wv()&&s.dom.focus(),requestAnimationFrame(()=>{n.isDestroyed||(s.focus(),t!=null&&t.scrollIntoView&&n.commands.scrollIntoView())})};if(s.hasFocus()&&e===null||e===!1)return!0;if(u&&e===null&&!tC(n.state.selection))return d(),!0;const c=nC(a.doc,e)||n.state.selection,w=n.state.selection.eq(c);return u&&(w||a.setSelection(c),w&&a.storedMarks&&a.setStoredMarks(a.storedMarks),d()),!0},LR=(e,t)=>n=>e.every((s,a)=>t(s,{...n,index:a})),BR=(e,t)=>({tr:n,commands:s})=>s.insertContentAt({from:n.selection.from,to:n.selection.to},e,t),iC=e=>{const t=e.childNodes;for(let n=t.length-1;n>=0;n-=1){const s=t[n];s.nodeType===3&&s.nodeValue&&/^(\n\s\s|\n)$/.test(s.nodeValue)?e.removeChild(s):s.nodeType===1&&iC(s)}return e};function Af(e){const t=`<body>${e}</body>`,n=new window.DOMParser().parseFromString(t,"text/html").body;return iC(n)}function Om(e,t,n){if(e instanceof La||e instanceof Ae)return e;n={slice:!0,parseOptions:{},...n};const s=typeof e=="object"&&e!==null,a=typeof e=="string";if(s)try{if(Array.isArray(e)&&e.length>0)return Ae.fromArray(e.map(c=>t.nodeFromJSON(c)));const d=t.nodeFromJSON(e);return n.errorOnInvalidContent&&d.check(),d}catch(u){if(n.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:u});return console.warn("[tiptap warn]: Invalid content.","Passed value:",e,"Error:",u),Om("",t,n)}if(a){if(n.errorOnInvalidContent){let d=!1,c="";const w=new H2({topNode:t.spec.topNode,marks:t.spec.marks,nodes:t.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:k=>(d=!0,c=typeof k=="string"?k:k.outerHTML,null)}]}})});if(n.slice?Ba.fromSchema(w).parseSlice(Af(e),n.parseOptions):Ba.fromSchema(w).parse(Af(e),n.parseOptions),n.errorOnInvalidContent&&d)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${c}`)})}const u=Ba.fromSchema(t);return n.slice?u.parseSlice(Af(e),n.parseOptions).content:u.parse(Af(e),n.parseOptions)}return Om("",t,n)}function FR(e,t,n){const s=e.steps.length-1;if(s<t)return;const a=e.steps[s];if(!(a instanceof ei||a instanceof ni))return;const u=e.mapping.maps[s];let d=0;u.forEach((c,w,k,E)=>{d===0&&(d=E)}),e.setSelection(Et.near(e.doc.resolve(d),n))}const NR=e=>!("type"in e),VR=(e,t,n)=>({tr:s,dispatch:a,editor:u})=>{var d;if(a){n={parseOptions:u.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...n};let c;try{c=Om(t,u.schema,{parseOptions:{preserveWhitespace:"full",...n.parseOptions},errorOnInvalidContent:(d=n.errorOnInvalidContent)!==null&&d!==void 0?d:u.options.enableContentCheck})}catch(j){return u.emit("contentError",{editor:u,error:j,disableCollaboration:()=>{u.storage.collaboration&&(u.storage.collaboration.isDisabled=!0)}}),!1}let{from:w,to:k}=typeof e=="number"?{from:e,to:e}:{from:e.from,to:e.to},E=!0,P=!0;if((NR(c)?c:[c]).forEach(j=>{j.check(),E=E?j.isText&&j.marks.length===0:!1,P=P?j.isBlock:!1}),w===k&&P){const{parent:j}=s.doc.resolve(w);j.isTextblock&&!j.type.spec.code&&!j.childCount&&(w-=1,k+=1)}let $;if(E){if(Array.isArray(t))$=t.map(j=>j.text||"").join("");else if(t instanceof Ae){let j="";t.forEach(X=>{X.text&&(j+=X.text)}),$=j}else typeof t=="object"&&t&&t.text?$=t.text:$=t;s.insertText($,w,k)}else $=c,s.replaceWith(w,k,$);n.updateSelection&&FR(s,s.steps.length-1,-1),n.applyInputRules&&s.setMeta("applyInputRules",{from:w,text:$}),n.applyPasteRules&&s.setMeta("applyPasteRules",{from:w,text:$})}return!0},$R=()=>({state:e,dispatch:t})=>$D(e,t),jR=()=>({state:e,dispatch:t})=>jD(e,t),UR=()=>({state:e,dispatch:t})=>OD(e,t),qR=()=>({state:e,dispatch:t})=>ND(e,t),HR=()=>({state:e,dispatch:t,tr:n})=>{try{const s=tg(e.doc,e.selection.$from.pos,-1);return s==null?!1:(n.join(s,2),t&&t(n),!0)}catch{return!1}},ZR=()=>({state:e,dispatch:t,tr:n})=>{try{const s=tg(e.doc,e.selection.$from.pos,1);return s==null?!1:(n.join(s,2),t&&t(n),!0)}catch{return!1}},WR=()=>({state:e,dispatch:t})=>LD(e,t),GR=()=>({state:e,dispatch:t})=>BD(e,t);function rC(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function KR(e){const t=e.split(/-(?!$)/);let n=t[t.length-1];n==="Space"&&(n=" ");let s,a,u,d;for(let c=0;c<t.length-1;c+=1){const w=t[c];if(/^(cmd|meta|m)$/i.test(w))d=!0;else if(/^a(lt)?$/i.test(w))s=!0;else if(/^(c|ctrl|control)$/i.test(w))a=!0;else if(/^s(hift)?$/i.test(w))u=!0;else if(/^mod$/i.test(w))Wv()||rC()?d=!0:a=!0;else throw new Error(`Unrecognized modifier name: ${w}`)}return s&&(n=`Alt-${n}`),a&&(n=`Ctrl-${n}`),d&&(n=`Meta-${n}`),u&&(n=`Shift-${n}`),n}const XR=e=>({editor:t,view:n,tr:s,dispatch:a})=>{const u=KR(e).split(/-(?!$)/),d=u.find(k=>!["Alt","Ctrl","Meta","Shift"].includes(k)),c=new KeyboardEvent("keydown",{key:d==="Space"?" ":d,altKey:u.includes("Alt"),ctrlKey:u.includes("Ctrl"),metaKey:u.includes("Meta"),shiftKey:u.includes("Shift"),bubbles:!0,cancelable:!0}),w=t.captureTransaction(()=>{n.someProp("handleKeyDown",k=>k(n,c))});return w==null||w.steps.forEach(k=>{const E=k.map(s.mapping);E&&a&&s.maybeStep(E)}),!0};function Xd(e,t,n={}){const{from:s,to:a,empty:u}=e.selection,d=t?ri(t,e.schema):null,c=[];e.doc.nodesBetween(s,a,(P,A)=>{if(P.isText)return;const $=Math.max(s,A),j=Math.min(a,A+P.nodeSize);c.push({node:P,from:$,to:j})});const w=a-s,k=c.filter(P=>d?d.name===P.node.type.name:!0).filter(P=>Rm(P.node.attrs,n,{strict:!1}));return u?!!k.length:k.reduce((P,A)=>P+A.to-A.from,0)>=w}const JR=(e,t={})=>({state:n,dispatch:s})=>{const a=ri(e,n.schema);return Xd(n,a,t)?UD(n,s):!1},YR=()=>({state:e,dispatch:t})=>WD(e,t),QR=e=>({state:t,dispatch:n})=>{const s=ri(e,t.schema);return tR(s)(t,n)},eO=()=>({state:e,dispatch:t})=>qD(e,t);function dg(e,t){return t.nodes[e]?"node":t.marks[e]?"mark":null}function Yb(e,t){const n=typeof t=="string"?[t]:t;return Object.keys(e).reduce((s,a)=>(n.includes(a)||(s[a]=e[a]),s),{})}const tO=(e,t)=>({tr:n,state:s,dispatch:a})=>{let u=null,d=null;const c=dg(typeof e=="string"?e:e.name,s.schema);return c?(c==="node"&&(u=ri(e,s.schema)),c==="mark"&&(d=Xa(e,s.schema)),a&&n.selection.ranges.forEach(w=>{s.doc.nodesBetween(w.$from.pos,w.$to.pos,(k,E)=>{u&&u===k.type&&n.setNodeMarkup(E,void 0,Yb(k.attrs,t)),d&&k.marks.length&&k.marks.forEach(P=>{d===P.type&&n.addMark(E,E+k.nodeSize,d.create(Yb(P.attrs,t)))})})}),!0):!1},nO=()=>({tr:e,dispatch:t})=>(t&&e.scrollIntoView(),!0),iO=()=>({tr:e,commands:t})=>t.setTextSelection({from:0,to:e.doc.content.size}),rO=()=>({state:e,dispatch:t})=>FD(e,t),sO=()=>({state:e,dispatch:t})=>VD(e,t),oO=()=>({state:e,dispatch:t})=>GD(e,t),aO=()=>({state:e,dispatch:t})=>JD(e,t),lO=()=>({state:e,dispatch:t})=>XD(e,t);function z0(e,t,n={},s={}){return Om(e,t,{slice:!1,parseOptions:n,errorOnInvalidContent:s.errorOnInvalidContent})}const cO=(e,t=!1,n={},s={})=>({editor:a,tr:u,dispatch:d,commands:c})=>{var w,k;const{doc:E}=u;if(n.preserveWhitespace!=="full"){const P=z0(e,a.schema,n,{errorOnInvalidContent:(w=s.errorOnInvalidContent)!==null&&w!==void 0?w:a.options.enableContentCheck});return d&&u.replaceWith(0,E.content.size,P).setMeta("preventUpdate",!t),!0}return d&&u.setMeta("preventUpdate",!t),c.insertContentAt({from:0,to:E.content.size},e,{parseOptions:n,errorOnInvalidContent:(k=s.errorOnInvalidContent)!==null&&k!==void 0?k:a.options.enableContentCheck})};function sC(e,t){const n=Xa(t,e.schema),{from:s,to:a,empty:u}=e.selection,d=[];u?(e.storedMarks&&d.push(...e.storedMarks),d.push(...e.selection.$head.marks())):e.doc.nodesBetween(s,a,w=>{d.push(...w.marks)});const c=d.find(w=>w.type.name===n.name);return c?{...c.attrs}:{}}function uO(e){for(let t=0;t<e.edgeCount;t+=1){const{type:n}=e.edge(t);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function hO(e,t){for(let n=e.depth;n>0;n-=1){const s=e.node(n);if(t(s))return{pos:n>0?e.before(n):0,start:e.start(n),depth:n,node:s}}}function Gv(e){return t=>hO(t.$from,e)}function dO(e,t){const n={from:0,to:e.content.size};return YT(e,n,t)}function pO(e,t){const n=ri(t,e.schema),{from:s,to:a}=e.selection,u=[];e.doc.nodesBetween(s,a,c=>{u.push(c)});const d=u.reverse().find(c=>c.type.name===n.name);return d?{...d.attrs}:{}}function fO(e,t){const n=dg(typeof t=="string"?t:t.name,e.schema);return n==="node"?pO(e,t):n==="mark"?sC(e,t):{}}function oC(e,t,n){const s=[];return e===t?n.resolve(e).marks().forEach(a=>{const u=n.resolve(e),d=Zv(u,a.type);d&&s.push({mark:a,...d})}):n.nodesBetween(e,t,(a,u)=>{!a||(a==null?void 0:a.nodeSize)===void 0||s.push(...a.marks.map(d=>({from:u,to:u+a.nodeSize,mark:d})))}),s}function Gf(e,t,n){return Object.fromEntries(Object.entries(n).filter(([s])=>{const a=e.find(u=>u.type===t&&u.name===s);return a?a.attribute.keepOnSplit:!1}))}function D0(e,t,n={}){const{empty:s,ranges:a}=e.selection,u=t?Xa(t,e.schema):null;if(s)return!!(e.storedMarks||e.selection.$from.marks()).filter(P=>u?u.name===P.type.name:!0).find(P=>Rm(P.attrs,n,{strict:!1}));let d=0;const c=[];if(a.forEach(({$from:P,$to:A})=>{const $=P.pos,j=A.pos;e.doc.nodesBetween($,j,(X,he)=>{if(!X.isText&&!X.marks.length)return;const K=Math.max($,he),J=Math.min(j,he+X.nodeSize),le=J-K;d+=le,c.push(...X.marks.map(Se=>({mark:Se,from:K,to:J})))})}),d===0)return!1;const w=c.filter(P=>u?u.name===P.mark.type.name:!0).filter(P=>Rm(P.mark.attrs,n,{strict:!1})).reduce((P,A)=>P+A.to-A.from,0),k=c.filter(P=>u?P.mark.type!==u&&P.mark.type.excludes(u):!0).reduce((P,A)=>P+A.to-A.from,0);return(w>0?w+k:w)>=d}function mO(e,t,n={}){if(!t)return Xd(e,null,n)||D0(e,null,n);const s=dg(t,e.schema);return s==="node"?Xd(e,t,n):s==="mark"?D0(e,t,n):!1}function Qb(e,t){const{nodeExtensions:n}=cg(t),s=n.find(d=>d.name===e);if(!s)return!1;const a={name:s.name,options:s.options,storage:s.storage},u=At(ot(s,"group",a));return typeof u!="string"?!1:u.split(" ").includes("list")}function Kv(e,{checkChildren:t=!0,ignoreWhitespace:n=!1}={}){var s;if(n){if(e.type.name==="hardBreak")return!0;if(e.isText)return/^\s*$/m.test((s=e.text)!==null&&s!==void 0?s:"")}if(e.isText)return!e.text;if(e.isAtom||e.isLeaf)return!1;if(e.content.childCount===0)return!0;if(t){let a=!0;return e.content.forEach(u=>{a!==!1&&(Kv(u,{ignoreWhitespace:n,checkChildren:t})||(a=!1))}),a}return!1}function gO(e){return e instanceof mt}function yO(e,t,n){var s;const{selection:a}=t;let u=null;if(tC(a)&&(u=a.$cursor),u){const c=(s=e.storedMarks)!==null&&s!==void 0?s:u.marks();return!!n.isInSet(c)||!c.some(w=>w.type.excludes(n))}const{ranges:d}=a;return d.some(({$from:c,$to:w})=>{let k=c.depth===0?e.doc.inlineContent&&e.doc.type.allowsMarkType(n):!1;return e.doc.nodesBetween(c.pos,w.pos,(E,P,A)=>{if(k)return!1;if(E.isInline){const $=!A||A.type.allowsMarkType(n),j=!!n.isInSet(E.marks)||!E.marks.some(X=>X.type.excludes(n));k=$&&j}return!k}),k})}const _O=(e,t={})=>({tr:n,state:s,dispatch:a})=>{const{selection:u}=n,{empty:d,ranges:c}=u,w=Xa(e,s.schema);if(a)if(d){const k=sC(s,w);n.addStoredMark(w.create({...k,...t}))}else c.forEach(k=>{const E=k.$from.pos,P=k.$to.pos;s.doc.nodesBetween(E,P,(A,$)=>{const j=Math.max($,E),X=Math.min($+A.nodeSize,P);A.marks.find(K=>K.type===w)?A.marks.forEach(K=>{w===K.type&&n.addMark(j,X,w.create({...K.attrs,...t}))}):n.addMark(j,X,w.create(t))})});return yO(s,n,w)},vO=(e,t)=>({tr:n})=>(n.setMeta(e,t),!0),xO=(e,t={})=>({state:n,dispatch:s,chain:a})=>{const u=ri(e,n.schema);let d;return n.selection.$anchor.sameParent(n.selection.$head)&&(d=n.selection.$anchor.parent.attrs),u.isTextblock?a().command(({commands:c})=>Wb(u,{...d,...t})(n)?!0:c.clearNodes()).command(({state:c})=>Wb(u,{...d,...t})(c,s)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},wO=e=>({tr:t,dispatch:n})=>{if(n){const{doc:s}=t,a=Fl(e,0,s.content.size),u=mt.create(s,a);t.setSelection(u)}return!0},bO=e=>({tr:t,dispatch:n})=>{if(n){const{doc:s}=t,{from:a,to:u}=typeof e=="number"?{from:e,to:e}:e,d=kt.atStart(s).from,c=kt.atEnd(s).to,w=Fl(a,d,c),k=Fl(u,d,c),E=kt.create(s,w,k);t.setSelection(E)}return!0},SO=e=>({state:t,dispatch:n})=>{const s=ri(e,t.schema);return rR(s)(t,n)};function eS(e,t){const n=e.storedMarks||e.selection.$to.parentOffset&&e.selection.$from.marks();if(n){const s=n.filter(a=>t==null?void 0:t.includes(a.type.name));e.tr.ensureMarks(s)}}const kO=({keepMarks:e=!0}={})=>({tr:t,state:n,dispatch:s,editor:a})=>{const{selection:u,doc:d}=t,{$from:c,$to:w}=u,k=a.extensionManager.attributes,E=Gf(k,c.node().type.name,c.node().attrs);if(u instanceof mt&&u.node.isBlock)return!c.parentOffset||!ku(d,c.pos)?!1:(s&&(e&&eS(n,a.extensionManager.splittableMarks),t.split(c.pos).scrollIntoView()),!0);if(!c.parent.isBlock)return!1;const P=w.parentOffset===w.parent.content.size,A=c.depth===0?void 0:uO(c.node(-1).contentMatchAt(c.indexAfter(-1)));let $=P&&A?[{type:A,attrs:E}]:void 0,j=ku(t.doc,t.mapping.map(c.pos),1,$);if(!$&&!j&&ku(t.doc,t.mapping.map(c.pos),1,A?[{type:A}]:void 0)&&(j=!0,$=A?[{type:A,attrs:E}]:void 0),s){if(j&&(u instanceof kt&&t.deleteSelection(),t.split(t.mapping.map(c.pos),1,$),A&&!P&&!c.parentOffset&&c.parent.type!==A)){const X=t.mapping.map(c.before()),he=t.doc.resolve(X);c.node(-1).canReplaceWith(he.index(),he.index()+1,A)&&t.setNodeMarkup(t.mapping.map(c.before()),A)}e&&eS(n,a.extensionManager.splittableMarks),t.scrollIntoView()}return j},TO=(e,t={})=>({tr:n,state:s,dispatch:a,editor:u})=>{var d;const c=ri(e,s.schema),{$from:w,$to:k}=s.selection,E=s.selection.node;if(E&&E.isBlock||w.depth<2||!w.sameParent(k))return!1;const P=w.node(-1);if(P.type!==c)return!1;const A=u.extensionManager.attributes;if(w.parent.content.size===0&&w.node(-1).childCount===w.indexAfter(-1)){if(w.depth===2||w.node(-3).type!==c||w.index(-2)!==w.node(-2).childCount-1)return!1;if(a){let K=Ae.empty;const J=w.index(-1)?1:w.index(-2)?2:3;for(let Ze=w.depth-J;Ze>=w.depth-3;Ze-=1)K=Ae.from(w.node(Ze).copy(K));const le=w.indexAfter(-1)<w.node(-2).childCount?1:w.indexAfter(-2)<w.node(-3).childCount?2:3,Se={...Gf(A,w.node().type.name,w.node().attrs),...t},Me=((d=c.contentMatch.defaultType)===null||d===void 0?void 0:d.createAndFill(Se))||void 0;K=K.append(Ae.from(c.createAndFill(null,Me)||void 0));const Ee=w.before(w.depth-(J-1));n.replace(Ee,w.after(-le),new Qe(K,4-J,0));let De=-1;n.doc.nodesBetween(Ee,n.doc.content.size,(Ze,tt)=>{if(De>-1)return!1;Ze.isTextblock&&Ze.content.size===0&&(De=tt+1)}),De>-1&&n.setSelection(kt.near(n.doc.resolve(De))),n.scrollIntoView()}return!0}const $=k.pos===w.end()?P.contentMatchAt(0).defaultType:null,j={...Gf(A,P.type.name,P.attrs),...t},X={...Gf(A,w.node().type.name,w.node().attrs),...t};n.delete(w.pos,k.pos);const he=$?[{type:c,attrs:j},{type:$,attrs:X}]:[{type:c,attrs:j}];if(!ku(n.doc,w.pos,2))return!1;if(a){const{selection:K,storedMarks:J}=s,{splittableMarks:le}=u.extensionManager,Se=J||K.$to.parentOffset&&K.$from.marks();if(n.split(w.pos,2,he).scrollIntoView(),!Se||!a)return!0;const Me=Se.filter(Ee=>le.includes(Ee.type.name));n.ensureMarks(Me)}return!0},g_=(e,t)=>{const n=Gv(d=>d.type===t)(e.selection);if(!n)return!0;const s=e.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(s===void 0)return!0;const a=e.doc.nodeAt(s);return n.node.type===(a==null?void 0:a.type)&&Ga(e.doc,n.pos)&&e.join(n.pos),!0},y_=(e,t)=>{const n=Gv(d=>d.type===t)(e.selection);if(!n)return!0;const s=e.doc.resolve(n.start).after(n.depth);if(s===void 0)return!0;const a=e.doc.nodeAt(s);return n.node.type===(a==null?void 0:a.type)&&Ga(e.doc,s)&&e.join(s),!0},CO=(e,t,n,s={})=>({editor:a,tr:u,state:d,dispatch:c,chain:w,commands:k,can:E})=>{const{extensions:P,splittableMarks:A}=a.extensionManager,$=ri(e,d.schema),j=ri(t,d.schema),{selection:X,storedMarks:he}=d,{$from:K,$to:J}=X,le=K.blockRange(J),Se=he||X.$to.parentOffset&&X.$from.marks();if(!le)return!1;const Me=Gv(Ee=>Qb(Ee.type.name,P))(X);if(le.depth>=1&&Me&&le.depth-Me.depth<=1){if(Me.node.type===$)return k.liftListItem(j);if(Qb(Me.node.type.name,P)&&$.validContent(Me.node.content)&&c)return w().command(()=>(u.setNodeMarkup(Me.pos,$),!0)).command(()=>g_(u,$)).command(()=>y_(u,$)).run()}return!n||!Se||!c?w().command(()=>E().wrapInList($,s)?!0:k.clearNodes()).wrapInList($,s).command(()=>g_(u,$)).command(()=>y_(u,$)).run():w().command(()=>{const Ee=E().wrapInList($,s),De=Se.filter(Ze=>A.includes(Ze.type.name));return u.ensureMarks(De),Ee?!0:k.clearNodes()}).wrapInList($,s).command(()=>g_(u,$)).command(()=>y_(u,$)).run()},MO=(e,t={},n={})=>({state:s,commands:a})=>{const{extendEmptyMarkRange:u=!1}=n,d=Xa(e,s.schema);return D0(s,d,t)?a.unsetMark(d,{extendEmptyMarkRange:u}):a.setMark(d,t)},EO=(e,t,n={})=>({state:s,commands:a})=>{const u=ri(e,s.schema),d=ri(t,s.schema),c=Xd(s,u,n);let w;return s.selection.$anchor.sameParent(s.selection.$head)&&(w=s.selection.$anchor.parent.attrs),c?a.setNode(d,w):a.setNode(u,{...w,...n})},IO=(e,t={})=>({state:n,commands:s})=>{const a=ri(e,n.schema);return Xd(n,a,t)?s.lift(a):s.wrapIn(a,t)},PO=()=>({state:e,dispatch:t})=>{const n=e.plugins;for(let s=0;s<n.length;s+=1){const a=n[s];let u;if(a.spec.isInputRules&&(u=a.getState(e))){if(t){const d=e.tr,c=u.transform;for(let w=c.steps.length-1;w>=0;w-=1)d.step(c.steps[w].invert(c.docs[w]));if(u.text){const w=d.doc.resolve(u.from).marks();d.replaceWith(u.from,u.to,e.schema.text(u.text,w))}else d.delete(u.from,u.to)}return!0}}return!1},AO=()=>({tr:e,dispatch:t})=>{const{selection:n}=e,{empty:s,ranges:a}=n;return s||t&&a.forEach(u=>{e.removeMark(u.$from.pos,u.$to.pos)}),!0},zO=(e,t={})=>({tr:n,state:s,dispatch:a})=>{var u;const{extendEmptyMarkRange:d=!1}=t,{selection:c}=n,w=Xa(e,s.schema),{$from:k,empty:E,ranges:P}=c;if(!a)return!0;if(E&&d){let{from:A,to:$}=c;const j=(u=k.marks().find(he=>he.type===w))===null||u===void 0?void 0:u.attrs,X=Zv(k,w,j);X&&(A=X.from,$=X.to),n.removeMark(A,$,w)}else P.forEach(A=>{n.removeMark(A.$from.pos,A.$to.pos,w)});return n.removeStoredMark(w),!0},DO=(e,t={})=>({tr:n,state:s,dispatch:a})=>{let u=null,d=null;const c=dg(typeof e=="string"?e:e.name,s.schema);return c?(c==="node"&&(u=ri(e,s.schema)),c==="mark"&&(d=Xa(e,s.schema)),a&&n.selection.ranges.forEach(w=>{const k=w.$from.pos,E=w.$to.pos;let P,A,$,j;n.selection.empty?s.doc.nodesBetween(k,E,(X,he)=>{u&&u===X.type&&($=Math.max(he,k),j=Math.min(he+X.nodeSize,E),P=he,A=X)}):s.doc.nodesBetween(k,E,(X,he)=>{he<k&&u&&u===X.type&&($=Math.max(he,k),j=Math.min(he+X.nodeSize,E),P=he,A=X),he>=k&&he<=E&&(u&&u===X.type&&n.setNodeMarkup(he,void 0,{...X.attrs,...t}),d&&X.marks.length&&X.marks.forEach(K=>{if(d===K.type){const J=Math.max(he,k),le=Math.min(he+X.nodeSize,E);n.addMark(J,le,d.create({...K.attrs,...t}))}}))}),A&&(P!==void 0&&n.setNodeMarkup(P,void 0,{...A.attrs,...t}),d&&A.marks.length&&A.marks.forEach(X=>{d===X.type&&n.addMark($,j,d.create({...X.attrs,...t}))}))}),!0):!1},RO=(e,t={})=>({state:n,dispatch:s})=>{const a=ri(e,n.schema);return YD(a,t)(n,s)},OO=(e,t={})=>({state:n,dispatch:s})=>{const a=ri(e,n.schema);return QD(a,t)(n,s)};var LO=Object.freeze({__proto__:null,blur:wR,clearContent:bR,clearNodes:SR,command:kR,createParagraphNear:TR,cut:CR,deleteCurrentNode:MR,deleteNode:ER,deleteRange:IR,deleteSelection:PR,enter:AR,exitCode:zR,extendMarkRange:DR,first:RR,focus:OR,forEach:LR,insertContent:BR,insertContentAt:VR,joinBackward:UR,joinDown:jR,joinForward:qR,joinItemBackward:HR,joinItemForward:ZR,joinTextblockBackward:WR,joinTextblockForward:GR,joinUp:$R,keyboardShortcut:XR,lift:JR,liftEmptyBlock:YR,liftListItem:QR,newlineInCode:eO,resetAttributes:tO,scrollIntoView:nO,selectAll:iO,selectNodeBackward:rO,selectNodeForward:sO,selectParentNode:oO,selectTextblockEnd:aO,selectTextblockStart:lO,setContent:cO,setMark:_O,setMeta:vO,setNode:xO,setNodeSelection:wO,setTextSelection:bO,sinkListItem:SO,splitBlock:kO,splitListItem:TO,toggleList:CO,toggleMark:MO,toggleNode:EO,toggleWrap:IO,undoInputRule:PO,unsetAllMarks:AO,unsetMark:zO,updateAttributes:DO,wrapIn:RO,wrapInList:OO});const BO=Oi.create({name:"commands",addCommands(){return{...LO}}}),FO=Oi.create({name:"drop",addProseMirrorPlugins(){return[new er({key:new Js("tiptapDrop"),props:{handleDrop:(e,t,n,s)=>{this.editor.emit("drop",{editor:this.editor,event:t,slice:n,moved:s})}}})]}}),NO=Oi.create({name:"editable",addProseMirrorPlugins(){return[new er({key:new Js("editable"),props:{editable:()=>this.editor.options.editable}})]}}),VO=Oi.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:e}=this;return[new er({key:new Js("focusEvents"),props:{handleDOMEvents:{focus:(t,n)=>{e.isFocused=!0;const s=e.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return t.dispatch(s),!1},blur:(t,n)=>{e.isFocused=!1;const s=e.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return t.dispatch(s),!1}}}})]}}),$O=Oi.create({name:"keymap",addKeyboardShortcuts(){const e=()=>this.editor.commands.first(({commands:d})=>[()=>d.undoInputRule(),()=>d.command(({tr:c})=>{const{selection:w,doc:k}=c,{empty:E,$anchor:P}=w,{pos:A,parent:$}=P,j=P.parent.isTextblock&&A>0?c.doc.resolve(A-1):P,X=j.parent.type.spec.isolating,he=P.pos-P.parentOffset,K=X&&j.parent.childCount===1?he===P.pos:Et.atStart(k).from===A;return!E||!$.type.isTextblock||$.textContent.length||!K||K&&P.parent.type.name==="paragraph"?!1:d.clearNodes()}),()=>d.deleteSelection(),()=>d.joinBackward(),()=>d.selectNodeBackward()]),t=()=>this.editor.commands.first(({commands:d})=>[()=>d.deleteSelection(),()=>d.deleteCurrentNode(),()=>d.joinForward(),()=>d.selectNodeForward()]),s={Enter:()=>this.editor.commands.first(({commands:d})=>[()=>d.newlineInCode(),()=>d.createParagraphNear(),()=>d.liftEmptyBlock(),()=>d.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:e,"Mod-Backspace":e,"Shift-Backspace":e,Delete:t,"Mod-Delete":t,"Mod-a":()=>this.editor.commands.selectAll()},a={...s},u={...s,"Ctrl-h":e,"Alt-Backspace":e,"Ctrl-d":t,"Ctrl-Alt-Backspace":t,"Alt-Delete":t,"Alt-d":t,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return Wv()||rC()?u:a},addProseMirrorPlugins(){return[new er({key:new Js("clearDocument"),appendTransaction:(e,t,n)=>{const s=e.some(X=>X.docChanged)&&!t.doc.eq(n.doc),a=e.some(X=>X.getMeta("preventClearDocument"));if(!s||a)return;const{empty:u,from:d,to:c}=t.selection,w=Et.atStart(t.doc).from,k=Et.atEnd(t.doc).to;if(u||!(d===w&&c===k)||!Kv(n.doc))return;const A=n.tr,$=ag({state:n,transaction:A}),{commands:j}=new lg({editor:this.editor,state:$});if(j.clearNodes(),!!A.steps.length)return A}})]}}),jO=Oi.create({name:"paste",addProseMirrorPlugins(){return[new er({key:new Js("tiptapPaste"),props:{handlePaste:(e,t,n)=>{this.editor.emit("paste",{editor:this.editor,event:t,slice:n})}}})]}}),UO=Oi.create({name:"tabindex",addProseMirrorPlugins(){return[new er({key:new Js("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}});class zl{get name(){return this.node.type.name}constructor(t,n,s=!1,a=null){this.currentNode=null,this.actualDepth=null,this.isBlock=s,this.resolvedPos=t,this.editor=n,this.currentNode=a}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var t;return(t=this.actualDepth)!==null&&t!==void 0?t:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(t){let n=this.from,s=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You cant set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}n=this.from+1,s=this.to-1}this.editor.commands.insertContentAt({from:n,to:s},t)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const t=this.resolvedPos.start(this.resolvedPos.depth-1),n=this.resolvedPos.doc.resolve(t);return new zl(n,this.editor)}get before(){let t=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return t.depth!==this.depth&&(t=this.resolvedPos.doc.resolve(this.from-3)),new zl(t,this.editor)}get after(){let t=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return t.depth!==this.depth&&(t=this.resolvedPos.doc.resolve(this.to+3)),new zl(t,this.editor)}get children(){const t=[];return this.node.content.forEach((n,s)=>{const a=n.isBlock&&!n.isTextblock,u=n.isAtom&&!n.isText,d=this.pos+s+(u?0:1),c=this.resolvedPos.doc.resolve(d);if(!a&&c.depth<=this.depth)return;const w=new zl(c,this.editor,a,a?n:null);a&&(w.actualDepth=this.depth+1),t.push(new zl(c,this.editor,a,a?n:null))}),t}get firstChild(){return this.children[0]||null}get lastChild(){const t=this.children;return t[t.length-1]||null}closest(t,n={}){let s=null,a=this.parent;for(;a&&!s;){if(a.node.type.name===t)if(Object.keys(n).length>0){const u=a.node.attrs,d=Object.keys(n);for(let c=0;c<d.length;c+=1){const w=d[c];if(u[w]!==n[w])break}}else s=a;a=a.parent}return s}querySelector(t,n={}){return this.querySelectorAll(t,n,!0)[0]||null}querySelectorAll(t,n={},s=!1){let a=[];if(!this.children||this.children.length===0)return a;const u=Object.keys(n);return this.children.forEach(d=>{s&&a.length>0||(d.node.type.name===t&&u.every(w=>n[w]===d.node.attrs[w])&&a.push(d),!(s&&a.length>0)&&(a=a.concat(d.querySelectorAll(t,n,s))))}),a}setAttribute(t){const{tr:n}=this.editor.state;n.setNodeMarkup(this.from,void 0,{...this.node.attrs,...t}),this.editor.view.dispatch(n)}}const qO=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.tippy-box[data-animation=fade][data-state=hidden] {
  opacity: 0
}`;function HO(e,t,n){const s=document.querySelector("style[data-tiptap-style]");if(s!==null)return s;const a=document.createElement("style");return t&&a.setAttribute("nonce",t),a.setAttribute("data-tiptap-style",""),a.innerHTML=e,document.getElementsByTagName("head")[0].appendChild(a),a}class ZO extends sR{constructor(t={}){super(),this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:n})=>{throw n},onPaste:()=>null,onDrop:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(t),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("contentError",this.options.onContentError),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:n,slice:s,moved:a})=>this.options.onDrop(n,s,a)),this.on("paste",({event:n,slice:s})=>this.options.onPaste(n,s)),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=HO(qO,this.options.injectNonce))}setOptions(t={}){this.options={...this.options,...t},!(!this.view||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(t,n=!0){this.setOptions({editable:t}),n&&this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(t,n){const s=JT(n)?n(t,[...this.state.plugins]):[...this.state.plugins,t],a=this.state.reconfigure({plugins:s});return this.view.updateState(a),a}unregisterPlugin(t){if(this.isDestroyed)return;const n=this.state.plugins;let s=n;if([].concat(t).forEach(u=>{const d=typeof u=="string"?`${u}$`:u.key;s=n.filter(c=>!c.key.startsWith(d))}),n.length===s.length)return;const a=this.state.reconfigure({plugins:s});return this.view.updateState(a),a}createExtensionManager(){var t,n;const a=[...this.options.enableCoreExtensions?[NO,xR.configure({blockSeparator:(n=(t=this.options.coreExtensionOptions)===null||t===void 0?void 0:t.clipboardTextSerializer)===null||n===void 0?void 0:n.blockSeparator}),BO,VO,$O,UO,FO,jO].filter(u=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[u.name]!==!1:!0):[],...this.options.extensions].filter(u=>["extension","node","mark"].includes(u==null?void 0:u.type));this.extensionManager=new gu(a,this)}createCommandManager(){this.commandManager=new lg({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){var t;let n;try{n=z0(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(d){if(!(d instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(d.message))throw d;this.emit("contentError",{editor:this,error:d,disableCollaboration:()=>{this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(c=>c.name!=="collaboration"),this.createExtensionManager()}}),n=z0(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}const s=nC(n,this.options.autofocus);this.view=new kD(this.options.element,{...this.options.editorProps,attributes:{role:"textbox",...(t=this.options.editorProps)===null||t===void 0?void 0:t.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:mu.create({doc:n,selection:s||void 0})});const a=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(a),this.createNodeViews(),this.prependClass();const u=this.view.dom;u.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`tiptap ${this.view.dom.className}`}captureTransaction(t){this.isCapturingTransaction=!0,t(),this.isCapturingTransaction=!1;const n=this.capturedTransaction;return this.capturedTransaction=null,n}dispatchTransaction(t){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=t;return}t.steps.forEach(d=>{var c;return(c=this.capturedTransaction)===null||c===void 0?void 0:c.step(d)});return}const n=this.state.apply(t),s=!this.state.selection.eq(n.selection);this.emit("beforeTransaction",{editor:this,transaction:t,nextState:n}),this.view.updateState(n),this.emit("transaction",{editor:this,transaction:t}),s&&this.emit("selectionUpdate",{editor:this,transaction:t});const a=t.getMeta("focus"),u=t.getMeta("blur");a&&this.emit("focus",{editor:this,event:a.event,transaction:t}),u&&this.emit("blur",{editor:this,event:u.event,transaction:t}),!(!t.docChanged||t.getMeta("preventUpdate"))&&this.emit("update",{editor:this,transaction:t})}getAttributes(t){return fO(this.state,t)}isActive(t,n){const s=typeof t=="string"?t:null,a=typeof t=="string"?n:t;return mO(this.state,s,a)}getJSON(){return this.state.doc.toJSON()}getHTML(){return qv(this.state.doc.content,this.schema)}getText(t){const{blockSeparator:n=`

`,textSerializers:s={}}=t||{};return dO(this.state.doc,{blockSeparator:n,textSerializers:{...QT(this.schema),...s}})}get isEmpty(){return Kv(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){if(this.emit("destroy"),this.view){const t=this.view.dom;t&&t.editor&&delete t.editor,this.view.destroy()}this.removeAllListeners()}get isDestroyed(){var t;return!(!((t=this.view)===null||t===void 0)&&t.docView)}$node(t,n){var s;return((s=this.$doc)===null||s===void 0?void 0:s.querySelector(t,n))||null}$nodes(t,n){var s;return((s=this.$doc)===null||s===void 0?void 0:s.querySelectorAll(t,n))||null}$pos(t){const n=this.state.doc.resolve(t);return new zl(n,this)}get $doc(){return this.$pos(0)}}function Fu(e){return new ug({find:e.find,handler:({state:t,range:n,match:s})=>{const a=At(e.getAttributes,void 0,s);if(a===!1||a===null)return null;const{tr:u}=t,d=s[s.length-1],c=s[0];if(d){const w=c.search(/\S/),k=n.from+c.indexOf(d),E=k+d.length;if(oC(n.from,n.to,t.doc).filter($=>$.mark.type.excluded.find(X=>X===e.type&&X!==$.mark.type)).filter($=>$.to>k).length)return null;E<n.to&&u.delete(E,n.to),k>n.from&&u.delete(n.from+w,k);const A=n.from+w+d.length;u.addMark(n.from+w,A,e.type.create(a||{})),u.removeStoredMark(e.type)}}})}function WO(e){return new ug({find:e.find,handler:({state:t,range:n,match:s})=>{const a=At(e.getAttributes,void 0,s)||{},{tr:u}=t,d=n.from;let c=n.to;const w=e.type.create(a);if(s[1]){const k=s[0].lastIndexOf(s[1]);let E=d+k;E>c?E=c:c=E+s[1].length;const P=s[0][s[0].length-1];u.insertText(P,d+s[0].length-1),u.replaceWith(E,c,w)}else if(s[0]){const k=e.type.isInline?d:d-1;u.insert(k,e.type.create(a)).delete(u.mapping.map(d),u.mapping.map(c))}u.scrollIntoView()}})}function R0(e){return new ug({find:e.find,handler:({state:t,range:n,match:s})=>{const a=t.doc.resolve(n.from),u=At(e.getAttributes,void 0,s)||{};if(!a.node(-1).canReplaceWith(a.index(-1),a.indexAfter(-1),e.type))return null;t.tr.delete(n.from,n.to).setBlockType(n.from,n.from,e.type,u)}})}function Jd(e){return new ug({find:e.find,handler:({state:t,range:n,match:s,chain:a})=>{const u=At(e.getAttributes,void 0,s)||{},d=t.tr.delete(n.from,n.to),w=d.doc.resolve(n.from).blockRange(),k=w&&zv(w,e.type,u);if(!k)return null;if(d.wrap(w,k),e.keepMarks&&e.editor){const{selection:P,storedMarks:A}=t,{splittableMarks:$}=e.editor.extensionManager,j=A||P.$to.parentOffset&&P.$from.marks();if(j){const X=j.filter(he=>$.includes(he.type.name));d.ensureMarks(X)}}if(e.keepAttributes){const P=e.type.name==="bulletList"||e.type.name==="orderedList"?"listItem":"taskList";a().updateAttributes(P,u).run()}const E=d.doc.resolve(n.from-1).nodeBefore;E&&E.type===e.type&&Ga(d.doc,n.from-1)&&(!e.joinPredicate||e.joinPredicate(s,E))&&d.join(n.from-1)}})}class _r{constructor(t={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...t},this.name=this.config.name,t.defaultOptions&&Object.keys(t.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=At(ot(this,"addOptions",{name:this.name}))),this.storage=At(ot(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(t={}){return new _r(t)}configure(t={}){const n=this.extend({...this.config,addOptions:()=>hg(this.options,t)});return n.name=this.name,n.parent=this.parent,n}extend(t={}){const n=new _r(t);return n.parent=this,this.child=n,n.name=t.name?t.name:n.parent.name,t.defaultOptions&&Object.keys(t.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=At(ot(n,"addOptions",{name:n.name})),n.storage=At(ot(n,"addStorage",{name:n.name,options:n.options})),n}}function Nu(e){return new fR({find:e.find,handler:({state:t,range:n,match:s,pasteEvent:a})=>{const u=At(e.getAttributes,void 0,s,a);if(u===!1||u===null)return null;const{tr:d}=t,c=s[s.length-1],w=s[0];let k=n.to;if(c){const E=w.search(/\S/),P=n.from+w.indexOf(c),A=P+c.length;if(oC(n.from,n.to,t.doc).filter(j=>j.mark.type.excluded.find(he=>he===e.type&&he!==j.mark.type)).filter(j=>j.to>P).length)return null;A<n.to&&d.delete(A,n.to),P>n.from&&d.delete(n.from+E,P),k=n.from+E+c.length,d.addMark(n.from+E,k,e.type.create(u||{})),d.removeStoredMark(e.type)}}})}function GO(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var aC={exports:{}},__={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tS;function KO(){if(tS)return __;tS=1;var e=Zi;function t(P,A){return P===A&&(P!==0||1/P===1/A)||P!==P&&A!==A}var n=typeof Object.is=="function"?Object.is:t,s=e.useState,a=e.useEffect,u=e.useLayoutEffect,d=e.useDebugValue;function c(P,A){var $=A(),j=s({inst:{value:$,getSnapshot:A}}),X=j[0].inst,he=j[1];return u(function(){X.value=$,X.getSnapshot=A,w(X)&&he({inst:X})},[P,$,A]),a(function(){return w(X)&&he({inst:X}),P(function(){w(X)&&he({inst:X})})},[P]),d($),$}function w(P){var A=P.getSnapshot;P=P.value;try{var $=A();return!n(P,$)}catch{return!0}}function k(P,A){return A()}var E=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?k:c;return __.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:E,__}aC.exports=KO();var Xv=aC.exports;const XO=(...e)=>t=>{e.forEach(n=>{typeof n=="function"?n(t):n&&(n.current=t)})},JO=({contentComponent:e})=>{const t=Xv.useSyncExternalStore(e.subscribe,e.getSnapshot,e.getServerSnapshot);return Zi.createElement(Zi.Fragment,null,Object.values(t))};function YO(){const e=new Set;let t={};return{subscribe(n){return e.add(n),()=>{e.delete(n)}},getSnapshot(){return t},getServerSnapshot(){return t},setRenderer(n,s){t={...t,[n]:XP.createPortal(s.reactElement,s.element,n)},e.forEach(a=>a())},removeRenderer(n){const s={...t};delete s[n],t=s,e.forEach(a=>a())}}}class QO extends Zi.Component{constructor(t){var n;super(t),this.editorContentRef=Zi.createRef(),this.initialized=!1,this.state={hasContentComponentInitialized:!!(!((n=t.editor)===null||n===void 0)&&n.contentComponent)}}componentDidMount(){this.init()}componentDidUpdate(){this.init()}init(){const t=this.props.editor;if(t&&!t.isDestroyed&&t.options.element){if(t.contentComponent)return;const n=this.editorContentRef.current;n.append(...t.options.element.childNodes),t.setOptions({element:n}),t.contentComponent=YO(),this.state.hasContentComponentInitialized||(this.unsubscribeToContentComponent=t.contentComponent.subscribe(()=>{this.setState(s=>s.hasContentComponentInitialized?s:{hasContentComponentInitialized:!0}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent()})),t.createNodeViews(),this.initialized=!0}}componentWillUnmount(){const t=this.props.editor;if(!t||(this.initialized=!1,t.isDestroyed||t.view.setProps({nodeViews:{}}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent(),t.contentComponent=null,!t.options.element.firstChild))return;const n=document.createElement("div");n.append(...t.options.element.childNodes),t.setOptions({element:n})}render(){const{editor:t,innerRef:n,...s}=this.props;return Zi.createElement(Zi.Fragment,null,Zi.createElement("div",{ref:XO(n,this.editorContentRef),...s}),(t==null?void 0:t.contentComponent)&&Zi.createElement(JO,{contentComponent:t.contentComponent}))}}const eL=gn.forwardRef((e,t)=>{const n=Zi.useMemo(()=>Math.floor(Math.random()*4294967295).toString(),[e.editor]);return Zi.createElement(QO,{key:n,innerRef:t,...e})}),tL=Zi.memo(eL);var nL=function e(t,n){if(t===n)return!0;if(t&&n&&typeof t=="object"&&typeof n=="object"){if(t.constructor!==n.constructor)return!1;var s,a,u;if(Array.isArray(t)){if(s=t.length,s!=n.length)return!1;for(a=s;a--!==0;)if(!e(t[a],n[a]))return!1;return!0}if(t instanceof Map&&n instanceof Map){if(t.size!==n.size)return!1;for(a of t.entries())if(!n.has(a[0]))return!1;for(a of t.entries())if(!e(a[1],n.get(a[0])))return!1;return!0}if(t instanceof Set&&n instanceof Set){if(t.size!==n.size)return!1;for(a of t.entries())if(!n.has(a[0]))return!1;return!0}if(ArrayBuffer.isView(t)&&ArrayBuffer.isView(n)){if(s=t.length,s!=n.length)return!1;for(a=s;a--!==0;)if(t[a]!==n[a])return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if(u=Object.keys(t),s=u.length,s!==Object.keys(n).length)return!1;for(a=s;a--!==0;)if(!Object.prototype.hasOwnProperty.call(n,u[a]))return!1;for(a=s;a--!==0;){var d=u[a];if(!(d==="_owner"&&t.$$typeof)&&!e(t[d],n[d]))return!1}return!0}return t!==t&&n!==n},iL=GO(nL),lC={exports:{}},v_={};/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nS;function rL(){if(nS)return v_;nS=1;var e=Zi,t=Xv;function n(k,E){return k===E&&(k!==0||1/k===1/E)||k!==k&&E!==E}var s=typeof Object.is=="function"?Object.is:n,a=t.useSyncExternalStore,u=e.useRef,d=e.useEffect,c=e.useMemo,w=e.useDebugValue;return v_.useSyncExternalStoreWithSelector=function(k,E,P,A,$){var j=u(null);if(j.current===null){var X={hasValue:!1,value:null};j.current=X}else X=j.current;j=c(function(){function K(Ee){if(!J){if(J=!0,le=Ee,Ee=A(Ee),$!==void 0&&X.hasValue){var De=X.value;if($(De,Ee))return Se=De}return Se=Ee}if(De=Se,s(le,Ee))return De;var Ze=A(Ee);return $!==void 0&&$(De,Ze)?De:(le=Ee,Se=Ze)}var J=!1,le,Se,Me=P===void 0?null:P;return[function(){return K(E())},Me===null?void 0:function(){return K(Me())}]},[E,P,A,$]);var he=a(k,j[0],j[1]);return d(function(){X.hasValue=!0,X.value=he},[he]),w(he),he},v_}lC.exports=rL();var sL=lC.exports;class oL{constructor(t){this.transactionNumber=0,this.lastTransactionNumber=0,this.subscribers=new Set,this.editor=t,this.lastSnapshot={editor:t,transactionNumber:0},this.getSnapshot=this.getSnapshot.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.watch=this.watch.bind(this),this.subscribe=this.subscribe.bind(this)}getSnapshot(){return this.transactionNumber===this.lastTransactionNumber?this.lastSnapshot:(this.lastTransactionNumber=this.transactionNumber,this.lastSnapshot={editor:this.editor,transactionNumber:this.transactionNumber},this.lastSnapshot)}getServerSnapshot(){return{editor:null,transactionNumber:0}}subscribe(t){return this.subscribers.add(t),()=>{this.subscribers.delete(t)}}watch(t){if(this.editor=t,this.editor){const n=()=>{this.transactionNumber+=1,this.subscribers.forEach(a=>a())},s=this.editor;return s.on("transaction",n),()=>{s.off("transaction",n)}}}}function aL(e){var t;const[n]=gn.useState(()=>new oL(e.editor)),s=sL.useSyncExternalStoreWithSelector(n.subscribe,n.getSnapshot,n.getServerSnapshot,e.selector,(t=e.equalityFn)!==null&&t!==void 0?t:iL);return gn.useLayoutEffect(()=>n.watch(e.editor),[e.editor,n]),gn.useDebugValue(s),s}const lL=!1,O0=typeof window>"u",cL=O0||!!(typeof window<"u"&&window.next);class uL{constructor(t){this.editor=null,this.subscriptions=new Set,this.isComponentMounted=!1,this.previousDeps=null,this.instanceId="",this.options=t,this.subscriptions=new Set,this.setEditor(this.getInitialEditor()),this.scheduleDestroy(),this.getEditor=this.getEditor.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.subscribe=this.subscribe.bind(this),this.refreshEditorInstance=this.refreshEditorInstance.bind(this),this.scheduleDestroy=this.scheduleDestroy.bind(this),this.onRender=this.onRender.bind(this),this.createEditor=this.createEditor.bind(this)}setEditor(t){this.editor=t,this.instanceId=Math.random().toString(36).slice(2,9),this.subscriptions.forEach(n=>n())}getInitialEditor(){if(this.options.current.immediatelyRender===void 0)return O0||cL?null:this.createEditor();if(this.options.current.immediatelyRender&&O0&&lL)throw new Error("Tiptap Error: SSR has been detected, and `immediatelyRender` has been set to `true` this is an unsupported configuration that may result in errors, explicitly set `immediatelyRender` to `false` to avoid hydration mismatches.");return this.options.current.immediatelyRender?this.createEditor():null}createEditor(){const t={...this.options.current,onBeforeCreate:(...s)=>{var a,u;return(u=(a=this.options.current).onBeforeCreate)===null||u===void 0?void 0:u.call(a,...s)},onBlur:(...s)=>{var a,u;return(u=(a=this.options.current).onBlur)===null||u===void 0?void 0:u.call(a,...s)},onCreate:(...s)=>{var a,u;return(u=(a=this.options.current).onCreate)===null||u===void 0?void 0:u.call(a,...s)},onDestroy:(...s)=>{var a,u;return(u=(a=this.options.current).onDestroy)===null||u===void 0?void 0:u.call(a,...s)},onFocus:(...s)=>{var a,u;return(u=(a=this.options.current).onFocus)===null||u===void 0?void 0:u.call(a,...s)},onSelectionUpdate:(...s)=>{var a,u;return(u=(a=this.options.current).onSelectionUpdate)===null||u===void 0?void 0:u.call(a,...s)},onTransaction:(...s)=>{var a,u;return(u=(a=this.options.current).onTransaction)===null||u===void 0?void 0:u.call(a,...s)},onUpdate:(...s)=>{var a,u;return(u=(a=this.options.current).onUpdate)===null||u===void 0?void 0:u.call(a,...s)},onContentError:(...s)=>{var a,u;return(u=(a=this.options.current).onContentError)===null||u===void 0?void 0:u.call(a,...s)},onDrop:(...s)=>{var a,u;return(u=(a=this.options.current).onDrop)===null||u===void 0?void 0:u.call(a,...s)},onPaste:(...s)=>{var a,u;return(u=(a=this.options.current).onPaste)===null||u===void 0?void 0:u.call(a,...s)}};return new ZO(t)}getEditor(){return this.editor}getServerSnapshot(){return null}subscribe(t){return this.subscriptions.add(t),()=>{this.subscriptions.delete(t)}}onRender(t){return()=>(this.isComponentMounted=!0,clearTimeout(this.scheduledDestructionTimeout),this.editor&&!this.editor.isDestroyed&&t.length===0?this.editor.setOptions({...this.options.current,editable:this.editor.isEditable}):this.refreshEditorInstance(t),()=>{this.isComponentMounted=!1,this.scheduleDestroy()})}refreshEditorInstance(t){if(this.editor&&!this.editor.isDestroyed){if(this.previousDeps===null){this.previousDeps=t;return}if(this.previousDeps.length===t.length&&this.previousDeps.every((s,a)=>s===t[a]))return}this.editor&&!this.editor.isDestroyed&&this.editor.destroy(),this.setEditor(this.createEditor()),this.previousDeps=t}scheduleDestroy(){const t=this.instanceId,n=this.editor;this.scheduledDestructionTimeout=setTimeout(()=>{if(this.isComponentMounted&&this.instanceId===t){n&&n.setOptions(this.options.current);return}n&&!n.isDestroyed&&(n.destroy(),this.instanceId===t&&this.setEditor(null))},1)}}function hL(e={},t=[]){const n=gn.useRef(e);n.current=e;const[s]=gn.useState(()=>new uL(n)),a=Xv.useSyncExternalStore(s.subscribe,s.getEditor,s.getServerSnapshot);return gn.useDebugValue(a),gn.useEffect(s.onRender(t)),aL({editor:a,selector:({transactionNumber:u})=>e.shouldRerenderOnTransaction===!1?null:e.immediatelyRender&&u===0?0:u+1}),a}const dL=gn.createContext({editor:null});dL.Consumer;const pL=gn.createContext({onDragStart:void 0}),fL=()=>gn.useContext(pL);Zi.forwardRef((e,t)=>{const{onDragStart:n}=fL(),s=e.as||"div";return Zi.createElement(s,{...e,ref:t,"data-node-view-wrapper":"",onDragStart:n,style:{whiteSpace:"normal",...e.style}})});const mL=/^\s*>\s$/,gL=_r.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:e}){return["blockquote",Ji(this.options.HTMLAttributes,e),0]},addCommands(){return{setBlockquote:()=>({commands:e})=>e.wrapIn(this.name),toggleBlockquote:()=>({commands:e})=>e.toggleWrap(this.name),unsetBlockquote:()=>({commands:e})=>e.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[Jd({find:mL,type:this.type})]}}),yL=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,_L=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,vL=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,xL=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,wL=qa.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:e=>e.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:e=>e.type.name===this.name},{style:"font-weight",getAttrs:e=>/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}]},renderHTML({HTMLAttributes:e}){return["strong",Ji(this.options.HTMLAttributes,e),0]},addCommands(){return{setBold:()=>({commands:e})=>e.setMark(this.name),toggleBold:()=>({commands:e})=>e.toggleMark(this.name),unsetBold:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[Fu({find:yL,type:this.type}),Fu({find:vL,type:this.type})]},addPasteRules(){return[Nu({find:_L,type:this.type}),Nu({find:xL,type:this.type})]}}),bL="listItem",iS="textStyle",rS=/^\s*([-+*])\s$/,SL=_r.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:e}){return["ul",Ji(this.options.HTMLAttributes,e),0]},addCommands(){return{toggleBulletList:()=>({commands:e,chain:t})=>this.options.keepAttributes?t().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(bL,this.editor.getAttributes(iS)).run():e.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let e=Jd({find:rS,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(e=Jd({find:rS,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(iS),editor:this.editor})),[e]}}),kL=/(?:^|\s)(`(?!\s+`)((?:[^`]+))`(?!\s+`))$/,TL=/(?:^|\s)(`(?!\s+`)((?:[^`]+))`(?!\s+`))/g,CL=qa.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:e}){return["code",Ji(this.options.HTMLAttributes,e),0]},addCommands(){return{setCode:()=>({commands:e})=>e.setMark(this.name),toggleCode:()=>({commands:e})=>e.toggleMark(this.name),unsetCode:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[Fu({find:kL,type:this.type})]},addPasteRules(){return[Nu({find:TL,type:this.type})]}}),ML=/^```([a-z]+)?[\s\n]$/,EL=/^~~~([a-z]+)?[\s\n]$/,IL=_r.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:e=>{var t;const{languageClassPrefix:n}=this.options,u=[...((t=e.firstElementChild)===null||t===void 0?void 0:t.classList)||[]].filter(d=>d.startsWith(n)).map(d=>d.replace(n,""))[0];return u||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:e,HTMLAttributes:t}){return["pre",Ji(this.options.HTMLAttributes,t),["code",{class:e.attrs.language?this.options.languageClassPrefix+e.attrs.language:null},0]]},addCommands(){return{setCodeBlock:e=>({commands:t})=>t.setNode(this.name,e),toggleCodeBlock:e=>({commands:t})=>t.toggleNode(this.name,"paragraph",e)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:e,$anchor:t}=this.editor.state.selection,n=t.pos===1;return!e||t.parent.type.name!==this.name?!1:n||!t.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:e})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:t}=e,{selection:n}=t,{$from:s,empty:a}=n;if(!a||s.parent.type!==this.type)return!1;const u=s.parentOffset===s.parent.nodeSize-2,d=s.parent.textContent.endsWith(`

`);return!u||!d?!1:e.chain().command(({tr:c})=>(c.delete(s.pos-2,s.pos),!0)).exitCode().run()},ArrowDown:({editor:e})=>{if(!this.options.exitOnArrowDown)return!1;const{state:t}=e,{selection:n,doc:s}=t,{$from:a,empty:u}=n;if(!u||a.parent.type!==this.type||!(a.parentOffset===a.parent.nodeSize-2))return!1;const c=a.after();return c===void 0?!1:s.nodeAt(c)?e.commands.command(({tr:k})=>(k.setSelection(Et.near(s.resolve(c))),!0)):e.commands.exitCode()}}},addInputRules(){return[R0({find:ML,type:this.type,getAttributes:e=>({language:e[1]})}),R0({find:EL,type:this.type,getAttributes:e=>({language:e[1]})})]},addProseMirrorPlugins(){return[new er({key:new Js("codeBlockVSCodeHandler"),props:{handlePaste:(e,t)=>{if(!t.clipboardData||this.editor.isActive(this.type.name))return!1;const n=t.clipboardData.getData("text/plain"),s=t.clipboardData.getData("vscode-editor-data"),a=s?JSON.parse(s):void 0,u=a==null?void 0:a.mode;if(!n||!u)return!1;const{tr:d,schema:c}=e.state,w=c.text(n.replace(/\r\n?/g,`
`));return d.replaceSelectionWith(this.type.create({language:u},w)),d.selection.$from.parent.type!==this.type&&d.setSelection(kt.near(d.doc.resolve(Math.max(0,d.selection.from-2)))),d.setMeta("paste",!0),e.dispatch(d),!0}}})]}}),PL=_r.create({name:"doc",topNode:!0,content:"block+"});function AL(e={}){return new er({view(t){return new zL(t,e)}})}class zL{constructor(t,n){var s;this.editorView=t,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(s=n.width)!==null&&s!==void 0?s:1,this.color=n.color===!1?void 0:n.color||"black",this.class=n.class,this.handlers=["dragover","dragend","drop","dragleave"].map(a=>{let u=d=>{this[a](d)};return t.dom.addEventListener(a,u),{name:a,handler:u}})}destroy(){this.handlers.forEach(({name:t,handler:n})=>this.editorView.dom.removeEventListener(t,n))}update(t,n){this.cursorPos!=null&&n.doc!=t.state.doc&&(this.cursorPos>t.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(t){t!=this.cursorPos&&(this.cursorPos=t,t==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let t=this.editorView.state.doc.resolve(this.cursorPos),n=!t.parent.inlineContent,s;if(n){let c=t.nodeBefore,w=t.nodeAfter;if(c||w){let k=this.editorView.nodeDOM(this.cursorPos-(c?c.nodeSize:0));if(k){let E=k.getBoundingClientRect(),P=c?E.bottom:E.top;c&&w&&(P=(P+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),s={left:E.left,right:E.right,top:P-this.width/2,bottom:P+this.width/2}}}}if(!s){let c=this.editorView.coordsAtPos(this.cursorPos);s={left:c.left-this.width/2,right:c.left+this.width/2,top:c.top,bottom:c.bottom}}let a=this.editorView.dom.offsetParent;this.element||(this.element=a.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n);let u,d;if(!a||a==document.body&&getComputedStyle(a).position=="static")u=-pageXOffset,d=-pageYOffset;else{let c=a.getBoundingClientRect();u=c.left-a.scrollLeft,d=c.top-a.scrollTop}this.element.style.left=s.left-u+"px",this.element.style.top=s.top-d+"px",this.element.style.width=s.right-s.left+"px",this.element.style.height=s.bottom-s.top+"px"}scheduleRemoval(t){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),t)}dragover(t){if(!this.editorView.editable)return;let n=this.editorView.posAtCoords({left:t.clientX,top:t.clientY}),s=n&&n.inside>=0&&this.editorView.state.doc.nodeAt(n.inside),a=s&&s.type.spec.disableDropCursor,u=typeof a=="function"?a(this.editorView,n,t):a;if(n&&!u){let d=n.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let c=nT(this.editorView.state.doc,d,this.editorView.dragging.slice);c!=null&&(d=c)}this.setCursor(d),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(t){(t.target==this.editorView.dom||!this.editorView.dom.contains(t.relatedTarget))&&this.setCursor(null)}}const DL=Oi.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[AL(this.options)]}});class Mn extends Et{constructor(t){super(t,t)}map(t,n){let s=t.resolve(n.map(this.head));return Mn.valid(s)?new Mn(s):Et.near(s)}content(){return Qe.empty}eq(t){return t instanceof Mn&&t.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(t,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new Mn(t.resolve(n.pos))}getBookmark(){return new Jv(this.anchor)}static valid(t){let n=t.parent;if(n.isTextblock||!RL(t)||!OL(t))return!1;let s=n.type.spec.allowGapCursor;if(s!=null)return s;let a=n.contentMatchAt(t.index()).defaultType;return a&&a.isTextblock}static findGapCursorFrom(t,n,s=!1){e:for(;;){if(!s&&Mn.valid(t))return t;let a=t.pos,u=null;for(let d=t.depth;;d--){let c=t.node(d);if(n>0?t.indexAfter(d)<c.childCount:t.index(d)>0){u=c.child(n>0?t.indexAfter(d):t.index(d)-1);break}else if(d==0)return null;a+=n;let w=t.doc.resolve(a);if(Mn.valid(w))return w}for(;;){let d=n>0?u.firstChild:u.lastChild;if(!d){if(u.isAtom&&!u.isText&&!mt.isSelectable(u)){t=t.doc.resolve(a+u.nodeSize*n),s=!1;continue e}break}u=d,a+=n;let c=t.doc.resolve(a);if(Mn.valid(c))return c}return null}}}Mn.prototype.visible=!1;Mn.findFrom=Mn.findGapCursorFrom;Et.jsonID("gapcursor",Mn);class Jv{constructor(t){this.pos=t}map(t){return new Jv(t.map(this.pos))}resolve(t){let n=t.resolve(this.pos);return Mn.valid(n)?new Mn(n):Et.near(n)}}function RL(e){for(let t=e.depth;t>=0;t--){let n=e.index(t),s=e.node(t);if(n==0){if(s.type.spec.isolating)return!0;continue}for(let a=s.child(n-1);;a=a.lastChild){if(a.childCount==0&&!a.inlineContent||a.isAtom||a.type.spec.isolating)return!0;if(a.inlineContent)return!1}}return!0}function OL(e){for(let t=e.depth;t>=0;t--){let n=e.indexAfter(t),s=e.node(t);if(n==s.childCount){if(s.type.spec.isolating)return!0;continue}for(let a=s.child(n);;a=a.firstChild){if(a.childCount==0&&!a.inlineContent||a.isAtom||a.type.spec.isolating)return!0;if(a.inlineContent)return!1}}return!0}function LL(){return new er({props:{decorations:VL,createSelectionBetween(e,t,n){return t.pos==n.pos&&Mn.valid(n)?new Mn(n):null},handleClick:FL,handleKeyDown:BL,handleDOMEvents:{beforeinput:NL}}})}const BL=UT({ArrowLeft:zf("horiz",-1),ArrowRight:zf("horiz",1),ArrowUp:zf("vert",-1),ArrowDown:zf("vert",1)});function zf(e,t){const n=e=="vert"?t>0?"down":"up":t>0?"right":"left";return function(s,a,u){let d=s.selection,c=t>0?d.$to:d.$from,w=d.empty;if(d instanceof kt){if(!u.endOfTextblock(n)||c.depth==0)return!1;w=!1,c=s.doc.resolve(t>0?c.after():c.before())}let k=Mn.findGapCursorFrom(c,t,w);return k?(a&&a(s.tr.setSelection(new Mn(k))),!0):!1}}function FL(e,t,n){if(!e||!e.editable)return!1;let s=e.state.doc.resolve(t);if(!Mn.valid(s))return!1;let a=e.posAtCoords({left:n.clientX,top:n.clientY});return a&&a.inside>-1&&mt.isSelectable(e.state.doc.nodeAt(a.inside))?!1:(e.dispatch(e.state.tr.setSelection(new Mn(s))),!0)}function NL(e,t){if(t.inputType!="insertCompositionText"||!(e.state.selection instanceof Mn))return!1;let{$from:n}=e.state.selection,s=n.parent.contentMatchAt(n.index()).findWrapping(e.state.schema.nodes.text);if(!s)return!1;let a=Ae.empty;for(let d=s.length-1;d>=0;d--)a=Ae.from(s[d].createAndFill(null,a));let u=e.state.tr.replace(n.pos,n.pos,new Qe(a,0,0));return u.setSelection(kt.near(u.doc.resolve(n.pos+1))),e.dispatch(u),!1}function VL(e){if(!(e.selection instanceof Mn))return null;let t=document.createElement("div");return t.className="ProseMirror-gapcursor",Ln.create(e.doc,[Fr.widget(e.selection.head,t,{key:"gapcursor"})])}const $L=Oi.create({name:"gapCursor",addProseMirrorPlugins(){return[LL()]},extendNodeSchema(e){var t;const n={name:e.name,options:e.options,storage:e.storage};return{allowGapCursor:(t=At(ot(e,"allowGapCursor",n)))!==null&&t!==void 0?t:null}}}),jL=_r.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:e}){return["br",Ji(this.options.HTMLAttributes,e)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:e,chain:t,state:n,editor:s})=>e.first([()=>e.exitCode(),()=>e.command(()=>{const{selection:a,storedMarks:u}=n;if(a.$from.parent.type.spec.isolating)return!1;const{keepMarks:d}=this.options,{splittableMarks:c}=s.extensionManager,w=u||a.$to.parentOffset&&a.$from.marks();return t().insertContent({type:this.name}).command(({tr:k,dispatch:E})=>{if(E&&w&&d){const P=w.filter(A=>c.includes(A.type.name));k.ensureMarks(P)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),UL=_r.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(e=>({tag:`h${e}`,attrs:{level:e}}))},renderHTML({node:e,HTMLAttributes:t}){return[`h${this.options.levels.includes(e.attrs.level)?e.attrs.level:this.options.levels[0]}`,Ji(this.options.HTMLAttributes,t),0]},addCommands(){return{setHeading:e=>({commands:t})=>this.options.levels.includes(e.level)?t.setNode(this.name,e):!1,toggleHeading:e=>({commands:t})=>this.options.levels.includes(e.level)?t.toggleNode(this.name,"paragraph",e):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((e,t)=>({...e,[`Mod-Alt-${t}`]:()=>this.editor.commands.toggleHeading({level:t})}),{})},addInputRules(){return this.options.levels.map(e=>R0({find:new RegExp(`^(#{1,${e}})\\s$`),type:this.type,getAttributes:{level:e}}))}});var Lm=200,ii=function(){};ii.prototype.append=function(t){return t.length?(t=ii.from(t),!this.length&&t||t.length<Lm&&this.leafAppend(t)||this.length<Lm&&t.leafPrepend(this)||this.appendInner(t)):this};ii.prototype.prepend=function(t){return t.length?ii.from(t).append(this):this};ii.prototype.appendInner=function(t){return new qL(this,t)};ii.prototype.slice=function(t,n){return t===void 0&&(t=0),n===void 0&&(n=this.length),t>=n?ii.empty:this.sliceInner(Math.max(0,t),Math.min(this.length,n))};ii.prototype.get=function(t){if(!(t<0||t>=this.length))return this.getInner(t)};ii.prototype.forEach=function(t,n,s){n===void 0&&(n=0),s===void 0&&(s=this.length),n<=s?this.forEachInner(t,n,s,0):this.forEachInvertedInner(t,n,s,0)};ii.prototype.map=function(t,n,s){n===void 0&&(n=0),s===void 0&&(s=this.length);var a=[];return this.forEach(function(u,d){return a.push(t(u,d))},n,s),a};ii.from=function(t){return t instanceof ii?t:t&&t.length?new cC(t):ii.empty};var cC=function(e){function t(s){e.call(this),this.values=s}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={length:{configurable:!0},depth:{configurable:!0}};return t.prototype.flatten=function(){return this.values},t.prototype.sliceInner=function(a,u){return a==0&&u==this.length?this:new t(this.values.slice(a,u))},t.prototype.getInner=function(a){return this.values[a]},t.prototype.forEachInner=function(a,u,d,c){for(var w=u;w<d;w++)if(a(this.values[w],c+w)===!1)return!1},t.prototype.forEachInvertedInner=function(a,u,d,c){for(var w=u-1;w>=d;w--)if(a(this.values[w],c+w)===!1)return!1},t.prototype.leafAppend=function(a){if(this.length+a.length<=Lm)return new t(this.values.concat(a.flatten()))},t.prototype.leafPrepend=function(a){if(this.length+a.length<=Lm)return new t(a.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(t.prototype,n),t}(ii);ii.empty=new cC([]);var qL=function(e){function t(n,s){e.call(this),this.left=n,this.right=s,this.length=n.length+s.length,this.depth=Math.max(n.depth,s.depth)+1}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},t.prototype.getInner=function(s){return s<this.left.length?this.left.get(s):this.right.get(s-this.left.length)},t.prototype.forEachInner=function(s,a,u,d){var c=this.left.length;if(a<c&&this.left.forEachInner(s,a,Math.min(u,c),d)===!1||u>c&&this.right.forEachInner(s,Math.max(a-c,0),Math.min(this.length,u)-c,d+c)===!1)return!1},t.prototype.forEachInvertedInner=function(s,a,u,d){var c=this.left.length;if(a>c&&this.right.forEachInvertedInner(s,a-c,Math.max(u,c)-c,d+c)===!1||u<c&&this.left.forEachInvertedInner(s,Math.min(a,c),u,d)===!1)return!1},t.prototype.sliceInner=function(s,a){if(s==0&&a==this.length)return this;var u=this.left.length;return a<=u?this.left.slice(s,a):s>=u?this.right.slice(s-u,a-u):this.left.slice(s,u).append(this.right.slice(0,a-u))},t.prototype.leafAppend=function(s){var a=this.right.leafAppend(s);if(a)return new t(this.left,a)},t.prototype.leafPrepend=function(s){var a=this.left.leafPrepend(s);if(a)return new t(a,this.right)},t.prototype.appendInner=function(s){return this.left.depth>=Math.max(this.right.depth,s.depth)+1?new t(this.left,new t(this.right,s)):new t(this,s)},t}(ii);const HL=500;class Ss{constructor(t,n){this.items=t,this.eventCount=n}popEvent(t,n){if(this.eventCount==0)return null;let s=this.items.length;for(;;s--)if(this.items.get(s-1).selection){--s;break}let a,u;n&&(a=this.remapping(s,this.items.length),u=a.maps.length);let d=t.tr,c,w,k=[],E=[];return this.items.forEach((P,A)=>{if(!P.step){a||(a=this.remapping(s,A+1),u=a.maps.length),u--,E.push(P);return}if(a){E.push(new qs(P.map));let $=P.step.map(a.slice(u)),j;$&&d.maybeStep($).doc&&(j=d.mapping.maps[d.mapping.maps.length-1],k.push(new qs(j,void 0,void 0,k.length+E.length))),u--,j&&a.appendMap(j,u)}else d.maybeStep(P.step);if(P.selection)return c=a?P.selection.map(a.slice(u)):P.selection,w=new Ss(this.items.slice(0,s).append(E.reverse().concat(k)),this.eventCount-1),!1},this.items.length,0),{remaining:w,transform:d,selection:c}}addTransform(t,n,s,a){let u=[],d=this.eventCount,c=this.items,w=!a&&c.length?c.get(c.length-1):null;for(let E=0;E<t.steps.length;E++){let P=t.steps[E].invert(t.docs[E]),A=new qs(t.mapping.maps[E],P,n),$;($=w&&w.merge(A))&&(A=$,E?u.pop():c=c.slice(0,c.length-1)),u.push(A),n&&(d++,n=void 0),a||(w=A)}let k=d-s.depth;return k>WL&&(c=ZL(c,k),d-=k),new Ss(c.append(u),d)}remapping(t,n){let s=new Su;return this.items.forEach((a,u)=>{let d=a.mirrorOffset!=null&&u-a.mirrorOffset>=t?s.maps.length-a.mirrorOffset:void 0;s.appendMap(a.map,d)},t,n),s}addMaps(t){return this.eventCount==0?this:new Ss(this.items.append(t.map(n=>new qs(n))),this.eventCount)}rebased(t,n){if(!this.eventCount)return this;let s=[],a=Math.max(0,this.items.length-n),u=t.mapping,d=t.steps.length,c=this.eventCount;this.items.forEach(A=>{A.selection&&c--},a);let w=n;this.items.forEach(A=>{let $=u.getMirror(--w);if($==null)return;d=Math.min(d,$);let j=u.maps[$];if(A.step){let X=t.steps[$].invert(t.docs[$]),he=A.selection&&A.selection.map(u.slice(w+1,$));he&&c++,s.push(new qs(j,X,he))}else s.push(new qs(j))},a);let k=[];for(let A=n;A<d;A++)k.push(new qs(u.maps[A]));let E=this.items.slice(0,a).append(k).append(s),P=new Ss(E,c);return P.emptyItemCount()>HL&&(P=P.compress(this.items.length-s.length)),P}emptyItemCount(){let t=0;return this.items.forEach(n=>{n.step||t++}),t}compress(t=this.items.length){let n=this.remapping(0,t),s=n.maps.length,a=[],u=0;return this.items.forEach((d,c)=>{if(c>=t)a.push(d),d.selection&&u++;else if(d.step){let w=d.step.map(n.slice(s)),k=w&&w.getMap();if(s--,k&&n.appendMap(k,s),w){let E=d.selection&&d.selection.map(n.slice(s));E&&u++;let P=new qs(k.invert(),w,E),A,$=a.length-1;(A=a.length&&a[$].merge(P))?a[$]=A:a.push(P)}}else d.map&&s--},this.items.length,0),new Ss(ii.from(a.reverse()),u)}}Ss.empty=new Ss(ii.empty,0);function ZL(e,t){let n;return e.forEach((s,a)=>{if(s.selection&&t--==0)return n=a,!1}),e.slice(n)}class qs{constructor(t,n,s,a){this.map=t,this.step=n,this.selection=s,this.mirrorOffset=a}merge(t){if(this.step&&t.step&&!t.selection){let n=t.step.merge(this.step);if(n)return new qs(n.getMap().invert(),n,this.selection)}}}class va{constructor(t,n,s,a,u){this.done=t,this.undone=n,this.prevRanges=s,this.prevTime=a,this.prevComposition=u}}const WL=20;function GL(e,t,n,s){let a=n.getMeta(Hl),u;if(a)return a.historyState;n.getMeta(JL)&&(e=new va(e.done,e.undone,null,0,-1));let d=n.getMeta("appendedTransaction");if(n.steps.length==0)return e;if(d&&d.getMeta(Hl))return d.getMeta(Hl).redo?new va(e.done.addTransform(n,void 0,s,Kf(t)),e.undone,sS(n.mapping.maps),e.prevTime,e.prevComposition):new va(e.done,e.undone.addTransform(n,void 0,s,Kf(t)),null,e.prevTime,e.prevComposition);if(n.getMeta("addToHistory")!==!1&&!(d&&d.getMeta("addToHistory")===!1)){let c=n.getMeta("composition"),w=e.prevTime==0||!d&&e.prevComposition!=c&&(e.prevTime<(n.time||0)-s.newGroupDelay||!KL(n,e.prevRanges)),k=d?x_(e.prevRanges,n.mapping):sS(n.mapping.maps);return new va(e.done.addTransform(n,w?t.selection.getBookmark():void 0,s,Kf(t)),Ss.empty,k,n.time,c??e.prevComposition)}else return(u=n.getMeta("rebased"))?new va(e.done.rebased(n,u),e.undone.rebased(n,u),x_(e.prevRanges,n.mapping),e.prevTime,e.prevComposition):new va(e.done.addMaps(n.mapping.maps),e.undone.addMaps(n.mapping.maps),x_(e.prevRanges,n.mapping),e.prevTime,e.prevComposition)}function KL(e,t){if(!t)return!1;if(!e.docChanged)return!0;let n=!1;return e.mapping.maps[0].forEach((s,a)=>{for(let u=0;u<t.length;u+=2)s<=t[u+1]&&a>=t[u]&&(n=!0)}),n}function sS(e){let t=[];for(let n=e.length-1;n>=0&&t.length==0;n--)e[n].forEach((s,a,u,d)=>t.push(u,d));return t}function x_(e,t){if(!e)return null;let n=[];for(let s=0;s<e.length;s+=2){let a=t.map(e[s],1),u=t.map(e[s+1],-1);a<=u&&n.push(a,u)}return n}function XL(e,t,n){let s=Kf(t),a=Hl.get(t).spec.config,u=(n?e.undone:e.done).popEvent(t,s);if(!u)return null;let d=u.selection.resolve(u.transform.doc),c=(n?e.done:e.undone).addTransform(u.transform,t.selection.getBookmark(),a,s),w=new va(n?c:u.remaining,n?u.remaining:c,null,0,-1);return u.transform.setSelection(d).setMeta(Hl,{redo:n,historyState:w})}let w_=!1,oS=null;function Kf(e){let t=e.plugins;if(oS!=t){w_=!1,oS=t;for(let n=0;n<t.length;n++)if(t[n].spec.historyPreserveItems){w_=!0;break}}return w_}const Hl=new Js("history"),JL=new Js("closeHistory");function YL(e={}){return e={depth:e.depth||100,newGroupDelay:e.newGroupDelay||500},new er({key:Hl,state:{init(){return new va(Ss.empty,Ss.empty,null,0,-1)},apply(t,n,s){return GL(n,s,t,e)}},config:e,props:{handleDOMEvents:{beforeinput(t,n){let s=n.inputType,a=s=="historyUndo"?hC:s=="historyRedo"?dC:null;return a?(n.preventDefault(),a(t.state,t.dispatch)):!1}}}})}function uC(e,t){return(n,s)=>{let a=Hl.getState(n);if(!a||(e?a.undone:a.done).eventCount==0)return!1;if(s){let u=XL(a,n,e);u&&s(t?u.scrollIntoView():u)}return!0}}const hC=uC(!1,!0),dC=uC(!0,!0),QL=Oi.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:e,dispatch:t})=>hC(e,t),redo:()=>({state:e,dispatch:t})=>dC(e,t)}},addProseMirrorPlugins(){return[YL(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-":()=>this.editor.commands.undo(),"Shift-Mod-":()=>this.editor.commands.redo()}}}),eB=_r.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:e}){return["hr",Ji(this.options.HTMLAttributes,e)]},addCommands(){return{setHorizontalRule:()=>({chain:e,state:t})=>{const{selection:n}=t,{$from:s,$to:a}=n,u=e();return s.parentOffset===0?u.insertContentAt({from:Math.max(s.pos-1,0),to:a.pos},{type:this.name}):gO(n)?u.insertContentAt(a.pos,{type:this.name}):u.insertContent({type:this.name}),u.command(({tr:d,dispatch:c})=>{var w;if(c){const{$to:k}=d.selection,E=k.end();if(k.nodeAfter)k.nodeAfter.isTextblock?d.setSelection(kt.create(d.doc,k.pos+1)):k.nodeAfter.isBlock?d.setSelection(mt.create(d.doc,k.pos)):d.setSelection(kt.create(d.doc,k.pos));else{const P=(w=k.parent.type.contentMatch.defaultType)===null||w===void 0?void 0:w.create();P&&(d.insert(E,P),d.setSelection(kt.create(d.doc,E+1)))}d.scrollIntoView()}return!0}).run()}}},addInputRules(){return[WO({find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type})]}}),tB=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,nB=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,iB=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,rB=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,sB=qa.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:e=>e.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:e=>e.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:e}){return["em",Ji(this.options.HTMLAttributes,e),0]},addCommands(){return{setItalic:()=>({commands:e})=>e.setMark(this.name),toggleItalic:()=>({commands:e})=>e.toggleMark(this.name),unsetItalic:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[Fu({find:tB,type:this.type}),Fu({find:iB,type:this.type})]},addPasteRules(){return[Nu({find:nB,type:this.type}),Nu({find:rB,type:this.type})]}}),oB=_r.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:e}){return["li",Ji(this.options.HTMLAttributes,e),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),aB="listItem",aS="textStyle",lS=/^(\d+)\.\s$/,lB=_r.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:e=>e.hasAttribute("start")?parseInt(e.getAttribute("start")||"",10):1},type:{default:void 0,parseHTML:e=>e.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:e}){const{start:t,...n}=e;return t===1?["ol",Ji(this.options.HTMLAttributes,n),0]:["ol",Ji(this.options.HTMLAttributes,e),0]},addCommands(){return{toggleOrderedList:()=>({commands:e,chain:t})=>this.options.keepAttributes?t().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(aB,this.editor.getAttributes(aS)).run():e.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let e=Jd({find:lS,type:this.type,getAttributes:t=>({start:+t[1]}),joinPredicate:(t,n)=>n.childCount+n.attrs.start===+t[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(e=Jd({find:lS,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:t=>({start:+t[1],...this.editor.getAttributes(aS)}),joinPredicate:(t,n)=>n.childCount+n.attrs.start===+t[1],editor:this.editor})),[e]}}),cB=_r.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:e}){return["p",Ji(this.options.HTMLAttributes,e),0]},addCommands(){return{setParagraph:()=>({commands:e})=>e.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),uB=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,hB=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,dB=qa.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:e=>e.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:e}){return["s",Ji(this.options.HTMLAttributes,e),0]},addCommands(){return{setStrike:()=>({commands:e})=>e.setMark(this.name),toggleStrike:()=>({commands:e})=>e.toggleMark(this.name),unsetStrike:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[Fu({find:uB,type:this.type})]},addPasteRules(){return[Nu({find:hB,type:this.type})]}}),pB=_r.create({name:"text",group:"inline"}),fB=Oi.create({name:"starterKit",addExtensions(){var e,t,n,s,a,u,d,c,w,k,E,P,A,$,j,X,he,K;const J=[];return this.options.bold!==!1&&J.push(wL.configure((e=this.options)===null||e===void 0?void 0:e.bold)),this.options.blockquote!==!1&&J.push(gL.configure((t=this.options)===null||t===void 0?void 0:t.blockquote)),this.options.bulletList!==!1&&J.push(SL.configure((n=this.options)===null||n===void 0?void 0:n.bulletList)),this.options.code!==!1&&J.push(CL.configure((s=this.options)===null||s===void 0?void 0:s.code)),this.options.codeBlock!==!1&&J.push(IL.configure((a=this.options)===null||a===void 0?void 0:a.codeBlock)),this.options.document!==!1&&J.push(PL.configure((u=this.options)===null||u===void 0?void 0:u.document)),this.options.dropcursor!==!1&&J.push(DL.configure((d=this.options)===null||d===void 0?void 0:d.dropcursor)),this.options.gapcursor!==!1&&J.push($L.configure((c=this.options)===null||c===void 0?void 0:c.gapcursor)),this.options.hardBreak!==!1&&J.push(jL.configure((w=this.options)===null||w===void 0?void 0:w.hardBreak)),this.options.heading!==!1&&J.push(UL.configure((k=this.options)===null||k===void 0?void 0:k.heading)),this.options.history!==!1&&J.push(QL.configure((E=this.options)===null||E===void 0?void 0:E.history)),this.options.horizontalRule!==!1&&J.push(eB.configure((P=this.options)===null||P===void 0?void 0:P.horizontalRule)),this.options.italic!==!1&&J.push(sB.configure((A=this.options)===null||A===void 0?void 0:A.italic)),this.options.listItem!==!1&&J.push(oB.configure(($=this.options)===null||$===void 0?void 0:$.listItem)),this.options.orderedList!==!1&&J.push(lB.configure((j=this.options)===null||j===void 0?void 0:j.orderedList)),this.options.paragraph!==!1&&J.push(cB.configure((X=this.options)===null||X===void 0?void 0:X.paragraph)),this.options.strike!==!1&&J.push(dB.configure((he=this.options)===null||he===void 0?void 0:he.strike)),this.options.text!==!1&&J.push(pB.configure((K=this.options)===null||K===void 0?void 0:K.text)),J}});function mB(e){let t;return function(n,...s){clearTimeout(t),t=setTimeout(()=>{n(...s)},e)}}const gB=Oi.create({name:"highlightedLocations",addProseMirrorPlugins(){return[new er({props:{decorations:({doc:e})=>{const t=[],n=/@([^@]+)@/g;return e.descendants((s,a)=>{if(s.isText){let u;for(;s.text!==void 0&&(u=n.exec(s.text))!==null;){const d=a+u.index,c=d+u[0].length;t.push(Fr.inline(d,c,{class:"highlight"}))}}}),Ln.create(e,t)}}})]}}),yB=[fB,gB],_B=`
{"type":"doc","content":[
  {"type":"paragraph","content":[{"type":"text","text":"Hello Traveller!"}]},
  {"type":"paragraph","content":[{"type":"text","text":"Use 'at' symbols surrounding a location to set a marker, e.g., @London@, and tildes surrounding a set of markers to specify an route, e.g., one day of your trip!"}]}
]}
`,vB=mB(2e3);function xB({onTextChange:e}){const t=hL({extensions:yB,content:JSON.parse(window.localStorage.getItem("editor-content")||_B),onUpdate:({editor:n})=>{vB(s=>{const a=JSON.stringify(s.getJSON());console.log(a),window.localStorage.setItem("editor-content",a);const u=s.getText();console.log(u),e(u)},n)},onCreate:({editor:n})=>{const s=n.getText();console.log("OnCreate",s),e(s)}});return hr.jsx(hr.Fragment,{children:hr.jsx(tL,{editor:t})})}var pC={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */(function(e,t){(function(n,s){e.exports=s()})(kE,function(){var n={},s={};function a(d,c,w){if(s[d]=w,d==="index"){var k="var sharedModule = {}; ("+s.shared+")(sharedModule); ("+s.worker+")(sharedModule);",E={};return s.shared(E),s.index(n,E),typeof window<"u"&&n.setWorkerUrl(window.URL.createObjectURL(new Blob([k],{type:"text/javascript"}))),n}}a("shared",["exports"],function(d){function c(o,r,l,p){return new(l||(l=Promise))(function(g,v){function x(I){try{T(p.next(I))}catch(z){v(z)}}function b(I){try{T(p.throw(I))}catch(z){v(z)}}function T(I){var z;I.done?g(I.value):(z=I.value,z instanceof l?z:new l(function(R){R(z)})).then(x,b)}T((p=p.apply(o,r||[])).next())})}function w(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}typeof SuppressedError=="function"&&SuppressedError;var k=E;function E(o,r){this.x=o,this.y=r}E.prototype={clone:function(){return new E(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,r){return this.clone()._rotateAround(o,r)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var r=o.x-this.x,l=o.y-this.y;return r*r+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,r){return Math.atan2(this.x*r-this.y*o,this.x*o+this.y*r)},_matMult:function(o){var r=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=r,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var r=Math.cos(o),l=Math.sin(o),p=l*this.x+r*this.y;return this.x=r*this.x-l*this.y,this.y=p,this},_rotateAround:function(o,r){var l=Math.cos(o),p=Math.sin(o),g=r.y+p*(this.x-r.x)+l*(this.y-r.y);return this.x=r.x+l*(this.x-r.x)-p*(this.y-r.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},E.convert=function(o){return o instanceof E?o:Array.isArray(o)?new E(o[0],o[1]):o};var P=w(k),A=$;function $(o,r,l,p){this.cx=3*o,this.bx=3*(l-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(p-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=r,this.p2x=l,this.p2y=p}$.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,r){if(r===void 0&&(r=1e-6),o<0)return 0;if(o>1)return 1;for(var l=o,p=0;p<8;p++){var g=this.sampleCurveX(l)-o;if(Math.abs(g)<r)return l;var v=this.sampleCurveDerivativeX(l);if(Math.abs(v)<1e-6)break;l-=g/v}var x=0,b=1;for(l=o,p=0;p<20&&(g=this.sampleCurveX(l),!(Math.abs(g-o)<r));p++)o>g?x=l:b=l,l=.5*(b-x)+x;return l},solve:function(o,r){return this.sampleCurveY(this.solveCurveX(o,r))}};var j=w(A);let X,he;function K(){return X==null&&(X=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),X}function J(){if(he==null&&(he=!1,K())){const r=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(r){for(let p=0;p<5*5;p++){const g=4*p;r.fillStyle=`rgb(${g},${g+1},${g+2})`,r.fillRect(p%5,Math.floor(p/5),1,1)}const l=r.getImageData(0,0,5,5).data;for(let p=0;p<5*5*4;p++)if(p%4!=3&&l[p]!==p){he=!0;break}}}return he||!1}function le(o,r,l,p){const g=new j(o,r,l,p);return v=>g.solve(v)}const Se=le(.25,.1,.25,1);function Me(o,r,l){return Math.min(l,Math.max(r,o))}function Ee(o,r,l){const p=l-r,g=((o-r)%p+p)%p+r;return g===r?l:g}function De(o,...r){for(const l of r)for(const p in l)o[p]=l[p];return o}let Ze=1;function tt(o,r,l){const p={};for(const g in o)p[g]=r.call(this,o[g],g,o);return p}function ft(o,r,l){const p={};for(const g in o)r.call(this,o[g],g,o)&&(p[g]=o[g]);return p}function xt(o){return Array.isArray(o)?o.map(xt):typeof o=="object"&&o?tt(o,xt):o}const tr={};function dn(o){tr[o]||(typeof console<"u"&&console.warn(o),tr[o]=!0)}function Pn(o,r,l){return(l.y-o.y)*(r.x-o.x)>(r.y-o.y)*(l.x-o.x)}function vr(o){return typeof WorkerGlobalScope<"u"&&o!==void 0&&o instanceof WorkerGlobalScope}let Ur=null;function yi(o){return typeof ImageBitmap<"u"&&o instanceof ImageBitmap}const Xe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function gt(o,r,l,p,g){return c(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const v=new VideoFrame(o,{timestamp:0});try{const x=v==null?void 0:v.format;if(!x||!x.startsWith("BGR")&&!x.startsWith("RGB"))throw new Error(`Unrecognized format ${x}`);const b=x.startsWith("BGR"),T=new Uint8ClampedArray(p*g*4);if(yield v.copyTo(T,function(I,z,R,B,V){const q=4*Math.max(-z,0),H=(Math.max(0,R)-R)*B*4+q,Q=4*B,ie=Math.max(0,z),ye=Math.max(0,R);return{rect:{x:ie,y:ye,width:Math.min(I.width,z+B)-ie,height:Math.min(I.height,R+V)-ye},layout:[{offset:H,stride:Q}]}}(o,r,l,p,g)),b)for(let I=0;I<T.length;I+=4){const z=T[I];T[I]=T[I+2],T[I+2]=z}return T}finally{v.close()}})}let yt,zt;const jt="AbortError";function xr(){return new Error(jt)}const qn={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function _i(o){return qn.REGISTERED_PROTOCOLS[o.substring(0,o.indexOf("://"))]}const vi="global-dispatcher";class An extends Error{constructor(r,l,p,g){super(`AJAXError: ${l} (${r}): ${p}`),this.status=r,this.statusText=l,this.url=p,this.body=g}}const wr=()=>vr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Ys=function(o,r){if(/:\/\//.test(o.url)&&!/^https?:|^file:/.test(o.url)){const p=_i(o.url);if(p)return p(o,r);if(vr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:o,targetMapId:vi},r)}if(!(/^file:/.test(l=o.url)||/^file:/.test(wr())&&!/^\w+:/.test(l))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(p,g){return c(this,void 0,void 0,function*(){const v=new Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,cache:p.cache,referrer:wr(),signal:g.signal});p.type!=="json"||v.headers.has("Accept")||v.headers.set("Accept","application/json");const x=yield fetch(v);if(!x.ok){const I=yield x.blob();throw new An(x.status,x.statusText,p.url,I)}let b;b=p.type==="arrayBuffer"||p.type==="image"?x.arrayBuffer():p.type==="json"?x.json():x.text();const T=yield b;if(g.signal.aborted)throw xr();return{data:T,cacheControl:x.headers.get("Cache-Control"),expires:x.headers.get("Expires")}})}(o,r);if(vr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:o,mustQueue:!0,targetMapId:vi},r)}var l;return function(p,g){return new Promise((v,x)=>{var b;const T=new XMLHttpRequest;T.open(p.method||"GET",p.url,!0),p.type!=="arrayBuffer"&&p.type!=="image"||(T.responseType="arraybuffer");for(const I in p.headers)T.setRequestHeader(I,p.headers[I]);p.type==="json"&&(T.responseType="text",!((b=p.headers)===null||b===void 0)&&b.Accept||T.setRequestHeader("Accept","application/json")),T.withCredentials=p.credentials==="include",T.onerror=()=>{x(new Error(T.statusText))},T.onload=()=>{if(!g.signal.aborted)if((T.status>=200&&T.status<300||T.status===0)&&T.response!==null){let I=T.response;if(p.type==="json")try{I=JSON.parse(T.response)}catch(z){return void x(z)}v({data:I,cacheControl:T.getResponseHeader("Cache-Control"),expires:T.getResponseHeader("Expires")})}else{const I=new Blob([T.response],{type:T.getResponseHeader("Content-Type")});x(new An(T.status,T.statusText,p.url,I))}},g.signal.addEventListener("abort",()=>{T.abort(),x(xr())}),T.send(p.body)})}(o,r)};function Qs(o){if(!o||o.indexOf("://")<=0||o.indexOf("data:image/")===0||o.indexOf("blob:")===0)return!0;const r=new URL(o),l=window.location;return r.protocol===l.protocol&&r.host===l.host}function Ja(o,r,l){l[o]&&l[o].indexOf(r)!==-1||(l[o]=l[o]||[],l[o].push(r))}function us(o,r,l){if(l&&l[o]){const p=l[o].indexOf(r);p!==-1&&l[o].splice(p,1)}}class Is{constructor(r,l={}){De(this,l),this.type=r}}class Ps extends Is{constructor(r,l={}){super("error",De({error:r},l))}}class zo{on(r,l){return this._listeners=this._listeners||{},Ja(r,l,this._listeners),this}off(r,l){return us(r,l,this._listeners),us(r,l,this._oneTimeListeners),this}once(r,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},Ja(r,l,this._oneTimeListeners),this):new Promise(p=>this.once(r,p))}fire(r,l){typeof r=="string"&&(r=new Is(r,l||{}));const p=r.type;if(this.listens(p)){r.target=this;const g=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const b of g)b.call(this,r);const v=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const b of v)us(p,b,this._oneTimeListeners),b.call(this,r);const x=this._eventedParent;x&&(De(r,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(r))}else r instanceof Ps&&console.error(r.error);return this}listens(r){return this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r)}setEventedParent(r,l){return this._eventedParent=r,this._eventedParentData=l,this}}var xe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const eo=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ya(o,r){const l={};for(const p in o)p!=="ref"&&(l[p]=o[p]);return eo.forEach(p=>{p in r&&(l[p]=r[p])}),l}function Ft(o,r){if(Array.isArray(o)){if(!Array.isArray(r)||o.length!==r.length)return!1;for(let l=0;l<o.length;l++)if(!Ft(o[l],r[l]))return!1;return!0}if(typeof o=="object"&&o!==null&&r!==null){if(typeof r!="object"||Object.keys(o).length!==Object.keys(r).length)return!1;for(const l in o)if(!Ft(o[l],r[l]))return!1;return!0}return o===r}function an(o,r){o.push(r)}function Qa(o,r,l){an(l,{command:"addSource",args:[o,r[o]]})}function As(o,r,l){an(r,{command:"removeSource",args:[o]}),l[o]=!0}function hs(o,r,l,p){As(o,l,p),Qa(o,r,l)}function Do(o,r,l){let p;for(p in o[l])if(Object.prototype.hasOwnProperty.call(o[l],p)&&p!=="data"&&!Ft(o[l][p],r[l][p]))return!1;for(p in r[l])if(Object.prototype.hasOwnProperty.call(r[l],p)&&p!=="data"&&!Ft(o[l][p],r[l][p]))return!1;return!0}function nr(o,r,l,p,g,v){o=o||{},r=r||{};for(const x in o)Object.prototype.hasOwnProperty.call(o,x)&&(Ft(o[x],r[x])||l.push({command:v,args:[p,x,r[x],g]}));for(const x in r)Object.prototype.hasOwnProperty.call(r,x)&&!Object.prototype.hasOwnProperty.call(o,x)&&(Ft(o[x],r[x])||l.push({command:v,args:[p,x,r[x],g]}))}function el(o){return o.id}function tl(o,r){return o[r.id]=r,o}class ze{constructor(r,l,p,g){this.message=(r?`${r}: `:"")+p,g&&(this.identifier=g),l!=null&&l.__line__&&(this.line=l.__line__)}}function qr(o,...r){for(const l of r)for(const p in l)o[p]=l[p];return o}class si extends Error{constructor(r,l){super(l),this.message=l,this.key=r}}class Hr{constructor(r,l=[]){this.parent=r,this.bindings={};for(const[p,g]of l)this.bindings[p]=g}concat(r){return new Hr(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const zs={kind:"null"},Fe={kind:"number"},bt={kind:"string"},ut={kind:"boolean"},xi={kind:"color"},br={kind:"object"},_t={kind:"value"},Zr={kind:"collator"},ds={kind:"formatted"},Ds={kind:"padding"},Wr={kind:"resolvedImage"},ne={kind:"variableAnchorOffsetCollection"};function N(o,r){return{kind:"array",itemType:o,N:r}}function F(o){if(o.kind==="array"){const r=F(o.itemType);return typeof o.N=="number"?`array<${r}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${r}>`}return o.kind}const W=[zs,Fe,bt,ut,xi,ds,br,N(_t),Ds,Wr,ne];function ee(o,r){if(r.kind==="error")return null;if(o.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!ee(o.itemType,r.itemType))&&(typeof o.N!="number"||o.N===r.N))return null}else{if(o.kind===r.kind)return null;if(o.kind==="value"){for(const l of W)if(!ee(l,r))return null}}return`Expected ${F(o)} but found ${F(r)} instead.`}function ue(o,r){return r.some(l=>l.kind===o.kind)}function pe(o,r){return r.some(l=>l==="null"?o===null:l==="array"?Array.isArray(o):l==="object"?o&&!Array.isArray(o)&&typeof o=="object":l===typeof o)}function ge(o,r){return o.kind==="array"&&r.kind==="array"?o.itemType.kind===r.itemType.kind&&typeof o.N=="number":o.kind===r.kind}const oe=.96422,be=.82521,Ce=4/29,ve=6/29,Oe=3*ve*ve,rt=ve*ve*ve,at=Math.PI/180,Dt=180/Math.PI;function vt(o){return(o%=360)<0&&(o+=360),o}function Rt([o,r,l,p]){let g,v;const x=Sn((.2225045*(o=Ct(o))+.7168786*(r=Ct(r))+.0606169*(l=Ct(l)))/1);o===r&&r===l?g=v=x:(g=Sn((.4360747*o+.3850649*r+.1430804*l)/oe),v=Sn((.0139322*o+.0971045*r+.7141733*l)/be));const b=116*x-16;return[b<0?0:b,500*(g-x),200*(x-v),p]}function Ct(o){return o<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function Sn(o){return o>rt?Math.pow(o,1/3):o/Oe+Ce}function ln([o,r,l,p]){let g=(o+16)/116,v=isNaN(r)?g:g+r/500,x=isNaN(l)?g:g-l/200;return g=1*Ut(g),v=oe*Ut(v),x=be*Ut(x),[St(3.1338561*v-1.6168667*g-.4906146*x),St(-.9787684*v+1.9161415*g+.033454*x),St(.0719453*v-.2289914*g+1.4052427*x),p]}function St(o){return(o=o<=.00304?12.92*o:1.055*Math.pow(o,1/2.4)-.055)<0?0:o>1?1:o}function Ut(o){return o>ve?o*o*o:Oe*(o-Ce)}function rn(o){return parseInt(o.padEnd(2,o),16)/255}function zn(o,r){return Nn(r?o/100:o,0,1)}function Nn(o,r,l){return Math.min(Math.max(r,o),l)}function oi(o){return!o.some(Number.isNaN)}const Ro={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class qt{constructor(r,l,p,g=1,v=!0){this.r=r,this.g=l,this.b=p,this.a=g,v||(this.r*=g,this.g*=g,this.b*=g,g||this.overwriteGetter("rgb",[r,l,p,g]))}static parse(r){if(r instanceof qt)return r;if(typeof r!="string")return;const l=function(p){if((p=p.toLowerCase().trim())==="transparent")return[0,0,0,0];const g=Ro[p];if(g){const[x,b,T]=g;return[x/255,b/255,T/255,1]}if(p.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(p)){const x=p.length<6?1:2;let b=1;return[rn(p.slice(b,b+=x)),rn(p.slice(b,b+=x)),rn(p.slice(b,b+=x)),rn(p.slice(b,b+x)||"ff")]}if(p.startsWith("rgb")){const x=p.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[b,T,I,z,R,B,V,q,H,Q,ie,ye]=x,ce=[z||" ",V||" ",Q].join("");if(ce==="  "||ce==="  /"||ce===",,"||ce===",,,"){const me=[I,B,H].join(""),we=me==="%%%"?100:me===""?255:0;if(we){const Ie=[Nn(+T/we,0,1),Nn(+R/we,0,1),Nn(+q/we,0,1),ie?zn(+ie,ye):1];if(oi(Ie))return Ie}}return}}const v=p.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(v){const[x,b,T,I,z,R,B,V,q]=v,H=[T||" ",z||" ",B].join("");if(H==="  "||H==="  /"||H===",,"||H===",,,"){const Q=[+b,Nn(+I,0,100),Nn(+R,0,100),V?zn(+V,q):1];if(oi(Q))return function([ie,ye,ce,me]){function we(Ie){const qe=(Ie+ie/30)%12,lt=ye*Math.min(ce,1-ce);return ce-lt*Math.max(-1,Math.min(qe-3,9-qe,1))}return ie=vt(ie),ye/=100,ce/=100,[we(0),we(8),we(4),me]}(Q)}}}(r);return l?new qt(...l,!1):void 0}get rgb(){const{r,g:l,b:p,a:g}=this,v=g||1/0;return this.overwriteGetter("rgb",[r/v,l/v,p/v,g])}get hcl(){return this.overwriteGetter("hcl",function(r){const[l,p,g,v]=Rt(r),x=Math.sqrt(p*p+g*g);return[Math.round(1e4*x)?vt(Math.atan2(g,p)*Dt):NaN,x,l,v]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Rt(this.rgb))}overwriteGetter(r,l){return Object.defineProperty(this,r,{value:l}),l}toString(){const[r,l,p,g]=this.rgb;return`rgba(${[r,l,p].map(v=>Math.round(255*v)).join(",")},${g})`}}qt.black=new qt(0,0,0,1),qt.white=new qt(1,1,1,1),qt.transparent=new qt(0,0,0,0),qt.red=new qt(1,0,0,1);class qu{constructor(r,l,p){this.sensitivity=r?l?"variant":"case":l?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,l){return this.collator.compare(r,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Hu{constructor(r,l,p,g,v){this.text=r,this.image=l,this.scale=p,this.fontStack=g,this.textColor=v}}class Bi{constructor(r){this.sections=r}static fromString(r){return new Bi([new Hu(r,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(r=>r.text.length!==0||r.image&&r.image.name.length!==0)}static factory(r){return r instanceof Bi?r:Bi.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map(r=>r.text).join("")}}class Fi{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof Fi)return r;if(typeof r=="number")return new Fi([r,r,r,r]);if(Array.isArray(r)&&!(r.length<1||r.length>4)){for(const l of r)if(typeof l!="number")return;switch(r.length){case 1:r=[r[0],r[0],r[0],r[0]];break;case 2:r=[r[0],r[1],r[0],r[1]];break;case 3:r=[r[0],r[1],r[2],r[1]]}return new Fi(r)}}toString(){return JSON.stringify(this.values)}}const pg=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class ir{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof ir)return r;if(Array.isArray(r)&&!(r.length<1)&&r.length%2==0){for(let l=0;l<r.length;l+=2){const p=r[l],g=r[l+1];if(typeof p!="string"||!pg.has(p)||!Array.isArray(g)||g.length!==2||typeof g[0]!="number"||typeof g[1]!="number")return}return new ir(r)}}toString(){return JSON.stringify(this.values)}}class Ni{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new Ni({name:r,available:!1}):null}}function Oo(o,r,l,p){return typeof o=="number"&&o>=0&&o<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof l=="number"&&l>=0&&l<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:`Invalid rgba value [${[o,r,l,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof p=="number"?[o,r,l,p]:[o,r,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function to(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof qt||o instanceof qu||o instanceof Bi||o instanceof Fi||o instanceof ir||o instanceof Ni)return!0;if(Array.isArray(o)){for(const r of o)if(!to(r))return!1;return!0}if(typeof o=="object"){for(const r in o)if(!to(o[r]))return!1;return!0}return!1}function kn(o){if(o===null)return zs;if(typeof o=="string")return bt;if(typeof o=="boolean")return ut;if(typeof o=="number")return Fe;if(o instanceof qt)return xi;if(o instanceof qu)return Zr;if(o instanceof Bi)return ds;if(o instanceof Fi)return Ds;if(o instanceof ir)return ne;if(o instanceof Ni)return Wr;if(Array.isArray(o)){const r=o.length;let l;for(const p of o){const g=kn(p);if(l){if(l===g)continue;l=_t;break}l=g}return N(l||_t,r)}return br}function nl(o){const r=typeof o;return o===null?"":r==="string"||r==="number"||r==="boolean"?String(o):o instanceof qt||o instanceof Bi||o instanceof Fi||o instanceof ir||o instanceof Ni?o.toString():JSON.stringify(o)}class Sr{constructor(r,l){this.type=r,this.value=l}static parse(r,l){if(r.length!==2)return l.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!to(r[1]))return l.error("invalid value");const p=r[1];let g=kn(p);const v=l.expectedType;return g.kind!=="array"||g.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(g=v),new Sr(g,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class _n{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}}const rc={string:bt,number:Fe,boolean:ut,object:br};class kr{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");let p,g=1;const v=r[0];if(v==="array"){let b,T;if(r.length>2){const I=r[1];if(typeof I!="string"||!(I in rc)||I==="object")return l.error('The item type argument of "array" must be one of string, number, boolean',1);b=rc[I],g++}else b=_t;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return l.error('The length argument to "array" must be a positive integer literal',2);T=r[2],g++}p=N(b,T)}else{if(!rc[v])throw new Error(`Types doesn't contain name = ${v}`);p=rc[v]}const x=[];for(;g<r.length;g++){const b=l.parse(r[g],g,_t);if(!b)return null;x.push(b)}return new kr(p,x)}evaluate(r){for(let l=0;l<this.args.length;l++){const p=this.args[l].evaluate(r);if(!ee(this.type,kn(p)))return p;if(l===this.args.length-1)throw new _n(`Expected value to be of type ${F(this.type)}, but found ${F(kn(p))} instead.`)}throw new Error}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}const Zu={"to-boolean":ut,"to-color":xi,"to-number":Fe,"to-string":bt};class Tr{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");const p=r[0];if(!Zu[p])throw new Error(`Can't parse ${p} as it is not part of the known types`);if((p==="to-boolean"||p==="to-string")&&r.length!==2)return l.error("Expected one argument.");const g=Zu[p],v=[];for(let x=1;x<r.length;x++){const b=l.parse(r[x],x,_t);if(!b)return null;v.push(b)}return new Tr(g,v)}evaluate(r){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(r);case"color":{let l,p;for(const g of this.args){if(l=g.evaluate(r),p=null,l instanceof qt)return l;if(typeof l=="string"){const v=r.parseColor(l);if(v)return v}else if(Array.isArray(l)&&(p=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:Oo(l[0],l[1],l[2],l[3]),!p))return new qt(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new _n(p||`Could not parse color from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"padding":{let l;for(const p of this.args){l=p.evaluate(r);const g=Fi.parse(l);if(g)return g}throw new _n(`Could not parse padding from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"variableAnchorOffsetCollection":{let l;for(const p of this.args){l=p.evaluate(r);const g=ir.parse(l);if(g)return g}throw new _n(`Could not parse variableAnchorOffsetCollection from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"number":{let l=null;for(const p of this.args){if(l=p.evaluate(r),l===null)return 0;const g=Number(l);if(!isNaN(g))return g}throw new _n(`Could not convert ${JSON.stringify(l)} to number.`)}case"formatted":return Bi.fromString(nl(this.args[0].evaluate(r)));case"resolvedImage":return Ni.fromString(nl(this.args[0].evaluate(r)));default:return nl(this.args[0].evaluate(r))}}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}const fg=["Unknown","Point","LineString","Polygon"];class sc{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?fg[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(r){let l=this._parseColorCache[r];return l||(l=this._parseColorCache[r]=qt.parse(r)),l}}class no{constructor(r,l,p=[],g,v=new Hr,x=[]){this.registry=r,this.path=p,this.key=p.map(b=>`[${b}]`).join(""),this.scope=v,this.errors=x,this.expectedType=g,this._isConstant=l}parse(r,l,p,g,v={}){return l?this.concat(l,p,g)._parse(r,v):this._parse(r,v)}_parse(r,l){function p(g,v,x){return x==="assert"?new kr(v,[g]):x==="coerce"?new Tr(v,[g]):g}if(r!==null&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"||(r=["literal",r]),Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=r[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const v=this.registry[g];if(v){let x=v.parse(r,this);if(!x)return null;if(this.expectedType){const b=this.expectedType,T=x.type;if(b.kind!=="string"&&b.kind!=="number"&&b.kind!=="boolean"&&b.kind!=="object"&&b.kind!=="array"||T.kind!=="value")if(b.kind!=="color"&&b.kind!=="formatted"&&b.kind!=="resolvedImage"||T.kind!=="value"&&T.kind!=="string")if(b.kind!=="padding"||T.kind!=="value"&&T.kind!=="number"&&T.kind!=="array")if(b.kind!=="variableAnchorOffsetCollection"||T.kind!=="value"&&T.kind!=="array"){if(this.checkSubtype(b,T))return null}else x=p(x,b,l.typeAnnotation||"coerce");else x=p(x,b,l.typeAnnotation||"coerce");else x=p(x,b,l.typeAnnotation||"coerce");else x=p(x,b,l.typeAnnotation||"assert")}if(!(x instanceof Sr)&&x.type.kind!=="resolvedImage"&&this._isConstant(x)){const b=new sc;try{x=new Sr(x.type,x.evaluate(b))}catch(T){return this.error(T.message),null}}return x}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(r===void 0?"'undefined' value invalid. Use null instead.":typeof r=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,l,p){const g=typeof r=="number"?this.path.concat(r):this.path,v=p?this.scope.concat(p):this.scope;return new no(this.registry,this._isConstant,g,l||null,v,this.errors)}error(r,...l){const p=`${this.key}${l.map(g=>`[${g}]`).join("")}`;this.errors.push(new si(p,r))}checkSubtype(r,l){const p=ee(r,l);return p&&this.error(p),p}}class Rs{constructor(r,l){this.type=l.type,this.bindings=[].concat(r),this.result=l}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const l of this.bindings)r(l[1]);r(this.result)}static parse(r,l){if(r.length<4)return l.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const p=[];for(let v=1;v<r.length-1;v+=2){const x=r[v];if(typeof x!="string")return l.error(`Expected string, but found ${typeof x} instead.`,v);if(/[^a-zA-Z0-9_]/.test(x))return l.error("Variable names must contain only alphanumeric characters or '_'.",v);const b=l.parse(r[v+1],v+1);if(!b)return null;p.push([x,b])}const g=l.parse(r[r.length-1],r.length-1,l.expectedType,p);return g?new Rs(p,g):null}outputDefined(){return this.result.outputDefined()}}class Nt{constructor(r,l){this.type=l.type,this.name=r,this.boundExpression=l}static parse(r,l){if(r.length!==2||typeof r[1]!="string")return l.error("'var' expression requires exactly one string literal argument.");const p=r[1];return l.scope.has(p)?new Nt(p,l.scope.get(p)):l.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}}class Wu{constructor(r,l,p){this.type=r,this.index=l,this.input=p}static parse(r,l){if(r.length!==3)return l.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const p=l.parse(r[1],1,Fe),g=l.parse(r[2],2,N(l.expectedType||_t));return p&&g?new Wu(g.type.itemType,p,g):null}evaluate(r){const l=this.index.evaluate(r),p=this.input.evaluate(r);if(l<0)throw new _n(`Array index out of bounds: ${l} < 0.`);if(l>=p.length)throw new _n(`Array index out of bounds: ${l} > ${p.length-1}.`);if(l!==Math.floor(l))throw new _n(`Array index must be an integer, but found ${l} instead.`);return p[l]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}}class Gu{constructor(r,l){this.type=ut,this.needle=r,this.haystack=l}static parse(r,l){if(r.length!==3)return l.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const p=l.parse(r[1],1,_t),g=l.parse(r[2],2,_t);return p&&g?ue(p.type,[ut,bt,Fe,zs,_t])?new Gu(p,g):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${F(p.type)} instead`):null}evaluate(r){const l=this.needle.evaluate(r),p=this.haystack.evaluate(r);if(!p)return!1;if(!pe(l,["boolean","string","number","null"]))throw new _n(`Expected first argument to be of type boolean, string, number or null, but found ${F(kn(l))} instead.`);if(!pe(p,["string","array"]))throw new _n(`Expected second argument to be of type array or string, but found ${F(kn(p))} instead.`);return p.indexOf(l)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}}class Lo{constructor(r,l,p){this.type=Fe,this.needle=r,this.haystack=l,this.fromIndex=p}static parse(r,l){if(r.length<=2||r.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const p=l.parse(r[1],1,_t),g=l.parse(r[2],2,_t);if(!p||!g)return null;if(!ue(p.type,[ut,bt,Fe,zs,_t]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${F(p.type)} instead`);if(r.length===4){const v=l.parse(r[3],3,Fe);return v?new Lo(p,g,v):null}return new Lo(p,g)}evaluate(r){const l=this.needle.evaluate(r),p=this.haystack.evaluate(r);if(!pe(l,["boolean","string","number","null"]))throw new _n(`Expected first argument to be of type boolean, string, number or null, but found ${F(kn(l))} instead.`);let g;if(this.fromIndex&&(g=this.fromIndex.evaluate(r)),pe(p,["string"])){const v=p.indexOf(l,g);return v===-1?-1:[...p.slice(0,v)].length}if(pe(p,["array"]))return p.indexOf(l,g);throw new _n(`Expected second argument to be of type array or string, but found ${F(kn(p))} instead.`)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}}class Ku{constructor(r,l,p,g,v,x){this.inputType=r,this.type=l,this.input=p,this.cases=g,this.outputs=v,this.otherwise=x}static parse(r,l){if(r.length<5)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return l.error("Expected an even number of arguments.");let p,g;l.expectedType&&l.expectedType.kind!=="value"&&(g=l.expectedType);const v={},x=[];for(let I=2;I<r.length-1;I+=2){let z=r[I];const R=r[I+1];Array.isArray(z)||(z=[z]);const B=l.concat(I);if(z.length===0)return B.error("Expected at least one branch label.");for(const q of z){if(typeof q!="number"&&typeof q!="string")return B.error("Branch labels must be numbers or strings.");if(typeof q=="number"&&Math.abs(q)>Number.MAX_SAFE_INTEGER)return B.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof q=="number"&&Math.floor(q)!==q)return B.error("Numeric branch labels must be integer values.");if(p){if(B.checkSubtype(p,kn(q)))return null}else p=kn(q);if(v[String(q)]!==void 0)return B.error("Branch labels must be unique.");v[String(q)]=x.length}const V=l.parse(R,I,g);if(!V)return null;g=g||V.type,x.push(V)}const b=l.parse(r[1],1,_t);if(!b)return null;const T=l.parse(r[r.length-1],r.length-1,g);return T?b.type.kind!=="value"&&l.concat(1).checkSubtype(p,b.type)?null:new Ku(p,g,b,v,x,T):null}evaluate(r){const l=this.input.evaluate(r);return(kn(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}}class oc{constructor(r,l,p){this.type=r,this.branches=l,this.otherwise=p}static parse(r,l){if(r.length<4)return l.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return l.error("Expected an odd number of arguments.");let p;l.expectedType&&l.expectedType.kind!=="value"&&(p=l.expectedType);const g=[];for(let x=1;x<r.length-1;x+=2){const b=l.parse(r[x],x,ut);if(!b)return null;const T=l.parse(r[x+1],x+1,p);if(!T)return null;g.push([b,T]),p=p||T.type}const v=l.parse(r[r.length-1],r.length-1,p);if(!v)return null;if(!p)throw new Error("Can't infer output type");return new oc(p,g,v)}evaluate(r){for(const[l,p]of this.branches)if(l.evaluate(r))return p.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[l,p]of this.branches)r(l),r(p);r(this.otherwise)}outputDefined(){return this.branches.every(([r,l])=>l.outputDefined())&&this.otherwise.outputDefined()}}class il{constructor(r,l,p,g){this.type=r,this.input=l,this.beginIndex=p,this.endIndex=g}static parse(r,l){if(r.length<=2||r.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const p=l.parse(r[1],1,_t),g=l.parse(r[2],2,Fe);if(!p||!g)return null;if(!ue(p.type,[N(_t),bt,_t]))return l.error(`Expected first argument to be of type array or string, but found ${F(p.type)} instead`);if(r.length===4){const v=l.parse(r[3],3,Fe);return v?new il(p.type,p,g,v):null}return new il(p.type,p,g)}evaluate(r){const l=this.input.evaluate(r),p=this.beginIndex.evaluate(r);let g;if(this.endIndex&&(g=this.endIndex.evaluate(r)),pe(l,["string"]))return[...l].slice(p,g).join("");if(pe(l,["array"]))return l.slice(p,g);throw new _n(`Expected first argument to be of type array or string, but found ${F(kn(l))} instead.`)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}}function ac(o,r){const l=o.length-1;let p,g,v=0,x=l,b=0;for(;v<=x;)if(b=Math.floor((v+x)/2),p=o[b],g=o[b+1],p<=r){if(b===l||r<g)return b;v=b+1}else{if(!(p>r))throw new _n("Input is not a number.");x=b-1}return 0}class Bo{constructor(r,l,p){this.type=r,this.input=l,this.labels=[],this.outputs=[];for(const[g,v]of p)this.labels.push(g),this.outputs.push(v)}static parse(r,l){if(r.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return l.error("Expected an even number of arguments.");const p=l.parse(r[1],1,Fe);if(!p)return null;const g=[];let v=null;l.expectedType&&l.expectedType.kind!=="value"&&(v=l.expectedType);for(let x=1;x<r.length;x+=2){const b=x===1?-1/0:r[x],T=r[x+1],I=x,z=x+1;if(typeof b!="number")return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(g.length&&g[g.length-1][0]>=b)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);const R=l.parse(T,z,v);if(!R)return null;v=v||R.type,g.push([b,R])}return new Bo(v,p,g)}evaluate(r){const l=this.labels,p=this.outputs;if(l.length===1)return p[0].evaluate(r);const g=this.input.evaluate(r);if(g<=l[0])return p[0].evaluate(r);const v=l.length;return g>=l[v-1]?p[v-1].evaluate(r):p[ac(l,g)].evaluate(r)}eachChild(r){r(this.input);for(const l of this.outputs)r(l)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}}function op(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var mg=ap;function ap(o,r,l,p){this.cx=3*o,this.bx=3*(l-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(p-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=r,this.p2x=l,this.p2y=p}ap.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,r){if(r===void 0&&(r=1e-6),o<0)return 0;if(o>1)return 1;for(var l=o,p=0;p<8;p++){var g=this.sampleCurveX(l)-o;if(Math.abs(g)<r)return l;var v=this.sampleCurveDerivativeX(l);if(Math.abs(v)<1e-6)break;l-=g/v}var x=0,b=1;for(l=o,p=0;p<20&&(g=this.sampleCurveX(l),!(Math.abs(g-o)<r));p++)o>g?x=l:b=l,l=.5*(b-x)+x;return l},solve:function(o,r){return this.sampleCurveY(this.solveCurveX(o,r))}};var gg=op(mg);function io(o,r,l){return o+l*(r-o)}function rl(o,r,l){return o.map((p,g)=>io(p,r[g],l))}const wi={number:io,color:function(o,r,l,p="rgb"){switch(p){case"rgb":{const[g,v,x,b]=rl(o.rgb,r.rgb,l);return new qt(g,v,x,b,!1)}case"hcl":{const[g,v,x,b]=o.hcl,[T,I,z,R]=r.hcl;let B,V;if(isNaN(g)||isNaN(T))isNaN(g)?isNaN(T)?B=NaN:(B=T,x!==1&&x!==0||(V=I)):(B=g,z!==1&&z!==0||(V=v));else{let ye=T-g;T>g&&ye>180?ye-=360:T<g&&g-T>180&&(ye+=360),B=g+l*ye}const[q,H,Q,ie]=function([ye,ce,me,we]){return ye=isNaN(ye)?0:ye*at,ln([me,Math.cos(ye)*ce,Math.sin(ye)*ce,we])}([B,V??io(v,I,l),io(x,z,l),io(b,R,l)]);return new qt(q,H,Q,ie,!1)}case"lab":{const[g,v,x,b]=ln(rl(o.lab,r.lab,l));return new qt(g,v,x,b,!1)}}},array:rl,padding:function(o,r,l){return new Fi(rl(o.values,r.values,l))},variableAnchorOffsetCollection:function(o,r,l){const p=o.values,g=r.values;if(p.length!==g.length)throw new _n(`Cannot interpolate values of different length. from: ${o.toString()}, to: ${r.toString()}`);const v=[];for(let x=0;x<p.length;x+=2){if(p[x]!==g[x])throw new _n(`Cannot interpolate values containing mismatched anchors. from[${x}]: ${p[x]}, to[${x}]: ${g[x]}`);v.push(p[x]);const[b,T]=p[x+1],[I,z]=g[x+1];v.push([io(b,I,l),io(T,z,l)])}return new ir(v)}};class bi{constructor(r,l,p,g,v){this.type=r,this.operator=l,this.interpolation=p,this.input=g,this.labels=[],this.outputs=[];for(const[x,b]of v)this.labels.push(x),this.outputs.push(b)}static interpolationFactor(r,l,p,g){let v=0;if(r.name==="exponential")v=lc(l,r.base,p,g);else if(r.name==="linear")v=lc(l,1,p,g);else if(r.name==="cubic-bezier"){const x=r.controlPoints;v=new gg(x[0],x[1],x[2],x[3]).solve(lc(l,1,p,g))}return v}static parse(r,l){let[p,g,v,...x]=r;if(!Array.isArray(g)||g.length===0)return l.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const I=g[1];if(typeof I!="number")return l.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:I}}else{if(g[0]!=="cubic-bezier")return l.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const I=g.slice(1);if(I.length!==4||I.some(z=>typeof z!="number"||z<0||z>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:I}}}if(r.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(v=l.parse(v,2,Fe),!v)return null;const b=[];let T=null;p==="interpolate-hcl"||p==="interpolate-lab"?T=xi:l.expectedType&&l.expectedType.kind!=="value"&&(T=l.expectedType);for(let I=0;I<x.length;I+=2){const z=x[I],R=x[I+1],B=I+3,V=I+4;if(typeof z!="number")return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(b.length&&b[b.length-1][0]>=z)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',B);const q=l.parse(R,V,T);if(!q)return null;T=T||q.type,b.push([z,q])}return ge(T,Fe)||ge(T,xi)||ge(T,Ds)||ge(T,ne)||ge(T,N(Fe))?new bi(T,p,g,v,b):l.error(`Type ${F(T)} is not interpolatable.`)}evaluate(r){const l=this.labels,p=this.outputs;if(l.length===1)return p[0].evaluate(r);const g=this.input.evaluate(r);if(g<=l[0])return p[0].evaluate(r);const v=l.length;if(g>=l[v-1])return p[v-1].evaluate(r);const x=ac(l,g),b=bi.interpolationFactor(this.interpolation,g,l[x],l[x+1]),T=p[x].evaluate(r),I=p[x+1].evaluate(r);switch(this.operator){case"interpolate":return wi[this.type.kind](T,I,b);case"interpolate-hcl":return wi.color(T,I,b,"hcl");case"interpolate-lab":return wi.color(T,I,b,"lab")}}eachChild(r){r(this.input);for(const l of this.outputs)r(l)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}}function lc(o,r,l,p){const g=p-l,v=o-l;return g===0?0:r===1?v/g:(Math.pow(r,v)-1)/(Math.pow(r,g)-1)}class cc{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expectected at least one argument.");let p=null;const g=l.expectedType;g&&g.kind!=="value"&&(p=g);const v=[];for(const b of r.slice(1)){const T=l.parse(b,1+v.length,p,void 0,{typeAnnotation:"omit"});if(!T)return null;p=p||T.type,v.push(T)}if(!p)throw new Error("No output type");const x=g&&v.some(b=>ee(g,b.type));return new cc(x?_t:p,v)}evaluate(r){let l,p=null,g=0;for(const v of this.args)if(g++,p=v.evaluate(r),p&&p instanceof Ni&&!p.available&&(l||(l=p.name),p=null,g===this.args.length&&(p=l)),p!==null)break;return p}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}function uc(o,r){return o==="=="||o==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function lp(o,r,l,p){return p.compare(r,l)===0}function Fo(o,r,l){const p=o!=="=="&&o!=="!=";return class fC{constructor(v,x,b){this.type=ut,this.lhs=v,this.rhs=x,this.collator=b,this.hasUntypedArgument=v.type.kind==="value"||x.type.kind==="value"}static parse(v,x){if(v.length!==3&&v.length!==4)return x.error("Expected two or three arguments.");const b=v[0];let T=x.parse(v[1],1,_t);if(!T)return null;if(!uc(b,T.type))return x.concat(1).error(`"${b}" comparisons are not supported for type '${F(T.type)}'.`);let I=x.parse(v[2],2,_t);if(!I)return null;if(!uc(b,I.type))return x.concat(2).error(`"${b}" comparisons are not supported for type '${F(I.type)}'.`);if(T.type.kind!==I.type.kind&&T.type.kind!=="value"&&I.type.kind!=="value")return x.error(`Cannot compare types '${F(T.type)}' and '${F(I.type)}'.`);p&&(T.type.kind==="value"&&I.type.kind!=="value"?T=new kr(I.type,[T]):T.type.kind!=="value"&&I.type.kind==="value"&&(I=new kr(T.type,[I])));let z=null;if(v.length===4){if(T.type.kind!=="string"&&I.type.kind!=="string"&&T.type.kind!=="value"&&I.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(z=x.parse(v[3],3,Zr),!z)return null}return new fC(T,I,z)}evaluate(v){const x=this.lhs.evaluate(v),b=this.rhs.evaluate(v);if(p&&this.hasUntypedArgument){const T=kn(x),I=kn(b);if(T.kind!==I.kind||T.kind!=="string"&&T.kind!=="number")throw new _n(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${T.kind}, ${I.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){const T=kn(x),I=kn(b);if(T.kind!=="string"||I.kind!=="string")return r(v,x,b)}return this.collator?l(v,x,b,this.collator.evaluate(v)):r(v,x,b)}eachChild(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)}outputDefined(){return!0}}}const yg=Fo("==",function(o,r,l){return r===l},lp),cp=Fo("!=",function(o,r,l){return r!==l},function(o,r,l,p){return!lp(0,r,l,p)}),up=Fo("<",function(o,r,l){return r<l},function(o,r,l,p){return p.compare(r,l)<0}),_g=Fo(">",function(o,r,l){return r>l},function(o,r,l,p){return p.compare(r,l)>0}),vg=Fo("<=",function(o,r,l){return r<=l},function(o,r,l,p){return p.compare(r,l)<=0}),hp=Fo(">=",function(o,r,l){return r>=l},function(o,r,l,p){return p.compare(r,l)>=0});class sl{constructor(r,l,p){this.type=Zr,this.locale=p,this.caseSensitive=r,this.diacriticSensitive=l}static parse(r,l){if(r.length!==2)return l.error("Expected one argument.");const p=r[1];if(typeof p!="object"||Array.isArray(p))return l.error("Collator options argument must be an object.");const g=l.parse(p["case-sensitive"]!==void 0&&p["case-sensitive"],1,ut);if(!g)return null;const v=l.parse(p["diacritic-sensitive"]!==void 0&&p["diacritic-sensitive"],1,ut);if(!v)return null;let x=null;return p.locale&&(x=l.parse(p.locale,1,bt),!x)?null:new sl(g,v,x)}evaluate(r){return new qu(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}}class Xu{constructor(r,l,p,g,v){this.type=bt,this.number=r,this.locale=l,this.currency=p,this.minFractionDigits=g,this.maxFractionDigits=v}static parse(r,l){if(r.length!==3)return l.error("Expected two arguments.");const p=l.parse(r[1],1,Fe);if(!p)return null;const g=r[2];if(typeof g!="object"||Array.isArray(g))return l.error("NumberFormat options argument must be an object.");let v=null;if(g.locale&&(v=l.parse(g.locale,1,bt),!v))return null;let x=null;if(g.currency&&(x=l.parse(g.currency,1,bt),!x))return null;let b=null;if(g["min-fraction-digits"]&&(b=l.parse(g["min-fraction-digits"],1,Fe),!b))return null;let T=null;return g["max-fraction-digits"]&&(T=l.parse(g["max-fraction-digits"],1,Fe),!T)?null:new Xu(p,v,x,b,T)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}}class hc{constructor(r){this.type=ds,this.sections=r}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");const p=r[1];if(!Array.isArray(p)&&typeof p=="object")return l.error("First argument must be an image or text section.");const g=[];let v=!1;for(let x=1;x<=r.length-1;++x){const b=r[x];if(v&&typeof b=="object"&&!Array.isArray(b)){v=!1;let T=null;if(b["font-scale"]&&(T=l.parse(b["font-scale"],1,Fe),!T))return null;let I=null;if(b["text-font"]&&(I=l.parse(b["text-font"],1,N(bt)),!I))return null;let z=null;if(b["text-color"]&&(z=l.parse(b["text-color"],1,xi),!z))return null;const R=g[g.length-1];R.scale=T,R.font=I,R.textColor=z}else{const T=l.parse(r[x],1,_t);if(!T)return null;const I=T.type.kind;if(I!=="string"&&I!=="value"&&I!=="null"&&I!=="resolvedImage")return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,g.push({content:T,scale:null,font:null,textColor:null})}}return new hc(g)}evaluate(r){return new Bi(this.sections.map(l=>{const p=l.content.evaluate(r);return kn(p)===Wr?new Hu("",p,null,null,null):new Hu(nl(p),null,l.scale?l.scale.evaluate(r):null,l.font?l.font.evaluate(r).join(","):null,l.textColor?l.textColor.evaluate(r):null)}))}eachChild(r){for(const l of this.sections)r(l.content),l.scale&&r(l.scale),l.font&&r(l.font),l.textColor&&r(l.textColor)}outputDefined(){return!1}}class Ju{constructor(r){this.type=Wr,this.input=r}static parse(r,l){if(r.length!==2)return l.error("Expected two arguments.");const p=l.parse(r[1],1,bt);return p?new Ju(p):l.error("No image name provided.")}evaluate(r){const l=this.input.evaluate(r),p=Ni.fromString(l);return p&&r.availableImages&&(p.available=r.availableImages.indexOf(l)>-1),p}eachChild(r){r(this.input)}outputDefined(){return!1}}class Yu{constructor(r){this.type=Fe,this.input=r}static parse(r,l){if(r.length!==2)return l.error(`Expected 1 argument, but found ${r.length-1} instead.`);const p=l.parse(r[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?l.error(`Expected argument of type string or array, but found ${F(p.type)} instead.`):new Yu(p):null}evaluate(r){const l=this.input.evaluate(r);if(typeof l=="string")return[...l].length;if(Array.isArray(l))return l.length;throw new _n(`Expected value to be of type string or array, but found ${F(kn(l))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}}const Gr=8192;function xg(o,r){const l=(180+o[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,g=Math.pow(2,r.z);return[Math.round(l*g*Gr),Math.round(p*g*Gr)]}function Qu(o,r){const l=Math.pow(2,r.z);return[(g=(o[0]/Gr+r.x)/l,360*g-180),(p=(o[1]/Gr+r.y)/l,360/Math.PI*Math.atan(Math.exp((180-360*p)*Math.PI/180))-90)];var p,g}function ro(o,r){o[0]=Math.min(o[0],r[0]),o[1]=Math.min(o[1],r[1]),o[2]=Math.max(o[2],r[0]),o[3]=Math.max(o[3],r[1])}function Os(o,r){return!(o[0]<=r[0]||o[2]>=r[2]||o[1]<=r[1]||o[3]>=r[3])}function Vt(o,r,l){const p=o[0]-r[0],g=o[1]-r[1],v=o[0]-l[0],x=o[1]-l[1];return p*x-v*g==0&&p*v<=0&&g*x<=0}function dc(o,r,l,p){return(g=[p[0]-l[0],p[1]-l[1]])[0]*(v=[r[0]-o[0],r[1]-o[1]])[1]-g[1]*v[0]!=0&&!(!pp(o,r,l,p)||!pp(l,p,o,r));var g,v}function wg(o,r,l){for(const p of l)for(let g=0;g<p.length-1;++g)if(dc(o,r,p[g],p[g+1]))return!0;return!1}function No(o,r,l=!1){let p=!1;for(const b of r)for(let T=0;T<b.length-1;T++){if(Vt(o,b[T],b[T+1]))return l;(v=b[T])[1]>(g=o)[1]!=(x=b[T+1])[1]>g[1]&&g[0]<(x[0]-v[0])*(g[1]-v[1])/(x[1]-v[1])+v[0]&&(p=!p)}var g,v,x;return p}function bg(o,r){for(const l of r)if(No(o,l))return!0;return!1}function dp(o,r){for(const l of o)if(!No(l,r))return!1;for(let l=0;l<o.length-1;++l)if(wg(o[l],o[l+1],r))return!1;return!0}function Sg(o,r){for(const l of r)if(dp(o,l))return!0;return!1}function pp(o,r,l,p){const g=p[0]-l[0],v=p[1]-l[1],x=(o[0]-l[0])*v-g*(o[1]-l[1]),b=(r[0]-l[0])*v-g*(r[1]-l[1]);return x>0&&b<0||x<0&&b>0}function eh(o,r,l){const p=[];for(let g=0;g<o.length;g++){const v=[];for(let x=0;x<o[g].length;x++){const b=xg(o[g][x],l);ro(r,b),v.push(b)}p.push(v)}return p}function fp(o,r,l){const p=[];for(let g=0;g<o.length;g++){const v=eh(o[g],r,l);p.push(v)}return p}function mp(o,r,l,p){if(o[0]<l[0]||o[0]>l[2]){const g=.5*p;let v=o[0]-l[0]>g?-p:l[0]-o[0]>g?p:0;v===0&&(v=o[0]-l[2]>g?-p:l[2]-o[0]>g?p:0),o[0]+=v}ro(r,o)}function gp(o,r,l,p){const g=Math.pow(2,p.z)*Gr,v=[p.x*Gr,p.y*Gr],x=[];for(const b of o)for(const T of b){const I=[T.x+v[0],T.y+v[1]];mp(I,r,l,g),x.push(I)}return x}function yp(o,r,l,p){const g=Math.pow(2,p.z)*Gr,v=[p.x*Gr,p.y*Gr],x=[];for(const T of o){const I=[];for(const z of T){const R=[z.x+v[0],z.y+v[1]];ro(r,R),I.push(R)}x.push(I)}if(r[2]-r[0]<=g/2){(b=r)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const T of x)for(const I of T)mp(I,r,l,g)}var b;return x}class so{constructor(r,l){this.type=ut,this.geojson=r,this.geometries=l}static parse(r,l){if(r.length!==2)return l.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(to(r[1])){const p=r[1];if(p.type==="FeatureCollection"){const g=[];for(const v of p.features){const{type:x,coordinates:b}=v.geometry;x==="Polygon"&&g.push(b),x==="MultiPolygon"&&g.push(...b)}if(g.length)return new so(p,{type:"MultiPolygon",coordinates:g})}else if(p.type==="Feature"){const g=p.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new so(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new so(p,p)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return function(l,p){const g=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],x=l.canonicalID();if(p.type==="Polygon"){const b=eh(p.coordinates,v,x),T=gp(l.geometry(),g,v,x);if(!Os(g,v))return!1;for(const I of T)if(!No(I,b))return!1}if(p.type==="MultiPolygon"){const b=fp(p.coordinates,v,x),T=gp(l.geometry(),g,v,x);if(!Os(g,v))return!1;for(const I of T)if(!bg(I,b))return!1}return!0}(r,this.geometries);if(r.geometryType()==="LineString")return function(l,p){const g=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],x=l.canonicalID();if(p.type==="Polygon"){const b=eh(p.coordinates,v,x),T=yp(l.geometry(),g,v,x);if(!Os(g,v))return!1;for(const I of T)if(!dp(I,b))return!1}if(p.type==="MultiPolygon"){const b=fp(p.coordinates,v,x),T=yp(l.geometry(),g,v,x);if(!Os(g,v))return!1;for(const I of T)if(!Sg(I,b))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let _p=class{constructor(o=[],r=(l,p)=>l<p?-1:l>p?1:0){if(this.data=o,this.length=this.data.length,this.compare=r,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(o){this.data.push(o),this._up(this.length++)}pop(){if(this.length===0)return;const o=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:r,compare:l}=this,p=r[o];for(;o>0;){const g=o-1>>1,v=r[g];if(l(p,v)>=0)break;r[o]=v,o=g}r[o]=p}_down(o){const{data:r,compare:l}=this,p=this.length>>1,g=r[o];for(;o<p;){let v=1+(o<<1);const x=v+1;if(x<this.length&&l(r[x],r[v])<0&&(v=x),l(r[v],g)>=0)break;r[o]=r[v],o=v}r[o]=g}};function kg(o,r,l,p,g){vp(o,r,l,p||o.length-1,g||Tg)}function vp(o,r,l,p,g){for(;p>l;){if(p-l>600){var v=p-l+1,x=r-l+1,b=Math.log(v),T=.5*Math.exp(2*b/3),I=.5*Math.sqrt(b*T*(v-T)/v)*(x-v/2<0?-1:1);vp(o,r,Math.max(l,Math.floor(r-x*T/v+I)),Math.min(p,Math.floor(r+(v-x)*T/v+I)),g)}var z=o[r],R=l,B=p;for(ol(o,l,r),g(o[p],z)>0&&ol(o,l,p);R<B;){for(ol(o,R,B),R++,B--;g(o[R],z)<0;)R++;for(;g(o[B],z)>0;)B--}g(o[l],z)===0?ol(o,l,B):ol(o,++B,p),B<=r&&(l=B+1),r<=B&&(p=B-1)}}function ol(o,r,l){var p=o[r];o[r]=o[l],o[l]=p}function Tg(o,r){return o<r?-1:o>r?1:0}function pc(o,r){if(o.length<=1)return[o];const l=[];let p,g;for(const v of o){const x=Mg(v);x!==0&&(v.area=Math.abs(x),g===void 0&&(g=x<0),g===x<0?(p&&l.push(p),p=[v]):p.push(v))}if(p&&l.push(p),r>1)for(let v=0;v<l.length;v++)l[v].length<=r||(kg(l[v],r,1,l[v].length-1,Cg),l[v]=l[v].slice(0,r));return l}function Cg(o,r){return r.area-o.area}function Mg(o){let r=0;for(let l,p,g=0,v=o.length,x=v-1;g<v;x=g++)l=o[g],p=o[x],r+=(p.x-l.x)*(l.y+p.y);return r}const xp=1/298.257223563,wp=xp*(2-xp),bp=Math.PI/180;class th{constructor(r){const l=6378.137*bp*1e3,p=Math.cos(r*bp),g=1/(1-wp*(1-p*p)),v=Math.sqrt(g);this.kx=l*v*p,this.ky=l*v*g*(1-wp)}distance(r,l){const p=this.wrap(r[0]-l[0])*this.kx,g=(r[1]-l[1])*this.ky;return Math.sqrt(p*p+g*g)}pointOnLine(r,l){let p,g,v,x,b=1/0;for(let T=0;T<r.length-1;T++){let I=r[T][0],z=r[T][1],R=this.wrap(r[T+1][0]-I)*this.kx,B=(r[T+1][1]-z)*this.ky,V=0;R===0&&B===0||(V=(this.wrap(l[0]-I)*this.kx*R+(l[1]-z)*this.ky*B)/(R*R+B*B),V>1?(I=r[T+1][0],z=r[T+1][1]):V>0&&(I+=R/this.kx*V,z+=B/this.ky*V)),R=this.wrap(l[0]-I)*this.kx,B=(l[1]-z)*this.ky;const q=R*R+B*B;q<b&&(b=q,p=I,g=z,v=T,x=V)}return{point:[p,g],index:v,t:Math.max(0,Math.min(1,x))}}wrap(r){for(;r<-180;)r+=360;for(;r>180;)r-=360;return r}}function Sp(o,r){return r[0]-o[0]}function fc(o){return o[1]-o[0]+1}function ps(o,r){return o[1]>=o[0]&&o[1]<r}function nh(o,r){if(o[0]>o[1])return[null,null];const l=fc(o);if(r){if(l===2)return[o,null];const g=Math.floor(l/2);return[[o[0],o[0]+g],[o[0]+g,o[1]]]}if(l===1)return[o,null];const p=Math.floor(l/2)-1;return[[o[0],o[0]+p],[o[0]+p+1,o[1]]]}function ih(o,r){if(!ps(r,o.length))return[1/0,1/0,-1/0,-1/0];const l=[1/0,1/0,-1/0,-1/0];for(let p=r[0];p<=r[1];++p)ro(l,o[p]);return l}function rh(o){const r=[1/0,1/0,-1/0,-1/0];for(const l of o)for(const p of l)ro(r,p);return r}function mc(o){return o[0]!==-1/0&&o[1]!==-1/0&&o[2]!==1/0&&o[3]!==1/0}function sh(o,r,l){if(!mc(o)||!mc(r))return NaN;let p=0,g=0;return o[2]<r[0]&&(p=r[0]-o[2]),o[0]>r[2]&&(p=o[0]-r[2]),o[1]>r[3]&&(g=o[1]-r[3]),o[3]<r[1]&&(g=r[1]-o[3]),l.distance([0,0],[p,g])}function oo(o,r,l){const p=l.pointOnLine(r,o);return l.distance(o,p.point)}function oh(o,r,l,p,g){const v=Math.min(oo(o,[l,p],g),oo(r,[l,p],g)),x=Math.min(oo(l,[o,r],g),oo(p,[o,r],g));return Math.min(v,x)}function Eg(o,r,l,p,g){if(!ps(r,o.length)||!ps(p,l.length))return 1/0;let v=1/0;for(let x=r[0];x<r[1];++x){const b=o[x],T=o[x+1];for(let I=p[0];I<p[1];++I){const z=l[I],R=l[I+1];if(dc(b,T,z,R))return 0;v=Math.min(v,oh(b,T,z,R,g))}}return v}function pn(o,r,l,p,g){if(!ps(r,o.length)||!ps(p,l.length))return NaN;let v=1/0;for(let x=r[0];x<=r[1];++x)for(let b=p[0];b<=p[1];++b)if(v=Math.min(v,g.distance(o[x],l[b])),v===0)return v;return v}function Ig(o,r,l){if(No(o,r,!0))return 0;let p=1/0;for(const g of r){const v=g[0],x=g[g.length-1];if(v!==x&&(p=Math.min(p,oo(o,[x,v],l)),p===0))return p;const b=l.pointOnLine(g,o);if(p=Math.min(p,l.distance(o,b.point)),p===0)return p}return p}function Tt(o,r,l,p){if(!ps(r,o.length))return NaN;for(let v=r[0];v<=r[1];++v)if(No(o[v],l,!0))return 0;let g=1/0;for(let v=r[0];v<r[1];++v){const x=o[v],b=o[v+1];for(const T of l)for(let I=0,z=T.length,R=z-1;I<z;R=I++){const B=T[R],V=T[I];if(dc(x,b,B,V))return 0;g=Math.min(g,oh(x,b,B,V,p))}}return g}function gc(o,r){for(const l of o)for(const p of l)if(No(p,r,!0))return!0;return!1}function Kt(o,r,l,p=1/0){const g=rh(o),v=rh(r);if(p!==1/0&&sh(g,v,l)>=p)return p;if(Os(g,v)){if(gc(o,r))return 0}else if(gc(r,o))return 0;let x=1/0;for(const b of o)for(let T=0,I=b.length,z=I-1;T<I;z=T++){const R=b[z],B=b[T];for(const V of r)for(let q=0,H=V.length,Q=H-1;q<H;Q=q++){const ie=V[Q],ye=V[q];if(dc(R,B,ie,ye))return 0;x=Math.min(x,oh(R,B,ie,ye,l))}}return x}function Ht(o,r,l,p,g,v){if(!v)return;const x=sh(ih(p,v),g,l);x<r&&o.push([x,v,[0,0]])}function ao(o,r,l,p,g,v,x){if(!v||!x)return;const b=sh(ih(p,v),ih(g,x),l);b<r&&o.push([b,v,x])}function al(o,r,l,p,g=1/0){let v=Math.min(p.distance(o[0],l[0][0]),g);if(v===0)return v;const x=new _p([[0,[0,o.length-1],[0,0]]],Sp),b=rh(l);for(;x.length>0;){const T=x.pop();if(T[0]>=v)continue;const I=T[1],z=r?50:100;if(fc(I)<=z){if(!ps(I,o.length))return NaN;if(r){const R=Tt(o,I,l,p);if(isNaN(R)||R===0)return R;v=Math.min(v,R)}else for(let R=I[0];R<=I[1];++R){const B=Ig(o[R],l,p);if(v=Math.min(v,B),v===0)return 0}}else{const R=nh(I,r);Ht(x,v,p,o,b,R[0]),Ht(x,v,p,o,b,R[1])}}return v}function ll(o,r,l,p,g,v=1/0){let x=Math.min(v,g.distance(o[0],l[0]));if(x===0)return x;const b=new _p([[0,[0,o.length-1],[0,l.length-1]]],Sp);for(;b.length>0;){const T=b.pop();if(T[0]>=x)continue;const I=T[1],z=T[2],R=r?50:100,B=p?50:100;if(fc(I)<=R&&fc(z)<=B){if(!ps(I,o.length)&&ps(z,l.length))return NaN;let V;if(r&&p)V=Eg(o,I,l,z,g),x=Math.min(x,V);else if(r&&!p){const q=o.slice(I[0],I[1]+1);for(let H=z[0];H<=z[1];++H)if(V=oo(l[H],q,g),x=Math.min(x,V),x===0)return x}else if(!r&&p){const q=l.slice(z[0],z[1]+1);for(let H=I[0];H<=I[1];++H)if(V=oo(o[H],q,g),x=Math.min(x,V),x===0)return x}else V=pn(o,I,l,z,g),x=Math.min(x,V)}else{const V=nh(I,r),q=nh(z,p);ao(b,x,g,o,l,V[0],q[0]),ao(b,x,g,o,l,V[0],q[1]),ao(b,x,g,o,l,V[1],q[0]),ao(b,x,g,o,l,V[1],q[1])}}return x}function ah(o){return o.type==="MultiPolygon"?o.coordinates.map(r=>({type:"Polygon",coordinates:r})):o.type==="MultiLineString"?o.coordinates.map(r=>({type:"LineString",coordinates:r})):o.type==="MultiPoint"?o.coordinates.map(r=>({type:"Point",coordinates:r})):[o]}class lo{constructor(r,l){this.type=Fe,this.geojson=r,this.geometries=l}static parse(r,l){if(r.length!==2)return l.error(`'distance' expression requires exactly one argument, but found ${r.length-1} instead.`);if(to(r[1])){const p=r[1];if(p.type==="FeatureCollection")return new lo(p,p.features.map(g=>ah(g.geometry)).flat());if(p.type==="Feature")return new lo(p,ah(p.geometry));if("type"in p&&"coordinates"in p)return new lo(p,ah(p))}return l.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return function(l,p){const g=l.geometry(),v=g.flat().map(T=>Qu([T.x,T.y],l.canonical));if(g.length===0)return NaN;const x=new th(v[0][1]);let b=1/0;for(const T of p){switch(T.type){case"Point":b=Math.min(b,ll(v,!1,[T.coordinates],!1,x,b));break;case"LineString":b=Math.min(b,ll(v,!1,T.coordinates,!0,x,b));break;case"Polygon":b=Math.min(b,al(v,!1,T.coordinates,x,b))}if(b===0)return b}return b}(r,this.geometries);if(r.geometryType()==="LineString")return function(l,p){const g=l.geometry(),v=g.flat().map(T=>Qu([T.x,T.y],l.canonical));if(g.length===0)return NaN;const x=new th(v[0][1]);let b=1/0;for(const T of p){switch(T.type){case"Point":b=Math.min(b,ll(v,!0,[T.coordinates],!1,x,b));break;case"LineString":b=Math.min(b,ll(v,!0,T.coordinates,!0,x,b));break;case"Polygon":b=Math.min(b,al(v,!0,T.coordinates,x,b))}if(b===0)return b}return b}(r,this.geometries);if(r.geometryType()==="Polygon")return function(l,p){const g=l.geometry();if(g.length===0||g[0].length===0)return NaN;const v=pc(g,0).map(T=>T.map(I=>I.map(z=>Qu([z.x,z.y],l.canonical)))),x=new th(v[0][0][0][1]);let b=1/0;for(const T of p)for(const I of v){switch(T.type){case"Point":b=Math.min(b,al([T.coordinates],!1,I,x,b));break;case"LineString":b=Math.min(b,al(T.coordinates,!0,I,x,b));break;case"Polygon":b=Math.min(b,Kt(I,T.coordinates,x,b))}if(b===0)return b}return b}(r,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Vo={"==":yg,"!=":cp,">":_g,"<":up,">=":hp,"<=":vg,array:kr,at:Wu,boolean:kr,case:oc,coalesce:cc,collator:sl,format:hc,image:Ju,in:Gu,"index-of":Lo,interpolate:bi,"interpolate-hcl":bi,"interpolate-lab":bi,length:Yu,let:Rs,literal:Sr,match:Ku,number:kr,"number-format":Xu,object:kr,slice:il,step:Bo,string:kr,"to-boolean":Tr,"to-color":Tr,"to-number":Tr,"to-string":Tr,var:Nt,within:so,distance:lo};class rr{constructor(r,l,p,g){this.name=r,this.type=l,this._evaluate=p,this.args=g}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}static parse(r,l){const p=r[0],g=rr.definitions[p];if(!g)return l.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);const v=Array.isArray(g)?g[0]:g.type,x=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,b=x.filter(([I])=>!Array.isArray(I)||I.length===r.length-1);let T=null;for(const[I,z]of b){T=new no(l.registry,cl,l.path,null,l.scope);const R=[];let B=!1;for(let V=1;V<r.length;V++){const q=r[V],H=Array.isArray(I)?I[V-1]:I.type,Q=T.parse(q,1+R.length,H);if(!Q){B=!0;break}R.push(Q)}if(!B)if(Array.isArray(I)&&I.length!==R.length)T.error(`Expected ${I.length} arguments, but found ${R.length} instead.`);else{for(let V=0;V<R.length;V++){const q=Array.isArray(I)?I[V]:I.type,H=R[V];T.concat(V+1).checkSubtype(q,H.type)}if(T.errors.length===0)return new rr(p,v,z,R)}}if(b.length===1)l.errors.push(...T.errors);else{const I=(b.length?b:x).map(([R])=>{return B=R,Array.isArray(B)?`(${B.map(F).join(", ")})`:`(${F(B.type)}...)`;var B}).join(" | "),z=[];for(let R=1;R<r.length;R++){const B=l.parse(r[R],1+z.length);if(!B)return null;z.push(F(B.type))}l.error(`Expected arguments of type ${I}, but found (${z.join(", ")}) instead.`)}return null}static register(r,l){rr.definitions=l;for(const p in l)r[p]=rr}}function lh(o,[r,l,p,g]){r=r.evaluate(o),l=l.evaluate(o),p=p.evaluate(o);const v=g?g.evaluate(o):1,x=Oo(r,l,p,v);if(x)throw new _n(x);return new qt(r/255,l/255,p/255,v,!1)}function ch(o,r){return o in r}function uh(o,r){const l=r[o];return l===void 0?null:l}function co(o){return{type:o}}function cl(o){if(o instanceof Nt)return cl(o.boundExpression);if(o instanceof rr&&o.name==="error"||o instanceof sl||o instanceof so||o instanceof lo)return!1;const r=o instanceof Tr||o instanceof kr;let l=!0;return o.eachChild(p=>{l=r?l&&cl(p):l&&p instanceof Sr}),!!l&&ul(o)&&hl(o,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function ul(o){if(o instanceof rr&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof so||o instanceof lo)return!1;let r=!0;return o.eachChild(l=>{r&&!ul(l)&&(r=!1)}),r}function $o(o){if(o instanceof rr&&o.name==="feature-state")return!1;let r=!0;return o.eachChild(l=>{r&&!$o(l)&&(r=!1)}),r}function hl(o,r){if(o instanceof rr&&r.indexOf(o.name)>=0)return!1;let l=!0;return o.eachChild(p=>{l&&!hl(p,r)&&(l=!1)}),l}function yc(o){return{result:"success",value:o}}function jo(o){return{result:"error",value:o}}function Uo(o){return o["property-type"]==="data-driven"||o["property-type"]==="cross-faded-data-driven"}function kp(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function hh(o){return!!o.expression&&o.expression.interpolated}function Lt(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":o===null?"null":typeof o}function _c(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function Pg(o){return o}function Tp(o,r){const l=r.type==="color",p=o.stops&&typeof o.stops[0][0]=="object",g=p||!(p||o.property!==void 0),v=o.type||(hh(r)?"exponential":"interval");if(l||r.type==="padding"){const z=l?qt.parse:Fi.parse;(o=qr({},o)).stops&&(o.stops=o.stops.map(R=>[R[0],z(R[1])])),o.default=z(o.default?o.default:r.default)}if(o.colorSpace&&(x=o.colorSpace)!=="rgb"&&x!=="hcl"&&x!=="lab")throw new Error(`Unknown color space: "${o.colorSpace}"`);var x;let b,T,I;if(v==="exponential")b=Mp;else if(v==="interval")b=vc;else if(v==="categorical"){b=Cp,T=Object.create(null);for(const z of o.stops)T[z[0]]=z[1];I=typeof o.stops[0][0]}else{if(v!=="identity")throw new Error(`Unknown function type "${v}"`);b=Ep}if(p){const z={},R=[];for(let q=0;q<o.stops.length;q++){const H=o.stops[q],Q=H[0].zoom;z[Q]===void 0&&(z[Q]={zoom:Q,type:o.type,property:o.property,default:o.default,stops:[]},R.push(Q)),z[Q].stops.push([H[0].value,H[1]])}const B=[];for(const q of R)B.push([z[q].zoom,Tp(z[q],r)]);const V={name:"linear"};return{kind:"composite",interpolationType:V,interpolationFactor:bi.interpolationFactor.bind(void 0,V),zoomStops:B.map(q=>q[0]),evaluate:({zoom:q},H)=>Mp({stops:B,base:o.base},r,q).evaluate(q,H)}}if(g){const z=v==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:z,interpolationFactor:bi.interpolationFactor.bind(void 0,z),zoomStops:o.stops.map(R=>R[0]),evaluate:({zoom:R})=>b(o,r,R,T,I)}}return{kind:"source",evaluate(z,R){const B=R&&R.properties?R.properties[o.property]:void 0;return B===void 0?qo(o.default,r.default):b(o,r,B,T,I)}}}function qo(o,r,l){return o!==void 0?o:r!==void 0?r:l!==void 0?l:void 0}function Cp(o,r,l,p,g){return qo(typeof l===g?p[l]:void 0,o.default,r.default)}function vc(o,r,l){if(Lt(l)!=="number")return qo(o.default,r.default);const p=o.stops.length;if(p===1||l<=o.stops[0][0])return o.stops[0][1];if(l>=o.stops[p-1][0])return o.stops[p-1][1];const g=ac(o.stops.map(v=>v[0]),l);return o.stops[g][1]}function Mp(o,r,l){const p=o.base!==void 0?o.base:1;if(Lt(l)!=="number")return qo(o.default,r.default);const g=o.stops.length;if(g===1||l<=o.stops[0][0])return o.stops[0][1];if(l>=o.stops[g-1][0])return o.stops[g-1][1];const v=ac(o.stops.map(z=>z[0]),l),x=function(z,R,B,V){const q=V-B,H=z-B;return q===0?0:R===1?H/q:(Math.pow(R,H)-1)/(Math.pow(R,q)-1)}(l,p,o.stops[v][0],o.stops[v+1][0]),b=o.stops[v][1],T=o.stops[v+1][1],I=wi[r.type]||Pg;return typeof b.evaluate=="function"?{evaluate(...z){const R=b.evaluate.apply(void 0,z),B=T.evaluate.apply(void 0,z);if(R!==void 0&&B!==void 0)return I(R,B,x,o.colorSpace)}}:I(b,T,x,o.colorSpace)}function Ep(o,r,l){switch(r.type){case"color":l=qt.parse(l);break;case"formatted":l=Bi.fromString(l.toString());break;case"resolvedImage":l=Ni.fromString(l.toString());break;case"padding":l=Fi.parse(l);break;default:Lt(l)===r.type||r.type==="enum"&&r.values[l]||(l=void 0)}return qo(l,o.default,r.default)}rr.register(Vo,{error:[{kind:"error"},[bt],(o,[r])=>{throw new _n(r.evaluate(o))}],typeof:[bt,[_t],(o,[r])=>F(kn(r.evaluate(o)))],"to-rgba":[N(Fe,4),[xi],(o,[r])=>{const[l,p,g,v]=r.evaluate(o).rgb;return[255*l,255*p,255*g,v]}],rgb:[xi,[Fe,Fe,Fe],lh],rgba:[xi,[Fe,Fe,Fe,Fe],lh],has:{type:ut,overloads:[[[bt],(o,[r])=>ch(r.evaluate(o),o.properties())],[[bt,br],(o,[r,l])=>ch(r.evaluate(o),l.evaluate(o))]]},get:{type:_t,overloads:[[[bt],(o,[r])=>uh(r.evaluate(o),o.properties())],[[bt,br],(o,[r,l])=>uh(r.evaluate(o),l.evaluate(o))]]},"feature-state":[_t,[bt],(o,[r])=>uh(r.evaluate(o),o.featureState||{})],properties:[br,[],o=>o.properties()],"geometry-type":[bt,[],o=>o.geometryType()],id:[_t,[],o=>o.id()],zoom:[Fe,[],o=>o.globals.zoom],"heatmap-density":[Fe,[],o=>o.globals.heatmapDensity||0],"line-progress":[Fe,[],o=>o.globals.lineProgress||0],accumulated:[_t,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[Fe,co(Fe),(o,r)=>{let l=0;for(const p of r)l+=p.evaluate(o);return l}],"*":[Fe,co(Fe),(o,r)=>{let l=1;for(const p of r)l*=p.evaluate(o);return l}],"-":{type:Fe,overloads:[[[Fe,Fe],(o,[r,l])=>r.evaluate(o)-l.evaluate(o)],[[Fe],(o,[r])=>-r.evaluate(o)]]},"/":[Fe,[Fe,Fe],(o,[r,l])=>r.evaluate(o)/l.evaluate(o)],"%":[Fe,[Fe,Fe],(o,[r,l])=>r.evaluate(o)%l.evaluate(o)],ln2:[Fe,[],()=>Math.LN2],pi:[Fe,[],()=>Math.PI],e:[Fe,[],()=>Math.E],"^":[Fe,[Fe,Fe],(o,[r,l])=>Math.pow(r.evaluate(o),l.evaluate(o))],sqrt:[Fe,[Fe],(o,[r])=>Math.sqrt(r.evaluate(o))],log10:[Fe,[Fe],(o,[r])=>Math.log(r.evaluate(o))/Math.LN10],ln:[Fe,[Fe],(o,[r])=>Math.log(r.evaluate(o))],log2:[Fe,[Fe],(o,[r])=>Math.log(r.evaluate(o))/Math.LN2],sin:[Fe,[Fe],(o,[r])=>Math.sin(r.evaluate(o))],cos:[Fe,[Fe],(o,[r])=>Math.cos(r.evaluate(o))],tan:[Fe,[Fe],(o,[r])=>Math.tan(r.evaluate(o))],asin:[Fe,[Fe],(o,[r])=>Math.asin(r.evaluate(o))],acos:[Fe,[Fe],(o,[r])=>Math.acos(r.evaluate(o))],atan:[Fe,[Fe],(o,[r])=>Math.atan(r.evaluate(o))],min:[Fe,co(Fe),(o,r)=>Math.min(...r.map(l=>l.evaluate(o)))],max:[Fe,co(Fe),(o,r)=>Math.max(...r.map(l=>l.evaluate(o)))],abs:[Fe,[Fe],(o,[r])=>Math.abs(r.evaluate(o))],round:[Fe,[Fe],(o,[r])=>{const l=r.evaluate(o);return l<0?-Math.round(-l):Math.round(l)}],floor:[Fe,[Fe],(o,[r])=>Math.floor(r.evaluate(o))],ceil:[Fe,[Fe],(o,[r])=>Math.ceil(r.evaluate(o))],"filter-==":[ut,[bt,_t],(o,[r,l])=>o.properties()[r.value]===l.value],"filter-id-==":[ut,[_t],(o,[r])=>o.id()===r.value],"filter-type-==":[ut,[bt],(o,[r])=>o.geometryType()===r.value],"filter-<":[ut,[bt,_t],(o,[r,l])=>{const p=o.properties()[r.value],g=l.value;return typeof p==typeof g&&p<g}],"filter-id-<":[ut,[_t],(o,[r])=>{const l=o.id(),p=r.value;return typeof l==typeof p&&l<p}],"filter->":[ut,[bt,_t],(o,[r,l])=>{const p=o.properties()[r.value],g=l.value;return typeof p==typeof g&&p>g}],"filter-id->":[ut,[_t],(o,[r])=>{const l=o.id(),p=r.value;return typeof l==typeof p&&l>p}],"filter-<=":[ut,[bt,_t],(o,[r,l])=>{const p=o.properties()[r.value],g=l.value;return typeof p==typeof g&&p<=g}],"filter-id-<=":[ut,[_t],(o,[r])=>{const l=o.id(),p=r.value;return typeof l==typeof p&&l<=p}],"filter->=":[ut,[bt,_t],(o,[r,l])=>{const p=o.properties()[r.value],g=l.value;return typeof p==typeof g&&p>=g}],"filter-id->=":[ut,[_t],(o,[r])=>{const l=o.id(),p=r.value;return typeof l==typeof p&&l>=p}],"filter-has":[ut,[_t],(o,[r])=>r.value in o.properties()],"filter-has-id":[ut,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[ut,[N(bt)],(o,[r])=>r.value.indexOf(o.geometryType())>=0],"filter-id-in":[ut,[N(_t)],(o,[r])=>r.value.indexOf(o.id())>=0],"filter-in-small":[ut,[bt,N(_t)],(o,[r,l])=>l.value.indexOf(o.properties()[r.value])>=0],"filter-in-large":[ut,[bt,N(_t)],(o,[r,l])=>function(p,g,v,x){for(;v<=x;){const b=v+x>>1;if(g[b]===p)return!0;g[b]>p?x=b-1:v=b+1}return!1}(o.properties()[r.value],l.value,0,l.value.length-1)],all:{type:ut,overloads:[[[ut,ut],(o,[r,l])=>r.evaluate(o)&&l.evaluate(o)],[co(ut),(o,r)=>{for(const l of r)if(!l.evaluate(o))return!1;return!0}]]},any:{type:ut,overloads:[[[ut,ut],(o,[r,l])=>r.evaluate(o)||l.evaluate(o)],[co(ut),(o,r)=>{for(const l of r)if(l.evaluate(o))return!0;return!1}]]},"!":[ut,[ut],(o,[r])=>!r.evaluate(o)],"is-supported-script":[ut,[bt],(o,[r])=>{const l=o.globals&&o.globals.isSupportedScript;return!l||l(r.evaluate(o))}],upcase:[bt,[bt],(o,[r])=>r.evaluate(o).toUpperCase()],downcase:[bt,[bt],(o,[r])=>r.evaluate(o).toLowerCase()],concat:[bt,co(_t),(o,r)=>r.map(l=>nl(l.evaluate(o))).join("")],"resolved-locale":[bt,[Zr],(o,[r])=>r.evaluate(o).resolvedLocale()]});class xc{constructor(r,l){var p;this.expression=r,this._warningHistory={},this._evaluator=new sc,this._defaultValue=l?(p=l).type==="color"&&_c(p.default)?new qt(0,0,0,0):p.type==="color"?qt.parse(p.default)||null:p.type==="padding"?Fi.parse(p.default)||null:p.type==="variableAnchorOffsetCollection"?ir.parse(p.default)||null:p.default===void 0?null:p.default:null,this._enumValues=l&&l.type==="enum"?l.values:null}evaluateWithoutErrorHandling(r,l,p,g,v,x){return this._evaluator.globals=r,this._evaluator.feature=l,this._evaluator.featureState=p,this._evaluator.canonical=g,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(r,l,p,g,v,x){this._evaluator.globals=r,this._evaluator.feature=l||null,this._evaluator.featureState=p||null,this._evaluator.canonical=g,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=x||null;try{const b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new _n(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(b.message)),this._defaultValue}}}function wc(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in Vo}function Ho(o,r){const l=new no(Vo,cl,[],r?function(g){const v={color:xi,string:bt,number:Fe,enum:bt,boolean:ut,formatted:ds,padding:Ds,resolvedImage:Wr,variableAnchorOffsetCollection:ne};return g.type==="array"?N(v[g.value]||_t,g.length):v[g.type]}(r):void 0),p=l.parse(o,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?yc(new xc(p,r)):jo(l.errors)}class Zo{constructor(r,l){this.kind=r,this._styleExpression=l,this.isStateDependent=r!=="constant"&&!$o(l.expression)}evaluateWithoutErrorHandling(r,l,p,g,v,x){return this._styleExpression.evaluateWithoutErrorHandling(r,l,p,g,v,x)}evaluate(r,l,p,g,v,x){return this._styleExpression.evaluate(r,l,p,g,v,x)}}class Wo{constructor(r,l,p,g){this.kind=r,this.zoomStops=p,this._styleExpression=l,this.isStateDependent=r!=="camera"&&!$o(l.expression),this.interpolationType=g}evaluateWithoutErrorHandling(r,l,p,g,v,x){return this._styleExpression.evaluateWithoutErrorHandling(r,l,p,g,v,x)}evaluate(r,l,p,g,v,x){return this._styleExpression.evaluate(r,l,p,g,v,x)}interpolationFactor(r,l,p){return this.interpolationType?bi.interpolationFactor(this.interpolationType,r,l,p):0}}function dh(o,r){const l=Ho(o,r);if(l.result==="error")return l;const p=l.value.expression,g=ul(p);if(!g&&!Uo(r))return jo([new si("","data expressions not supported")]);const v=hl(p,["zoom"]);if(!v&&!kp(r))return jo([new si("","zoom expressions not supported")]);const x=dl(p);return x||v?x instanceof si?jo([x]):x instanceof bi&&!hh(r)?jo([new si("",'"interpolate" expressions cannot be used with this property')]):yc(x?new Wo(g?"camera":"composite",l.value,x.labels,x instanceof bi?x.interpolation:void 0):new Zo(g?"constant":"source",l.value)):jo([new si("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Go{constructor(r,l){this._parameters=r,this._specification=l,qr(this,Tp(this._parameters,this._specification))}static deserialize(r){return new Go(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function dl(o){let r=null;if(o instanceof Rs)r=dl(o.result);else if(o instanceof cc){for(const l of o.args)if(r=dl(l),r)break}else(o instanceof Bo||o instanceof bi)&&o.input instanceof rr&&o.input.name==="zoom"&&(r=o);return r instanceof si||o.eachChild(l=>{const p=dl(l);p instanceof si?r=p:!r&&p?r=new si("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&p&&r!==p&&(r=new si("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}function bc(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const r of o.slice(1))if(!bc(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}const Sc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ph(o){if(o==null)return{filter:()=>!0,needGeometry:!1};bc(o)||(o=kc(o));const r=Ho(o,Sc);if(r.result==="error")throw new Error(r.value.map(l=>`${l.key}: ${l.message}`).join(", "));return{filter:(l,p,g)=>r.value.evaluate(l,p,{},g),needGeometry:Ip(o)}}function Ag(o,r){return o<r?-1:o>r?1:0}function Ip(o){if(!Array.isArray(o))return!1;if(o[0]==="within"||o[0]==="distance")return!0;for(let r=1;r<o.length;r++)if(Ip(o[r]))return!0;return!1}function kc(o){if(!o)return!0;const r=o[0];return o.length<=1?r!=="any":r==="=="?fh(o[1],o[2],"=="):r==="!="?Hn(fh(o[1],o[2],"==")):r==="<"||r===">"||r==="<="||r===">="?fh(o[1],o[2],r):r==="any"?(l=o.slice(1),["any"].concat(l.map(kc))):r==="all"?["all"].concat(o.slice(1).map(kc)):r==="none"?["all"].concat(o.slice(1).map(kc).map(Hn)):r==="in"?pl(o[1],o.slice(2)):r==="!in"?Hn(pl(o[1],o.slice(2))):r==="has"?fl(o[1]):r!=="!has"||Hn(fl(o[1]));var l}function fh(o,r,l){switch(o){case"$type":return[`filter-type-${l}`,r];case"$id":return[`filter-id-${l}`,r];default:return[`filter-${l}`,o,r]}}function pl(o,r){if(r.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(l=>typeof l!=typeof r[0])?["filter-in-large",o,["literal",r.sort(Ag)]]:["filter-in-small",o,["literal",r]]}}function fl(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function Hn(o){return["!",o]}function uo(o){const r=typeof o;if(r==="number"||r==="boolean"||r==="string"||o==null)return JSON.stringify(o);if(Array.isArray(o)){let g="[";for(const v of o)g+=`${uo(v)},`;return`${g}]`}const l=Object.keys(o).sort();let p="{";for(let g=0;g<l.length;g++)p+=`${JSON.stringify(l[g])}:${uo(o[l[g]])},`;return`${p}}`}function Pp(o){let r="";for(const l of eo)r+=`/${uo(o[l])}`;return r}function Ap(o){const r=o.value;return r?[new ze(o.key,r,"constants have been deprecated as of v8")]:[]}function fn(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function Cr(o){if(Array.isArray(o))return o.map(Cr);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const r={};for(const l in o)r[l]=Cr(o[l]);return r}return fn(o)}function Vi(o){const r=o.key,l=o.value,p=o.valueSpec||{},g=o.objectElementValidators||{},v=o.style,x=o.styleSpec,b=o.validateSpec;let T=[];const I=Lt(l);if(I!=="object")return[new ze(r,l,`object expected, ${I} found`)];for(const z in l){const R=z.split(".")[0],B=p[R]||p["*"];let V;if(g[R])V=g[R];else if(p[R])V=b;else if(g["*"])V=g["*"];else{if(!p["*"]){T.push(new ze(r,l[z],`unknown property "${z}"`));continue}V=b}T=T.concat(V({key:(r&&`${r}.`)+z,value:l[z],valueSpec:B,style:v,styleSpec:x,object:l,objectKey:z,validateSpec:b},l))}for(const z in p)g[z]||p[z].required&&p[z].default===void 0&&l[z]===void 0&&T.push(new ze(r,l,`missing required property "${z}"`));return T}function ml(o){const r=o.value,l=o.valueSpec,p=o.style,g=o.styleSpec,v=o.key,x=o.arrayElementValidator||o.validateSpec;if(Lt(r)!=="array")return[new ze(v,r,`array expected, ${Lt(r)} found`)];if(l.length&&r.length!==l.length)return[new ze(v,r,`array length ${l.length} expected, length ${r.length} found`)];if(l["min-length"]&&r.length<l["min-length"])return[new ze(v,r,`array length at least ${l["min-length"]} expected, length ${r.length} found`)];let b={type:l.value,values:l.values};g.$version<7&&(b.function=l.function),Lt(l.value)==="object"&&(b=l.value);let T=[];for(let I=0;I<r.length;I++)T=T.concat(x({array:r,arrayIndex:I,value:r[I],valueSpec:b,validateSpec:o.validateSpec,style:p,styleSpec:g,key:`${v}[${I}]`}));return T}function mh(o){const r=o.key,l=o.value,p=o.valueSpec;let g=Lt(l);return g==="number"&&l!=l&&(g="NaN"),g!=="number"?[new ze(r,l,`number expected, ${g} found`)]:"minimum"in p&&l<p.minimum?[new ze(r,l,`${l} is less than the minimum value ${p.minimum}`)]:"maximum"in p&&l>p.maximum?[new ze(r,l,`${l} is greater than the maximum value ${p.maximum}`)]:[]}function Tc(o){const r=o.valueSpec,l=fn(o.value.type);let p,g,v,x={};const b=l!=="categorical"&&o.value.property===void 0,T=!b,I=Lt(o.value.stops)==="array"&&Lt(o.value.stops[0])==="array"&&Lt(o.value.stops[0][0])==="object",z=Vi({key:o.key,value:o.value,valueSpec:o.styleSpec.function,validateSpec:o.validateSpec,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(V){if(l==="identity")return[new ze(V.key,V.value,'identity function may not have a "stops" property')];let q=[];const H=V.value;return q=q.concat(ml({key:V.key,value:H,valueSpec:V.valueSpec,validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec,arrayElementValidator:R})),Lt(H)==="array"&&H.length===0&&q.push(new ze(V.key,H,"array must have at least one stop")),q},default:function(V){return V.validateSpec({key:V.key,value:V.value,valueSpec:r,validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec})}}});return l==="identity"&&b&&z.push(new ze(o.key,o.value,'missing required property "property"')),l==="identity"||o.value.stops||z.push(new ze(o.key,o.value,'missing required property "stops"')),l==="exponential"&&o.valueSpec.expression&&!hh(o.valueSpec)&&z.push(new ze(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(T&&!Uo(o.valueSpec)?z.push(new ze(o.key,o.value,"property functions not supported")):b&&!kp(o.valueSpec)&&z.push(new ze(o.key,o.value,"zoom functions not supported"))),l!=="categorical"&&!I||o.value.property!==void 0||z.push(new ze(o.key,o.value,'"property" property is required')),z;function R(V){let q=[];const H=V.value,Q=V.key;if(Lt(H)!=="array")return[new ze(Q,H,`array expected, ${Lt(H)} found`)];if(H.length!==2)return[new ze(Q,H,`array length 2 expected, length ${H.length} found`)];if(I){if(Lt(H[0])!=="object")return[new ze(Q,H,`object expected, ${Lt(H[0])} found`)];if(H[0].zoom===void 0)return[new ze(Q,H,"object stop key must have zoom")];if(H[0].value===void 0)return[new ze(Q,H,"object stop key must have value")];if(v&&v>fn(H[0].zoom))return[new ze(Q,H[0].zoom,"stop zoom values must appear in ascending order")];fn(H[0].zoom)!==v&&(v=fn(H[0].zoom),g=void 0,x={}),q=q.concat(Vi({key:`${Q}[0]`,value:H[0],valueSpec:{zoom:{}},validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec,objectElementValidators:{zoom:mh,value:B}}))}else q=q.concat(B({key:`${Q}[0]`,value:H[0],valueSpec:{},validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec},H));return wc(Cr(H[1]))?q.concat([new ze(`${Q}[1]`,H[1],"expressions are not allowed in function stops.")]):q.concat(V.validateSpec({key:`${Q}[1]`,value:H[1],valueSpec:r,validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec}))}function B(V,q){const H=Lt(V.value),Q=fn(V.value),ie=V.value!==null?V.value:q;if(p){if(H!==p)return[new ze(V.key,ie,`${H} stop domain type must match previous stop domain type ${p}`)]}else p=H;if(H!=="number"&&H!=="string"&&H!=="boolean")return[new ze(V.key,ie,"stop domain value must be a number, string, or boolean")];if(H!=="number"&&l!=="categorical"){let ye=`number expected, ${H} found`;return Uo(r)&&l===void 0&&(ye+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ze(V.key,ie,ye)]}return l!=="categorical"||H!=="number"||isFinite(Q)&&Math.floor(Q)===Q?l!=="categorical"&&H==="number"&&g!==void 0&&Q<g?[new ze(V.key,ie,"stop domain values must appear in ascending order")]:(g=Q,l==="categorical"&&Q in x?[new ze(V.key,ie,"stop domain values must be unique")]:(x[Q]=!0,[])):[new ze(V.key,ie,`integer expected, found ${Q}`)]}}function Ko(o){const r=(o.expressionContext==="property"?dh:Ho)(Cr(o.value),o.valueSpec);if(r.result==="error")return r.value.map(p=>new ze(`${o.key}${p.key}`,o.value,p.message));const l=r.value.expression||r.value._styleExpression.expression;if(o.expressionContext==="property"&&o.propertyKey==="text-font"&&!l.outputDefined())return[new ze(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if(o.expressionContext==="property"&&o.propertyType==="layout"&&!$o(l))return[new ze(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if(o.expressionContext==="filter"&&!$o(l))return[new ze(o.key,o.value,'"feature-state" data expressions are not supported with filters.')];if(o.expressionContext&&o.expressionContext.indexOf("cluster")===0){if(!hl(l,["zoom","feature-state"]))return[new ze(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(o.expressionContext==="cluster-initial"&&!ul(l))return[new ze(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function fs(o){const r=o.key,l=o.value,p=o.valueSpec,g=[];return Array.isArray(p.values)?p.values.indexOf(fn(l))===-1&&g.push(new ze(r,l,`expected one of [${p.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(p.values).indexOf(fn(l))===-1&&g.push(new ze(r,l,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(l)} found`)),g}function gh(o){return bc(Cr(o.value))?Ko(qr({},o,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Cc(o)}function Cc(o){const r=o.value,l=o.key;if(Lt(r)!=="array")return[new ze(l,r,`array expected, ${Lt(r)} found`)];const p=o.styleSpec;let g,v=[];if(r.length<1)return[new ze(l,r,"filter array must have at least 1 element")];switch(v=v.concat(fs({key:`${l}[0]`,value:r[0],valueSpec:p.filter_operator,style:o.style,styleSpec:o.styleSpec})),fn(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&fn(r[1])==="$type"&&v.push(new ze(l,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&v.push(new ze(l,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(g=Lt(r[1]),g!=="string"&&v.push(new ze(`${l}[1]`,r[1],`string expected, ${g} found`)));for(let x=2;x<r.length;x++)g=Lt(r[x]),fn(r[1])==="$type"?v=v.concat(fs({key:`${l}[${x}]`,value:r[x],valueSpec:p.geometry_type,style:o.style,styleSpec:o.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&v.push(new ze(`${l}[${x}]`,r[x],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let x=1;x<r.length;x++)v=v.concat(Cc({key:`${l}[${x}]`,value:r[x],style:o.style,styleSpec:o.styleSpec}));break;case"has":case"!has":g=Lt(r[1]),r.length!==2?v.push(new ze(l,r,`filter array for "${r[0]}" operator must have 2 elements`)):g!=="string"&&v.push(new ze(`${l}[1]`,r[1],`string expected, ${g} found`))}return v}function yh(o,r){const l=o.key,p=o.validateSpec,g=o.style,v=o.styleSpec,x=o.value,b=o.objectKey,T=v[`${r}_${o.layerType}`];if(!T)return[];const I=b.match(/^(.*)-transition$/);if(r==="paint"&&I&&T[I[1]]&&T[I[1]].transition)return p({key:l,value:x,valueSpec:v.transition,style:g,styleSpec:v});const z=o.valueSpec||T[b];if(!z)return[new ze(l,x,`unknown property "${b}"`)];let R;if(Lt(x)==="string"&&Uo(z)&&!z.tokens&&(R=/^{([^}]+)}$/.exec(x)))return[new ze(l,x,`"${b}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(R[1])} }\`.`)];const B=[];return o.layerType==="symbol"&&(b==="text-field"&&g&&!g.glyphs&&B.push(new ze(l,x,'use of "text-field" requires a style "glyphs" property')),b==="text-font"&&_c(Cr(x))&&fn(x.type)==="identity"&&B.push(new ze(l,x,'"text-font" does not support identity functions'))),B.concat(p({key:o.key,value:x,valueSpec:z,style:g,styleSpec:v,expressionContext:"property",propertyType:r,propertyKey:b}))}function Mc(o){return yh(o,"paint")}function _h(o){return yh(o,"layout")}function vh(o){let r=[];const l=o.value,p=o.key,g=o.style,v=o.styleSpec;l.type||l.ref||r.push(new ze(p,l,'either "type" or "ref" is required'));let x=fn(l.type);const b=fn(l.ref);if(l.id){const T=fn(l.id);for(let I=0;I<o.arrayIndex;I++){const z=g.layers[I];fn(z.id)===T&&r.push(new ze(p,l.id,`duplicate layer id "${l.id}", previously used at line ${z.id.__line__}`))}}if("ref"in l){let T;["type","source","source-layer","filter","layout"].forEach(I=>{I in l&&r.push(new ze(p,l[I],`"${I}" is prohibited for ref layers`))}),g.layers.forEach(I=>{fn(I.id)===b&&(T=I)}),T?T.ref?r.push(new ze(p,l.ref,"ref cannot reference another ref layer")):x=fn(T.type):r.push(new ze(p,l.ref,`ref layer "${b}" not found`))}else if(x!=="background")if(l.source){const T=g.sources&&g.sources[l.source],I=T&&fn(T.type);T?I==="vector"&&x==="raster"?r.push(new ze(p,l.source,`layer "${l.id}" requires a raster source`)):I!=="raster-dem"&&x==="hillshade"?r.push(new ze(p,l.source,`layer "${l.id}" requires a raster-dem source`)):I==="raster"&&x!=="raster"?r.push(new ze(p,l.source,`layer "${l.id}" requires a vector source`)):I!=="vector"||l["source-layer"]?I==="raster-dem"&&x!=="hillshade"?r.push(new ze(p,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):x!=="line"||!l.paint||!l.paint["line-gradient"]||I==="geojson"&&T.lineMetrics||r.push(new ze(p,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new ze(p,l,`layer "${l.id}" must specify a "source-layer"`)):r.push(new ze(p,l.source,`source "${l.source}" not found`))}else r.push(new ze(p,l,'missing required property "source"'));return r=r.concat(Vi({key:p,value:l,valueSpec:v.layer,style:o.style,styleSpec:o.styleSpec,validateSpec:o.validateSpec,objectElementValidators:{"*":()=>[],type:()=>o.validateSpec({key:`${p}.type`,value:l.type,valueSpec:v.layer.type,style:o.style,styleSpec:o.styleSpec,validateSpec:o.validateSpec,object:l,objectKey:"type"}),filter:gh,layout:T=>Vi({layer:l,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":I=>_h(qr({layerType:x},I))}}),paint:T=>Vi({layer:l,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":I=>Mc(qr({layerType:x},I))}})}})),r}function ho(o){const r=o.value,l=o.key,p=Lt(r);return p!=="string"?[new ze(l,r,`string expected, ${p} found`)]:[]}const Ec={promoteId:function({key:o,value:r}){if(Lt(r)==="string")return ho({key:o,value:r});{const l=[];for(const p in r)l.push(...ho({key:`${o}.${p}`,value:r[p]}));return l}}};function gl(o){const r=o.value,l=o.key,p=o.styleSpec,g=o.style,v=o.validateSpec;if(!r.type)return[new ze(l,r,'"type" is required')];const x=fn(r.type);let b;switch(x){case"vector":case"raster":return b=Vi({key:l,value:r,valueSpec:p[`source_${x.replace("-","_")}`],style:o.style,styleSpec:p,objectElementValidators:Ec,validateSpec:v}),b;case"raster-dem":return b=function(T){var I;const z=(I=T.sourceName)!==null&&I!==void 0?I:"",R=T.value,B=T.styleSpec,V=B.source_raster_dem,q=T.style;let H=[];const Q=Lt(R);if(R===void 0)return H;if(Q!=="object")return H.push(new ze("source_raster_dem",R,`object expected, ${Q} found`)),H;const ie=fn(R.encoding)==="custom",ye=["redFactor","greenFactor","blueFactor","baseShift"],ce=T.value.encoding?`"${T.value.encoding}"`:"Default";for(const me in R)!ie&&ye.includes(me)?H.push(new ze(me,R[me],`In "${z}": "${me}" is only valid when "encoding" is set to "custom". ${ce} encoding found`)):V[me]?H=H.concat(T.validateSpec({key:me,value:R[me],valueSpec:V[me],validateSpec:T.validateSpec,style:q,styleSpec:B})):H.push(new ze(me,R[me],`unknown property "${me}"`));return H}({sourceName:l,value:r,style:o.style,styleSpec:p,validateSpec:v}),b;case"geojson":if(b=Vi({key:l,value:r,valueSpec:p.source_geojson,style:g,styleSpec:p,validateSpec:v,objectElementValidators:Ec}),r.cluster)for(const T in r.clusterProperties){const[I,z]=r.clusterProperties[T],R=typeof I=="string"?[I,["accumulated"],["get",T]]:I;b.push(...Ko({key:`${l}.${T}.map`,value:z,validateSpec:v,expressionContext:"cluster-map"})),b.push(...Ko({key:`${l}.${T}.reduce`,value:R,validateSpec:v,expressionContext:"cluster-reduce"}))}return b;case"video":return Vi({key:l,value:r,valueSpec:p.source_video,style:g,validateSpec:v,styleSpec:p});case"image":return Vi({key:l,value:r,valueSpec:p.source_image,style:g,validateSpec:v,styleSpec:p});case"canvas":return[new ze(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return fs({key:`${l}.type`,value:r.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:g,validateSpec:v,styleSpec:p})}}function xh(o){const r=o.value,l=o.styleSpec,p=l.light,g=o.style;let v=[];const x=Lt(r);if(r===void 0)return v;if(x!=="object")return v=v.concat([new ze("light",r,`object expected, ${x} found`)]),v;for(const b in r){const T=b.match(/^(.*)-transition$/);v=v.concat(T&&p[T[1]]&&p[T[1]].transition?o.validateSpec({key:b,value:r[b],valueSpec:l.transition,validateSpec:o.validateSpec,style:g,styleSpec:l}):p[b]?o.validateSpec({key:b,value:r[b],valueSpec:p[b],validateSpec:o.validateSpec,style:g,styleSpec:l}):[new ze(b,r[b],`unknown property "${b}"`)])}return v}function wh(o){const r=o.value,l=o.styleSpec,p=l.sky,g=o.style,v=Lt(r);if(r===void 0)return[];if(v!=="object")return[new ze("sky",r,`object expected, ${v} found`)];let x=[];for(const b in r)x=x.concat(p[b]?o.validateSpec({key:b,value:r[b],valueSpec:p[b],style:g,styleSpec:l}):[new ze(b,r[b],`unknown property "${b}"`)]);return x}function bh(o){const r=o.value,l=o.styleSpec,p=l.terrain,g=o.style;let v=[];const x=Lt(r);if(r===void 0)return v;if(x!=="object")return v=v.concat([new ze("terrain",r,`object expected, ${x} found`)]),v;for(const b in r)v=v.concat(p[b]?o.validateSpec({key:b,value:r[b],valueSpec:p[b],validateSpec:o.validateSpec,style:g,styleSpec:l}):[new ze(b,r[b],`unknown property "${b}"`)]);return v}function Sh(o){let r=[];const l=o.value,p=o.key;if(Array.isArray(l)){const g=[],v=[];for(const x in l)l[x].id&&g.includes(l[x].id)&&r.push(new ze(p,l,`all the sprites' ids must be unique, but ${l[x].id} is duplicated`)),g.push(l[x].id),l[x].url&&v.includes(l[x].url)&&r.push(new ze(p,l,`all the sprites' URLs must be unique, but ${l[x].url} is duplicated`)),v.push(l[x].url),r=r.concat(Vi({key:`${p}[${x}]`,value:l[x],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:o.validateSpec}));return r}return ho({key:p,value:l})}const Ic={"*":()=>[],array:ml,boolean:function(o){const r=o.value,l=o.key,p=Lt(r);return p!=="boolean"?[new ze(l,r,`boolean expected, ${p} found`)]:[]},number:mh,color:function(o){const r=o.key,l=o.value,p=Lt(l);return p!=="string"?[new ze(r,l,`color expected, ${p} found`)]:qt.parse(String(l))?[]:[new ze(r,l,`color expected, "${l}" found`)]},constants:Ap,enum:fs,filter:gh,function:Tc,layer:vh,object:Vi,source:gl,light:xh,sky:wh,terrain:bh,projection:function(o){const r=o.value,l=o.styleSpec,p=l.projection,g=o.style,v=Lt(r);if(r===void 0)return[];if(v!=="object")return[new ze("projection",r,`object expected, ${v} found`)];let x=[];for(const b in r)x=x.concat(p[b]?o.validateSpec({key:b,value:r[b],valueSpec:p[b],style:g,styleSpec:l}):[new ze(b,r[b],`unknown property "${b}"`)]);return x},string:ho,formatted:function(o){return ho(o).length===0?[]:Ko(o)},resolvedImage:function(o){return ho(o).length===0?[]:Ko(o)},padding:function(o){const r=o.key,l=o.value;if(Lt(l)==="array"){if(l.length<1||l.length>4)return[new ze(r,l,`padding requires 1 to 4 values; ${l.length} values found`)];const p={type:"number"};let g=[];for(let v=0;v<l.length;v++)g=g.concat(o.validateSpec({key:`${r}[${v}]`,value:l[v],validateSpec:o.validateSpec,valueSpec:p}));return g}return mh({key:r,value:l,valueSpec:{}})},variableAnchorOffsetCollection:function(o){const r=o.key,l=o.value,p=Lt(l),g=o.styleSpec;if(p!=="array"||l.length<1||l.length%2!=0)return[new ze(r,l,"variableAnchorOffsetCollection requires a non-empty array of even length")];let v=[];for(let x=0;x<l.length;x+=2)v=v.concat(fs({key:`${r}[${x}]`,value:l[x],valueSpec:g.layout_symbol["text-anchor"]})),v=v.concat(ml({key:`${r}[${x+1}]`,value:l[x+1],valueSpec:{length:2,value:"number"},validateSpec:o.validateSpec,style:o.style,styleSpec:g}));return v},sprite:Sh};function Xo(o){const r=o.value,l=o.valueSpec,p=o.styleSpec;return o.validateSpec=Xo,l.expression&&_c(fn(r))?Tc(o):l.expression&&wc(Cr(r))?Ko(o):l.type&&Ic[l.type]?Ic[l.type](o):Vi(qr({},o,{valueSpec:l.type?p[l.type]:l}))}function zp(o){const r=o.value,l=o.key,p=ho(o);return p.length||(r.indexOf("{fontstack}")===-1&&p.push(new ze(l,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&p.push(new ze(l,r,'"glyphs" url must include a "{range}" token'))),p}function sr(o,r=xe){let l=[];return l=l.concat(Xo({key:"",value:o,valueSpec:r.$root,styleSpec:r,style:o,validateSpec:Xo,objectElementValidators:{glyphs:zp,"*":()=>[]}})),o.constants&&(l=l.concat(Ap({key:"constants",value:o.constants,style:o,styleSpec:r,validateSpec:Xo}))),kh(l)}function Kr(o){return function(r){return o({...r,validateSpec:Xo})}}function kh(o){return[].concat(o).sort((r,l)=>r.line-l.line)}function Mr(o){return function(...r){return kh(o.apply(this,r))}}sr.source=Mr(Kr(gl)),sr.sprite=Mr(Kr(Sh)),sr.glyphs=Mr(Kr(zp)),sr.light=Mr(Kr(xh)),sr.sky=Mr(Kr(wh)),sr.terrain=Mr(Kr(bh)),sr.layer=Mr(Kr(vh)),sr.filter=Mr(Kr(gh)),sr.paintProperty=Mr(Kr(Mc)),sr.layoutProperty=Mr(Kr(_h));const po=sr,zg=po.light,Dg=po.sky,Dp=po.paintProperty,Rp=po.layoutProperty;function Th(o,r){let l=!1;if(r&&r.length)for(const p of r)o.fire(new Ps(new Error(p.message))),l=!0;return l}class Jo{constructor(r,l,p){const g=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;const x=new Int32Array(this.arrayBuffer);r=x[0],this.d=(l=x[1])+2*(p=x[2]);for(let T=0;T<this.d*this.d;T++){const I=x[3+T],z=x[3+T+1];g.push(I===z?null:x.subarray(I,z))}const b=x[3+g.length+1];this.keys=x.subarray(x[3+g.length],b),this.bboxes=x.subarray(b),this.insert=this._insertReadonly}else{this.d=l+2*p;for(let x=0;x<this.d*this.d;x++)g.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=r,this.padding=p,this.scale=l/r,this.uid=0;const v=p/l*r;this.min=-v,this.max=r+v}insert(r,l,p,g,v){this._forEachCell(l,p,g,v,this._insertCell,this.uid++,void 0,void 0),this.keys.push(r),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(g),this.bboxes.push(v)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(r,l,p,g,v,x){this.cells[v].push(x)}query(r,l,p,g,v){const x=this.min,b=this.max;if(r<=x&&l<=x&&b<=p&&b<=g&&!v)return Array.prototype.slice.call(this.keys);{const T=[];return this._forEachCell(r,l,p,g,this._queryCell,T,{},v),T}}_queryCell(r,l,p,g,v,x,b,T){const I=this.cells[v];if(I!==null){const z=this.keys,R=this.bboxes;for(let B=0;B<I.length;B++){const V=I[B];if(b[V]===void 0){const q=4*V;(T?T(R[q+0],R[q+1],R[q+2],R[q+3]):r<=R[q+2]&&l<=R[q+3]&&p>=R[q+0]&&g>=R[q+1])?(b[V]=!0,x.push(z[V])):b[V]=!1}}}}_forEachCell(r,l,p,g,v,x,b,T){const I=this._convertToCellCoord(r),z=this._convertToCellCoord(l),R=this._convertToCellCoord(p),B=this._convertToCellCoord(g);for(let V=I;V<=R;V++)for(let q=z;q<=B;q++){const H=this.d*q+V;if((!T||T(this._convertFromCellCoord(V),this._convertFromCellCoord(q),this._convertFromCellCoord(V+1),this._convertFromCellCoord(q+1)))&&v.call(this,r,l,p,g,H,x,b,T))return}}_convertFromCellCoord(r){return(r-this.padding)/this.scale}_convertToCellCoord(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const r=this.cells,l=3+this.cells.length+1+1;let p=0;for(let x=0;x<this.cells.length;x++)p+=this.cells[x].length;const g=new Int32Array(l+p+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;let v=l;for(let x=0;x<r.length;x++){const b=r[x];g[3+x]=v,g.set(b,v),v+=b.length}return g[3+r.length]=v,g.set(this.keys,v),v+=this.keys.length,g[3+r.length+1]=v,g.set(this.bboxes,v),v+=this.bboxes.length,g.buffer}static serialize(r,l){const p=r.toArrayBuffer();return l&&l.push(p),{buffer:p}}static deserialize(r){return new Jo(r.buffer)}}const or={};function Ge(o,r,l={}){if(or[o])throw new Error(`${o} is already registered.`);Object.defineProperty(r,"_classRegistryKey",{value:o,writeable:!1}),or[o]={klass:r,omit:l.omit||[],shallow:l.shallow||[]}}Ge("Object",Object),Ge("TransferableGridIndex",Jo),Ge("Color",qt),Ge("Error",Error),Ge("AJAXError",An),Ge("ResolvedImage",Ni),Ge("StylePropertyFunction",Go),Ge("StyleExpression",xc,{omit:["_evaluator"]}),Ge("ZoomDependentExpression",Wo),Ge("ZoomConstantExpression",Zo),Ge("CompoundExpression",rr,{omit:["_evaluate"]});for(const o in Vo)Vo[o]._classRegistryKey||Ge(`Expression_${o}`,Vo[o]);function Pc(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function Ch(o){return o.$name||o.constructor._classRegistryKey}function Op(o){return!function(r){if(r===null||typeof r!="object")return!1;const l=Ch(r);return!(!l||l==="Object")}(o)&&(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||o instanceof Blob||o instanceof Error||Pc(o)||yi(o)||ArrayBuffer.isView(o)||o instanceof ImageData)}function Yo(o,r){if(Op(o))return(Pc(o)||yi(o))&&r&&r.push(o),ArrayBuffer.isView(o)&&r&&r.push(o.buffer),o instanceof ImageData&&r&&r.push(o.data.buffer),o;if(Array.isArray(o)){const v=[];for(const x of o)v.push(Yo(x,r));return v}if(typeof o!="object")throw new Error("can't serialize object of type "+typeof o);const l=Ch(o);if(!l)throw new Error(`can't serialize object of unregistered class ${o.constructor.name}`);if(!or[l])throw new Error(`${l} is not registered.`);const{klass:p}=or[l],g=p.serialize?p.serialize(o,r):{};if(p.serialize){if(r&&g===r[r.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const v in o){if(!o.hasOwnProperty(v)||or[l].omit.indexOf(v)>=0)continue;const x=o[v];g[v]=or[l].shallow.indexOf(v)>=0?x:Yo(x,r)}o instanceof Error&&(g.message=o.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(g.$name=l),g}function Qo(o){if(Op(o))return o;if(Array.isArray(o))return o.map(Qo);if(typeof o!="object")throw new Error("can't deserialize object of type "+typeof o);const r=Ch(o)||"Object";if(!or[r])throw new Error(`can't deserialize unregistered class ${r}`);const{klass:l}=or[r];if(!l)throw new Error(`can't deserialize unregistered class ${r}`);if(l.deserialize)return l.deserialize(o);const p=Object.create(l.prototype);for(const g of Object.keys(o)){if(g==="$name")continue;const v=o[g];p[g]=or[r].shallow.indexOf(g)>=0?v:Qo(v)}return p}class Mh{constructor(){this.first=!0}update(r,l){const p=Math.floor(r);return this.first?(this.first=!1,this.lastIntegerZoom=p,this.lastIntegerZoomTime=0,this.lastZoom=r,this.lastFloorZoom=p,!0):(this.lastFloorZoom>p?(this.lastIntegerZoom=p+1,this.lastIntegerZoomTime=l):this.lastFloorZoom<p&&(this.lastIntegerZoom=p,this.lastIntegerZoomTime=l),r!==this.lastZoom&&(this.lastZoom=r,this.lastFloorZoom=p,!0))}}const It={"Latin-1 Supplement":o=>o>=128&&o<=255,"Hangul Jamo":o=>o>=4352&&o<=4607,Khmer:o=>o>=6016&&o<=6143,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Katakana:o=>o>=12448&&o<=12543,Kanbun:o=>o>=12688&&o<=12703,"CJK Strokes":o=>o>=12736&&o<=12783,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"Private Use Area":o=>o>=57344&&o<=63743,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519};function Eh(o){for(const r of o)if(Ph(r.charCodeAt(0)))return!0;return!1}function Rg(o){for(const r of o)if(!ea(r.charCodeAt(0)))return!1;return!0}function Ih(o){const r=o.map(l=>{try{return new RegExp(`\\p{sc=${l}}`,"u").source}catch{return null}}).filter(l=>l);return new RegExp(r.join("|"),"u")}const Og=Ih(["Arab","Dupl","Mong","Ougr","Syrc"]);function ea(o){return!Og.test(String.fromCodePoint(o))}const Lp=Ih(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Ph(o){return!(o!==746&&o!==747&&(o<4352||!(It["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||It["CJK Compatibility"](o)||It["CJK Strokes"](o)||!(!It["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||It["Enclosed CJK Letters and Months"](o)||It["Ideographic Description Characters"](o)||It.Kanbun(o)||It.Katakana(o)&&o!==12540||!(!It["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!It["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||It["Vertical Forms"](o)||It["Yijing Hexagram Symbols"](o)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(o))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(o))||Lp.test(String.fromCodePoint(o)))))}function Bp(o){return!(Ph(o)||function(r){return!!(It["Latin-1 Supplement"](r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||It["General Punctuation"](r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||It["Letterlike Symbols"](r)||It["Number Forms"](r)||It["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||It["Control Pictures"](r)&&r!==9251||It["Optical Character Recognition"](r)||It["Enclosed Alphanumerics"](r)||It["Geometric Shapes"](r)||It["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||It["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||It["CJK Symbols and Punctuation"](r)||It.Katakana(r)||It["Private Use Area"](r)||It["CJK Compatibility Forms"](r)||It["Small Form Variants"](r)||It["Halfwidth and Fullwidth Forms"](r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)}(o))}const Lg=Ih(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Ah(o){return Lg.test(String.fromCodePoint(o))}function Bg(o,r){return!(!r&&Ah(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||It.Khmer(o))}function Fg(o){for(const r of o)if(Ah(r.charCodeAt(0)))return!0;return!1}const $i=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(o){this.pluginStatus=o.pluginStatus,this.pluginURL=o.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(o){this.applyArabicShaping=o.applyArabicShaping,this.processBidirectionalText=o.processBidirectionalText,this.processStyledBidirectionalText=o.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Yt{constructor(r,l){this.zoom=r,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.zoomHistory=l.zoomHistory,this.transition=l.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Mh,this.transition={})}isSupportedScript(r){return function(l,p){for(const g of l)if(!Bg(g.charCodeAt(0),p))return!1;return!0}(r,$i.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const r=this.zoom,l=r-Math.floor(r),p=this.crossFadingFactor();return r>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:l+(1-l)*p}:{fromScale:.5,toScale:1,t:1-(1-p)*l}}}class ta{constructor(r,l){this.property=r,this.value=l,this.expression=function(p,g){if(_c(p))return new Go(p,g);if(wc(p)){const v=dh(p,g);if(v.result==="error")throw new Error(v.value.map(x=>`${x.key}: ${x.message}`).join(", "));return v.value}{let v=p;return g.type==="color"&&typeof p=="string"?v=qt.parse(p):g.type!=="padding"||typeof p!="number"&&!Array.isArray(p)?g.type==="variableAnchorOffsetCollection"&&Array.isArray(p)&&(v=ir.parse(p)):v=Fi.parse(p),{kind:"constant",evaluate:()=>v}}}(l===void 0?r.specification.default:l,r.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(r,l,p){return this.property.possiblyEvaluate(this,r,l,p)}}class Ac{constructor(r){this.property=r,this.value=new ta(r,void 0)}transitioned(r,l){return new Fp(this.property,this.value,l,De({},r.transition,this.transition),r.now)}untransitioned(){return new Fp(this.property,this.value,null,{},0)}}class zc{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return xt(this._values[r].value.value)}setValue(r,l){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new Ac(this._values[r].property)),this._values[r].value=new ta(this._values[r].property,l===null?void 0:xt(l))}getTransition(r){return xt(this._values[r].transition)}setTransition(r,l){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new Ac(this._values[r].property)),this._values[r].transition=xt(l)||void 0}serialize(){const r={};for(const l of Object.keys(this._values)){const p=this.getValue(l);p!==void 0&&(r[l]=p);const g=this.getTransition(l);g!==void 0&&(r[`${l}-transition`]=g)}return r}transitioned(r,l){const p=new yl(this._properties);for(const g of Object.keys(this._values))p._values[g]=this._values[g].transitioned(r,l._values[g]);return p}untransitioned(){const r=new yl(this._properties);for(const l of Object.keys(this._values))r._values[l]=this._values[l].untransitioned();return r}}class Fp{constructor(r,l,p,g,v){this.property=r,this.value=l,this.begin=v+g.delay||0,this.end=this.begin+g.duration||0,r.specification.transition&&(g.delay||g.duration)&&(this.prior=p)}possiblyEvaluate(r,l,p){const g=r.now||0,v=this.value.possiblyEvaluate(r,l,p),x=this.prior;if(x){if(g>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(g<this.begin)return x.possiblyEvaluate(r,l,p);{const b=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(r,l,p),v,function(T){if(T<=0)return 0;if(T>=1)return 1;const I=T*T,z=I*T;return 4*(T<.5?z:3*(T-I)+z-.75)}(b))}}return v}}class yl{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,l,p){const g=new vl(this._properties);for(const v of Object.keys(this._values))g._values[v]=this._values[v].possiblyEvaluate(r,l,p);return g}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class _l{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}hasValue(r){return this._values[r].value!==void 0}getValue(r){return xt(this._values[r].value)}setValue(r,l){this._values[r]=new ta(this._values[r].property,l===null?void 0:xt(l))}serialize(){const r={};for(const l of Object.keys(this._values)){const p=this.getValue(l);p!==void 0&&(r[l]=p)}return r}possiblyEvaluate(r,l,p){const g=new vl(this._properties);for(const v of Object.keys(this._values))g._values[v]=this._values[v].possiblyEvaluate(r,l,p);return g}}class Xr{constructor(r,l,p){this.property=r,this.value=l,this.parameters=p}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,l,p,g){return this.property.evaluate(this.value,this.parameters,r,l,p,g)}}class vl{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class Je{constructor(r){this.specification=r}possiblyEvaluate(r,l){if(r.isDataDriven())throw new Error("Value should not be data driven");return r.expression.evaluate(l)}interpolate(r,l,p){const g=wi[this.specification.type];return g?g(r,l,p):r}}class ct{constructor(r,l){this.specification=r,this.overrides=l}possiblyEvaluate(r,l,p,g){return new Xr(this,r.expression.kind==="constant"||r.expression.kind==="camera"?{kind:"constant",value:r.expression.evaluate(l,null,{},p,g)}:r.expression,l)}interpolate(r,l,p){if(r.value.kind!=="constant"||l.value.kind!=="constant")return r;if(r.value.value===void 0||l.value.value===void 0)return new Xr(this,{kind:"constant",value:void 0},r.parameters);const g=wi[this.specification.type];if(g){const v=g(r.value.value,l.value.value,p);return new Xr(this,{kind:"constant",value:v},r.parameters)}return r}evaluate(r,l,p,g,v,x){return r.kind==="constant"?r.value:r.evaluate(l,p,g,v,x)}}class Dc extends ct{possiblyEvaluate(r,l,p,g){if(r.value===void 0)return new Xr(this,{kind:"constant",value:void 0},l);if(r.expression.kind==="constant"){const v=r.expression.evaluate(l,null,{},p,g),x=r.property.specification.type==="resolvedImage"&&typeof v!="string"?v.name:v,b=this._calculate(x,x,x,l);return new Xr(this,{kind:"constant",value:b},l)}if(r.expression.kind==="camera"){const v=this._calculate(r.expression.evaluate({zoom:l.zoom-1}),r.expression.evaluate({zoom:l.zoom}),r.expression.evaluate({zoom:l.zoom+1}),l);return new Xr(this,{kind:"constant",value:v},l)}return new Xr(this,r.expression,l)}evaluate(r,l,p,g,v,x){if(r.kind==="source"){const b=r.evaluate(l,p,g,v,x);return this._calculate(b,b,b,l)}return r.kind==="composite"?this._calculate(r.evaluate({zoom:Math.floor(l.zoom)-1},p,g),r.evaluate({zoom:Math.floor(l.zoom)},p,g),r.evaluate({zoom:Math.floor(l.zoom)+1},p,g),l):r.value}_calculate(r,l,p,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:r,to:l}:{from:p,to:l}}interpolate(r){return r}}class Rc{constructor(r){this.specification=r}possiblyEvaluate(r,l,p,g){if(r.value!==void 0){if(r.expression.kind==="constant"){const v=r.expression.evaluate(l,null,{},p,g);return this._calculate(v,v,v,l)}return this._calculate(r.expression.evaluate(new Yt(Math.floor(l.zoom-1),l)),r.expression.evaluate(new Yt(Math.floor(l.zoom),l)),r.expression.evaluate(new Yt(Math.floor(l.zoom+1),l)),l)}}_calculate(r,l,p,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:r,to:l}:{from:p,to:l}}interpolate(r){return r}}class zh{constructor(r){this.specification=r}possiblyEvaluate(r,l,p,g){return!!r.expression.evaluate(l,null,{},p,g)}interpolate(){return!1}}class _{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const l in r){const p=r[l];p.specification.overridable&&this.overridableProperties.push(l);const g=this.defaultPropertyValues[l]=new ta(p,void 0),v=this.defaultTransitionablePropertyValues[l]=new Ac(p);this.defaultTransitioningPropertyValues[l]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=g.possiblyEvaluate({})}}}Ge("DataDrivenProperty",ct),Ge("DataConstantProperty",Je),Ge("CrossFadedDataDrivenProperty",Dc),Ge("CrossFadedProperty",Rc),Ge("ColorRampProperty",zh);const i="-transition";class h extends zo{constructor(r,l){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1},r.type!=="custom"&&(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),l.layout&&(this._unevaluatedLayout=new _l(l.layout)),l.paint)){this._transitionablePaint=new zc(l.paint);for(const p in r.paint)this.setPaintProperty(p,r.paint[p],{validate:!1});for(const p in r.layout)this.setLayoutProperty(p,r.layout[p],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new vl(l.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,l,p={}){l!=null&&this._validate(Rp,`layers.${this.id}.layout.${r}`,r,l,p)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,l):this.visibility=l)}getPaintProperty(r){return r.endsWith(i)?this._transitionablePaint.getTransition(r.slice(0,-11)):this._transitionablePaint.getValue(r)}setPaintProperty(r,l,p={}){if(l!=null&&this._validate(Dp,`layers.${this.id}.paint.${r}`,r,l,p))return!1;if(r.endsWith(i))return this._transitionablePaint.setTransition(r.slice(0,-11),l||void 0),!1;{const g=this._transitionablePaint._values[r],v=g.property.specification["property-type"]==="cross-faded-data-driven",x=g.value.isDataDriven(),b=g.value;this._transitionablePaint.setValue(r,l),this._handleSpecialPaintPropertyUpdate(r);const T=this._transitionablePaint._values[r].value;return T.isDataDriven()||x||v||this._handleOverridablePaintPropertyUpdate(r,b,T)}}_handleSpecialPaintPropertyUpdate(r){}_handleOverridablePaintPropertyUpdate(r,l,p){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,l){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,l)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),ft(r,(l,p)=>!(l===void 0||p==="layout"&&!Object.keys(l).length||p==="paint"&&!Object.keys(l).length))}_validate(r,l,p,g,v={}){return(!v||v.validate!==!1)&&Th(this,r.call(po,{key:l,layerType:this.type,objectKey:p,value:g,styleSpec:xe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const l=this.paint.get(r);if(l instanceof Xr&&Uo(l.property.specification)&&(l.value.kind==="source"||l.value.kind==="composite")&&l.value.isStateDependent)return!0}return!1}}const f={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class m{constructor(r,l){this._structArray=r,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class y{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,l){return r._trim(),l&&(r.isTransferred=!0,l.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const l=Object.create(this.prototype);return l.arrayBuffer=r.arrayBuffer,l.length=r.length,l.capacity=r.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function S(o,r=1){let l=0,p=0;return{members:o.map(g=>{const v=f[g.type].BYTES_PER_ELEMENT,x=l=C(l,Math.max(r,v)),b=g.components||1;return p=Math.max(p,v),l+=v*b,{name:g.name,type:g.type,components:b,offset:x}}),size:C(l,Math.max(p,r)),alignment:r}}function C(o,r){return Math.ceil(o/r)*r}class M extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l){const p=this.length;return this.resize(p+1),this.emplace(p,r,l)}emplace(r,l,p){const g=2*r;return this.int16[g+0]=l,this.int16[g+1]=p,r}}M.prototype.bytesPerElement=4,Ge("StructArrayLayout2i4",M);class D extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,p){const g=this.length;return this.resize(g+1),this.emplace(g,r,l,p)}emplace(r,l,p,g){const v=3*r;return this.int16[v+0]=l,this.int16[v+1]=p,this.int16[v+2]=g,r}}D.prototype.bytesPerElement=6,Ge("StructArrayLayout3i6",D);class O extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,r,l,p,g)}emplace(r,l,p,g,v){const x=4*r;return this.int16[x+0]=l,this.int16[x+1]=p,this.int16[x+2]=g,this.int16[x+3]=v,r}}O.prototype.bytesPerElement=8,Ge("StructArrayLayout4i8",O);class L extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,p,g,v,x){const b=this.length;return this.resize(b+1),this.emplace(b,r,l,p,g,v,x)}emplace(r,l,p,g,v,x,b){const T=6*r;return this.int16[T+0]=l,this.int16[T+1]=p,this.int16[T+2]=g,this.int16[T+3]=v,this.int16[T+4]=x,this.int16[T+5]=b,r}}L.prototype.bytesPerElement=12,Ge("StructArrayLayout2i4i12",L);class U extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,p,g,v,x){const b=this.length;return this.resize(b+1),this.emplace(b,r,l,p,g,v,x)}emplace(r,l,p,g,v,x,b){const T=4*r,I=8*r;return this.int16[T+0]=l,this.int16[T+1]=p,this.uint8[I+4]=g,this.uint8[I+5]=v,this.uint8[I+6]=x,this.uint8[I+7]=b,r}}U.prototype.bytesPerElement=8,Ge("StructArrayLayout2i4ub8",U);class Z extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l){const p=this.length;return this.resize(p+1),this.emplace(p,r,l)}emplace(r,l,p){const g=2*r;return this.float32[g+0]=l,this.float32[g+1]=p,r}}Z.prototype.bytesPerElement=8,Ge("StructArrayLayout2f8",Z);class G extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,p,g,v,x,b,T,I,z){const R=this.length;return this.resize(R+1),this.emplace(R,r,l,p,g,v,x,b,T,I,z)}emplace(r,l,p,g,v,x,b,T,I,z,R){const B=10*r;return this.uint16[B+0]=l,this.uint16[B+1]=p,this.uint16[B+2]=g,this.uint16[B+3]=v,this.uint16[B+4]=x,this.uint16[B+5]=b,this.uint16[B+6]=T,this.uint16[B+7]=I,this.uint16[B+8]=z,this.uint16[B+9]=R,r}}G.prototype.bytesPerElement=20,Ge("StructArrayLayout10ui20",G);class te extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,p,g,v,x,b,T,I,z,R,B){const V=this.length;return this.resize(V+1),this.emplace(V,r,l,p,g,v,x,b,T,I,z,R,B)}emplace(r,l,p,g,v,x,b,T,I,z,R,B,V){const q=12*r;return this.int16[q+0]=l,this.int16[q+1]=p,this.int16[q+2]=g,this.int16[q+3]=v,this.uint16[q+4]=x,this.uint16[q+5]=b,this.uint16[q+6]=T,this.uint16[q+7]=I,this.int16[q+8]=z,this.int16[q+9]=R,this.int16[q+10]=B,this.int16[q+11]=V,r}}te.prototype.bytesPerElement=24,Ge("StructArrayLayout4i4ui4i24",te);class re extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,p){const g=this.length;return this.resize(g+1),this.emplace(g,r,l,p)}emplace(r,l,p,g){const v=3*r;return this.float32[v+0]=l,this.float32[v+1]=p,this.float32[v+2]=g,r}}re.prototype.bytesPerElement=12,Ge("StructArrayLayout3f12",re);class se extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.uint32[1*r+0]=l,r}}se.prototype.bytesPerElement=4,Ge("StructArrayLayout1ul4",se);class ae extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,p,g,v,x,b,T,I){const z=this.length;return this.resize(z+1),this.emplace(z,r,l,p,g,v,x,b,T,I)}emplace(r,l,p,g,v,x,b,T,I,z){const R=10*r,B=5*r;return this.int16[R+0]=l,this.int16[R+1]=p,this.int16[R+2]=g,this.int16[R+3]=v,this.int16[R+4]=x,this.int16[R+5]=b,this.uint32[B+3]=T,this.uint16[R+8]=I,this.uint16[R+9]=z,r}}ae.prototype.bytesPerElement=20,Ge("StructArrayLayout6i1ul2ui20",ae);class Y extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,p,g,v,x){const b=this.length;return this.resize(b+1),this.emplace(b,r,l,p,g,v,x)}emplace(r,l,p,g,v,x,b){const T=6*r;return this.int16[T+0]=l,this.int16[T+1]=p,this.int16[T+2]=g,this.int16[T+3]=v,this.int16[T+4]=x,this.int16[T+5]=b,r}}Y.prototype.bytesPerElement=12,Ge("StructArrayLayout2i2i2i12",Y);class de extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,p,g,v){const x=this.length;return this.resize(x+1),this.emplace(x,r,l,p,g,v)}emplace(r,l,p,g,v,x){const b=4*r,T=8*r;return this.float32[b+0]=l,this.float32[b+1]=p,this.float32[b+2]=g,this.int16[T+6]=v,this.int16[T+7]=x,r}}de.prototype.bytesPerElement=16,Ge("StructArrayLayout2f1f2i16",de);class fe extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,p,g,v,x){const b=this.length;return this.resize(b+1),this.emplace(b,r,l,p,g,v,x)}emplace(r,l,p,g,v,x,b){const T=16*r,I=4*r,z=8*r;return this.uint8[T+0]=l,this.uint8[T+1]=p,this.float32[I+1]=g,this.float32[I+2]=v,this.int16[z+6]=x,this.int16[z+7]=b,r}}fe.prototype.bytesPerElement=16,Ge("StructArrayLayout2ub2f2i16",fe);class _e extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,p){const g=this.length;return this.resize(g+1),this.emplace(g,r,l,p)}emplace(r,l,p,g){const v=3*r;return this.uint16[v+0]=l,this.uint16[v+1]=p,this.uint16[v+2]=g,r}}_e.prototype.bytesPerElement=6,Ge("StructArrayLayout3ui6",_e);class Te extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,p,g,v,x,b,T,I,z,R,B,V,q,H,Q,ie){const ye=this.length;return this.resize(ye+1),this.emplace(ye,r,l,p,g,v,x,b,T,I,z,R,B,V,q,H,Q,ie)}emplace(r,l,p,g,v,x,b,T,I,z,R,B,V,q,H,Q,ie,ye){const ce=24*r,me=12*r,we=48*r;return this.int16[ce+0]=l,this.int16[ce+1]=p,this.uint16[ce+2]=g,this.uint16[ce+3]=v,this.uint32[me+2]=x,this.uint32[me+3]=b,this.uint32[me+4]=T,this.uint16[ce+10]=I,this.uint16[ce+11]=z,this.uint16[ce+12]=R,this.float32[me+7]=B,this.float32[me+8]=V,this.uint8[we+36]=q,this.uint8[we+37]=H,this.uint8[we+38]=Q,this.uint32[me+10]=ie,this.int16[ce+22]=ye,r}}Te.prototype.bytesPerElement=48,Ge("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Te);class Pe extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,p,g,v,x,b,T,I,z,R,B,V,q,H,Q,ie,ye,ce,me,we,Ie,qe,lt,je,Ve,nt,Ke){const We=this.length;return this.resize(We+1),this.emplace(We,r,l,p,g,v,x,b,T,I,z,R,B,V,q,H,Q,ie,ye,ce,me,we,Ie,qe,lt,je,Ve,nt,Ke)}emplace(r,l,p,g,v,x,b,T,I,z,R,B,V,q,H,Q,ie,ye,ce,me,we,Ie,qe,lt,je,Ve,nt,Ke,We){const ke=32*r,it=16*r;return this.int16[ke+0]=l,this.int16[ke+1]=p,this.int16[ke+2]=g,this.int16[ke+3]=v,this.int16[ke+4]=x,this.int16[ke+5]=b,this.int16[ke+6]=T,this.int16[ke+7]=I,this.uint16[ke+8]=z,this.uint16[ke+9]=R,this.uint16[ke+10]=B,this.uint16[ke+11]=V,this.uint16[ke+12]=q,this.uint16[ke+13]=H,this.uint16[ke+14]=Q,this.uint16[ke+15]=ie,this.uint16[ke+16]=ye,this.uint16[ke+17]=ce,this.uint16[ke+18]=me,this.uint16[ke+19]=we,this.uint16[ke+20]=Ie,this.uint16[ke+21]=qe,this.uint16[ke+22]=lt,this.uint32[it+12]=je,this.float32[it+13]=Ve,this.float32[it+14]=nt,this.uint16[ke+30]=Ke,this.uint16[ke+31]=We,r}}Pe.prototype.bytesPerElement=64,Ge("StructArrayLayout8i15ui1ul2f2ui64",Pe);class $e extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.float32[1*r+0]=l,r}}$e.prototype.bytesPerElement=4,Ge("StructArrayLayout1f4",$e);class He extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,p){const g=this.length;return this.resize(g+1),this.emplace(g,r,l,p)}emplace(r,l,p,g){const v=3*r;return this.uint16[6*r+0]=l,this.float32[v+1]=p,this.float32[v+2]=g,r}}He.prototype.bytesPerElement=12,Ge("StructArrayLayout1ui2f12",He);class Be extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,p){const g=this.length;return this.resize(g+1),this.emplace(g,r,l,p)}emplace(r,l,p,g){const v=4*r;return this.uint32[2*r+0]=l,this.uint16[v+2]=p,this.uint16[v+3]=g,r}}Be.prototype.bytesPerElement=8,Ge("StructArrayLayout1ul2ui8",Be);class Le extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l){const p=this.length;return this.resize(p+1),this.emplace(p,r,l)}emplace(r,l,p){const g=2*r;return this.uint16[g+0]=l,this.uint16[g+1]=p,r}}Le.prototype.bytesPerElement=4,Ge("StructArrayLayout2ui4",Le);class Ye extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.uint16[1*r+0]=l,r}}Ye.prototype.bytesPerElement=2,Ge("StructArrayLayout1ui2",Ye);class pt extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,r,l,p,g)}emplace(r,l,p,g,v){const x=4*r;return this.float32[x+0]=l,this.float32[x+1]=p,this.float32[x+2]=g,this.float32[x+3]=v,r}}pt.prototype.bytesPerElement=16,Ge("StructArrayLayout4f16",pt);class Ne extends m{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new P(this.anchorPointX,this.anchorPointY)}}Ne.prototype.size=20;class Ue extends ae{get(r){return new Ne(this,r)}}Ge("CollisionBoxArray",Ue);class ht extends m{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(r){this._structArray.uint8[this._pos1+37]=r}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(r){this._structArray.uint8[this._pos1+38]=r}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(r){this._structArray.uint32[this._pos4+10]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ht.prototype.size=48;class Qt extends Te{get(r){return new ht(this,r)}}Ge("PlacedSymbolArray",Qt);class wt extends m{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(r){this._structArray.uint32[this._pos4+12]=r}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}wt.prototype.size=64;class Mt extends Pe{get(r){return new wt(this,r)}}Ge("SymbolInstanceArray",Mt);class en extends $e{getoffsetX(r){return this.float32[1*r+0]}}Ge("GlyphOffsetArray",en);class Zn extends D{getx(r){return this.int16[3*r+0]}gety(r){return this.int16[3*r+1]}gettileUnitDistanceFromAnchor(r){return this.int16[3*r+2]}}Ge("SymbolLineVertexArray",Zn);class Er extends m{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Er.prototype.size=12;class tn extends He{get(r){return new Er(this,r)}}Ge("TextAnchorOffsetArray",tn);class Si extends m{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Si.prototype.size=8;class ai extends Be{get(r){return new Si(this,r)}}Ge("FeatureIndexArray",ai);class Wn extends M{}class li extends M{}class Jr extends M{}class na extends L{}class Oc extends U{}class ia extends Z{}class ar extends G{}class Lc extends te{}class Dh extends re{}class lr extends se{}class cr extends Y{}class Ls extends fe{}class Ir extends _e{}class Vn extends Le{}const Gn=S([{name:"a_pos",components:2,type:"Int16"}],4),{members:ji}=Gn;class Pt{constructor(r=[]){this.segments=r}prepareSegment(r,l,p,g){let v=this.segments[this.segments.length-1];return r>Pt.MAX_VERTEX_ARRAY_LENGTH&&dn(`Max vertices per segment is ${Pt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!v||v.vertexLength+r>Pt.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==g)&&(v={vertexOffset:l.length,primitiveOffset:p.length,vertexLength:0,primitiveLength:0},g!==void 0&&(v.sortKey=g),this.segments.push(v)),v}get(){return this.segments}destroy(){for(const r of this.segments)for(const l in r.vaos)r.vaos[l].destroy()}static simpleSegment(r,l,p,g){return new Pt([{vertexOffset:r,primitiveOffset:l,vertexLength:p,primitiveLength:g,vaos:{},sortKey:0}])}}function fo(o,r){return 256*(o=Me(Math.floor(o),0,255))+Me(Math.floor(r),0,255)}Pt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ge("SegmentVector",Pt);const ra=S([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var sa={exports:{}},Np={exports:{}};Np.exports=function(o,r){var l,p,g,v,x,b,T,I;for(p=o.length-(l=3&o.length),g=r,x=3432918353,b=461845907,I=0;I<p;)T=255&o.charCodeAt(I)|(255&o.charCodeAt(++I))<<8|(255&o.charCodeAt(++I))<<16|(255&o.charCodeAt(++I))<<24,++I,g=27492+(65535&(v=5*(65535&(g=(g^=T=(65535&(T=(T=(65535&T)*x+(((T>>>16)*x&65535)<<16)&4294967295)<<15|T>>>17))*b+(((T>>>16)*b&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(T=0,l){case 3:T^=(255&o.charCodeAt(I+2))<<16;case 2:T^=(255&o.charCodeAt(I+1))<<8;case 1:g^=T=(65535&(T=(T=(65535&(T^=255&o.charCodeAt(I)))*x+(((T>>>16)*x&65535)<<16)&4294967295)<<15|T>>>17))*b+(((T>>>16)*b&65535)<<16)&4294967295}return g^=o.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0};var Ng=Np.exports,Vp={exports:{}};Vp.exports=function(o,r){for(var l,p=o.length,g=r^p,v=0;p>=4;)l=1540483477*(65535&(l=255&o.charCodeAt(v)|(255&o.charCodeAt(++v))<<8|(255&o.charCodeAt(++v))<<16|(255&o.charCodeAt(++v))<<24))+((1540483477*(l>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),p-=4,++v;switch(p){case 3:g^=(255&o.charCodeAt(v+2))<<16;case 2:g^=(255&o.charCodeAt(v+1))<<8;case 1:g=1540483477*(65535&(g^=255&o.charCodeAt(v)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0};var Bs=Ng,$p=Vp.exports;sa.exports=Bs,sa.exports.murmur3=Bs,sa.exports.murmur2=$p;var Bc=w(sa.exports);class xl{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,l,p,g){this.ids.push(Fc(r)),this.positions.push(l,p,g)}getPositions(r){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const l=Fc(r);let p=0,g=this.ids.length-1;for(;p<g;){const x=p+g>>1;this.ids[x]>=l?g=x:p=x+1}const v=[];for(;this.ids[p]===l;)v.push({index:this.positions[3*p],start:this.positions[3*p+1],end:this.positions[3*p+2]}),p++;return v}static serialize(r,l){const p=new Float64Array(r.ids),g=new Uint32Array(r.positions);return Nc(p,g,0,p.length-1),l&&l.push(p.buffer,g.buffer),{ids:p,positions:g}}static deserialize(r){const l=new xl;return l.ids=r.ids,l.positions=r.positions,l.indexed=!0,l}}function Fc(o){const r=+o;return!isNaN(r)&&r<=Number.MAX_SAFE_INTEGER?r:Bc(String(o))}function Nc(o,r,l,p){for(;l<p;){const g=o[l+p>>1];let v=l-1,x=p+1;for(;;){do v++;while(o[v]<g);do x--;while(o[x]>g);if(v>=x)break;oa(o,v,x),oa(r,3*v,3*x),oa(r,3*v+1,3*x+1),oa(r,3*v+2,3*x+2)}x-l<p-x?(Nc(o,r,l,x),l=x+1):(Nc(o,r,x+1,p),p=x)}}function oa(o,r,l){const p=o[r];o[r]=o[l],o[l]=p}Ge("FeaturePositionMap",xl);class wl{constructor(r,l){this.gl=r.gl,this.location=l}}class jp extends wl{constructor(r,l){super(r,l),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class ix extends wl{constructor(r,l){super(r,l),this.current=[0,0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))}}class rx extends wl{constructor(r,l){super(r,l),this.current=qt.transparent}set(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))}}const zC=new Float32Array(16);function Vg(o){return[fo(255*o.r,255*o.g),fo(255*o.b,255*o.a)]}class Rh{constructor(r,l,p){this.value=r,this.uniformNames=l.map(g=>`u_${g}`),this.type=p}setUniform(r,l,p){r.set(p.constantOr(this.value))}getBinding(r,l,p){return this.type==="color"?new rx(r,l):new jp(r,l)}}class Vc{constructor(r,l){this.uniformNames=l.map(p=>`u_${p}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(r,l){this.pixelRatioFrom=l.pixelRatio,this.pixelRatioTo=r.pixelRatio,this.patternFrom=l.tlbr,this.patternTo=r.tlbr}setUniform(r,l,p,g){const v=g==="u_pattern_to"?this.patternTo:g==="u_pattern_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&r.set(v)}getBinding(r,l,p){return p.substr(0,9)==="u_pattern"?new ix(r,l):new jp(r,l)}}class mo{constructor(r,l,p,g){this.expression=r,this.type=p,this.maxValue=0,this.paintVertexAttributes=l.map(v=>({name:`a_${v}`,type:"Float32",components:p==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(r,l,p,g,v){const x=this.paintVertexArray.length,b=this.expression.evaluate(new Yt(0),l,{},g,[],v);this.paintVertexArray.resize(r),this._setPaintValue(x,r,b)}updatePaintArray(r,l,p,g){const v=this.expression.evaluate({zoom:0},p,g);this._setPaintValue(r,l,v)}_setPaintValue(r,l,p){if(this.type==="color"){const g=Vg(p);for(let v=r;v<l;v++)this.paintVertexArray.emplace(v,g[0],g[1])}else{for(let g=r;g<l;g++)this.paintVertexArray.emplace(g,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ms{constructor(r,l,p,g,v,x){this.expression=r,this.uniformNames=l.map(b=>`u_${b}_t`),this.type=p,this.useIntegerZoom=g,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=l.map(b=>({name:`a_${b}`,type:"Float32",components:p==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(r,l,p,g,v){const x=this.expression.evaluate(new Yt(this.zoom),l,{},g,[],v),b=this.expression.evaluate(new Yt(this.zoom+1),l,{},g,[],v),T=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(T,r,x,b)}updatePaintArray(r,l,p,g){const v=this.expression.evaluate({zoom:this.zoom},p,g),x=this.expression.evaluate({zoom:this.zoom+1},p,g);this._setPaintValue(r,l,v,x)}_setPaintValue(r,l,p,g){if(this.type==="color"){const v=Vg(p),x=Vg(g);for(let b=r;b<l;b++)this.paintVertexArray.emplace(b,v[0],v[1],x[0],x[1])}else{for(let v=r;v<l;v++)this.paintVertexArray.emplace(v,p,g);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(g))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,l){const p=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,g=Me(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);r.set(g)}getBinding(r,l,p){return new jp(r,l)}}class aa{constructor(r,l,p,g,v,x){this.expression=r,this.type=l,this.useIntegerZoom=p,this.zoom=g,this.layerId=x,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v}populatePaintArray(r,l,p){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(r),this.zoomOutPaintVertexArray.resize(r),this._setPaintValues(g,r,l.patterns&&l.patterns[this.layerId],p)}updatePaintArray(r,l,p,g,v){this._setPaintValues(r,l,p.patterns&&p.patterns[this.layerId],v)}_setPaintValues(r,l,p,g){if(!g||!p)return;const{min:v,mid:x,max:b}=p,T=g[v],I=g[x],z=g[b];if(T&&I&&z)for(let R=r;R<l;R++)this.zoomInPaintVertexArray.emplace(R,I.tl[0],I.tl[1],I.br[0],I.br[1],T.tl[0],T.tl[1],T.br[0],T.br[1],I.pixelRatio,T.pixelRatio),this.zoomOutPaintVertexArray.emplace(R,I.tl[0],I.tl[1],I.br[0],I.br[1],z.tl[0],z.tl[1],z.br[0],z.br[1],I.pixelRatio,z.pixelRatio)}upload(r){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=r.createVertexBuffer(this.zoomInPaintVertexArray,ra.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=r.createVertexBuffer(this.zoomOutPaintVertexArray,ra.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class sx{constructor(r,l,p){this.binders={},this._buffers=[];const g=[];for(const v in r.paint._values){if(!p(v))continue;const x=r.paint.get(v);if(!(x instanceof Xr&&Uo(x.property.specification)))continue;const b=DC(v,r.type),T=x.value,I=x.property.specification.type,z=x.property.useIntegerZoom,R=x.property.specification["property-type"],B=R==="cross-faded"||R==="cross-faded-data-driven";if(T.kind==="constant")this.binders[v]=B?new Vc(T.value,b):new Rh(T.value,b,I),g.push(`/u_${v}`);else if(T.kind==="source"||B){const V=ox(v,I,"source");this.binders[v]=B?new aa(T,I,z,l,V,r.id):new mo(T,b,I,V),g.push(`/a_${v}`)}else{const V=ox(v,I,"composite");this.binders[v]=new ms(T,b,I,z,l,V),g.push(`/z_${v}`)}}this.cacheKey=g.sort().join("")}getMaxValue(r){const l=this.binders[r];return l instanceof mo||l instanceof ms?l.maxValue:0}populatePaintArrays(r,l,p,g,v){for(const x in this.binders){const b=this.binders[x];(b instanceof mo||b instanceof ms||b instanceof aa)&&b.populatePaintArray(r,l,p,g,v)}}setConstantPatternPositions(r,l){for(const p in this.binders){const g=this.binders[p];g instanceof Vc&&g.setConstantPatternPositions(r,l)}}updatePaintArrays(r,l,p,g,v){let x=!1;for(const b in r){const T=l.getPositions(b);for(const I of T){const z=p.feature(I.index);for(const R in this.binders){const B=this.binders[R];if((B instanceof mo||B instanceof ms||B instanceof aa)&&B.expression.isStateDependent===!0){const V=g.paint.get(R);B.expression=V.value,B.updatePaintArray(I.start,I.end,z,r[b],v),x=!0}}}}return x}defines(){const r=[];for(const l in this.binders){const p=this.binders[l];(p instanceof Rh||p instanceof Vc)&&r.push(...p.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return r}getBinderAttributes(){const r=[];for(const l in this.binders){const p=this.binders[l];if(p instanceof mo||p instanceof ms)for(let g=0;g<p.paintVertexAttributes.length;g++)r.push(p.paintVertexAttributes[g].name);else if(p instanceof aa)for(let g=0;g<ra.members.length;g++)r.push(ra.members[g].name)}return r}getBinderUniforms(){const r=[];for(const l in this.binders){const p=this.binders[l];if(p instanceof Rh||p instanceof Vc||p instanceof ms)for(const g of p.uniformNames)r.push(g)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r,l){const p=[];for(const g in this.binders){const v=this.binders[g];if(v instanceof Rh||v instanceof Vc||v instanceof ms){for(const x of v.uniformNames)if(l[x]){const b=v.getBinding(r,l[x],x);p.push({name:x,property:g,binding:b})}}}return p}setUniforms(r,l,p,g){for(const{name:v,property:x,binding:b}of l)this.binders[x].setUniform(b,g,p.get(x),v)}updatePaintBuffers(r){this._buffers=[];for(const l in this.binders){const p=this.binders[l];if(r&&p instanceof aa){const g=r.fromScale===2?p.zoomInPaintVertexBuffer:p.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(p instanceof mo||p instanceof ms)&&p.paintVertexBuffer&&this._buffers.push(p.paintVertexBuffer)}}upload(r){for(const l in this.binders){const p=this.binders[l];(p instanceof mo||p instanceof ms||p instanceof aa)&&p.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const l=this.binders[r];(l instanceof mo||l instanceof ms||l instanceof aa)&&l.destroy()}}}class bl{constructor(r,l,p=()=>!0){this.programConfigurations={};for(const g of r)this.programConfigurations[g.id]=new sx(g,l,p);this.needsUpload=!1,this._featureMap=new xl,this._bufferOffset=0}populatePaintArrays(r,l,p,g,v,x){for(const b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(r,l,g,v,x);l.id!==void 0&&this._featureMap.add(l.id,p,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,l,p,g){for(const v of p)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(r,this._featureMap,l,v,g)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}function DC(o,r){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[o]||[o.replace(`${r}-`,"").replace(/-/g,"_")]}function ox(o,r,l){const p={color:{source:Z,composite:pt},number:{source:$e,composite:Z}},g=function(v){return{"line-pattern":{source:ar,composite:ar},"fill-pattern":{source:ar,composite:ar},"fill-extrusion-pattern":{source:ar,composite:ar}}[v]}(o);return g&&g[l]||p[r][l]}Ge("ConstantBinder",Rh),Ge("CrossFadedConstantBinder",Vc),Ge("SourceExpressionBinder",mo),Ge("CrossFadedCompositeBinder",aa),Ge("CompositeExpressionBinder",ms),Ge("ProgramConfiguration",sx,{omit:["_buffers"]}),Ge("ProgramConfigurationSet",bl);const Tn=8192,$g=Math.pow(2,14)-1,ax=-$g-1;function Sl(o){const r=Tn/o.extent,l=o.loadGeometry();for(let p=0;p<l.length;p++){const g=l[p];for(let v=0;v<g.length;v++){const x=g[v],b=Math.round(x.x*r),T=Math.round(x.y*r);x.x=Me(b,ax,$g),x.y=Me(T,ax,$g),(b<x.x||b>x.x+1||T<x.y||T>x.y+1)&&dn("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return l}function kl(o,r){return{type:o.type,id:o.id,properties:o.properties,geometry:r?Sl(o):[]}}function Up(o,r,l,p,g){o.emplaceBack(2*r+(p+1)/2,2*l+(g+1)/2)}class jg{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new li,this.indexArray=new Ir,this.segments=new Pt,this.programConfigurations=new bl(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(r,l,p){const g=this.layers[0],v=[];let x=null,b=!1;g.type==="circle"&&(x=g.layout.get("circle-sort-key"),b=!x.isConstant());for(const{feature:T,id:I,index:z,sourceLayerIndex:R}of r){const B=this.layers[0]._featureFilter.needGeometry,V=kl(T,B);if(!this.layers[0]._featureFilter.filter(new Yt(this.zoom),V,p))continue;const q=b?x.evaluate(V,{},p):void 0,H={id:I,properties:T.properties,type:T.type,sourceLayerIndex:R,index:z,geometry:B?V.geometry:Sl(T),patterns:{},sortKey:q};v.push(H)}b&&v.sort((T,I)=>T.sortKey-I.sortKey);for(const T of v){const{geometry:I,index:z,sourceLayerIndex:R}=T,B=r[z].feature;this.addFeature(T,I,z,p),l.featureIndex.insert(B,I,z,R,this.index)}}update(r,l,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,ji),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,l,p,g){for(const v of l)for(const x of v){const b=x.x,T=x.y;if(b<0||b>=Tn||T<0||T>=Tn)continue;const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),z=I.vertexLength;Up(this.layoutVertexArray,b,T,-1,-1),Up(this.layoutVertexArray,b,T,1,-1),Up(this.layoutVertexArray,b,T,1,1),Up(this.layoutVertexArray,b,T,-1,1),this.indexArray.emplaceBack(z,z+1,z+2),this.indexArray.emplaceBack(z,z+3,z+2),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,p,{},g)}}function lx(o,r){for(let l=0;l<o.length;l++)if($c(r,o[l]))return!0;for(let l=0;l<r.length;l++)if($c(o,r[l]))return!0;return!!Ug(o,r)}function RC(o,r,l){return!!$c(o,r)||!!qg(r,o,l)}function cx(o,r){if(o.length===1)return hx(r,o[0]);for(let l=0;l<r.length;l++){const p=r[l];for(let g=0;g<p.length;g++)if($c(o,p[g]))return!0}for(let l=0;l<o.length;l++)if(hx(r,o[l]))return!0;for(let l=0;l<r.length;l++)if(Ug(o,r[l]))return!0;return!1}function OC(o,r,l){if(o.length>1){if(Ug(o,r))return!0;for(let p=0;p<r.length;p++)if(qg(r[p],o,l))return!0}for(let p=0;p<o.length;p++)if(qg(o[p],r,l))return!0;return!1}function Ug(o,r){if(o.length===0||r.length===0)return!1;for(let l=0;l<o.length-1;l++){const p=o[l],g=o[l+1];for(let v=0;v<r.length-1;v++)if(LC(p,g,r[v],r[v+1]))return!0}return!1}function LC(o,r,l,p){return Pn(o,l,p)!==Pn(r,l,p)&&Pn(o,r,l)!==Pn(o,r,p)}function qg(o,r,l){const p=l*l;if(r.length===1)return o.distSqr(r[0])<p;for(let g=1;g<r.length;g++)if(ux(o,r[g-1],r[g])<p)return!0;return!1}function ux(o,r,l){const p=r.distSqr(l);if(p===0)return o.distSqr(r);const g=((o.x-r.x)*(l.x-r.x)+(o.y-r.y)*(l.y-r.y))/p;return o.distSqr(g<0?r:g>1?l:l.sub(r)._mult(g)._add(r))}function hx(o,r){let l,p,g,v=!1;for(let x=0;x<o.length;x++){l=o[x];for(let b=0,T=l.length-1;b<l.length;T=b++)p=l[b],g=l[T],p.y>r.y!=g.y>r.y&&r.x<(g.x-p.x)*(r.y-p.y)/(g.y-p.y)+p.x&&(v=!v)}return v}function $c(o,r){let l=!1;for(let p=0,g=o.length-1;p<o.length;g=p++){const v=o[p],x=o[g];v.y>r.y!=x.y>r.y&&r.x<(x.x-v.x)*(r.y-v.y)/(x.y-v.y)+v.x&&(l=!l)}return l}function BC(o,r,l){const p=l[0],g=l[2];if(o.x<p.x&&r.x<p.x||o.x>g.x&&r.x>g.x||o.y<p.y&&r.y<p.y||o.y>g.y&&r.y>g.y)return!1;const v=Pn(o,r,l[0]);return v!==Pn(o,r,l[1])||v!==Pn(o,r,l[2])||v!==Pn(o,r,l[3])}function Oh(o,r,l){const p=r.paint.get(o).value;return p.kind==="constant"?p.value:l.programConfigurations.get(r.id).getMaxValue(o)}function qp(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function Hp(o,r,l,p,g){if(!r[0]&&!r[1])return o;const v=P.convert(r)._mult(g);l==="viewport"&&v._rotate(-p);const x=[];for(let b=0;b<o.length;b++)x.push(o[b].sub(v));return x}let dx,px;Ge("CircleBucket",jg,{omit:["layers"]});var FC={get paint(){return px=px||new _({"circle-radius":new ct(xe.paint_circle["circle-radius"]),"circle-color":new ct(xe.paint_circle["circle-color"]),"circle-blur":new ct(xe.paint_circle["circle-blur"]),"circle-opacity":new ct(xe.paint_circle["circle-opacity"]),"circle-translate":new Je(xe.paint_circle["circle-translate"]),"circle-translate-anchor":new Je(xe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Je(xe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Je(xe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ct(xe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ct(xe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ct(xe.paint_circle["circle-stroke-opacity"])})},get layout(){return dx=dx||new _({"circle-sort-key":new ct(xe.layout_circle["circle-sort-key"])})}},ki=1e-6,jc=typeof Float32Array<"u"?Float32Array:Array;function Hg(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function fx(o,r,l){var p=r[0],g=r[1],v=r[2],x=r[3],b=r[4],T=r[5],I=r[6],z=r[7],R=r[8],B=r[9],V=r[10],q=r[11],H=r[12],Q=r[13],ie=r[14],ye=r[15],ce=l[0],me=l[1],we=l[2],Ie=l[3];return o[0]=ce*p+me*b+we*R+Ie*H,o[1]=ce*g+me*T+we*B+Ie*Q,o[2]=ce*v+me*I+we*V+Ie*ie,o[3]=ce*x+me*z+we*q+Ie*ye,o[4]=(ce=l[4])*p+(me=l[5])*b+(we=l[6])*R+(Ie=l[7])*H,o[5]=ce*g+me*T+we*B+Ie*Q,o[6]=ce*v+me*I+we*V+Ie*ie,o[7]=ce*x+me*z+we*q+Ie*ye,o[8]=(ce=l[8])*p+(me=l[9])*b+(we=l[10])*R+(Ie=l[11])*H,o[9]=ce*g+me*T+we*B+Ie*Q,o[10]=ce*v+me*I+we*V+Ie*ie,o[11]=ce*x+me*z+we*q+Ie*ye,o[12]=(ce=l[12])*p+(me=l[13])*b+(we=l[14])*R+(Ie=l[15])*H,o[13]=ce*g+me*T+we*B+Ie*Q,o[14]=ce*v+me*I+we*V+Ie*ie,o[15]=ce*x+me*z+we*q+Ie*ye,o}Math.hypot||(Math.hypot=function(){for(var o=0,r=arguments.length;r--;)o+=arguments[r]*arguments[r];return Math.sqrt(o)});var Lh,NC=fx;function Zp(o,r,l){var p=r[0],g=r[1],v=r[2],x=r[3];return o[0]=l[0]*p+l[4]*g+l[8]*v+l[12]*x,o[1]=l[1]*p+l[5]*g+l[9]*v+l[13]*x,o[2]=l[2]*p+l[6]*g+l[10]*v+l[14]*x,o[3]=l[3]*p+l[7]*g+l[11]*v+l[15]*x,o}Lh=new jc(4),jc!=Float32Array&&(Lh[0]=0,Lh[1]=0,Lh[2]=0,Lh[3]=0);class VC extends h{constructor(r){super(r,FC)}createBucket(r){return new jg(r)}queryRadius(r){const l=r;return Oh("circle-radius",this,l)+Oh("circle-stroke-width",this,l)+qp(this.paint.get("circle-translate"))}queryIntersectsFeature(r,l,p,g,v,x,b,T){const I=Hp(r,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,b),z=this.paint.get("circle-radius").evaluate(l,p)+this.paint.get("circle-stroke-width").evaluate(l,p),R=this.paint.get("circle-pitch-alignment")==="map",B=R?I:function(q,H){return q.map(Q=>mx(Q,H))}(I,T),V=R?z*b:z;for(const q of g)for(const H of q){const Q=R?H:mx(H,T);let ie=V;const ye=Zp([],[H.x,H.y,0,1],T);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ie*=ye[3]/x.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ie*=x.cameraToCenterDistance/ye[3]),RC(B,Q,ie))return!0}return!1}}function mx(o,r){const l=Zp([],[o.x,o.y,0,1],r);return new P(l[0]/l[3],l[1]/l[3])}class gx extends jg{}let yx;Ge("HeatmapBucket",gx,{omit:["layers"]});var $C={get paint(){return yx=yx||new _({"heatmap-radius":new ct(xe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ct(xe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Je(xe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new zh(xe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Je(xe.paint_heatmap["heatmap-opacity"])})}};function Zg(o,{width:r,height:l},p,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==r*l*p)throw new RangeError(`mismatched image size. expected: ${g.length} but got: ${r*l*p}`)}else g=new Uint8Array(r*l*p);return o.width=r,o.height=l,o.data=g,o}function _x(o,{width:r,height:l},p){if(r===o.width&&l===o.height)return;const g=Zg({},{width:r,height:l},p);Wg(o,g,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,r),height:Math.min(o.height,l)},p),o.width=r,o.height=l,o.data=g.data}function Wg(o,r,l,p,g,v){if(g.width===0||g.height===0)return r;if(g.width>o.width||g.height>o.height||l.x>o.width-g.width||l.y>o.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>r.width||g.height>r.height||p.x>r.width-g.width||p.y>r.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const x=o.data,b=r.data;if(x===b)throw new Error("srcData equals dstData, so image is already copied");for(let T=0;T<g.height;T++){const I=((l.y+T)*o.width+l.x)*v,z=((p.y+T)*r.width+p.x)*v;for(let R=0;R<g.width*v;R++)b[z+R]=x[I+R]}return r}class Bh{constructor(r,l){Zg(this,r,1,l)}resize(r){_x(this,r,1)}clone(){return new Bh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,l,p,g,v){Wg(r,l,p,g,v,1)}}class Pr{constructor(r,l){Zg(this,r,4,l)}resize(r){_x(this,r,4)}replace(r,l){l?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new Pr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,l,p,g,v){Wg(r,l,p,g,v,4)}}function vx(o){const r={},l=o.resolution||256,p=o.clips?o.clips.length:1,g=o.image||new Pr({width:l,height:p});if(Math.log(l)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${l}`);const v=(x,b,T)=>{r[o.evaluationKey]=T;const I=o.expression.evaluate(r);g.data[x+b+0]=Math.floor(255*I.r/I.a),g.data[x+b+1]=Math.floor(255*I.g/I.a),g.data[x+b+2]=Math.floor(255*I.b/I.a),g.data[x+b+3]=Math.floor(255*I.a)};if(o.clips)for(let x=0,b=0;x<p;++x,b+=4*l)for(let T=0,I=0;T<l;T++,I+=4){const z=T/(l-1),{start:R,end:B}=o.clips[x];v(b,I,R*(1-z)+B*z)}else for(let x=0,b=0;x<l;x++,b+=4)v(0,b,x/(l-1));return g}Ge("AlphaImage",Bh),Ge("RGBAImage",Pr);const Gg="big-fb";class jC extends h{createBucket(r){return new gx(r)}constructor(r){super(r,$C),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=vx({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Gg)&&this.heatmapFbos.delete(Gg)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let xx;var UC={get paint(){return xx=xx||new _({"hillshade-illumination-direction":new Je(xe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Je(xe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Je(xe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Je(xe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Je(xe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Je(xe.paint_hillshade["hillshade-accent-color"])})}};class qC extends h{constructor(r){super(r,UC)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const HC=S([{name:"a_pos",components:2,type:"Int16"}],4),{members:ZC}=HC;function wx(o,r,l=2){const p=r&&r.length,g=p?r[0]*l:o.length;let v=bx(o,0,g,l,!0);const x=[];if(!v||v.next===v.prev)return x;let b,T,I;if(p&&(v=function(z,R,B,V){const q=[];for(let H=0,Q=R.length;H<Q;H++){const ie=bx(z,R[H]*V,H<Q-1?R[H+1]*V:z.length,V,!1);ie===ie.next&&(ie.steiner=!0),q.push(eM(ie))}q.sort(JC);for(let H=0;H<q.length;H++)B=YC(q[H],B);return B}(o,r,v,l)),o.length>80*l){b=1/0,T=1/0;let z=-1/0,R=-1/0;for(let B=l;B<g;B+=l){const V=o[B],q=o[B+1];V<b&&(b=V),q<T&&(T=q),V>z&&(z=V),q>R&&(R=q)}I=Math.max(z-b,R-T),I=I!==0?32767/I:0}return Fh(v,x,l,b,T,I,0),x}function bx(o,r,l,p,g){let v;if(g===function(x,b,T,I){let z=0;for(let R=b,B=T-I;R<T;R+=I)z+=(x[B]-x[R])*(x[R+1]+x[B+1]),B=R;return z}(o,r,l,p)>0)for(let x=r;x<l;x+=p)v=Tx(x/p|0,o[x],o[x+1],v);else for(let x=l-p;x>=r;x-=p)v=Tx(x/p|0,o[x],o[x+1],v);return v&&Wp(v,v.next)&&(Vh(v),v=v.next),v}function Tl(o,r){if(!o)return o;r||(r=o);let l,p=o;do if(l=!1,p.steiner||!Wp(p,p.next)&&vn(p.prev,p,p.next)!==0)p=p.next;else{if(Vh(p),p=r=p.prev,p===p.next)break;l=!0}while(l||p!==r);return r}function Fh(o,r,l,p,g,v,x){if(!o)return;!x&&v&&function(T,I,z,R){let B=T;do B.z===0&&(B.z=Kg(B.x,B.y,I,z,R)),B.prevZ=B.prev,B.nextZ=B.next,B=B.next;while(B!==T);B.prevZ.nextZ=null,B.prevZ=null,function(V){let q,H=1;do{let Q,ie=V;V=null;let ye=null;for(q=0;ie;){q++;let ce=ie,me=0;for(let Ie=0;Ie<H&&(me++,ce=ce.nextZ,ce);Ie++);let we=H;for(;me>0||we>0&&ce;)me!==0&&(we===0||!ce||ie.z<=ce.z)?(Q=ie,ie=ie.nextZ,me--):(Q=ce,ce=ce.nextZ,we--),ye?ye.nextZ=Q:V=Q,Q.prevZ=ye,ye=Q;ie=ce}ye.nextZ=null,H*=2}while(q>1)}(B)}(o,p,g,v);let b=o;for(;o.prev!==o.next;){const T=o.prev,I=o.next;if(v?GC(o,p,g,v):WC(o))r.push(T.i,o.i,I.i),Vh(o),o=I.next,b=I.next;else if((o=I)===b){x?x===1?Fh(o=KC(Tl(o),r),r,l,p,g,v,2):x===2&&XC(o,r,l,p,g,v):Fh(Tl(o),r,l,p,g,v,1);break}}}function WC(o){const r=o.prev,l=o,p=o.next;if(vn(r,l,p)>=0)return!1;const g=r.x,v=l.x,x=p.x,b=r.y,T=l.y,I=p.y,z=g<v?g<x?g:x:v<x?v:x,R=b<T?b<I?b:I:T<I?T:I,B=g>v?g>x?g:x:v>x?v:x,V=b>T?b>I?b:I:T>I?T:I;let q=p.next;for(;q!==r;){if(q.x>=z&&q.x<=B&&q.y>=R&&q.y<=V&&Uc(g,b,v,T,x,I,q.x,q.y)&&vn(q.prev,q,q.next)>=0)return!1;q=q.next}return!0}function GC(o,r,l,p){const g=o.prev,v=o,x=o.next;if(vn(g,v,x)>=0)return!1;const b=g.x,T=v.x,I=x.x,z=g.y,R=v.y,B=x.y,V=b<T?b<I?b:I:T<I?T:I,q=z<R?z<B?z:B:R<B?R:B,H=b>T?b>I?b:I:T>I?T:I,Q=z>R?z>B?z:B:R>B?R:B,ie=Kg(V,q,r,l,p),ye=Kg(H,Q,r,l,p);let ce=o.prevZ,me=o.nextZ;for(;ce&&ce.z>=ie&&me&&me.z<=ye;){if(ce.x>=V&&ce.x<=H&&ce.y>=q&&ce.y<=Q&&ce!==g&&ce!==x&&Uc(b,z,T,R,I,B,ce.x,ce.y)&&vn(ce.prev,ce,ce.next)>=0||(ce=ce.prevZ,me.x>=V&&me.x<=H&&me.y>=q&&me.y<=Q&&me!==g&&me!==x&&Uc(b,z,T,R,I,B,me.x,me.y)&&vn(me.prev,me,me.next)>=0))return!1;me=me.nextZ}for(;ce&&ce.z>=ie;){if(ce.x>=V&&ce.x<=H&&ce.y>=q&&ce.y<=Q&&ce!==g&&ce!==x&&Uc(b,z,T,R,I,B,ce.x,ce.y)&&vn(ce.prev,ce,ce.next)>=0)return!1;ce=ce.prevZ}for(;me&&me.z<=ye;){if(me.x>=V&&me.x<=H&&me.y>=q&&me.y<=Q&&me!==g&&me!==x&&Uc(b,z,T,R,I,B,me.x,me.y)&&vn(me.prev,me,me.next)>=0)return!1;me=me.nextZ}return!0}function KC(o,r){let l=o;do{const p=l.prev,g=l.next.next;!Wp(p,g)&&Sx(p,l,l.next,g)&&Nh(p,g)&&Nh(g,p)&&(r.push(p.i,l.i,g.i),Vh(l),Vh(l.next),l=o=g),l=l.next}while(l!==o);return Tl(l)}function XC(o,r,l,p,g,v){let x=o;do{let b=x.next.next;for(;b!==x.prev;){if(x.i!==b.i&&tM(x,b)){let T=kx(x,b);return x=Tl(x,x.next),T=Tl(T,T.next),Fh(x,r,l,p,g,v,0),void Fh(T,r,l,p,g,v,0)}b=b.next}x=x.next}while(x!==o)}function JC(o,r){return o.x-r.x}function YC(o,r){const l=function(g,v){let x=v;const b=g.x,T=g.y;let I,z=-1/0;do{if(T<=x.y&&T>=x.next.y&&x.next.y!==x.y){const H=x.x+(T-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(H<=b&&H>z&&(z=H,I=x.x<x.next.x?x:x.next,H===b))return I}x=x.next}while(x!==v);if(!I)return null;const R=I,B=I.x,V=I.y;let q=1/0;x=I;do{if(b>=x.x&&x.x>=B&&b!==x.x&&Uc(T<V?b:z,T,B,V,T<V?z:b,T,x.x,x.y)){const H=Math.abs(T-x.y)/(b-x.x);Nh(x,g)&&(H<q||H===q&&(x.x>I.x||x.x===I.x&&QC(I,x)))&&(I=x,q=H)}x=x.next}while(x!==R);return I}(o,r);if(!l)return r;const p=kx(l,o);return Tl(p,p.next),Tl(l,l.next)}function QC(o,r){return vn(o.prev,o,r.prev)<0&&vn(r.next,o,o.next)<0}function Kg(o,r,l,p,g){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-l)*g|0)|o<<8))|o<<4))|o<<2))|o<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-p)*g|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function eM(o){let r=o,l=o;do(r.x<l.x||r.x===l.x&&r.y<l.y)&&(l=r),r=r.next;while(r!==o);return l}function Uc(o,r,l,p,g,v,x,b){return(g-x)*(r-b)>=(o-x)*(v-b)&&(o-x)*(p-b)>=(l-x)*(r-b)&&(l-x)*(v-b)>=(g-x)*(p-b)}function tM(o,r){return o.next.i!==r.i&&o.prev.i!==r.i&&!function(l,p){let g=l;do{if(g.i!==l.i&&g.next.i!==l.i&&g.i!==p.i&&g.next.i!==p.i&&Sx(g,g.next,l,p))return!0;g=g.next}while(g!==l);return!1}(o,r)&&(Nh(o,r)&&Nh(r,o)&&function(l,p){let g=l,v=!1;const x=(l.x+p.x)/2,b=(l.y+p.y)/2;do g.y>b!=g.next.y>b&&g.next.y!==g.y&&x<(g.next.x-g.x)*(b-g.y)/(g.next.y-g.y)+g.x&&(v=!v),g=g.next;while(g!==l);return v}(o,r)&&(vn(o.prev,o,r.prev)||vn(o,r.prev,r))||Wp(o,r)&&vn(o.prev,o,o.next)>0&&vn(r.prev,r,r.next)>0)}function vn(o,r,l){return(r.y-o.y)*(l.x-r.x)-(r.x-o.x)*(l.y-r.y)}function Wp(o,r){return o.x===r.x&&o.y===r.y}function Sx(o,r,l,p){const g=Kp(vn(o,r,l)),v=Kp(vn(o,r,p)),x=Kp(vn(l,p,o)),b=Kp(vn(l,p,r));return g!==v&&x!==b||!(g!==0||!Gp(o,l,r))||!(v!==0||!Gp(o,p,r))||!(x!==0||!Gp(l,o,p))||!(b!==0||!Gp(l,r,p))}function Gp(o,r,l){return r.x<=Math.max(o.x,l.x)&&r.x>=Math.min(o.x,l.x)&&r.y<=Math.max(o.y,l.y)&&r.y>=Math.min(o.y,l.y)}function Kp(o){return o>0?1:o<0?-1:0}function Nh(o,r){return vn(o.prev,o,o.next)<0?vn(o,r,o.next)>=0&&vn(o,o.prev,r)>=0:vn(o,r,o.prev)<0||vn(o,o.next,r)<0}function kx(o,r){const l=Xg(o.i,o.x,o.y),p=Xg(r.i,r.x,r.y),g=o.next,v=r.prev;return o.next=r,r.prev=o,l.next=g,g.prev=l,p.next=l,l.prev=p,v.next=p,p.prev=v,p}function Tx(o,r,l,p){const g=Xg(o,r,l);return p?(g.next=p.next,g.prev=p,p.next.prev=g,p.next=g):(g.prev=g,g.next=g),g}function Vh(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function Xg(o,r,l){return{i:o,x:r,y:l,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Jg(o,r,l){const p=l.patternDependencies;let g=!1;for(const v of r){const x=v.paint.get(`${o}-pattern`);x.isConstant()||(g=!0);const b=x.constantOr(null);b&&(g=!0,p[b.to]=!0,p[b.from]=!0)}return g}function Yg(o,r,l,p,g){const v=g.patternDependencies;for(const x of r){const b=x.paint.get(`${o}-pattern`).value;if(b.kind!=="constant"){let T=b.evaluate({zoom:p-1},l,{},g.availableImages),I=b.evaluate({zoom:p},l,{},g.availableImages),z=b.evaluate({zoom:p+1},l,{},g.availableImages);T=T&&T.name?T.name:T,I=I&&I.name?I.name:I,z=z&&z.name?z.name:z,v[T]=!0,v[I]=!0,v[z]=!0,l.patterns[x.id]={min:T,mid:I,max:z}}}return l}class Qg{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Jr,this.indexArray=new Ir,this.indexArray2=new Vn,this.programConfigurations=new bl(r.layers,r.zoom),this.segments=new Pt,this.segments2=new Pt,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(r,l,p){this.hasPattern=Jg("fill",this.layers,l);const g=this.layers[0].layout.get("fill-sort-key"),v=!g.isConstant(),x=[];for(const{feature:b,id:T,index:I,sourceLayerIndex:z}of r){const R=this.layers[0]._featureFilter.needGeometry,B=kl(b,R);if(!this.layers[0]._featureFilter.filter(new Yt(this.zoom),B,p))continue;const V=v?g.evaluate(B,{},p,l.availableImages):void 0,q={id:T,properties:b.properties,type:b.type,sourceLayerIndex:z,index:I,geometry:R?B.geometry:Sl(b),patterns:{},sortKey:V};x.push(q)}v&&x.sort((b,T)=>b.sortKey-T.sortKey);for(const b of x){const{geometry:T,index:I,sourceLayerIndex:z}=b;if(this.hasPattern){const R=Yg("fill",this.layers,b,this.zoom,l);this.patternFeatures.push(R)}else this.addFeature(b,T,I,p,{});l.featureIndex.insert(r[I].feature,T,I,z,this.index)}}update(r,l,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,p)}addFeatures(r,l,p){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,l,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,ZC),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,l,p,g,v){for(const x of pc(l,500)){let b=0;for(const V of x)b+=V.length;const T=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),I=T.vertexLength,z=[],R=[];for(const V of x){if(V.length===0)continue;V!==x[0]&&R.push(z.length/2);const q=this.segments2.prepareSegment(V.length,this.layoutVertexArray,this.indexArray2),H=q.vertexLength;this.layoutVertexArray.emplaceBack(V[0].x,V[0].y),this.indexArray2.emplaceBack(H+V.length-1,H),z.push(V[0].x),z.push(V[0].y);for(let Q=1;Q<V.length;Q++)this.layoutVertexArray.emplaceBack(V[Q].x,V[Q].y),this.indexArray2.emplaceBack(H+Q-1,H+Q),z.push(V[Q].x),z.push(V[Q].y);q.vertexLength+=V.length,q.primitiveLength+=V.length}const B=wx(z,R);for(let V=0;V<B.length;V+=3)this.indexArray.emplaceBack(I+B[V],I+B[V+1],I+B[V+2]);T.vertexLength+=b,T.primitiveLength+=B.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,p,v,g)}}let Cx,Mx;Ge("FillBucket",Qg,{omit:["layers","patternFeatures"]});var nM={get paint(){return Mx=Mx||new _({"fill-antialias":new Je(xe.paint_fill["fill-antialias"]),"fill-opacity":new ct(xe.paint_fill["fill-opacity"]),"fill-color":new ct(xe.paint_fill["fill-color"]),"fill-outline-color":new ct(xe.paint_fill["fill-outline-color"]),"fill-translate":new Je(xe.paint_fill["fill-translate"]),"fill-translate-anchor":new Je(xe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Dc(xe.paint_fill["fill-pattern"])})},get layout(){return Cx=Cx||new _({"fill-sort-key":new ct(xe.layout_fill["fill-sort-key"])})}};class iM extends h{constructor(r){super(r,nM)}recalculate(r,l){super.recalculate(r,l);const p=this.paint._values["fill-outline-color"];p.value.kind==="constant"&&p.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new Qg(r)}queryRadius(){return qp(this.paint.get("fill-translate"))}queryIntersectsFeature(r,l,p,g,v,x,b){return cx(Hp(r,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,b),g)}isTileClipped(){return!0}}const rM=S([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),sM=S([{name:"a_centroid",components:2,type:"Int16"}],4),{members:oM}=rM;var la={},aM=k,Ex=qc;function qc(o,r,l,p,g){this.properties={},this.extent=l,this.type=0,this._pbf=o,this._geometry=-1,this._keys=p,this._values=g,o.readFields(lM,this,r)}function lM(o,r,l){o==1?r.id=l.readVarint():o==2?function(p,g){for(var v=p.readVarint()+p.pos;p.pos<v;){var x=g._keys[p.readVarint()],b=g._values[p.readVarint()];g.properties[x]=b}}(l,r):o==3?r.type=l.readVarint():o==4&&(r._geometry=l.pos)}function cM(o){for(var r,l,p=0,g=0,v=o.length,x=v-1;g<v;x=g++)p+=((l=o[x]).x-(r=o[g]).x)*(r.y+l.y);return p}qc.types=["Unknown","Point","LineString","Polygon"],qc.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var r,l=o.readVarint()+o.pos,p=1,g=0,v=0,x=0,b=[];o.pos<l;){if(g<=0){var T=o.readVarint();p=7&T,g=T>>3}if(g--,p===1||p===2)v+=o.readSVarint(),x+=o.readSVarint(),p===1&&(r&&b.push(r),r=[]),r.push(new aM(v,x));else{if(p!==7)throw new Error("unknown command "+p);r&&r.push(r[0].clone())}}return r&&b.push(r),b},qc.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var r=o.readVarint()+o.pos,l=1,p=0,g=0,v=0,x=1/0,b=-1/0,T=1/0,I=-1/0;o.pos<r;){if(p<=0){var z=o.readVarint();l=7&z,p=z>>3}if(p--,l===1||l===2)(g+=o.readSVarint())<x&&(x=g),g>b&&(b=g),(v+=o.readSVarint())<T&&(T=v),v>I&&(I=v);else if(l!==7)throw new Error("unknown command "+l)}return[x,T,b,I]},qc.prototype.toGeoJSON=function(o,r,l){var p,g,v=this.extent*Math.pow(2,l),x=this.extent*o,b=this.extent*r,T=this.loadGeometry(),I=qc.types[this.type];function z(V){for(var q=0;q<V.length;q++){var H=V[q];V[q]=[360*(H.x+x)/v-180,360/Math.PI*Math.atan(Math.exp((180-360*(H.y+b)/v)*Math.PI/180))-90]}}switch(this.type){case 1:var R=[];for(p=0;p<T.length;p++)R[p]=T[p][0];z(T=R);break;case 2:for(p=0;p<T.length;p++)z(T[p]);break;case 3:for(T=function(V){var q=V.length;if(q<=1)return[V];for(var H,Q,ie=[],ye=0;ye<q;ye++){var ce=cM(V[ye]);ce!==0&&(Q===void 0&&(Q=ce<0),Q===ce<0?(H&&ie.push(H),H=[V[ye]]):H.push(V[ye]))}return H&&ie.push(H),ie}(T),p=0;p<T.length;p++)for(g=0;g<T[p].length;g++)z(T[p][g])}T.length===1?T=T[0]:I="Multi"+I;var B={type:"Feature",geometry:{type:I,coordinates:T},properties:this.properties};return"id"in this&&(B.id=this.id),B};var uM=Ex,Ix=Px;function Px(o,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(hM,this,r),this.length=this._features.length}function hM(o,r,l){o===15?r.version=l.readVarint():o===1?r.name=l.readString():o===5?r.extent=l.readVarint():o===2?r._features.push(l.pos):o===3?r._keys.push(l.readString()):o===4&&r._values.push(function(p){for(var g=null,v=p.readVarint()+p.pos;p.pos<v;){var x=p.readVarint()>>3;g=x===1?p.readString():x===2?p.readFloat():x===3?p.readDouble():x===4?p.readVarint64():x===5?p.readVarint():x===6?p.readSVarint():x===7?p.readBoolean():null}return g}(l))}Px.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var r=this._pbf.readVarint()+this._pbf.pos;return new uM(this._pbf,r,this.extent,this._keys,this._values)};var dM=Ix;function pM(o,r,l){if(o===3){var p=new dM(l,l.readVarint()+l.pos);p.length&&(r[p.name]=p)}}la.VectorTile=function(o,r){this.layers=o.readFields(pM,{},r)},la.VectorTileFeature=Ex,la.VectorTileLayer=Ix;const fM=la.VectorTileFeature.types,ey=Math.pow(2,13);function $h(o,r,l,p,g,v,x,b){o.emplaceBack(r,l,2*Math.floor(p*ey)+x,g*ey*2,v*ey*2,Math.round(b))}class ty{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new na,this.centroidVertexArray=new Wn,this.indexArray=new Ir,this.programConfigurations=new bl(r.layers,r.zoom),this.segments=new Pt,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(r,l,p){this.features=[],this.hasPattern=Jg("fill-extrusion",this.layers,l);for(const{feature:g,id:v,index:x,sourceLayerIndex:b}of r){const T=this.layers[0]._featureFilter.needGeometry,I=kl(g,T);if(!this.layers[0]._featureFilter.filter(new Yt(this.zoom),I,p))continue;const z={id:v,sourceLayerIndex:b,index:x,geometry:T?I.geometry:Sl(g),properties:g.properties,type:g.type,patterns:{}};this.hasPattern?this.features.push(Yg("fill-extrusion",this.layers,z,this.zoom,l)):this.addFeature(z,z.geometry,x,p,{}),l.featureIndex.insert(g,z.geometry,x,b,this.index,!0)}}addFeatures(r,l,p){for(const g of this.features){const{geometry:v}=g;this.addFeature(g,v,g.index,l,p)}}update(r,l,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,oM),this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,sM.members,!0),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(r,l,p,g,v){for(const x of pc(l,500)){const b={x:0,y:0,vertexCount:0};let T=0;for(const q of x)T+=q.length;let I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const q of x){if(q.length===0||gM(q))continue;let H=0;for(let Q=0;Q<q.length;Q++){const ie=q[Q];if(Q>=1){const ye=q[Q-1];if(!mM(ie,ye)){I.vertexLength+4>Pt.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ce=ie.sub(ye)._perp()._unit(),me=ye.dist(ie);H+me>32768&&(H=0),$h(this.layoutVertexArray,ie.x,ie.y,ce.x,ce.y,0,0,H),$h(this.layoutVertexArray,ie.x,ie.y,ce.x,ce.y,0,1,H),b.x+=2*ie.x,b.y+=2*ie.y,b.vertexCount+=2,H+=me,$h(this.layoutVertexArray,ye.x,ye.y,ce.x,ce.y,0,0,H),$h(this.layoutVertexArray,ye.x,ye.y,ce.x,ce.y,0,1,H),b.x+=2*ye.x,b.y+=2*ye.y,b.vertexCount+=2;const we=I.vertexLength;this.indexArray.emplaceBack(we,we+2,we+1),this.indexArray.emplaceBack(we+1,we+2,we+3),I.vertexLength+=4,I.primitiveLength+=2}}}}if(I.vertexLength+T>Pt.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray)),fM[r.type]!=="Polygon")continue;const z=[],R=[],B=I.vertexLength;for(const q of x)if(q.length!==0){q!==x[0]&&R.push(z.length/2);for(let H=0;H<q.length;H++){const Q=q[H];$h(this.layoutVertexArray,Q.x,Q.y,0,0,1,1,0),b.x+=Q.x,b.y+=Q.y,b.vertexCount+=1,z.push(Q.x),z.push(Q.y)}}const V=wx(z,R);for(let q=0;q<V.length;q+=3)this.indexArray.emplaceBack(B+V[q],B+V[q+2],B+V[q+1]);I.primitiveLength+=V.length/3,I.vertexLength+=T;for(let q=0;q<b.vertexCount;q++){const H=Math.floor(b.x/b.vertexCount),Q=Math.floor(b.y/b.vertexCount);this.centroidVertexArray.emplaceBack(H,Q)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,p,v,g)}}function mM(o,r){return o.x===r.x&&(o.x<0||o.x>Tn)||o.y===r.y&&(o.y<0||o.y>Tn)}function gM(o){return o.every(r=>r.x<0)||o.every(r=>r.x>Tn)||o.every(r=>r.y<0)||o.every(r=>r.y>Tn)}let Ax;Ge("FillExtrusionBucket",ty,{omit:["layers","features"]});var yM={get paint(){return Ax=Ax||new _({"fill-extrusion-opacity":new Je(xe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ct(xe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Je(xe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Je(xe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Dc(xe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ct(xe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ct(xe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Je(xe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class _M extends h{constructor(r){super(r,yM)}createBucket(r){return new ty(r)}queryRadius(){return qp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(r,l,p,g,v,x,b,T){const I=Hp(r,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,b),z=this.paint.get("fill-extrusion-height").evaluate(l,p),R=this.paint.get("fill-extrusion-base").evaluate(l,p),B=function(q,H,Q,ie){const ye=[];for(const ce of q){const me=[ce.x,ce.y,0,1];Zp(me,me,H),ye.push(new P(me[0]/me[3],me[1]/me[3]))}return ye}(I,T),V=function(q,H,Q,ie){const ye=[],ce=[],me=ie[8]*H,we=ie[9]*H,Ie=ie[10]*H,qe=ie[11]*H,lt=ie[8]*Q,je=ie[9]*Q,Ve=ie[10]*Q,nt=ie[11]*Q;for(const Ke of q){const We=[],ke=[];for(const it of Ke){const et=it.x,dt=it.y,Gt=ie[0]*et+ie[4]*dt+ie[12],Wt=ie[1]*et+ie[5]*dt+ie[13],Dn=ie[2]*et+ie[6]*dt+ie[14],Yr=ie[3]*et+ie[7]*dt+ie[15],Xn=Dn+Ie,Rn=Yr+qe,Ti=Gt+lt,Ci=Wt+je,Mi=Dn+Ve,mn=Yr+nt,On=new P((Gt+me)/Rn,(Wt+we)/Rn);On.z=Xn/Rn,We.push(On);const ci=new P(Ti/mn,Ci/mn);ci.z=Mi/mn,ke.push(ci)}ye.push(We),ce.push(ke)}return[ye,ce]}(g,R,z,T);return function(q,H,Q){let ie=1/0;cx(Q,H)&&(ie=zx(Q,H[0]));for(let ye=0;ye<H.length;ye++){const ce=H[ye],me=q[ye];for(let we=0;we<ce.length-1;we++){const Ie=ce[we],qe=[Ie,ce[we+1],me[we+1],me[we],Ie];lx(Q,qe)&&(ie=Math.min(ie,zx(Q,qe)))}}return ie!==1/0&&ie}(V[0],V[1],B)}}function jh(o,r){return o.x*r.x+o.y*r.y}function zx(o,r){if(o.length===1){let l=0;const p=r[l++];let g;for(;!g||p.equals(g);)if(g=r[l++],!g)return 1/0;for(;l<r.length;l++){const v=r[l],x=o[0],b=g.sub(p),T=v.sub(p),I=x.sub(p),z=jh(b,b),R=jh(b,T),B=jh(T,T),V=jh(I,b),q=jh(I,T),H=z*B-R*R,Q=(B*V-R*q)/H,ie=(z*q-R*V)/H,ye=p.z*(1-Q-ie)+g.z*Q+v.z*ie;if(isFinite(ye))return ye}return 1/0}{let l=1/0;for(const p of r)l=Math.min(l,p.z);return l}}const vM=S([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:xM}=vM,wM=S([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:bM}=wM,SM=la.VectorTileFeature.types,kM=Math.cos(Math.PI/180*37.5),Dx=Math.pow(2,14)/.5;class ny{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new Oc,this.layoutVertexArray2=new ia,this.indexArray=new Ir,this.programConfigurations=new bl(r.layers,r.zoom),this.segments=new Pt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(r,l,p){this.hasPattern=Jg("line",this.layers,l);const g=this.layers[0].layout.get("line-sort-key"),v=!g.isConstant(),x=[];for(const{feature:b,id:T,index:I,sourceLayerIndex:z}of r){const R=this.layers[0]._featureFilter.needGeometry,B=kl(b,R);if(!this.layers[0]._featureFilter.filter(new Yt(this.zoom),B,p))continue;const V=v?g.evaluate(B,{},p):void 0,q={id:T,properties:b.properties,type:b.type,sourceLayerIndex:z,index:I,geometry:R?B.geometry:Sl(b),patterns:{},sortKey:V};x.push(q)}v&&x.sort((b,T)=>b.sortKey-T.sortKey);for(const b of x){const{geometry:T,index:I,sourceLayerIndex:z}=b;if(this.hasPattern){const R=Yg("line",this.layers,b,this.zoom,l);this.patternFeatures.push(R)}else this.addFeature(b,T,I,p,{});l.featureIndex.insert(r[I].feature,T,I,z,this.index)}}update(r,l,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,p)}addFeatures(r,l,p){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,l,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,bM)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,xM),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,l,p,g,v){const x=this.layers[0].layout,b=x.get("line-join").evaluate(r,{}),T=x.get("line-cap"),I=x.get("line-miter-limit"),z=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const R of l)this.addLine(R,r,b,T,I,z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,p,v,g)}addLine(r,l,p,g,v,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ie=0;ie<r.length-1;ie++)this.totalDistance+=r[ie].dist(r[ie+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const b=SM[l.type]==="Polygon";let T=r.length;for(;T>=2&&r[T-1].equals(r[T-2]);)T--;let I=0;for(;I<T-1&&r[I].equals(r[I+1]);)I++;if(T<(b?3:2))return;p==="bevel"&&(v=1.05);const z=this.overscaling<=16?15*Tn/(512*this.overscaling):0,R=this.segments.prepareSegment(10*T,this.layoutVertexArray,this.indexArray);let B,V,q,H,Q;this.e1=this.e2=-1,b&&(B=r[T-2],Q=r[I].sub(B)._unit()._perp());for(let ie=I;ie<T;ie++){if(q=ie===T-1?b?r[I+1]:void 0:r[ie+1],q&&r[ie].equals(q))continue;Q&&(H=Q),B&&(V=B),B=r[ie],Q=q?q.sub(B)._unit()._perp():H,H=H||Q;let ye=H.add(Q);ye.x===0&&ye.y===0||ye._unit();const ce=H.x*Q.x+H.y*Q.y,me=ye.x*Q.x+ye.y*Q.y,we=me!==0?1/me:1/0,Ie=2*Math.sqrt(2-2*me),qe=me<kM&&V&&q,lt=H.x*Q.y-H.y*Q.x>0;if(qe&&ie>I){const nt=B.dist(V);if(nt>2*z){const Ke=B.sub(B.sub(V)._mult(z/nt)._round());this.updateDistance(V,Ke),this.addCurrentVertex(Ke,H,0,0,R),V=Ke}}const je=V&&q;let Ve=je?p:b?"butt":g;if(je&&Ve==="round"&&(we<x?Ve="miter":we<=2&&(Ve="fakeround")),Ve==="miter"&&we>v&&(Ve="bevel"),Ve==="bevel"&&(we>2&&(Ve="flipbevel"),we<v&&(Ve="miter")),V&&this.updateDistance(V,B),Ve==="miter")ye._mult(we),this.addCurrentVertex(B,ye,0,0,R);else if(Ve==="flipbevel"){if(we>100)ye=Q.mult(-1);else{const nt=we*H.add(Q).mag()/H.sub(Q).mag();ye._perp()._mult(nt*(lt?-1:1))}this.addCurrentVertex(B,ye,0,0,R),this.addCurrentVertex(B,ye.mult(-1),0,0,R)}else if(Ve==="bevel"||Ve==="fakeround"){const nt=-Math.sqrt(we*we-1),Ke=lt?nt:0,We=lt?0:nt;if(V&&this.addCurrentVertex(B,H,Ke,We,R),Ve==="fakeround"){const ke=Math.round(180*Ie/Math.PI/20);for(let it=1;it<ke;it++){let et=it/ke;if(et!==.5){const Gt=et-.5;et+=et*Gt*(et-1)*((1.0904+ce*(ce*(3.55645-1.43519*ce)-3.2452))*Gt*Gt+(.848013+ce*(.215638*ce-1.06021)))}const dt=Q.sub(H)._mult(et)._add(H)._unit()._mult(lt?-1:1);this.addHalfVertex(B,dt.x,dt.y,!1,lt,0,R)}}q&&this.addCurrentVertex(B,Q,-Ke,-We,R)}else if(Ve==="butt")this.addCurrentVertex(B,ye,0,0,R);else if(Ve==="square"){const nt=V?1:-1;this.addCurrentVertex(B,ye,nt,nt,R)}else Ve==="round"&&(V&&(this.addCurrentVertex(B,H,0,0,R),this.addCurrentVertex(B,H,1,1,R,!0)),q&&(this.addCurrentVertex(B,Q,-1,-1,R,!0),this.addCurrentVertex(B,Q,0,0,R)));if(qe&&ie<T-1){const nt=B.dist(q);if(nt>2*z){const Ke=B.add(q.sub(B)._mult(z/nt)._round());this.updateDistance(B,Ke),this.addCurrentVertex(Ke,Q,0,0,R),B=Ke}}}}addCurrentVertex(r,l,p,g,v,x=!1){const b=l.y*g-l.x,T=-l.y-l.x*g;this.addHalfVertex(r,l.x+l.y*p,l.y-l.x*p,x,!1,p,v),this.addHalfVertex(r,b,T,x,!0,-g,v),this.distance>Dx/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(r,l,p,g,v,x))}addHalfVertex({x:r,y:l},p,g,v,x,b,T){const I=.5*(this.lineClips?this.scaledDistance*(Dx-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((r<<1)+(v?1:0),(l<<1)+(x?1:0),Math.round(63*p)+128,Math.round(63*g)+128,1+(b===0?0:b<0?-1:1)|(63&I)<<2,I>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const z=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,z),T.primitiveLength++),x?this.e2=z:this.e1=z}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(r,l){this.distance+=r.dist(l),this.updateScaledDistance()}}let Rx,Ox;Ge("LineBucket",ny,{omit:["layers","patternFeatures"]});var Lx={get paint(){return Ox=Ox||new _({"line-opacity":new ct(xe.paint_line["line-opacity"]),"line-color":new ct(xe.paint_line["line-color"]),"line-translate":new Je(xe.paint_line["line-translate"]),"line-translate-anchor":new Je(xe.paint_line["line-translate-anchor"]),"line-width":new ct(xe.paint_line["line-width"]),"line-gap-width":new ct(xe.paint_line["line-gap-width"]),"line-offset":new ct(xe.paint_line["line-offset"]),"line-blur":new ct(xe.paint_line["line-blur"]),"line-dasharray":new Rc(xe.paint_line["line-dasharray"]),"line-pattern":new Dc(xe.paint_line["line-pattern"]),"line-gradient":new zh(xe.paint_line["line-gradient"])})},get layout(){return Rx=Rx||new _({"line-cap":new Je(xe.layout_line["line-cap"]),"line-join":new ct(xe.layout_line["line-join"]),"line-miter-limit":new Je(xe.layout_line["line-miter-limit"]),"line-round-limit":new Je(xe.layout_line["line-round-limit"]),"line-sort-key":new ct(xe.layout_line["line-sort-key"])})}};class TM extends ct{possiblyEvaluate(r,l){return l=new Yt(Math.floor(l.zoom),{now:l.now,fadeDuration:l.fadeDuration,zoomHistory:l.zoomHistory,transition:l.transition}),super.possiblyEvaluate(r,l)}evaluate(r,l,p,g){return l=De({},l,{zoom:Math.floor(l.zoom)}),super.evaluate(r,l,p,g)}}let Xp;class CM extends h{constructor(r){super(r,Lx),this.gradientVersion=0,Xp||(Xp=new TM(Lx.paint.properties["line-width"].specification),Xp.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(r){if(r==="line-gradient"){const l=this.gradientExpression();this.stepInterpolant=!!function(p){return p._styleExpression!==void 0}(l)&&l._styleExpression.expression instanceof Bo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(r,l){super.recalculate(r,l),this.paint._values["line-floorwidth"]=Xp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new ny(r)}queryRadius(r){const l=r,p=Bx(Oh("line-width",this,l),Oh("line-gap-width",this,l)),g=Oh("line-offset",this,l);return p/2+Math.abs(g)+qp(this.paint.get("line-translate"))}queryIntersectsFeature(r,l,p,g,v,x,b){const T=Hp(r,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,b),I=b/2*Bx(this.paint.get("line-width").evaluate(l,p),this.paint.get("line-gap-width").evaluate(l,p)),z=this.paint.get("line-offset").evaluate(l,p);return z&&(g=function(R,B){const V=[];for(let q=0;q<R.length;q++){const H=R[q],Q=[];for(let ie=0;ie<H.length;ie++){const ye=H[ie-1],ce=H[ie],me=H[ie+1],we=ie===0?new P(0,0):ce.sub(ye)._unit()._perp(),Ie=ie===H.length-1?new P(0,0):me.sub(ce)._unit()._perp(),qe=we._add(Ie)._unit(),lt=qe.x*Ie.x+qe.y*Ie.y;lt!==0&&qe._mult(1/lt),Q.push(qe._mult(B)._add(ce))}V.push(Q)}return V}(g,z*b)),function(R,B,V){for(let q=0;q<B.length;q++){const H=B[q];if(R.length>=3){for(let Q=0;Q<H.length;Q++)if($c(R,H[Q]))return!0}if(OC(R,H,V))return!0}return!1}(T,g,I)}isTileClipped(){return!0}}function Bx(o,r){return r>0?r+2*o:o}const MM=S([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),EM=S([{name:"a_projected_pos",components:3,type:"Float32"}],4);S([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const IM=S([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);S([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Fx=S([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),PM=S([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function AM(o,r,l){return o.sections.forEach(p=>{p.text=function(g,v,x){const b=v.layout.get("text-transform").evaluate(x,{});return b==="uppercase"?g=g.toLocaleUpperCase():b==="lowercase"&&(g=g.toLocaleLowerCase()),$i.applyArabicShaping&&(g=$i.applyArabicShaping(g)),g}(p.text,r,l)}),o}S([{name:"triangle",components:3,type:"Uint16"}]),S([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),S([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),S([{type:"Float32",name:"offsetX"}]),S([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),S([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Uh={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var En=24,Nx=Zt,Vx=function(o,r,l,p,g){var v,x,b=8*g-p-1,T=(1<<b)-1,I=T>>1,z=-7,R=g-1,B=-1,V=o[r+R];for(R+=B,v=V&(1<<-z)-1,V>>=-z,z+=b;z>0;v=256*v+o[r+R],R+=B,z-=8);for(x=v&(1<<-z)-1,v>>=-z,z+=p;z>0;x=256*x+o[r+R],R+=B,z-=8);if(v===0)v=1-I;else{if(v===T)return x?NaN:1/0*(V?-1:1);x+=Math.pow(2,p),v-=I}return(V?-1:1)*x*Math.pow(2,v-p)},$x=function(o,r,l,p,g,v){var x,b,T,I=8*v-g-1,z=(1<<I)-1,R=z>>1,B=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,V=0,q=1,H=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(b=isNaN(r)?1:0,x=z):(x=Math.floor(Math.log(r)/Math.LN2),r*(T=Math.pow(2,-x))<1&&(x--,T*=2),(r+=x+R>=1?B/T:B*Math.pow(2,1-R))*T>=2&&(x++,T/=2),x+R>=z?(b=0,x=z):x+R>=1?(b=(r*T-1)*Math.pow(2,g),x+=R):(b=r*Math.pow(2,R-1)*Math.pow(2,g),x=0));g>=8;o[l+V]=255&b,V+=q,b/=256,g-=8);for(x=x<<g|b,I+=g;I>0;o[l+V]=255&x,V+=q,x/=256,I-=8);o[l+V-q]|=128*H};function Zt(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}Zt.Varint=0,Zt.Fixed64=1,Zt.Bytes=2,Zt.Fixed32=5;var iy=4294967296,jx=1/iy,Ux=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function go(o){return o.type===Zt.Bytes?o.readVarint()+o.pos:o.pos+1}function Hc(o,r,l){return l?4294967296*r+(o>>>0):4294967296*(r>>>0)+(o>>>0)}function qx(o,r,l){var p=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));l.realloc(p);for(var g=l.pos-1;g>=o;g--)l.buf[g+p]=l.buf[g]}function zM(o,r){for(var l=0;l<o.length;l++)r.writeVarint(o[l])}function DM(o,r){for(var l=0;l<o.length;l++)r.writeSVarint(o[l])}function RM(o,r){for(var l=0;l<o.length;l++)r.writeFloat(o[l])}function OM(o,r){for(var l=0;l<o.length;l++)r.writeDouble(o[l])}function LM(o,r){for(var l=0;l<o.length;l++)r.writeBoolean(o[l])}function BM(o,r){for(var l=0;l<o.length;l++)r.writeFixed32(o[l])}function FM(o,r){for(var l=0;l<o.length;l++)r.writeSFixed32(o[l])}function NM(o,r){for(var l=0;l<o.length;l++)r.writeFixed64(o[l])}function VM(o,r){for(var l=0;l<o.length;l++)r.writeSFixed64(o[l])}function Jp(o,r){return(o[r]|o[r+1]<<8|o[r+2]<<16)+16777216*o[r+3]}function Zc(o,r,l){o[l]=r,o[l+1]=r>>>8,o[l+2]=r>>>16,o[l+3]=r>>>24}function Hx(o,r){return(o[r]|o[r+1]<<8|o[r+2]<<16)+(o[r+3]<<24)}Zt.prototype={destroy:function(){this.buf=null},readFields:function(o,r,l){for(l=l||this.length;this.pos<l;){var p=this.readVarint(),g=p>>3,v=this.pos;this.type=7&p,o(g,r,this),this.pos===v&&this.skip(p)}return r},readMessage:function(o,r){return this.readFields(o,r,this.readVarint()+this.pos)},readFixed32:function(){var o=Jp(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=Hx(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=Jp(this.buf,this.pos)+Jp(this.buf,this.pos+4)*iy;return this.pos+=8,o},readSFixed64:function(){var o=Jp(this.buf,this.pos)+Hx(this.buf,this.pos+4)*iy;return this.pos+=8,o},readFloat:function(){var o=Vx(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=Vx(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var r,l,p=this.buf;return r=127&(l=p[this.pos++]),l<128?r:(r|=(127&(l=p[this.pos++]))<<7,l<128?r:(r|=(127&(l=p[this.pos++]))<<14,l<128?r:(r|=(127&(l=p[this.pos++]))<<21,l<128?r:function(g,v,x){var b,T,I=x.buf;if(b=(112&(T=I[x.pos++]))>>4,T<128||(b|=(127&(T=I[x.pos++]))<<3,T<128)||(b|=(127&(T=I[x.pos++]))<<10,T<128)||(b|=(127&(T=I[x.pos++]))<<17,T<128)||(b|=(127&(T=I[x.pos++]))<<24,T<128)||(b|=(1&(T=I[x.pos++]))<<31,T<128))return Hc(g,b,v);throw new Error("Expected varint not more than 10 bytes")}(r|=(15&(l=p[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var o=this.readVarint()+this.pos,r=this.pos;return this.pos=o,o-r>=12&&Ux?function(l,p,g){return Ux.decode(l.subarray(p,g))}(this.buf,r,o):function(l,p,g){for(var v="",x=p;x<g;){var b,T,I,z=l[x],R=null,B=z>239?4:z>223?3:z>191?2:1;if(x+B>g)break;B===1?z<128&&(R=z):B===2?(192&(b=l[x+1]))==128&&(R=(31&z)<<6|63&b)<=127&&(R=null):B===3?(T=l[x+2],(192&(b=l[x+1]))==128&&(192&T)==128&&((R=(15&z)<<12|(63&b)<<6|63&T)<=2047||R>=55296&&R<=57343)&&(R=null)):B===4&&(T=l[x+2],I=l[x+3],(192&(b=l[x+1]))==128&&(192&T)==128&&(192&I)==128&&((R=(15&z)<<18|(63&b)<<12|(63&T)<<6|63&I)<=65535||R>=1114112)&&(R=null)),R===null?(R=65533,B=1):R>65535&&(R-=65536,v+=String.fromCharCode(R>>>10&1023|55296),R=56320|1023&R),v+=String.fromCharCode(R),x+=B}return v}(this.buf,r,o)},readBytes:function(){var o=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,o);return this.pos=o,r},readPackedVarint:function(o,r){if(this.type!==Zt.Bytes)return o.push(this.readVarint(r));var l=go(this);for(o=o||[];this.pos<l;)o.push(this.readVarint(r));return o},readPackedSVarint:function(o){if(this.type!==Zt.Bytes)return o.push(this.readSVarint());var r=go(this);for(o=o||[];this.pos<r;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==Zt.Bytes)return o.push(this.readBoolean());var r=go(this);for(o=o||[];this.pos<r;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==Zt.Bytes)return o.push(this.readFloat());var r=go(this);for(o=o||[];this.pos<r;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==Zt.Bytes)return o.push(this.readDouble());var r=go(this);for(o=o||[];this.pos<r;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==Zt.Bytes)return o.push(this.readFixed32());var r=go(this);for(o=o||[];this.pos<r;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==Zt.Bytes)return o.push(this.readSFixed32());var r=go(this);for(o=o||[];this.pos<r;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==Zt.Bytes)return o.push(this.readFixed64());var r=go(this);for(o=o||[];this.pos<r;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==Zt.Bytes)return o.push(this.readSFixed64());var r=go(this);for(o=o||[];this.pos<r;)o.push(this.readSFixed64());return o},skip:function(o){var r=7&o;if(r===Zt.Varint)for(;this.buf[this.pos++]>127;);else if(r===Zt.Bytes)this.pos=this.readVarint()+this.pos;else if(r===Zt.Fixed32)this.pos+=4;else{if(r!==Zt.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(o,r){this.writeVarint(o<<3|r)},realloc:function(o){for(var r=this.length||16;r<this.pos+o;)r*=2;if(r!==this.length){var l=new Uint8Array(r);l.set(this.buf),this.buf=l,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),Zc(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),Zc(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),Zc(this.buf,-1&o,this.pos),Zc(this.buf,Math.floor(o*jx),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),Zc(this.buf,-1&o,this.pos),Zc(this.buf,Math.floor(o*jx),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(r,l){var p,g;if(r>=0?(p=r%4294967296|0,g=r/4294967296|0):(g=~(-r/4294967296),4294967295^(p=~(-r%4294967296))?p=p+1|0:(p=0,g=g+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),function(v,x,b){b.buf[b.pos++]=127&v|128,v>>>=7,b.buf[b.pos++]=127&v|128,v>>>=7,b.buf[b.pos++]=127&v|128,v>>>=7,b.buf[b.pos++]=127&v|128,b.buf[b.pos]=127&(v>>>=7)}(p,0,l),function(v,x){var b=(7&v)<<4;x.buf[x.pos++]|=b|((v>>>=3)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v)))))}(g,l)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(!!o)},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var r=this.pos;this.pos=function(p,g,v){for(var x,b,T=0;T<g.length;T++){if((x=g.charCodeAt(T))>55295&&x<57344){if(!b){x>56319||T+1===g.length?(p[v++]=239,p[v++]=191,p[v++]=189):b=x;continue}if(x<56320){p[v++]=239,p[v++]=191,p[v++]=189,b=x;continue}x=b-55296<<10|x-56320|65536,b=null}else b&&(p[v++]=239,p[v++]=191,p[v++]=189,b=null);x<128?p[v++]=x:(x<2048?p[v++]=x>>6|192:(x<65536?p[v++]=x>>12|224:(p[v++]=x>>18|240,p[v++]=x>>12&63|128),p[v++]=x>>6&63|128),p[v++]=63&x|128)}return v}(this.buf,o,this.pos);var l=this.pos-r;l>=128&&qx(r,l,this),this.pos=r-1,this.writeVarint(l),this.pos+=l},writeFloat:function(o){this.realloc(4),$x(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),$x(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var r=o.length;this.writeVarint(r),this.realloc(r);for(var l=0;l<r;l++)this.buf[this.pos++]=o[l]},writeRawMessage:function(o,r){this.pos++;var l=this.pos;o(r,this);var p=this.pos-l;p>=128&&qx(l,p,this),this.pos=l-1,this.writeVarint(p),this.pos+=p},writeMessage:function(o,r,l){this.writeTag(o,Zt.Bytes),this.writeRawMessage(r,l)},writePackedVarint:function(o,r){r.length&&this.writeMessage(o,zM,r)},writePackedSVarint:function(o,r){r.length&&this.writeMessage(o,DM,r)},writePackedBoolean:function(o,r){r.length&&this.writeMessage(o,LM,r)},writePackedFloat:function(o,r){r.length&&this.writeMessage(o,RM,r)},writePackedDouble:function(o,r){r.length&&this.writeMessage(o,OM,r)},writePackedFixed32:function(o,r){r.length&&this.writeMessage(o,BM,r)},writePackedSFixed32:function(o,r){r.length&&this.writeMessage(o,FM,r)},writePackedFixed64:function(o,r){r.length&&this.writeMessage(o,NM,r)},writePackedSFixed64:function(o,r){r.length&&this.writeMessage(o,VM,r)},writeBytesField:function(o,r){this.writeTag(o,Zt.Bytes),this.writeBytes(r)},writeFixed32Field:function(o,r){this.writeTag(o,Zt.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(o,r){this.writeTag(o,Zt.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(o,r){this.writeTag(o,Zt.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(o,r){this.writeTag(o,Zt.Fixed64),this.writeSFixed64(r)},writeVarintField:function(o,r){this.writeTag(o,Zt.Varint),this.writeVarint(r)},writeSVarintField:function(o,r){this.writeTag(o,Zt.Varint),this.writeSVarint(r)},writeStringField:function(o,r){this.writeTag(o,Zt.Bytes),this.writeString(r)},writeFloatField:function(o,r){this.writeTag(o,Zt.Fixed32),this.writeFloat(r)},writeDoubleField:function(o,r){this.writeTag(o,Zt.Fixed64),this.writeDouble(r)},writeBooleanField:function(o,r){this.writeVarintField(o,!!r)}};var ry=w(Nx);const sy=3;function $M(o,r,l){o===1&&l.readMessage(jM,r)}function jM(o,r,l){if(o===3){const{id:p,bitmap:g,width:v,height:x,left:b,top:T,advance:I}=l.readMessage(UM,{});r.push({id:p,bitmap:new Bh({width:v+2*sy,height:x+2*sy},g),metrics:{width:v,height:x,left:b,top:T,advance:I}})}}function UM(o,r,l){o===1?r.id=l.readVarint():o===2?r.bitmap=l.readBytes():o===3?r.width=l.readVarint():o===4?r.height=l.readVarint():o===5?r.left=l.readSVarint():o===6?r.top=l.readSVarint():o===7&&(r.advance=l.readVarint())}const Zx=sy;function Wx(o){let r=0,l=0;for(const x of o)r+=x.w*x.h,l=Math.max(l,x.w);o.sort((x,b)=>b.h-x.h);const p=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),l),h:1/0}];let g=0,v=0;for(const x of o)for(let b=p.length-1;b>=0;b--){const T=p[b];if(!(x.w>T.w||x.h>T.h)){if(x.x=T.x,x.y=T.y,v=Math.max(v,x.y+x.h),g=Math.max(g,x.x+x.w),x.w===T.w&&x.h===T.h){const I=p.pop();b<p.length&&(p[b]=I)}else x.h===T.h?(T.x+=x.w,T.w-=x.w):x.w===T.w?(T.y+=x.h,T.h-=x.h):(p.push({x:T.x+x.w,y:T.y,w:T.w-x.w,h:x.h}),T.y+=x.h,T.h-=x.h);break}}return{w:g,h:v,fill:r/(g*v)||0}}const Ui=1;class oy{constructor(r,{pixelRatio:l,version:p,stretchX:g,stretchY:v,content:x,textFitWidth:b,textFitHeight:T}){this.paddedRect=r,this.pixelRatio=l,this.stretchX=g,this.stretchY=v,this.content=x,this.version=p,this.textFitWidth=b,this.textFitHeight=T}get tl(){return[this.paddedRect.x+Ui,this.paddedRect.y+Ui]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ui,this.paddedRect.y+this.paddedRect.h-Ui]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Ui)/this.pixelRatio,(this.paddedRect.h-2*Ui)/this.pixelRatio]}}class Gx{constructor(r,l){const p={},g={};this.haveRenderCallbacks=[];const v=[];this.addImages(r,p,v),this.addImages(l,g,v);const{w:x,h:b}=Wx(v),T=new Pr({width:x||1,height:b||1});for(const I in r){const z=r[I],R=p[I].paddedRect;Pr.copy(z.data,T,{x:0,y:0},{x:R.x+Ui,y:R.y+Ui},z.data)}for(const I in l){const z=l[I],R=g[I].paddedRect,B=R.x+Ui,V=R.y+Ui,q=z.data.width,H=z.data.height;Pr.copy(z.data,T,{x:0,y:0},{x:B,y:V},z.data),Pr.copy(z.data,T,{x:0,y:H-1},{x:B,y:V-1},{width:q,height:1}),Pr.copy(z.data,T,{x:0,y:0},{x:B,y:V+H},{width:q,height:1}),Pr.copy(z.data,T,{x:q-1,y:0},{x:B-1,y:V},{width:1,height:H}),Pr.copy(z.data,T,{x:0,y:0},{x:B+q,y:V},{width:1,height:H})}this.image=T,this.iconPositions=p,this.patternPositions=g}addImages(r,l,p){for(const g in r){const v=r[g],x={x:0,y:0,w:v.data.width+2*Ui,h:v.data.height+2*Ui};p.push(x),l[g]=new oy(x,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(r,l){r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const p in r.updatedImages)this.patchUpdatedImage(this.iconPositions[p],r.getImage(p),l),this.patchUpdatedImage(this.patternPositions[p],r.getImage(p),l)}patchUpdatedImage(r,l,p){if(!r||!l||r.version===l.version)return;r.version=l.version;const[g,v]=r.tl;p.update(l.data,void 0,{x:g,y:v})}}var ca;Ge("ImagePosition",oy),Ge("ImageAtlas",Gx),d.ah=void 0,(ca=d.ah||(d.ah={}))[ca.none=0]="none",ca[ca.horizontal=1]="horizontal",ca[ca.vertical=2]="vertical",ca[ca.horizontalOnly=3]="horizontalOnly";const qh=-17;class Hh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,l){const p=new Hh;return p.scale=r||1,p.fontStack=l,p}static forImage(r){const l=new Hh;return l.imageName=r,l}}class Wc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,l){const p=new Wc;for(let g=0;g<r.sections.length;g++){const v=r.sections[g];v.image?p.addImageSection(v):p.addTextSection(v,l)}return p}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(){this.text=function(r){let l="";for(let p=0;p<r.length;p++){const g=r.charCodeAt(p+1)||null,v=r.charCodeAt(p-1)||null;l+=g&&Bp(g)&&!Uh[r[p+1]]||v&&Bp(v)&&!Uh[r[p-1]]||!Uh[r[p]]?r[p]:Uh[r[p]]}return l}(this.text)}trim(){let r=0;for(let p=0;p<this.text.length&&Qp[this.text.charCodeAt(p)];p++)r++;let l=this.text.length;for(let p=this.text.length-1;p>=0&&p>=r&&Qp[this.text.charCodeAt(p)];p--)l--;this.text=this.text.substring(r,l),this.sectionIndex=this.sectionIndex.slice(r,l)}substring(r,l){const p=new Wc;return p.text=this.text.substring(r,l),p.sectionIndex=this.sectionIndex.slice(r,l),p.sections=this.sections,p}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,l)=>Math.max(r,this.sections[l].scale),0)}addTextSection(r,l){this.text+=r.text,this.sections.push(Hh.forText(r.scale,r.fontStack||l));const p=this.sections.length-1;for(let g=0;g<r.text.length;++g)this.sectionIndex.push(p)}addImageSection(r){const l=r.image?r.image.name:"";if(l.length===0)return void dn("Can't add FormattedSection with an empty image.");const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCharCode(p),this.sections.push(Hh.forImage(l)),this.sectionIndex.push(this.sections.length-1)):dn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Yp(o,r,l,p,g,v,x,b,T,I,z,R,B,V,q){const H=Wc.fromFeature(o,g);let Q;R===d.ah.vertical&&H.verticalizePunctuation();const{processBidirectionalText:ie,processStyledBidirectionalText:ye}=$i;if(ie&&H.sections.length===1){Q=[];const we=ie(H.toString(),ay(H,I,v,r,p,V));for(const Ie of we){const qe=new Wc;qe.text=Ie,qe.sections=H.sections;for(let lt=0;lt<Ie.length;lt++)qe.sectionIndex.push(0);Q.push(qe)}}else if(ye){Q=[];const we=ye(H.text,H.sectionIndex,ay(H,I,v,r,p,V));for(const Ie of we){const qe=new Wc;qe.text=Ie[0],qe.sectionIndex=Ie[1],qe.sections=H.sections,Q.push(qe)}}else Q=function(we,Ie){const qe=[],lt=we.text;let je=0;for(const Ve of Ie)qe.push(we.substring(je,Ve)),je=Ve;return je<lt.length&&qe.push(we.substring(je,lt.length)),qe}(H,ay(H,I,v,r,p,V));const ce=[],me={positionedLines:ce,text:H.toString(),top:z[1],bottom:z[1],left:z[0],right:z[0],writingMode:R,iconsInText:!1,verticalizable:!1};return function(we,Ie,qe,lt,je,Ve,nt,Ke,We,ke,it,et){let dt=0,Gt=qh,Wt=0,Dn=0;const Yr=Ke==="right"?1:Ke==="left"?0:.5;let Xn=0;for(const mn of je){mn.trim();const On=mn.getMaxScale(),ci=(On-1)*En,Jn={positionedGlyphs:[],lineOffset:0};we.positionedLines[Xn]=Jn;const Ei=Jn.positionedGlyphs;let Yn=0;if(!mn.length()){Gt+=Ve,++Xn;continue}for(let qi=0;qi<mn.length();qi++){const Bt=mn.getSection(qi),Xt=mn.getSectionIndex(qi),nn=mn.getCharCode(qi);let ur=0,cn=null,Jc=null,Ns=null,Vs=En;const Qr=!(We===d.ah.horizontal||!it&&!Ph(nn)||it&&(Qp[nn]||(Rn=nn,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(Rn)))));if(Bt.imageName){const Dr=lt[Bt.imageName];if(!Dr)continue;Ns=Bt.imageName,we.iconsInText=we.iconsInText||!0,Jc=Dr.paddedRect;const $n=Dr.displaySize;Bt.scale=Bt.scale*En/et,cn={width:$n[0],height:$n[1],left:Ui,top:-Zx,advance:Qr?$n[1]:$n[0]},ur=ci+(En-$n[1]*Bt.scale),Vs=cn.advance;const yo=Qr?$n[0]*Bt.scale-En*On:$n[1]*Bt.scale-En*On;yo>0&&yo>Yn&&(Yn=yo)}else{const Dr=qe[Bt.fontStack],$n=Dr&&Dr[nn];if($n&&$n.rect)Jc=$n.rect,cn=$n.metrics;else{const yo=Ie[Bt.fontStack],Jh=yo&&yo[nn];if(!Jh)continue;cn=Jh.metrics}ur=(On-Bt.scale)*En}Qr?(we.verticalizable=!0,Ei.push({glyph:nn,imageName:Ns,x:dt,y:Gt+ur,vertical:Qr,scale:Bt.scale,fontStack:Bt.fontStack,sectionIndex:Xt,metrics:cn,rect:Jc}),dt+=Vs*Bt.scale+ke):(Ei.push({glyph:nn,imageName:Ns,x:dt,y:Gt+ur,vertical:Qr,scale:Bt.scale,fontStack:Bt.fontStack,sectionIndex:Xt,metrics:cn,rect:Jc}),dt+=cn.advance*Bt.scale+ke)}Ei.length!==0&&(Wt=Math.max(dt-ke,Wt),WM(Ei,0,Ei.length-1,Yr,Yn)),dt=0;const zr=Ve*On+Yn;Jn.lineOffset=Math.max(Yn,ci),Gt+=zr,Dn=Math.max(zr,Dn),++Xn}var Rn;const Ti=Gt-qh,{horizontalAlign:Ci,verticalAlign:Mi}=ly(nt);(function(mn,On,ci,Jn,Ei,Yn,zr,qi,Bt){const Xt=(On-ci)*Ei;let nn=0;nn=Yn!==zr?-qi*Jn-qh:(-Jn*Bt+.5)*zr;for(const ur of mn)for(const cn of ur.positionedGlyphs)cn.x+=Xt,cn.y+=nn})(we.positionedLines,Yr,Ci,Mi,Wt,Dn,Ve,Ti,je.length),we.top+=-Mi*Ti,we.bottom=we.top+Ti,we.left+=-Ci*Wt,we.right=we.left+Wt}(me,r,l,p,Q,x,b,T,R,I,B,q),!function(we){for(const Ie of we)if(Ie.positionedGlyphs.length!==0)return!1;return!0}(ce)&&me}const Qp={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},qM={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},HM={40:!0};function Kx(o,r,l,p,g,v){if(r.imageName){const x=p[r.imageName];return x?x.displaySize[0]*r.scale*En/v+g:0}{const x=l[r.fontStack],b=x&&x[o];return b?b.metrics.advance*r.scale+g:0}}function Xx(o,r,l,p){const g=Math.pow(o-r,2);return p?o<r?g/2:2*g:g+Math.abs(l)*l}function ZM(o,r,l){let p=0;return o===10&&(p-=1e4),l&&(p+=150),o!==40&&o!==65288||(p+=50),r!==41&&r!==65289||(p+=50),p}function Jx(o,r,l,p,g,v){let x=null,b=Xx(r,l,g,v);for(const T of p){const I=Xx(r-T.x,l,g,v)+T.badness;I<=b&&(x=T,b=I)}return{index:o,x:r,priorBreak:x,badness:b}}function Yx(o){return o?Yx(o.priorBreak).concat(o.index):[]}function ay(o,r,l,p,g,v){if(!o)return[];const x=[],b=function(R,B,V,q,H,Q){let ie=0;for(let ye=0;ye<R.length();ye++){const ce=R.getSection(ye);ie+=Kx(R.getCharCode(ye),ce,q,H,B,Q)}return ie/Math.max(1,Math.ceil(ie/V))}(o,r,l,p,g,v),T=o.text.indexOf("")>=0;let I=0;for(let R=0;R<o.length();R++){const B=o.getSection(R),V=o.getCharCode(R);if(Qp[V]||(I+=Kx(V,B,p,g,r,v)),R<o.length()-1){const q=!((z=V)<11904)&&(!!It["CJK Compatibility Forms"](z)||!!It["CJK Compatibility"](z)||!!It["CJK Strokes"](z)||!!It["CJK Symbols and Punctuation"](z)||!!It["Enclosed CJK Letters and Months"](z)||!!It["Halfwidth and Fullwidth Forms"](z)||!!It["Ideographic Description Characters"](z)||!!It["Vertical Forms"](z)||Lp.test(String.fromCodePoint(z)));(qM[V]||q||B.imageName||R!==o.length()-2&&HM[o.getCharCode(R+1)])&&x.push(Jx(R+1,I,b,x,ZM(V,o.getCharCode(R+1),q&&T),!1))}}var z;return Yx(Jx(o.length(),I,b,x,0,!0))}function ly(o){let r=.5,l=.5;switch(o){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:r,verticalAlign:l}}function WM(o,r,l,p,g){if(!p&&!g)return;const v=o[l],x=(o[l].x+v.metrics.advance*v.scale)*p;for(let b=r;b<=l;b++)o[b].x-=x,o[b].y+=g}function GM(o,r,l){const{horizontalAlign:p,verticalAlign:g}=ly(l),v=r[0]-o.displaySize[0]*p,x=r[1]-o.displaySize[1]*g;return{image:o,top:x,bottom:x+o.displaySize[1],left:v,right:v+o.displaySize[0]}}function Qx(o){var r,l;let p=o.left,g=o.top,v=o.right-p,x=o.bottom-g;const b=(r=o.image.textFitWidth)!==null&&r!==void 0?r:"stretchOrShrink",T=(l=o.image.textFitHeight)!==null&&l!==void 0?l:"stretchOrShrink",I=(o.image.content[2]-o.image.content[0])/(o.image.content[3]-o.image.content[1]);if(T==="proportional"){if(b==="stretchOnly"&&v/x<I||b==="proportional"){const z=Math.ceil(x*I);p*=z/v,v=z}}else if(b==="proportional"&&T==="stretchOnly"&&I!==0&&v/x>I){const z=Math.ceil(v/I);g*=z/x,x=z}return{x1:p,y1:g,x2:p+v,y2:g+x}}function e1(o,r,l,p,g,v){const x=o.image;let b;if(x.content){const Q=x.content,ie=x.pixelRatio||1;b=[Q[0]/ie,Q[1]/ie,x.displaySize[0]-Q[2]/ie,x.displaySize[1]-Q[3]/ie]}const T=r.left*v,I=r.right*v;let z,R,B,V;l==="width"||l==="both"?(V=g[0]+T-p[3],R=g[0]+I+p[1]):(V=g[0]+(T+I-x.displaySize[0])/2,R=V+x.displaySize[0]);const q=r.top*v,H=r.bottom*v;return l==="height"||l==="both"?(z=g[1]+q-p[0],B=g[1]+H+p[2]):(z=g[1]+(q+H-x.displaySize[1])/2,B=z+x.displaySize[1]),{image:x,top:z,right:R,bottom:B,left:V,collisionPadding:b}}const Zh=255,Fs=128,ua=Zh*Fs;function t1(o,r){const{expression:l}=r;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new Yt(o+1))};if(l.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:g}=l;let v=0;for(;v<p.length&&p[v]<=o;)v++;v=Math.max(0,v-1);let x=v;for(;x<p.length&&p[x]<o+1;)x++;x=Math.min(p.length-1,x);const b=p[v],T=p[x];return l.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:T,interpolationType:g}:{kind:"camera",minZoom:b,maxZoom:T,minSize:l.evaluate(new Yt(b)),maxSize:l.evaluate(new Yt(T)),interpolationType:g}}}function cy(o,r,l){let p="never";const g=o.get(r);return g?p=g:o.get(l)&&(p="always"),p}const KM=la.VectorTileFeature.types,XM=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ef(o,r,l,p,g,v,x,b,T,I,z,R,B){const V=b?Math.min(ua,Math.round(b[0])):0,q=b?Math.min(ua,Math.round(b[1])):0;o.emplaceBack(r,l,Math.round(32*p),Math.round(32*g),v,x,(V<<1)+(T?1:0),q,16*I,16*z,256*R,256*B)}function uy(o,r,l){o.emplaceBack(r.x,r.y,l),o.emplaceBack(r.x,r.y,l),o.emplaceBack(r.x,r.y,l),o.emplaceBack(r.x,r.y,l)}function JM(o){for(const r of o.sections)if(Fg(r.text))return!0;return!1}class hy{constructor(r){this.layoutVertexArray=new Lc,this.indexArray=new Ir,this.programConfigurations=r,this.segments=new Pt,this.dynamicLayoutVertexArray=new Dh,this.opacityVertexArray=new lr,this.hasVisibleVertices=!1,this.placedSymbolArray=new Qt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(r,l,p,g){this.isEmpty()||(p&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,MM.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,EM.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,XM,!0),this.opacityVertexBuffer.itemSize=1),(p||g)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ge("SymbolBuffers",hy);class dy{constructor(r,l,p){this.layoutVertexArray=new r,this.layoutAttributes=l,this.indexArray=new p,this.segments=new Pt,this.collisionVertexArray=new Ls}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,IM.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ge("CollisionBuffers",dy);class Gc{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(x=>x.id),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Hg([]),this.placementViewportMatrix=Hg([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=t1(this.zoom,l["text-size"]),this.iconSizeData=t1(this.zoom,l["icon-size"]);const p=this.layers[0].layout,g=p.get("symbol-sort-key"),v=p.get("symbol-z-order");this.canOverlap=cy(p,"text-overlap","text-allow-overlap")!=="never"||cy(p,"icon-overlap","icon-allow-overlap")!=="never"||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&!g.isConstant(),this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,p.get("symbol-placement")==="point"&&(this.writingModes=p.get("text-writing-mode").map(x=>d.ah[x])),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=r.sourceID}createArrays(){this.text=new hy(new bl(this.layers,this.zoom,r=>/^text/.test(r))),this.icon=new hy(new bl(this.layers,this.zoom,r=>/^icon/.test(r))),this.glyphOffsetArray=new en,this.lineVertexArray=new Zn,this.symbolInstances=new Mt,this.textAnchorOffsets=new tn}calculateGlyphDependencies(r,l,p,g,v){for(let x=0;x<r.length;x++)if(l[r.charCodeAt(x)]=!0,(p||g)&&v){const b=Uh[r.charAt(x)];b&&(l[b.charCodeAt(0)]=!0)}}populate(r,l,p){const g=this.layers[0],v=g.layout,x=v.get("text-font"),b=v.get("text-field"),T=v.get("icon-image"),I=(b.value.kind!=="constant"||b.value.value instanceof Bi&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),z=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,R=v.get("symbol-sort-key");if(this.features=[],!I&&!z)return;const B=l.iconDependencies,V=l.glyphDependencies,q=l.availableImages,H=new Yt(this.zoom);for(const{feature:Q,id:ie,index:ye,sourceLayerIndex:ce}of r){const me=g._featureFilter.needGeometry,we=kl(Q,me);if(!g._featureFilter.filter(H,we,p))continue;let Ie,qe;if(me||(we.geometry=Sl(Q)),I){const je=g.getValueAndResolveTokens("text-field",we,p,q),Ve=Bi.factory(je),nt=this.hasRTLText=this.hasRTLText||JM(Ve);(!nt||$i.getRTLTextPluginStatus()==="unavailable"||nt&&$i.isParsed())&&(Ie=AM(Ve,g,we))}if(z){const je=g.getValueAndResolveTokens("icon-image",we,p,q);qe=je instanceof Ni?je:Ni.fromString(je)}if(!Ie&&!qe)continue;const lt=this.sortFeaturesByKey?R.evaluate(we,{},p):void 0;if(this.features.push({id:ie,text:Ie,icon:qe,index:ye,sourceLayerIndex:ce,geometry:we.geometry,properties:Q.properties,type:KM[Q.type],sortKey:lt}),qe&&(B[qe.name]=!0),Ie){const je=x.evaluate(we,{},p).join(","),Ve=v.get("text-rotation-alignment")!=="viewport"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(d.ah.vertical)>=0;for(const nt of Ie.sections)if(nt.image)B[nt.image.name]=!0;else{const Ke=Eh(Ie.toString()),We=nt.fontStack||je,ke=V[We]=V[We]||{};this.calculateGlyphDependencies(nt.text,ke,Ve,this.allowVerticalPlacement,Ke)}}}v.get("symbol-placement")==="line"&&(this.features=function(Q){const ie={},ye={},ce=[];let me=0;function we(je){ce.push(Q[je]),me++}function Ie(je,Ve,nt){const Ke=ye[je];return delete ye[je],ye[Ve]=Ke,ce[Ke].geometry[0].pop(),ce[Ke].geometry[0]=ce[Ke].geometry[0].concat(nt[0]),Ke}function qe(je,Ve,nt){const Ke=ie[Ve];return delete ie[Ve],ie[je]=Ke,ce[Ke].geometry[0].shift(),ce[Ke].geometry[0]=nt[0].concat(ce[Ke].geometry[0]),Ke}function lt(je,Ve,nt){const Ke=nt?Ve[0][Ve[0].length-1]:Ve[0][0];return`${je}:${Ke.x}:${Ke.y}`}for(let je=0;je<Q.length;je++){const Ve=Q[je],nt=Ve.geometry,Ke=Ve.text?Ve.text.toString():null;if(!Ke){we(je);continue}const We=lt(Ke,nt),ke=lt(Ke,nt,!0);if(We in ye&&ke in ie&&ye[We]!==ie[ke]){const it=qe(We,ke,nt),et=Ie(We,ke,ce[it].geometry);delete ie[We],delete ye[ke],ye[lt(Ke,ce[et].geometry,!0)]=et,ce[it].geometry=null}else We in ye?Ie(We,ke,nt):ke in ie?qe(We,ke,nt):(we(je),ie[We]=me-1,ye[ke]=me-1)}return ce.filter(je=>je.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Q,ie)=>Q.sortKey-ie.sortKey)}update(r,l,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,l,this.layers,p),this.icon.programConfigurations.updatePaintArrays(r,l,this.layers,p))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,l){const p=this.lineVertexArray.length;if(r.segment!==void 0){let g=r.dist(l[r.segment+1]),v=r.dist(l[r.segment]);const x={};for(let b=r.segment+1;b<l.length;b++)x[b]={x:l[b].x,y:l[b].y,tileUnitDistanceFromAnchor:g},b<l.length-1&&(g+=l[b+1].dist(l[b]));for(let b=r.segment||0;b>=0;b--)x[b]={x:l[b].x,y:l[b].y,tileUnitDistanceFromAnchor:v},b>0&&(v+=l[b-1].dist(l[b]));for(let b=0;b<l.length;b++){const T=x[b];this.lineVertexArray.emplaceBack(T.x,T.y,T.tileUnitDistanceFromAnchor)}}return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}}addSymbols(r,l,p,g,v,x,b,T,I,z,R,B){const V=r.indexArray,q=r.layoutVertexArray,H=r.segments.prepareSegment(4*l.length,q,V,this.canOverlap?x.sortKey:void 0),Q=this.glyphOffsetArray.length,ie=H.vertexLength,ye=this.allowVerticalPlacement&&b===d.ah.vertical?Math.PI/2:0,ce=x.text&&x.text.sections;for(let me=0;me<l.length;me++){const{tl:we,tr:Ie,bl:qe,br:lt,tex:je,pixelOffsetTL:Ve,pixelOffsetBR:nt,minFontScaleX:Ke,minFontScaleY:We,glyphOffset:ke,isSDF:it,sectionIndex:et}=l[me],dt=H.vertexLength,Gt=ke[1];ef(q,T.x,T.y,we.x,Gt+we.y,je.x,je.y,p,it,Ve.x,Ve.y,Ke,We),ef(q,T.x,T.y,Ie.x,Gt+Ie.y,je.x+je.w,je.y,p,it,nt.x,Ve.y,Ke,We),ef(q,T.x,T.y,qe.x,Gt+qe.y,je.x,je.y+je.h,p,it,Ve.x,nt.y,Ke,We),ef(q,T.x,T.y,lt.x,Gt+lt.y,je.x+je.w,je.y+je.h,p,it,nt.x,nt.y,Ke,We),uy(r.dynamicLayoutVertexArray,T,ye),V.emplaceBack(dt,dt+1,dt+2),V.emplaceBack(dt+1,dt+2,dt+3),H.vertexLength+=4,H.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ke[0]),me!==l.length-1&&et===l[me+1].sectionIndex||r.programConfigurations.populatePaintArrays(q.length,x,x.index,{},B,ce&&ce[et])}r.placedSymbolArray.emplaceBack(T.x,T.y,Q,this.glyphOffsetArray.length-Q,ie,I,z,T.segment,p?p[0]:0,p?p[1]:0,g[0],g[1],b,0,!1,0,R)}_addCollisionDebugVertex(r,l,p,g,v,x){return l.emplaceBack(0,0),r.emplaceBack(p.x,p.y,g,v,Math.round(x.x),Math.round(x.y))}addCollisionDebugVertices(r,l,p,g,v,x,b){const T=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),I=T.vertexLength,z=v.layoutVertexArray,R=v.collisionVertexArray,B=b.anchorX,V=b.anchorY;this._addCollisionDebugVertex(z,R,x,B,V,new P(r,l)),this._addCollisionDebugVertex(z,R,x,B,V,new P(p,l)),this._addCollisionDebugVertex(z,R,x,B,V,new P(p,g)),this._addCollisionDebugVertex(z,R,x,B,V,new P(r,g)),T.vertexLength+=4;const q=v.indexArray;q.emplaceBack(I,I+1),q.emplaceBack(I+1,I+2),q.emplaceBack(I+2,I+3),q.emplaceBack(I+3,I),T.primitiveLength+=4}addDebugCollisionBoxes(r,l,p,g){for(let v=r;v<l;v++){const x=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,g?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,p)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new dy(cr,Fx.members,Vn),this.iconCollisionBox=new dy(cr,Fx.members,Vn);for(let r=0;r<this.symbolInstances.length;r++){const l=this.symbolInstances.get(r);this.addDebugCollisionBoxes(l.textBoxStartIndex,l.textBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.iconBoxStartIndex,l.iconBoxEndIndex,l,!1),this.addDebugCollisionBoxes(l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex,l,!1)}}_deserializeCollisionBoxesForSymbol(r,l,p,g,v,x,b,T,I){const z={};for(let R=l;R<p;R++){const B=r.get(R);z.textBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},z.textFeatureIndex=B.featureIndex;break}for(let R=g;R<v;R++){const B=r.get(R);z.verticalTextBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},z.verticalTextFeatureIndex=B.featureIndex;break}for(let R=x;R<b;R++){const B=r.get(R);z.iconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},z.iconFeatureIndex=B.featureIndex;break}for(let R=T;R<I;R++){const B=r.get(R);z.verticalIconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},z.verticalIconFeatureIndex=B.featureIndex;break}return z}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const p=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,l){const p=r.placedSymbolArray.get(l),g=p.vertexStartIndex+4*p.numGlyphs;for(let v=p.vertexStartIndex;v<g;v+=4)r.indexArray.emplaceBack(v,v+1,v+2),r.indexArray.emplaceBack(v+1,v+2,v+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const l=Math.sin(r),p=Math.cos(r),g=[],v=[],x=[];for(let b=0;b<this.symbolInstances.length;++b){x.push(b);const T=this.symbolInstances.get(b);g.push(0|Math.round(l*T.anchorX+p*T.anchorY)),v.push(T.featureIndex)}return x.sort((b,T)=>g[b]-g[T]||v[T]-v[b]),x}addToSortKeyRanges(r,l){const p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===l?p.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const p=this.symbolInstances.get(l);this.featureSortOrder.push(p.featureIndex),[p.rightJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.leftJustifiedTextSymbolIndex].forEach((g,v,x)=>{g>=0&&x.indexOf(g)===v&&this.addIndicesForPlacedSymbol(this.text,g)}),p.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,p.verticalPlacedTextSymbolIndex),p.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.placedIconSymbolIndex),p.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let n1,i1;Ge("SymbolBucket",Gc,{omit:["layers","collisionBoxArray","features","compareText"]}),Gc.MAX_GLYPHS=65535,Gc.addDynamicAttributes=uy;var py={get paint(){return i1=i1||new _({"icon-opacity":new ct(xe.paint_symbol["icon-opacity"]),"icon-color":new ct(xe.paint_symbol["icon-color"]),"icon-halo-color":new ct(xe.paint_symbol["icon-halo-color"]),"icon-halo-width":new ct(xe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ct(xe.paint_symbol["icon-halo-blur"]),"icon-translate":new Je(xe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Je(xe.paint_symbol["icon-translate-anchor"]),"text-opacity":new ct(xe.paint_symbol["text-opacity"]),"text-color":new ct(xe.paint_symbol["text-color"],{runtimeType:xi,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new ct(xe.paint_symbol["text-halo-color"]),"text-halo-width":new ct(xe.paint_symbol["text-halo-width"]),"text-halo-blur":new ct(xe.paint_symbol["text-halo-blur"]),"text-translate":new Je(xe.paint_symbol["text-translate"]),"text-translate-anchor":new Je(xe.paint_symbol["text-translate-anchor"])})},get layout(){return n1=n1||new _({"symbol-placement":new Je(xe.layout_symbol["symbol-placement"]),"symbol-spacing":new Je(xe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Je(xe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ct(xe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Je(xe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Je(xe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Je(xe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Je(xe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Je(xe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Je(xe.layout_symbol["icon-rotation-alignment"]),"icon-size":new ct(xe.layout_symbol["icon-size"]),"icon-text-fit":new Je(xe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Je(xe.layout_symbol["icon-text-fit-padding"]),"icon-image":new ct(xe.layout_symbol["icon-image"]),"icon-rotate":new ct(xe.layout_symbol["icon-rotate"]),"icon-padding":new ct(xe.layout_symbol["icon-padding"]),"icon-keep-upright":new Je(xe.layout_symbol["icon-keep-upright"]),"icon-offset":new ct(xe.layout_symbol["icon-offset"]),"icon-anchor":new ct(xe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Je(xe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Je(xe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Je(xe.layout_symbol["text-rotation-alignment"]),"text-field":new ct(xe.layout_symbol["text-field"]),"text-font":new ct(xe.layout_symbol["text-font"]),"text-size":new ct(xe.layout_symbol["text-size"]),"text-max-width":new ct(xe.layout_symbol["text-max-width"]),"text-line-height":new Je(xe.layout_symbol["text-line-height"]),"text-letter-spacing":new ct(xe.layout_symbol["text-letter-spacing"]),"text-justify":new ct(xe.layout_symbol["text-justify"]),"text-radial-offset":new ct(xe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Je(xe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new ct(xe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new ct(xe.layout_symbol["text-anchor"]),"text-max-angle":new Je(xe.layout_symbol["text-max-angle"]),"text-writing-mode":new Je(xe.layout_symbol["text-writing-mode"]),"text-rotate":new ct(xe.layout_symbol["text-rotate"]),"text-padding":new Je(xe.layout_symbol["text-padding"]),"text-keep-upright":new Je(xe.layout_symbol["text-keep-upright"]),"text-transform":new ct(xe.layout_symbol["text-transform"]),"text-offset":new ct(xe.layout_symbol["text-offset"]),"text-allow-overlap":new Je(xe.layout_symbol["text-allow-overlap"]),"text-overlap":new Je(xe.layout_symbol["text-overlap"]),"text-ignore-placement":new Je(xe.layout_symbol["text-ignore-placement"]),"text-optional":new Je(xe.layout_symbol["text-optional"])})}};class r1{constructor(r){if(r.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=r.property.overrides?r.property.overrides.runtimeType:zs,this.defaultValue=r}evaluate(r){if(r.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(r.formattedSection))return l.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ge("FormatSectionOverride",r1,{omit:["defaultValue"]});class tf extends h{constructor(r){super(r,py)}recalculate(r,l){if(super.recalculate(r,l),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const p=this.layout.get("text-writing-mode");if(p){const g=[];for(const v of p)g.indexOf(v)<0&&g.push(v);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(r,l,p,g){const v=this.layout.get(r).evaluate(l,{},p,g),x=this._unevaluatedLayout._values[r];return x.isDataDriven()||wc(x.value)||!v?v:function(b,T){return T.replace(/{([^{}]+)}/g,(I,z)=>b&&z in b?String(b[z]):"")}(l.properties,v)}createBucket(r){return new Gc(r)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const r of py.paint.overridableProperties){if(!tf.hasPaintOverride(this.layout,r))continue;const l=this.paint.get(r),p=new r1(l),g=new xc(p,l.property.specification);let v=null;v=l.value.kind==="constant"||l.value.kind==="source"?new Zo("source",g):new Wo("composite",g,l.value.zoomStops),this.paint._values[r]=new Xr(l.property,v,l.parameters)}}_handleOverridablePaintPropertyUpdate(r,l,p){return!(!this.layout||l.isDataDriven()||p.isDataDriven())&&tf.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,l){const p=r.get("text-field"),g=py.paint.properties[l];let v=!1;const x=b=>{for(const T of b)if(g.overrides&&g.overrides.hasOverride(T))return void(v=!0)};if(p.value.kind==="constant"&&p.value.value instanceof Bi)x(p.value.value.sections);else if(p.value.kind==="source"){const b=I=>{v||(I instanceof Sr&&kn(I.value)===ds?x(I.value.sections):I instanceof hc?x(I.sections):I.eachChild(b))},T=p.value;T._styleExpression&&b(T._styleExpression.expression)}return v}}let s1;var YM={get paint(){return s1=s1||new _({"background-color":new Je(xe.paint_background["background-color"]),"background-pattern":new Rc(xe.paint_background["background-pattern"]),"background-opacity":new Je(xe.paint_background["background-opacity"])})}};class QM extends h{constructor(r){super(r,YM)}}let o1;var eE={get paint(){return o1=o1||new _({"raster-opacity":new Je(xe.paint_raster["raster-opacity"]),"raster-hue-rotate":new Je(xe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Je(xe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Je(xe.paint_raster["raster-brightness-max"]),"raster-saturation":new Je(xe.paint_raster["raster-saturation"]),"raster-contrast":new Je(xe.paint_raster["raster-contrast"]),"raster-resampling":new Je(xe.paint_raster["raster-resampling"]),"raster-fade-duration":new Je(xe.paint_raster["raster-fade-duration"])})}};class tE extends h{constructor(r){super(r,eE)}}class nE extends h{constructor(r){super(r,{}),this.onAdd=l=>{this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)},this.onRemove=l=>{this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)},this.implementation=r}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class iE{constructor(r){this._methodToThrottle=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const fy=63710088e-1;class ha{constructor(r,l){if(isNaN(r)||isNaN(l))throw new Error(`Invalid LngLat object: (${r}, ${l})`);if(this.lng=+r,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ha(Ee(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const l=Math.PI/180,p=this.lat*l,g=r.lat*l,v=Math.sin(p)*Math.sin(g)+Math.cos(p)*Math.cos(g)*Math.cos((r.lng-this.lng)*l);return fy*Math.acos(Math.min(v,1))}static convert(r){if(r instanceof ha)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new ha(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new ha(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const a1=2*Math.PI*fy;function l1(o){return a1*Math.cos(o*Math.PI/180)}function c1(o){return(180+o)/360}function u1(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function h1(o,r){return o/l1(r)}function my(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}class Wh{constructor(r,l,p=0){this.x=+r,this.y=+l,this.z=+p}static fromLngLat(r,l=0){const p=ha.convert(r);return new Wh(c1(p.lng),u1(p.lat),h1(l,p.lat))}toLngLat(){return new ha(360*this.x-180,my(this.y))}toAltitude(){return this.z*l1(my(this.y))}meterInMercatorCoordinateUnits(){return 1/a1*(r=my(this.y),1/Math.cos(r*Math.PI/180));var r}}function d1(o,r,l){var p=2*Math.PI*6378137/256/Math.pow(2,l);return[o*p-2*Math.PI*6378137/2,r*p-2*Math.PI*6378137/2]}class gy{constructor(r,l,p){if(!function(g,v,x){return!(g<0||g>25||x<0||x>=Math.pow(2,g)||v<0||v>=Math.pow(2,g))}(r,l,p))throw new Error(`x=${l}, y=${p}, z=${r} outside of bounds. 0<=x<${Math.pow(2,r)}, 0<=y<${Math.pow(2,r)} 0<=z<=25 `);this.z=r,this.x=l,this.y=p,this.key=Gh(0,r,r,l,p)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,l,p){const g=(x=this.y,b=this.z,T=d1(256*(v=this.x),256*(x=Math.pow(2,b)-x-1),b),I=d1(256*(v+1),256*(x+1),b),T[0]+","+T[1]+","+I[0]+","+I[1]);var v,x,b,T,I;const z=function(R,B,V){let q,H="";for(let Q=R;Q>0;Q--)q=1<<Q-1,H+=(B&q?1:0)+(V&q?2:0);return H}(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(p==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,l>1?"@2x":"").replace(/{quadkey}/g,z).replace(/{bbox-epsg-3857}/g,g)}isChildOf(r){const l=this.z-r.z;return l>0&&r.x===this.x>>l&&r.y===this.y>>l}getTilePoint(r){const l=Math.pow(2,this.z);return new P((r.x*l-this.x)*Tn,(r.y*l-this.y)*Tn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class p1{constructor(r,l){this.wrap=r,this.canonical=l,this.key=Gh(r,l.z,l.z,l.x,l.y)}}class Ar{constructor(r,l,p,g,v){if(r<p)throw new Error(`overscaledZ should be >= z; overscaledZ = ${r}; z = ${p}`);this.overscaledZ=r,this.wrap=l,this.canonical=new gy(p,+g,+v),this.key=Gh(l,r,p,g,v)}clone(){return new Ar(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){if(r>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${r}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-r;return r>this.canonical.z?new Ar(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ar(r,this.wrap,r,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(r,l){if(r>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${r}; overscaledZ = ${this.overscaledZ}`);const p=this.canonical.z-r;return r>this.canonical.z?Gh(this.wrap*+l,r,this.canonical.z,this.canonical.x,this.canonical.y):Gh(this.wrap*+l,r,r,this.canonical.x>>p,this.canonical.y>>p)}isChildOf(r){if(r.wrap!==this.wrap)return!1;const l=this.canonical.z-r.canonical.z;return r.overscaledZ===0||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>l&&r.canonical.y===this.canonical.y>>l}children(r){if(this.overscaledZ>=r)return[new Ar(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,p=2*this.canonical.x,g=2*this.canonical.y;return[new Ar(l,this.wrap,l,p,g),new Ar(l,this.wrap,l,p+1,g),new Ar(l,this.wrap,l,p,g+1),new Ar(l,this.wrap,l,p+1,g+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new Ar(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new Ar(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new p1(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(r){return this.canonical.getTilePoint(new Wh(r.x-this.wrap,r.y))}}function Gh(o,r,l,p,g){(o*=2)<0&&(o=-1*o-1);const v=1<<l;return(v*v*o+v*g+p).toString(36)+l.toString(36)+r.toString(36)}Ge("CanonicalTileID",gy),Ge("OverscaledTileID",Ar,{omit:["posMatrix"]});class f1{constructor(r,l,p,g=1,v=1,x=1,b=0){if(this.uid=r,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(p&&!["mapbox","terrarium","custom"].includes(p))return void dn(`"${p}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=l.height;const T=this.dim=l.height-2;switch(this.data=new Uint32Array(l.data.buffer),p){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=g,this.greenFactor=v,this.blueFactor=x,this.baseShift=b;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let I=0;I<T;I++)this.data[this._idx(-1,I)]=this.data[this._idx(0,I)],this.data[this._idx(T,I)]=this.data[this._idx(T-1,I)],this.data[this._idx(I,-1)]=this.data[this._idx(I,0)],this.data[this._idx(I,T)]=this.data[this._idx(I,T-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(T,-1)]=this.data[this._idx(T-1,0)],this.data[this._idx(-1,T)]=this.data[this._idx(0,T-1)],this.data[this._idx(T,T)]=this.data[this._idx(T-1,T-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let I=0;I<T;I++)for(let z=0;z<T;z++){const R=this.get(I,z);R>this.max&&(this.max=R),R<this.min&&(this.min=R)}}get(r,l){const p=new Uint8Array(this.data.buffer),g=4*this._idx(r,l);return this.unpack(p[g],p[g+1],p[g+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(r,l){if(r<-1||r>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(r+1)}unpack(r,l,p){return r*this.redFactor+l*this.greenFactor+p*this.blueFactor-this.baseShift}getPixels(){return new Pr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(r,l,p){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let g=l*this.dim,v=l*this.dim+this.dim,x=p*this.dim,b=p*this.dim+this.dim;switch(l){case-1:g=v-1;break;case 1:v=g+1}switch(p){case-1:x=b-1;break;case 1:b=x+1}const T=-l*this.dim,I=-p*this.dim;for(let z=x;z<b;z++)for(let R=g;R<v;R++)this.data[this._idx(R,z)]=r.data[this._idx(R+T,z+I)]}}Ge("DEMData",f1);class m1{constructor(r){this._stringToNumber={},this._numberToString=[];for(let l=0;l<r.length;l++){const p=r[l];this._stringToNumber[p]=l,this._numberToString[l]=p}}encode(r){return this._stringToNumber[r]}decode(r){if(r>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${r} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[r]}}class g1{constructor(r,l,p,g,v){this.type="Feature",this._vectorTileFeature=r,r._z=l,r._x=p,r._y=g,this.properties=r.properties,this.id=v}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={geometry:this.geometry};for(const l in this)l!=="_geometry"&&l!=="_vectorTileFeature"&&(r[l]=this[l]);return r}}class y1{constructor(r,l){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new Jo(Tn,16,0),this.grid3D=new Jo(Tn,16,0),this.featureIndexArray=new ai,this.promoteId=l}insert(r,l,p,g,v,x){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,g,v);const T=x?this.grid3D:this.grid;for(let I=0;I<l.length;I++){const z=l[I],R=[1/0,1/0,-1/0,-1/0];for(let B=0;B<z.length;B++){const V=z[B];R[0]=Math.min(R[0],V.x),R[1]=Math.min(R[1],V.y),R[2]=Math.max(R[2],V.x),R[3]=Math.max(R[3],V.y)}R[0]<Tn&&R[1]<Tn&&R[2]>=0&&R[3]>=0&&T.insert(b,R[0],R[1],R[2],R[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new la.VectorTile(new ry(this.rawTileData)).layers,this.sourceLayerCoder=new m1(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(r,l,p,g){this.loadVTLayers();const v=r.params||{},x=Tn/r.tileSize/r.scale,b=ph(v.filter),T=r.queryGeometry,I=r.queryPadding*x,z=v1(T),R=this.grid.query(z.minX-I,z.minY-I,z.maxX+I,z.maxY+I),B=v1(r.cameraQueryGeometry),V=this.grid3D.query(B.minX-I,B.minY-I,B.maxX+I,B.maxY+I,(Q,ie,ye,ce)=>function(me,we,Ie,qe,lt){for(const Ve of me)if(we<=Ve.x&&Ie<=Ve.y&&qe>=Ve.x&&lt>=Ve.y)return!0;const je=[new P(we,Ie),new P(we,lt),new P(qe,lt),new P(qe,Ie)];if(me.length>2){for(const Ve of je)if($c(me,Ve))return!0}for(let Ve=0;Ve<me.length-1;Ve++)if(BC(me[Ve],me[Ve+1],je))return!0;return!1}(r.cameraQueryGeometry,Q-I,ie-I,ye+I,ce+I));for(const Q of V)R.push(Q);R.sort(rE);const q={};let H;for(let Q=0;Q<R.length;Q++){const ie=R[Q];if(ie===H)continue;H=ie;const ye=this.featureIndexArray.get(ie);let ce=null;this.loadMatchingFeature(q,ye.bucketIndex,ye.sourceLayerIndex,ye.featureIndex,b,v.layers,v.availableImages,l,p,g,(me,we,Ie)=>(ce||(ce=Sl(me)),we.queryIntersectsFeature(T,me,Ie,ce,this.z,r.transform,x,r.pixelPosMatrix)))}return q}loadMatchingFeature(r,l,p,g,v,x,b,T,I,z,R){const B=this.bucketLayerIDs[l];if(x&&!function(Q,ie){for(let ye=0;ye<Q.length;ye++)if(ie.indexOf(Q[ye])>=0)return!0;return!1}(x,B))return;const V=this.sourceLayerCoder.decode(p),q=this.vtLayers[V].feature(g);if(v.needGeometry){const Q=kl(q,!0);if(!v.filter(new Yt(this.tileID.overscaledZ),Q,this.tileID.canonical))return}else if(!v.filter(new Yt(this.tileID.overscaledZ),q))return;const H=this.getId(q,V);for(let Q=0;Q<B.length;Q++){const ie=B[Q];if(x&&x.indexOf(ie)<0)continue;const ye=T[ie];if(!ye)continue;let ce={};H&&z&&(ce=z.getState(ye.sourceLayer||"_geojsonTileLayer",H));const me=De({},I[ie]);me.paint=_1(me.paint,ye.paint,q,ce,b),me.layout=_1(me.layout,ye.layout,q,ce,b);const we=!R||R(q,ye,ce);if(!we)continue;const Ie=new g1(q,this.z,this.x,this.y,H);Ie.layer=me;let qe=r[ie];qe===void 0&&(qe=r[ie]=[]),qe.push({featureIndex:g,feature:Ie,intersectionZ:we})}}lookupSymbolFeatures(r,l,p,g,v,x,b,T){const I={};this.loadVTLayers();const z=ph(v);for(const R of r)this.loadMatchingFeature(I,p,g,R,z,x,b,T,l);return I}hasLayer(r){for(const l of this.bucketLayerIDs)for(const p of l)if(r===p)return!0;return!1}getId(r,l){let p=r.id;return this.promoteId&&(p=r.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[l]],typeof p=="boolean"&&(p=Number(p))),p}}function _1(o,r,l,p,g){return tt(o,(v,x)=>{const b=r instanceof vl?r.get(x):null;return b&&b.evaluate?b.evaluate(l,p,g):b})}function v1(o){let r=1/0,l=1/0,p=-1/0,g=-1/0;for(const v of o)r=Math.min(r,v.x),l=Math.min(l,v.y),p=Math.max(p,v.x),g=Math.max(g,v.y);return{minX:r,minY:l,maxX:p,maxY:g}}function rE(o,r){return r-o}function x1(o,r,l,p,g){const v=[];for(let x=0;x<o.length;x++){const b=o[x];let T;for(let I=0;I<b.length-1;I++){let z=b[I],R=b[I+1];z.x<r&&R.x<r||(z.x<r?z=new P(r,z.y+(r-z.x)/(R.x-z.x)*(R.y-z.y))._round():R.x<r&&(R=new P(r,z.y+(r-z.x)/(R.x-z.x)*(R.y-z.y))._round()),z.y<l&&R.y<l||(z.y<l?z=new P(z.x+(l-z.y)/(R.y-z.y)*(R.x-z.x),l)._round():R.y<l&&(R=new P(z.x+(l-z.y)/(R.y-z.y)*(R.x-z.x),l)._round()),z.x>=p&&R.x>=p||(z.x>=p?z=new P(p,z.y+(p-z.x)/(R.x-z.x)*(R.y-z.y))._round():R.x>=p&&(R=new P(p,z.y+(p-z.x)/(R.x-z.x)*(R.y-z.y))._round()),z.y>=g&&R.y>=g||(z.y>=g?z=new P(z.x+(g-z.y)/(R.y-z.y)*(R.x-z.x),g)._round():R.y>=g&&(R=new P(z.x+(g-z.y)/(R.y-z.y)*(R.x-z.x),g)._round()),T&&z.equals(T[T.length-1])||(T=[z],v.push(T)),T.push(R)))))}}return v}Ge("FeatureIndex",y1,{omit:["rawTileData","sourceLayerCoder"]});class da extends P{constructor(r,l,p,g){super(r,l),this.angle=p,g!==void 0&&(this.segment=g)}clone(){return new da(this.x,this.y,this.angle,this.segment)}}function w1(o,r,l,p,g){if(r.segment===void 0||l===0)return!0;let v=r,x=r.segment+1,b=0;for(;b>-l/2;){if(x--,x<0)return!1;b-=o[x].dist(v),v=o[x]}b+=o[x].dist(o[x+1]),x++;const T=[];let I=0;for(;b<l/2;){const z=o[x],R=o[x+1];if(!R)return!1;let B=o[x-1].angleTo(z)-z.angleTo(R);for(B=Math.abs((B+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:b,angleDelta:B}),I+=B;b-T[0].distance>p;)I-=T.shift().angleDelta;if(I>g)return!1;x++,b+=z.dist(R)}return!0}function b1(o){let r=0;for(let l=0;l<o.length-1;l++)r+=o[l].dist(o[l+1]);return r}function S1(o,r,l){return o?.6*r*l:0}function k1(o,r){return Math.max(o?o.right-o.left:0,r?r.right-r.left:0)}function sE(o,r,l,p,g,v){const x=S1(l,g,v),b=k1(l,p)*v;let T=0;const I=b1(o)/2;for(let z=0;z<o.length-1;z++){const R=o[z],B=o[z+1],V=R.dist(B);if(T+V>I){const q=(I-T)/V,H=wi.number(R.x,B.x,q),Q=wi.number(R.y,B.y,q),ie=new da(H,Q,B.angleTo(R),z);return ie._round(),!x||w1(o,ie,b,x,r)?ie:void 0}T+=V}}function oE(o,r,l,p,g,v,x,b,T){const I=S1(p,v,x),z=k1(p,g),R=z*x,B=o[0].x===0||o[0].x===T||o[0].y===0||o[0].y===T;return r-R<r/4&&(r=R+r/4),T1(o,B?r/2*b%r:(z/2+2*v)*x*b%r,r,I,l,R,B,!1,T)}function T1(o,r,l,p,g,v,x,b,T){const I=v/2,z=b1(o);let R=0,B=r-l,V=[];for(let q=0;q<o.length-1;q++){const H=o[q],Q=o[q+1],ie=H.dist(Q),ye=Q.angleTo(H);for(;B+l<R+ie;){B+=l;const ce=(B-R)/ie,me=wi.number(H.x,Q.x,ce),we=wi.number(H.y,Q.y,ce);if(me>=0&&me<T&&we>=0&&we<T&&B-I>=0&&B+I<=z){const Ie=new da(me,we,ye,q);Ie._round(),p&&!w1(o,Ie,v,p,g)||V.push(Ie)}}R+=ie}return b||V.length||x||(V=T1(o,R/2,l,p,g,v,x,!0,T)),V}Ge("Anchor",da);const Kc=Ui;function C1(o,r,l,p){const g=[],v=o.image,x=v.pixelRatio,b=v.paddedRect.w-2*Kc,T=v.paddedRect.h-2*Kc;let I={x1:o.left,y1:o.top,x2:o.right,y2:o.bottom};const z=v.stretchX||[[0,b]],R=v.stretchY||[[0,T]],B=(ke,it)=>ke+it[1]-it[0],V=z.reduce(B,0),q=R.reduce(B,0),H=b-V,Q=T-q;let ie=0,ye=V,ce=0,me=q,we=0,Ie=H,qe=0,lt=Q;if(v.content&&p){const ke=v.content,it=ke[2]-ke[0],et=ke[3]-ke[1];(v.textFitWidth||v.textFitHeight)&&(I=Qx(o)),ie=nf(z,0,ke[0]),ce=nf(R,0,ke[1]),ye=nf(z,ke[0],ke[2]),me=nf(R,ke[1],ke[3]),we=ke[0]-ie,qe=ke[1]-ce,Ie=it-ye,lt=et-me}const je=I.x1,Ve=I.y1,nt=I.x2-je,Ke=I.y2-Ve,We=(ke,it,et,dt)=>{const Gt=rf(ke.stretch-ie,ye,nt,je),Wt=sf(ke.fixed-we,Ie,ke.stretch,V),Dn=rf(it.stretch-ce,me,Ke,Ve),Yr=sf(it.fixed-qe,lt,it.stretch,q),Xn=rf(et.stretch-ie,ye,nt,je),Rn=sf(et.fixed-we,Ie,et.stretch,V),Ti=rf(dt.stretch-ce,me,Ke,Ve),Ci=sf(dt.fixed-qe,lt,dt.stretch,q),Mi=new P(Gt,Dn),mn=new P(Xn,Dn),On=new P(Xn,Ti),ci=new P(Gt,Ti),Jn=new P(Wt/x,Yr/x),Ei=new P(Rn/x,Ci/x),Yn=r*Math.PI/180;if(Yn){const Bt=Math.sin(Yn),Xt=Math.cos(Yn),nn=[Xt,-Bt,Bt,Xt];Mi._matMult(nn),mn._matMult(nn),ci._matMult(nn),On._matMult(nn)}const zr=ke.stretch+ke.fixed,qi=it.stretch+it.fixed;return{tl:Mi,tr:mn,bl:ci,br:On,tex:{x:v.paddedRect.x+Kc+zr,y:v.paddedRect.y+Kc+qi,w:et.stretch+et.fixed-zr,h:dt.stretch+dt.fixed-qi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Jn,pixelOffsetBR:Ei,minFontScaleX:Ie/x/nt,minFontScaleY:lt/x/Ke,isSDF:l}};if(p&&(v.stretchX||v.stretchY)){const ke=M1(z,H,V),it=M1(R,Q,q);for(let et=0;et<ke.length-1;et++){const dt=ke[et],Gt=ke[et+1];for(let Wt=0;Wt<it.length-1;Wt++)g.push(We(dt,it[Wt],Gt,it[Wt+1]))}}else g.push(We({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:T+1}));return g}function nf(o,r,l){let p=0;for(const g of o)p+=Math.max(r,Math.min(l,g[1]))-Math.max(r,Math.min(l,g[0]));return p}function M1(o,r,l){const p=[{fixed:-Kc,stretch:0}];for(const[g,v]of o){const x=p[p.length-1];p.push({fixed:g-x.stretch,stretch:x.stretch}),p.push({fixed:g-x.stretch,stretch:x.stretch+(v-g)})}return p.push({fixed:r+Kc,stretch:l}),p}function rf(o,r,l,p){return o/r*l+p}function sf(o,r,l,p){return o-r*l/p}class of{constructor(r,l,p,g,v,x,b,T,I,z){var R;if(this.boxStartIndex=r.length,I){let B=x.top,V=x.bottom;const q=x.collisionPadding;q&&(B-=q[1],V+=q[3]);let H=V-B;H>0&&(H=Math.max(10,H),this.circleDiameter=H)}else{const B=!((R=x.image)===null||R===void 0)&&R.content&&(x.image.textFitWidth||x.image.textFitHeight)?Qx(x):{x1:x.left,y1:x.top,x2:x.right,y2:x.bottom};B.y1=B.y1*b-T[0],B.y2=B.y2*b+T[2],B.x1=B.x1*b-T[3],B.x2=B.x2*b+T[1];const V=x.collisionPadding;if(V&&(B.x1-=V[0]*b,B.y1-=V[1]*b,B.x2+=V[2]*b,B.y2+=V[3]*b),z){const q=new P(B.x1,B.y1),H=new P(B.x2,B.y1),Q=new P(B.x1,B.y2),ie=new P(B.x2,B.y2),ye=z*Math.PI/180;q._rotate(ye),H._rotate(ye),Q._rotate(ye),ie._rotate(ye),B.x1=Math.min(q.x,H.x,Q.x,ie.x),B.x2=Math.max(q.x,H.x,Q.x,ie.x),B.y1=Math.min(q.y,H.y,Q.y,ie.y),B.y2=Math.max(q.y,H.y,Q.y,ie.y)}r.emplaceBack(l.x,l.y,B.x1,B.y1,B.x2,B.y2,p,g,v)}this.boxEndIndex=r.length}}class aE{constructor(r=[],l=(p,g)=>p<g?-1:p>g?1:0){if(this.data=r,this.length=this.data.length,this.compare=l,this.length>0)for(let p=(this.length>>1)-1;p>=0;p--)this._down(p)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],l=this.data.pop();return--this.length>0&&(this.data[0]=l,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:l,compare:p}=this,g=l[r];for(;r>0;){const v=r-1>>1,x=l[v];if(p(g,x)>=0)break;l[r]=x,r=v}l[r]=g}_down(r){const{data:l,compare:p}=this,g=this.length>>1,v=l[r];for(;r<g;){let x=1+(r<<1);const b=x+1;if(b<this.length&&p(l[b],l[x])<0&&(x=b),p(l[x],v)>=0)break;l[r]=l[x],r=x}l[r]=v}}function lE(o,r=1,l=!1){let p=1/0,g=1/0,v=-1/0,x=-1/0;const b=o[0];for(let V=0;V<b.length;V++){const q=b[V];(!V||q.x<p)&&(p=q.x),(!V||q.y<g)&&(g=q.y),(!V||q.x>v)&&(v=q.x),(!V||q.y>x)&&(x=q.y)}const T=Math.min(v-p,x-g);let I=T/2;const z=new aE([],cE);if(T===0)return new P(p,g);for(let V=p;V<v;V+=T)for(let q=g;q<x;q+=T)z.push(new Xc(V+I,q+I,I,o));let R=function(V){let q=0,H=0,Q=0;const ie=V[0];for(let ye=0,ce=ie.length,me=ce-1;ye<ce;me=ye++){const we=ie[ye],Ie=ie[me],qe=we.x*Ie.y-Ie.x*we.y;H+=(we.x+Ie.x)*qe,Q+=(we.y+Ie.y)*qe,q+=3*qe}return new Xc(H/q,Q/q,0,V)}(o),B=z.length;for(;z.length;){const V=z.pop();(V.d>R.d||!R.d)&&(R=V,l&&console.log("found best %d after %d probes",Math.round(1e4*V.d)/1e4,B)),V.max-R.d<=r||(I=V.h/2,z.push(new Xc(V.p.x-I,V.p.y-I,I,o)),z.push(new Xc(V.p.x+I,V.p.y-I,I,o)),z.push(new Xc(V.p.x-I,V.p.y+I,I,o)),z.push(new Xc(V.p.x+I,V.p.y+I,I,o)),B+=4)}return l&&(console.log(`num probes: ${B}`),console.log(`best distance: ${R.d}`)),R.p}function cE(o,r){return r.max-o.max}function Xc(o,r,l,p){this.p=new P(o,r),this.h=l,this.d=function(g,v){let x=!1,b=1/0;for(let T=0;T<v.length;T++){const I=v[T];for(let z=0,R=I.length,B=R-1;z<R;B=z++){const V=I[z],q=I[B];V.y>g.y!=q.y>g.y&&g.x<(q.x-V.x)*(g.y-V.y)/(q.y-V.y)+V.x&&(x=!x),b=Math.min(b,ux(g,V,q))}}return(x?1:-1)*Math.sqrt(b)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}var Kn;d.aq=void 0,(Kn=d.aq||(d.aq={}))[Kn.center=1]="center",Kn[Kn.left=2]="left",Kn[Kn.right=3]="right",Kn[Kn.top=4]="top",Kn[Kn.bottom=5]="bottom",Kn[Kn["top-left"]=6]="top-left",Kn[Kn["top-right"]=7]="top-right",Kn[Kn["bottom-left"]=8]="bottom-left",Kn[Kn["bottom-right"]=9]="bottom-right";const pa=7,yy=Number.POSITIVE_INFINITY;function E1(o,r){return r[1]!==yy?function(l,p,g){let v=0,x=0;switch(p=Math.abs(p),g=Math.abs(g),l){case"top-right":case"top-left":case"top":x=g-pa;break;case"bottom-right":case"bottom-left":case"bottom":x=-g+pa}switch(l){case"top-right":case"bottom-right":case"right":v=-p;break;case"top-left":case"bottom-left":case"left":v=p}return[v,x]}(o,r[0],r[1]):function(l,p){let g=0,v=0;p<0&&(p=0);const x=p/Math.SQRT2;switch(l){case"top-right":case"top-left":v=x-pa;break;case"bottom-right":case"bottom-left":v=-x+pa;break;case"bottom":v=-p+pa;break;case"top":v=p-pa}switch(l){case"top-right":case"bottom-right":g=-x;break;case"top-left":case"bottom-left":g=x;break;case"left":g=p;break;case"right":g=-p}return[g,v]}(o,r[0])}function I1(o,r,l){var p;const g=o.layout,v=(p=g.get("text-variable-anchor-offset"))===null||p===void 0?void 0:p.evaluate(r,{},l);if(v){const b=v.values,T=[];for(let I=0;I<b.length;I+=2){const z=T[I]=b[I],R=b[I+1].map(B=>B*En);z.startsWith("top")?R[1]-=pa:z.startsWith("bottom")&&(R[1]+=pa),T[I+1]=R}return new ir(T)}const x=g.get("text-variable-anchor");if(x){let b;b=o._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[g.get("text-radial-offset").evaluate(r,{},l)*En,yy]:g.get("text-offset").evaluate(r,{},l).map(I=>I*En);const T=[];for(const I of x)T.push(I,E1(I,b));return new ir(T)}return null}function _y(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function uE(o,r,l,p,g,v,x,b,T,I,z){let R=v.textMaxSize.evaluate(r,{});R===void 0&&(R=x);const B=o.layers[0].layout,V=B.get("icon-offset").evaluate(r,{},z),q=A1(l.horizontal),H=x/24,Q=o.tilePixelRatio*H,ie=o.tilePixelRatio*R/24,ye=o.tilePixelRatio*b,ce=o.tilePixelRatio*B.get("symbol-spacing"),me=B.get("text-padding")*o.tilePixelRatio,we=function(ke,it,et,dt=1){const Gt=ke.get("icon-padding").evaluate(it,{},et),Wt=Gt&&Gt.values;return[Wt[0]*dt,Wt[1]*dt,Wt[2]*dt,Wt[3]*dt]}(B,r,z,o.tilePixelRatio),Ie=B.get("text-max-angle")/180*Math.PI,qe=B.get("text-rotation-alignment")!=="viewport"&&B.get("symbol-placement")!=="point",lt=B.get("icon-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",je=B.get("symbol-placement"),Ve=ce/2,nt=B.get("icon-text-fit");let Ke;p&&nt!=="none"&&(o.allowVerticalPlacement&&l.vertical&&(Ke=e1(p,l.vertical,nt,B.get("icon-text-fit-padding"),V,H)),q&&(p=e1(p,q,nt,B.get("icon-text-fit-padding"),V,H)));const We=(ke,it)=>{it.x<0||it.x>=Tn||it.y<0||it.y>=Tn||function(et,dt,Gt,Wt,Dn,Yr,Xn,Rn,Ti,Ci,Mi,mn,On,ci,Jn,Ei,Yn,zr,qi,Bt,Xt,nn,ur,cn,Jc){const Ns=et.addToLineVertexArray(dt,Gt);let Vs,Qr,Dr,$n,yo=0,Jh=0,O1=0,L1=0,Cy=-1,My=-1;const _o={};let B1=Bc("");if(et.allowVerticalPlacement&&Wt.vertical){const ui=Rn.layout.get("text-rotate").evaluate(Xt,{},cn)+90;Dr=new of(Ti,dt,Ci,Mi,mn,Wt.vertical,On,ci,Jn,ui),Xn&&($n=new of(Ti,dt,Ci,Mi,mn,Xn,Yn,zr,Jn,ui))}if(Dn){const ui=Rn.layout.get("icon-rotate").evaluate(Xt,{}),Rr=Rn.layout.get("icon-text-fit")!=="none",Cl=C1(Dn,ui,ur,Rr),ys=Xn?C1(Xn,ui,ur,Rr):void 0;Qr=new of(Ti,dt,Ci,Mi,mn,Dn,Yn,zr,!1,ui),yo=4*Cl.length;const Ml=et.iconSizeData;let $s=null;Ml.kind==="source"?($s=[Fs*Rn.layout.get("icon-size").evaluate(Xt,{})],$s[0]>ua&&dn(`${et.layerIds[0]}: Value for "icon-size" is >= ${Zh}. Reduce your "icon-size".`)):Ml.kind==="composite"&&($s=[Fs*nn.compositeIconSizes[0].evaluate(Xt,{},cn),Fs*nn.compositeIconSizes[1].evaluate(Xt,{},cn)],($s[0]>ua||$s[1]>ua)&&dn(`${et.layerIds[0]}: Value for "icon-size" is >= ${Zh}. Reduce your "icon-size".`)),et.addSymbols(et.icon,Cl,$s,Bt,qi,Xt,d.ah.none,dt,Ns.lineStartIndex,Ns.lineLength,-1,cn),Cy=et.icon.placedSymbolArray.length-1,ys&&(Jh=4*ys.length,et.addSymbols(et.icon,ys,$s,Bt,qi,Xt,d.ah.vertical,dt,Ns.lineStartIndex,Ns.lineLength,-1,cn),My=et.icon.placedSymbolArray.length-1)}const F1=Object.keys(Wt.horizontal);for(const ui of F1){const Rr=Wt.horizontal[ui];if(!Vs){B1=Bc(Rr.text);const ys=Rn.layout.get("text-rotate").evaluate(Xt,{},cn);Vs=new of(Ti,dt,Ci,Mi,mn,Rr,On,ci,Jn,ys)}const Cl=Rr.positionedLines.length===1;if(O1+=P1(et,dt,Rr,Yr,Rn,Jn,Xt,Ei,Ns,Wt.vertical?d.ah.horizontal:d.ah.horizontalOnly,Cl?F1:[ui],_o,Cy,nn,cn),Cl)break}Wt.vertical&&(L1+=P1(et,dt,Wt.vertical,Yr,Rn,Jn,Xt,Ei,Ns,d.ah.vertical,["vertical"],_o,My,nn,cn));const pE=Vs?Vs.boxStartIndex:et.collisionBoxArray.length,fE=Vs?Vs.boxEndIndex:et.collisionBoxArray.length,mE=Dr?Dr.boxStartIndex:et.collisionBoxArray.length,gE=Dr?Dr.boxEndIndex:et.collisionBoxArray.length,yE=Qr?Qr.boxStartIndex:et.collisionBoxArray.length,_E=Qr?Qr.boxEndIndex:et.collisionBoxArray.length,vE=$n?$n.boxStartIndex:et.collisionBoxArray.length,xE=$n?$n.boxEndIndex:et.collisionBoxArray.length;let gs=-1;const lf=(ui,Rr)=>ui&&ui.circleDiameter?Math.max(ui.circleDiameter,Rr):Rr;gs=lf(Vs,gs),gs=lf(Dr,gs),gs=lf(Qr,gs),gs=lf($n,gs);const N1=gs>-1?1:0;N1&&(gs*=Jc/En),et.glyphOffsetArray.length>=Gc.MAX_GLYPHS&&dn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Xt.sortKey!==void 0&&et.addToSortKeyRanges(et.symbolInstances.length,Xt.sortKey);const wE=I1(Rn,Xt,cn),[bE,SE]=function(ui,Rr){const Cl=ui.length,ys=Rr==null?void 0:Rr.values;if((ys==null?void 0:ys.length)>0)for(let Ml=0;Ml<ys.length;Ml+=2){const $s=ys[Ml+1];ui.emplaceBack(d.aq[ys[Ml]],$s[0],$s[1])}return[Cl,ui.length]}(et.textAnchorOffsets,wE);et.symbolInstances.emplaceBack(dt.x,dt.y,_o.right>=0?_o.right:-1,_o.center>=0?_o.center:-1,_o.left>=0?_o.left:-1,_o.vertical||-1,Cy,My,B1,pE,fE,mE,gE,yE,_E,vE,xE,Ci,O1,L1,yo,Jh,N1,0,On,gs,bE,SE)}(o,it,ke,l,p,g,Ke,o.layers[0],o.collisionBoxArray,r.index,r.sourceLayerIndex,o.index,Q,[me,me,me,me],qe,T,ye,we,lt,V,r,v,I,z,x)};if(je==="line")for(const ke of x1(r.geometry,0,0,Tn,Tn)){const it=oE(ke,ce,Ie,l.vertical||q,p,24,ie,o.overscaling,Tn);for(const et of it)q&&hE(o,q.text,Ve,et)||We(ke,et)}else if(je==="line-center"){for(const ke of r.geometry)if(ke.length>1){const it=sE(ke,Ie,l.vertical||q,p,24,ie);it&&We(ke,it)}}else if(r.type==="Polygon")for(const ke of pc(r.geometry,0)){const it=lE(ke,16);We(ke[0],new da(it.x,it.y,0))}else if(r.type==="LineString")for(const ke of r.geometry)We(ke,new da(ke[0].x,ke[0].y,0));else if(r.type==="Point")for(const ke of r.geometry)for(const it of ke)We([it],new da(it.x,it.y,0))}function P1(o,r,l,p,g,v,x,b,T,I,z,R,B,V,q){const H=function(ye,ce,me,we,Ie,qe,lt,je){const Ve=we.layout.get("text-rotate").evaluate(qe,{})*Math.PI/180,nt=[];for(const Ke of ce.positionedLines)for(const We of Ke.positionedGlyphs){if(!We.rect)continue;const ke=We.rect||{};let it=Zx+1,et=!0,dt=1,Gt=0;const Wt=(Ie||je)&&We.vertical,Dn=We.metrics.advance*We.scale/2;if(je&&ce.verticalizable&&(Gt=Ke.lineOffset/2-(We.imageName?-(En-We.metrics.width*We.scale)/2:(We.scale-1)*En)),We.imageName){const Bt=lt[We.imageName];et=Bt.sdf,dt=Bt.pixelRatio,it=Ui/dt}const Yr=Ie?[We.x+Dn,We.y]:[0,0];let Xn=Ie?[0,0]:[We.x+Dn+me[0],We.y+me[1]-Gt],Rn=[0,0];Wt&&(Rn=Xn,Xn=[0,0]);const Ti=We.metrics.isDoubleResolution?2:1,Ci=(We.metrics.left-it)*We.scale-Dn+Xn[0],Mi=(-We.metrics.top-it)*We.scale+Xn[1],mn=Ci+ke.w/Ti*We.scale/dt,On=Mi+ke.h/Ti*We.scale/dt,ci=new P(Ci,Mi),Jn=new P(mn,Mi),Ei=new P(Ci,On),Yn=new P(mn,On);if(Wt){const Bt=new P(-Dn,Dn-qh),Xt=-Math.PI/2,nn=En/2-Dn,ur=new P(5-qh-nn,-(We.imageName?nn:0)),cn=new P(...Rn);ci._rotateAround(Xt,Bt)._add(ur)._add(cn),Jn._rotateAround(Xt,Bt)._add(ur)._add(cn),Ei._rotateAround(Xt,Bt)._add(ur)._add(cn),Yn._rotateAround(Xt,Bt)._add(ur)._add(cn)}if(Ve){const Bt=Math.sin(Ve),Xt=Math.cos(Ve),nn=[Xt,-Bt,Bt,Xt];ci._matMult(nn),Jn._matMult(nn),Ei._matMult(nn),Yn._matMult(nn)}const zr=new P(0,0),qi=new P(0,0);nt.push({tl:ci,tr:Jn,bl:Ei,br:Yn,tex:ke,writingMode:ce.writingMode,glyphOffset:Yr,sectionIndex:We.sectionIndex,isSDF:et,pixelOffsetTL:zr,pixelOffsetBR:qi,minFontScaleX:0,minFontScaleY:0})}return nt}(0,l,b,g,v,x,p,o.allowVerticalPlacement),Q=o.textSizeData;let ie=null;Q.kind==="source"?(ie=[Fs*g.layout.get("text-size").evaluate(x,{})],ie[0]>ua&&dn(`${o.layerIds[0]}: Value for "text-size" is >= ${Zh}. Reduce your "text-size".`)):Q.kind==="composite"&&(ie=[Fs*V.compositeTextSizes[0].evaluate(x,{},q),Fs*V.compositeTextSizes[1].evaluate(x,{},q)],(ie[0]>ua||ie[1]>ua)&&dn(`${o.layerIds[0]}: Value for "text-size" is >= ${Zh}. Reduce your "text-size".`)),o.addSymbols(o.text,H,ie,b,v,x,I,r,T.lineStartIndex,T.lineLength,B,q);for(const ye of z)R[ye]=o.text.placedSymbolArray.length-1;return 4*H.length}function A1(o){for(const r in o)return o[r];return null}function hE(o,r,l,p){const g=o.compareText;if(r in g){const v=g[r];for(let x=v.length-1;x>=0;x--)if(p.dist(v[x])<l)return!0}else g[r]=[];return g[r].push(p),!1}const z1=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class vy{static from(r){if(!(r instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,p]=new Uint8Array(r,0,2);if(l!==219)throw new Error("Data does not appear to be in a KDBush format.");const g=p>>4;if(g!==1)throw new Error(`Got v${g} data when expected v1.`);const v=z1[15&p];if(!v)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(r,2,1),[b]=new Uint32Array(r,4,1);return new vy(b,x,v,r)}constructor(r,l=64,p=Float64Array,g){if(isNaN(r)||r<0)throw new Error(`Unpexpected numItems value: ${r}.`);this.numItems=+r,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=p,this.IndexArrayType=r<65536?Uint16Array:Uint32Array;const v=z1.indexOf(this.ArrayType),x=2*r*this.ArrayType.BYTES_PER_ELEMENT,b=r*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-b%8)%8;if(v<0)throw new Error(`Unexpected typed array class: ${p}.`);g&&g instanceof ArrayBuffer?(this.data=g,this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+b+T,2*r),this._pos=2*r,this._finished=!0):(this.data=new ArrayBuffer(8+x+b+T),this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+b+T,2*r),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+v]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=r)}add(r,l){const p=this._pos>>1;return this.ids[p]=p,this.coords[this._pos++]=r,this.coords[this._pos++]=l,p}finish(){const r=this._pos>>1;if(r!==this.numItems)throw new Error(`Added ${r} items when expected ${this.numItems}.`);return xy(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(r,l,p,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:x,nodeSize:b}=this,T=[0,v.length-1,0],I=[];for(;T.length;){const z=T.pop()||0,R=T.pop()||0,B=T.pop()||0;if(R-B<=b){for(let Q=B;Q<=R;Q++){const ie=x[2*Q],ye=x[2*Q+1];ie>=r&&ie<=p&&ye>=l&&ye<=g&&I.push(v[Q])}continue}const V=B+R>>1,q=x[2*V],H=x[2*V+1];q>=r&&q<=p&&H>=l&&H<=g&&I.push(v[V]),(z===0?r<=q:l<=H)&&(T.push(B),T.push(V-1),T.push(1-z)),(z===0?p>=q:g>=H)&&(T.push(V+1),T.push(R),T.push(1-z))}return I}within(r,l,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:v,nodeSize:x}=this,b=[0,g.length-1,0],T=[],I=p*p;for(;b.length;){const z=b.pop()||0,R=b.pop()||0,B=b.pop()||0;if(R-B<=x){for(let Q=B;Q<=R;Q++)R1(v[2*Q],v[2*Q+1],r,l)<=I&&T.push(g[Q]);continue}const V=B+R>>1,q=v[2*V],H=v[2*V+1];R1(q,H,r,l)<=I&&T.push(g[V]),(z===0?r-p<=q:l-p<=H)&&(b.push(B),b.push(V-1),b.push(1-z)),(z===0?r+p>=q:l+p>=H)&&(b.push(V+1),b.push(R),b.push(1-z))}return T}}function xy(o,r,l,p,g,v){if(g-p<=l)return;const x=p+g>>1;D1(o,r,x,p,g,v),xy(o,r,l,p,x-1,1-v),xy(o,r,l,x+1,g,1-v)}function D1(o,r,l,p,g,v){for(;g>p;){if(g-p>600){const I=g-p+1,z=l-p+1,R=Math.log(I),B=.5*Math.exp(2*R/3),V=.5*Math.sqrt(R*B*(I-B)/I)*(z-I/2<0?-1:1);D1(o,r,l,Math.max(p,Math.floor(l-z*B/I+V)),Math.min(g,Math.floor(l+(I-z)*B/I+V)),v)}const x=r[2*l+v];let b=p,T=g;for(Kh(o,r,p,l),r[2*g+v]>x&&Kh(o,r,p,g);b<T;){for(Kh(o,r,b,T),b++,T--;r[2*b+v]<x;)b++;for(;r[2*T+v]>x;)T--}r[2*p+v]===x?Kh(o,r,p,T):(T++,Kh(o,r,T,g)),T<=l&&(p=T+1),l<=T&&(g=T-1)}}function Kh(o,r,l,p){wy(o,l,p),wy(r,2*l,2*p),wy(r,2*l+1,2*p+1)}function wy(o,r,l){const p=o[r];o[r]=o[l],o[l]=p}function R1(o,r,l,p){const g=o-l,v=r-p;return g*g+v*v}var by;d.bg=void 0,(by=d.bg||(d.bg={})).create="create",by.load="load",by.fullLoad="fullLoad";let af=null,Xh=[];const Sy=1e3/60,ky="loadTime",Ty="fullLoadTime",dE={mark(o){performance.mark(o)},frame(o){const r=o;af!=null&&Xh.push(r-af),af=r},clearMetrics(){af=null,Xh=[],performance.clearMeasures(ky),performance.clearMeasures(Ty);for(const o in d.bg)performance.clearMarks(d.bg[o])},getPerformanceMetrics(){performance.measure(ky,d.bg.create,d.bg.load),performance.measure(Ty,d.bg.create,d.bg.fullLoad);const o=performance.getEntriesByName(ky)[0].duration,r=performance.getEntriesByName(Ty)[0].duration,l=Xh.length,p=1/(Xh.reduce((v,x)=>v+x,0)/l/1e3),g=Xh.filter(v=>v>Sy).reduce((v,x)=>v+(x-Sy)/Sy,0);return{loadTime:o,fullLoadTime:r,fps:p,percentDroppedFrames:g/(l+g)*100,totalFrames:l}}};d.$=class extends O{},d.A=jc,d.B=Dg,d.C=function(o){if(Ur==null){const r=o.navigator?o.navigator.userAgent:null;Ur=!!o.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return Ur},d.D=Je,d.E=zo,d.F=class{constructor(o,r){this.target=o,this.mapId=r,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new iE(()=>this.process()),this.subscription=function(l,p,g,v){return l.addEventListener(p,g,!1),{unsubscribe:()=>{l.removeEventListener(p,g,!1)}}}(this.target,"message",l=>this.receive(l)),this.globalScope=vr(self)?o:window}registerMessageHandler(o,r){this.messageHandlers[o]=r}sendAsync(o,r){return new Promise((l,p)=>{const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[g]={resolve:l,reject:p},r&&r.signal.addEventListener("abort",()=>{delete this.resolveRejects[g];const b={id:g,type:"<cancel>",origin:location.origin,targetMapId:o.targetMapId,sourceMapId:this.mapId};this.target.postMessage(b)},{once:!0});const v=[],x=Object.assign(Object.assign({},o),{id:g,sourceMapId:this.mapId,origin:location.origin,data:Yo(o.data,v)});this.target.postMessage(x,{transfer:v})})}receive(o){const r=o.data,l=r.id;if(!(r.origin!=="file://"&&location.origin!=="file://"&&r.origin!=="resource://android"&&location.origin!=="resource://android"&&r.origin!==location.origin||r.targetMapId&&this.mapId!==r.targetMapId)){if(r.type==="<cancel>"){delete this.tasks[l];const p=this.abortControllers[l];return delete this.abortControllers[l],void(p&&p.abort())}if(vr(self)||r.mustQueue)return this.tasks[l]=r,this.taskQueue.push(l),void this.invoker.trigger();this.processTask(l,r)}}process(){if(this.taskQueue.length===0)return;const o=this.taskQueue.shift(),r=this.tasks[o];delete this.tasks[o],this.taskQueue.length>0&&this.invoker.trigger(),r&&this.processTask(o,r)}processTask(o,r){return c(this,void 0,void 0,function*(){if(r.type==="<response>"){const g=this.resolveRejects[o];return delete this.resolveRejects[o],g?void(r.error?g.reject(Qo(r.error)):g.resolve(Qo(r.data))):void 0}if(!this.messageHandlers[r.type])return void this.completeTask(o,new Error(`Could not find a registered handler for ${r.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const l=Qo(r.data),p=new AbortController;this.abortControllers[o]=p;try{const g=yield this.messageHandlers[r.type](r.sourceMapId,l,p);this.completeTask(o,null,g)}catch(g){this.completeTask(o,g)}})}completeTask(o,r,l){const p=[];delete this.abortControllers[o];const g={id:o,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:r?Yo(r):null,data:Yo(l,p)};this.target.postMessage(g,{transfer:p})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},d.G=vi,d.H=function(){var o=new jc(16);return jc!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},d.I=oy,d.J=function(o,r,l){var p,g,v,x,b,T,I,z,R,B,V,q,H=l[0],Q=l[1],ie=l[2];return r===o?(o[12]=r[0]*H+r[4]*Q+r[8]*ie+r[12],o[13]=r[1]*H+r[5]*Q+r[9]*ie+r[13],o[14]=r[2]*H+r[6]*Q+r[10]*ie+r[14],o[15]=r[3]*H+r[7]*Q+r[11]*ie+r[15]):(g=r[1],v=r[2],x=r[3],b=r[4],T=r[5],I=r[6],z=r[7],R=r[8],B=r[9],V=r[10],q=r[11],o[0]=p=r[0],o[1]=g,o[2]=v,o[3]=x,o[4]=b,o[5]=T,o[6]=I,o[7]=z,o[8]=R,o[9]=B,o[10]=V,o[11]=q,o[12]=p*H+b*Q+R*ie+r[12],o[13]=g*H+T*Q+B*ie+r[13],o[14]=v*H+I*Q+V*ie+r[14],o[15]=x*H+z*Q+q*ie+r[15]),o},d.K=function(o,r,l){var p=l[0],g=l[1],v=l[2];return o[0]=r[0]*p,o[1]=r[1]*p,o[2]=r[2]*p,o[3]=r[3]*p,o[4]=r[4]*g,o[5]=r[5]*g,o[6]=r[6]*g,o[7]=r[7]*g,o[8]=r[8]*v,o[9]=r[9]*v,o[10]=r[10]*v,o[11]=r[11]*v,o[12]=r[12],o[13]=r[13],o[14]=r[14],o[15]=r[15],o},d.L=fx,d.M=function(o,r){const l={};for(let p=0;p<r.length;p++){const g=r[p];g in o&&(l[g]=o[g])}return l},d.N=ha,d.O=c1,d.P=P,d.Q=u1,d.R=Pr,d.S=Ar,d.T=zc,d.U=K,d.V=J,d.W=gt,d.X=Tn,d.Y=S,d.Z=Wh,d._=c,d.a=qn,d.a$=function(o,r){var l=o[0],p=o[1],g=o[2],v=o[3],x=o[4],b=o[5],T=o[6],I=o[7],z=o[8],R=o[9],B=o[10],V=o[11],q=o[12],H=o[13],Q=o[14],ie=o[15],ye=r[0],ce=r[1],me=r[2],we=r[3],Ie=r[4],qe=r[5],lt=r[6],je=r[7],Ve=r[8],nt=r[9],Ke=r[10],We=r[11],ke=r[12],it=r[13],et=r[14],dt=r[15];return Math.abs(l-ye)<=ki*Math.max(1,Math.abs(l),Math.abs(ye))&&Math.abs(p-ce)<=ki*Math.max(1,Math.abs(p),Math.abs(ce))&&Math.abs(g-me)<=ki*Math.max(1,Math.abs(g),Math.abs(me))&&Math.abs(v-we)<=ki*Math.max(1,Math.abs(v),Math.abs(we))&&Math.abs(x-Ie)<=ki*Math.max(1,Math.abs(x),Math.abs(Ie))&&Math.abs(b-qe)<=ki*Math.max(1,Math.abs(b),Math.abs(qe))&&Math.abs(T-lt)<=ki*Math.max(1,Math.abs(T),Math.abs(lt))&&Math.abs(I-je)<=ki*Math.max(1,Math.abs(I),Math.abs(je))&&Math.abs(z-Ve)<=ki*Math.max(1,Math.abs(z),Math.abs(Ve))&&Math.abs(R-nt)<=ki*Math.max(1,Math.abs(R),Math.abs(nt))&&Math.abs(B-Ke)<=ki*Math.max(1,Math.abs(B),Math.abs(Ke))&&Math.abs(V-We)<=ki*Math.max(1,Math.abs(V),Math.abs(We))&&Math.abs(q-ke)<=ki*Math.max(1,Math.abs(q),Math.abs(ke))&&Math.abs(H-it)<=ki*Math.max(1,Math.abs(H),Math.abs(it))&&Math.abs(Q-et)<=ki*Math.max(1,Math.abs(Q),Math.abs(et))&&Math.abs(ie-dt)<=ki*Math.max(1,Math.abs(ie),Math.abs(dt))},d.a0=Pt,d.a1=gy,d.a2=ze,d.a3=o=>{const r=window.document.createElement("video");return r.muted=!0,new Promise(l=>{r.onloadstart=()=>{l(r)};for(const p of o){const g=window.document.createElement("source");Qs(p)||(r.crossOrigin="Anonymous"),g.src=p,r.appendChild(g)}})},d.a4=function(){return Ze++},d.a5=Ue,d.a6=Gc,d.a7=ph,d.a8=kl,d.a9=g1,d.aA=function(o){if(o.type==="custom")return new nE(o);switch(o.type){case"background":return new QM(o);case"circle":return new VC(o);case"fill":return new iM(o);case"fill-extrusion":return new _M(o);case"heatmap":return new jC(o);case"hillshade":return new qC(o);case"line":return new CM(o);case"raster":return new tE(o);case"symbol":return new tf(o)}},d.aB=xt,d.aC=function(o,r){if(!o)return[{command:"setStyle",args:[r]}];let l=[];try{if(!Ft(o.version,r.version))return[{command:"setStyle",args:[r]}];Ft(o.center,r.center)||l.push({command:"setCenter",args:[r.center]}),Ft(o.zoom,r.zoom)||l.push({command:"setZoom",args:[r.zoom]}),Ft(o.bearing,r.bearing)||l.push({command:"setBearing",args:[r.bearing]}),Ft(o.pitch,r.pitch)||l.push({command:"setPitch",args:[r.pitch]}),Ft(o.sprite,r.sprite)||l.push({command:"setSprite",args:[r.sprite]}),Ft(o.glyphs,r.glyphs)||l.push({command:"setGlyphs",args:[r.glyphs]}),Ft(o.transition,r.transition)||l.push({command:"setTransition",args:[r.transition]}),Ft(o.light,r.light)||l.push({command:"setLight",args:[r.light]}),Ft(o.terrain,r.terrain)||l.push({command:"setTerrain",args:[r.terrain]}),Ft(o.sky,r.sky)||l.push({command:"setSky",args:[r.sky]}),Ft(o.projection,r.projection)||l.push({command:"setProjection",args:[r.projection]});const p={},g=[];(function(x,b,T,I){let z;for(z in b=b||{},x=x||{})Object.prototype.hasOwnProperty.call(x,z)&&(Object.prototype.hasOwnProperty.call(b,z)||As(z,T,I));for(z in b)Object.prototype.hasOwnProperty.call(b,z)&&(Object.prototype.hasOwnProperty.call(x,z)?Ft(x[z],b[z])||(x[z].type==="geojson"&&b[z].type==="geojson"&&Do(x,b,z)?an(T,{command:"setGeoJSONSourceData",args:[z,b[z].data]}):hs(z,b,T,I)):Qa(z,b,T))})(o.sources,r.sources,g,p);const v=[];o.layers&&o.layers.forEach(x=>{"source"in x&&p[x.source]?l.push({command:"removeLayer",args:[x.id]}):v.push(x)}),l=l.concat(g),function(x,b,T){b=b||[];const I=(x=x||[]).map(el),z=b.map(el),R=x.reduce(tl,{}),B=b.reduce(tl,{}),V=I.slice(),q=Object.create(null);let H,Q,ie,ye,ce;for(let me=0,we=0;me<I.length;me++)H=I[me],Object.prototype.hasOwnProperty.call(B,H)?we++:(an(T,{command:"removeLayer",args:[H]}),V.splice(V.indexOf(H,we),1));for(let me=0,we=0;me<z.length;me++)H=z[z.length-1-me],V[V.length-1-me]!==H&&(Object.prototype.hasOwnProperty.call(R,H)?(an(T,{command:"removeLayer",args:[H]}),V.splice(V.lastIndexOf(H,V.length-we),1)):we++,ye=V[V.length-me],an(T,{command:"addLayer",args:[B[H],ye]}),V.splice(V.length-me,0,H),q[H]=!0);for(let me=0;me<z.length;me++)if(H=z[me],Q=R[H],ie=B[H],!q[H]&&!Ft(Q,ie))if(Ft(Q.source,ie.source)&&Ft(Q["source-layer"],ie["source-layer"])&&Ft(Q.type,ie.type)){for(ce in nr(Q.layout,ie.layout,T,H,null,"setLayoutProperty"),nr(Q.paint,ie.paint,T,H,null,"setPaintProperty"),Ft(Q.filter,ie.filter)||an(T,{command:"setFilter",args:[H,ie.filter]}),Ft(Q.minzoom,ie.minzoom)&&Ft(Q.maxzoom,ie.maxzoom)||an(T,{command:"setLayerZoomRange",args:[H,ie.minzoom,ie.maxzoom]}),Q)Object.prototype.hasOwnProperty.call(Q,ce)&&ce!=="layout"&&ce!=="paint"&&ce!=="filter"&&ce!=="metadata"&&ce!=="minzoom"&&ce!=="maxzoom"&&(ce.indexOf("paint.")===0?nr(Q[ce],ie[ce],T,H,ce.slice(6),"setPaintProperty"):Ft(Q[ce],ie[ce])||an(T,{command:"setLayerProperty",args:[H,ce,ie[ce]]}));for(ce in ie)Object.prototype.hasOwnProperty.call(ie,ce)&&!Object.prototype.hasOwnProperty.call(Q,ce)&&ce!=="layout"&&ce!=="paint"&&ce!=="filter"&&ce!=="metadata"&&ce!=="minzoom"&&ce!=="maxzoom"&&(ce.indexOf("paint.")===0?nr(Q[ce],ie[ce],T,H,ce.slice(6),"setPaintProperty"):Ft(Q[ce],ie[ce])||an(T,{command:"setLayerProperty",args:[H,ce,ie[ce]]}))}else an(T,{command:"removeLayer",args:[H]}),ye=V[V.lastIndexOf(H)+1],an(T,{command:"addLayer",args:[ie,ye]})}(v,r.layers,l)}catch(p){console.warn("Unable to compute style diff:",p),l=[{command:"setStyle",args:[r]}]}return l},d.aD=function(o){const r=[],l=o.id;return l===void 0&&r.push({message:`layers.${l}: missing required property "id"`}),o.render===void 0&&r.push({message:`layers.${l}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&r.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),r},d.aE=function o(r,l){if(Array.isArray(r)){if(!Array.isArray(l)||r.length!==l.length)return!1;for(let p=0;p<r.length;p++)if(!o(r[p],l[p]))return!1;return!0}if(typeof r=="object"&&r!==null&&l!==null){if(typeof l!="object"||Object.keys(r).length!==Object.keys(l).length)return!1;for(const p in r)if(!o(r[p],l[p]))return!1;return!0}return r===l},d.aF=tt,d.aG=ft,d.aH=class extends wl{constructor(o,r){super(o,r),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}},d.aI=jp,d.aJ=class extends wl{constructor(o,r){super(o,r),this.current=zC}set(o){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let r=1;r<16;r++)if(o[r]!==this.current[r]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}},d.aK=ix,d.aL=rx,d.aM=qt,d.aN=class extends wl{constructor(o,r){super(o,r),this.current=[0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2]))}},d.aO=class extends wl{constructor(o,r){super(o,r),this.current=[0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1]))}},d.aP=function(o,r,l,p,g,v,x){var b=1/(r-l),T=1/(p-g),I=1/(v-x);return o[0]=-2*b,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*T,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*I,o[11]=0,o[12]=(r+l)*b,o[13]=(g+p)*T,o[14]=(x+v)*I,o[15]=1,o},d.aQ=NC,d.aR=class extends de{},d.aS=PM,d.aT=class extends _e{},d.aU=Gg,d.aV=function(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))},d.aW=vx,d.aX=Wn,d.aY=Ir,d.aZ=class extends Ye{},d.a_=function(o,r){return o[0]===r[0]&&o[1]===r[1]&&o[2]===r[2]&&o[3]===r[3]&&o[4]===r[4]&&o[5]===r[5]&&o[6]===r[6]&&o[7]===r[7]&&o[8]===r[8]&&o[9]===r[9]&&o[10]===r[10]&&o[11]===r[11]&&o[12]===r[12]&&o[13]===r[13]&&o[14]===r[14]&&o[15]===r[15]},d.aa=function(o){const r={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,p,g,v)=>{const x=g||v;return r[p]=!x||x.toLowerCase(),""}),r["max-age"]){const l=parseInt(r["max-age"],10);isNaN(l)?delete r["max-age"]:r["max-age"]=l}return r},d.ab=function(o,r){const l=[];for(const p in o)p in r||l.push(p);return l},d.ac=Me,d.ad=function(o,r,l){var p=Math.sin(l),g=Math.cos(l),v=r[0],x=r[1],b=r[2],T=r[3],I=r[4],z=r[5],R=r[6],B=r[7];return r!==o&&(o[8]=r[8],o[9]=r[9],o[10]=r[10],o[11]=r[11],o[12]=r[12],o[13]=r[13],o[14]=r[14],o[15]=r[15]),o[0]=v*g+I*p,o[1]=x*g+z*p,o[2]=b*g+R*p,o[3]=T*g+B*p,o[4]=I*g-v*p,o[5]=z*g-x*p,o[6]=R*g-b*p,o[7]=B*g-T*p,o},d.ae=function(o){var r=new jc(16);return r[0]=o[0],r[1]=o[1],r[2]=o[2],r[3]=o[3],r[4]=o[4],r[5]=o[5],r[6]=o[6],r[7]=o[7],r[8]=o[8],r[9]=o[9],r[10]=o[10],r[11]=o[11],r[12]=o[12],r[13]=o[13],r[14]=o[14],r[15]=o[15],r},d.af=Zp,d.ag=function(o,r){let l=0,p=0;if(o.kind==="constant")p=o.layoutSize;else if(o.kind!=="source"){const{interpolationType:g,minZoom:v,maxZoom:x}=o,b=g?Me(bi.interpolationFactor(g,r,v,x),0,1):0;o.kind==="camera"?p=wi.number(o.minSize,o.maxSize,b):l=b}return{uSizeT:l,uSize:p}},d.ai=function(o,{uSize:r,uSizeT:l},{lowerSize:p,upperSize:g}){return o.kind==="source"?p/Fs:o.kind==="composite"?wi.number(p/Fs,g/Fs,l):r},d.aj=uy,d.ak=function(o,r,l,p){const g=r.y-o.y,v=r.x-o.x,x=p.y-l.y,b=p.x-l.x,T=x*v-b*g;if(T===0)return null;const I=(b*(o.y-l.y)-x*(o.x-l.x))/T;return new P(o.x+I*v,o.y+I*g)},d.al=x1,d.am=lx,d.an=Hg,d.ao=function(o){let r=1/0,l=1/0,p=-1/0,g=-1/0;for(const v of o)r=Math.min(r,v.x),l=Math.min(l,v.y),p=Math.max(p,v.x),g=Math.max(g,v.y);return[r,l,p,g]},d.ap=En,d.ar=cy,d.as=function(o,r){var l=r[0],p=r[1],g=r[2],v=r[3],x=r[4],b=r[5],T=r[6],I=r[7],z=r[8],R=r[9],B=r[10],V=r[11],q=r[12],H=r[13],Q=r[14],ie=r[15],ye=l*b-p*x,ce=l*T-g*x,me=l*I-v*x,we=p*T-g*b,Ie=p*I-v*b,qe=g*I-v*T,lt=z*H-R*q,je=z*Q-B*q,Ve=z*ie-V*q,nt=R*Q-B*H,Ke=R*ie-V*H,We=B*ie-V*Q,ke=ye*We-ce*Ke+me*nt+we*Ve-Ie*je+qe*lt;return ke?(o[0]=(b*We-T*Ke+I*nt)*(ke=1/ke),o[1]=(g*Ke-p*We-v*nt)*ke,o[2]=(H*qe-Q*Ie+ie*we)*ke,o[3]=(B*Ie-R*qe-V*we)*ke,o[4]=(T*Ve-x*We-I*je)*ke,o[5]=(l*We-g*Ve+v*je)*ke,o[6]=(Q*me-q*qe-ie*ce)*ke,o[7]=(z*qe-B*me+V*ce)*ke,o[8]=(x*Ke-b*Ve+I*lt)*ke,o[9]=(p*Ve-l*Ke-v*lt)*ke,o[10]=(q*Ie-H*me+ie*ye)*ke,o[11]=(R*me-z*Ie-V*ye)*ke,o[12]=(b*je-x*nt-T*lt)*ke,o[13]=(l*nt-p*je+g*lt)*ke,o[14]=(H*ce-q*we-Q*ye)*ke,o[15]=(z*we-R*ce+B*ye)*ke,o):null},d.at=_y,d.au=ly,d.av=vy,d.aw=function(){const o={},r=xe.$version;for(const l in xe.$root){const p=xe.$root[l];if(p.required){let g=null;g=l==="version"?r:p.type==="array"?[]:{},g!=null&&(o[l]=g)}}return o},d.ax=Mh,d.ay=wr,d.az=function(o){o=o.slice();const r=Object.create(null);for(let l=0;l<o.length;l++)r[o[l].id]=o[l];for(let l=0;l<o.length;l++)"ref"in o[l]&&(o[l]=Ya(o[l],r[o[l].ref]));return o},d.b=yi,d.b0=function(o,r){return o[0]=r[0],o[1]=r[1],o[2]=r[2],o[3]=r[3],o[4]=r[4],o[5]=r[5],o[6]=r[6],o[7]=r[7],o[8]=r[8],o[9]=r[9],o[10]=r[10],o[11]=r[11],o[12]=r[12],o[13]=r[13],o[14]=r[14],o[15]=r[15],o},d.b1=function(o,r,l){return o[0]=r[0]*l[0],o[1]=r[1]*l[1],o[2]=r[2]*l[2],o[3]=r[3]*l[3],o},d.b2=function(o,r){return o[0]*r[0]+o[1]*r[1]+o[2]*r[2]+o[3]*r[3]},d.b3=Ee,d.b4=p1,d.b5=h1,d.b6=function(o,r,l,p,g){var v,x=1/Math.tan(r/2);return o[0]=x/l,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=x,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,g!=null&&g!==1/0?(o[10]=(g+p)*(v=1/(p-g)),o[14]=2*g*p*v):(o[10]=-1,o[14]=-2*p),o},d.b7=function(o,r,l){var p=Math.sin(l),g=Math.cos(l),v=r[4],x=r[5],b=r[6],T=r[7],I=r[8],z=r[9],R=r[10],B=r[11];return r!==o&&(o[0]=r[0],o[1]=r[1],o[2]=r[2],o[3]=r[3],o[12]=r[12],o[13]=r[13],o[14]=r[14],o[15]=r[15]),o[4]=v*g+I*p,o[5]=x*g+z*p,o[6]=b*g+R*p,o[7]=T*g+B*p,o[8]=I*g-v*p,o[9]=z*g-x*p,o[10]=R*g-b*p,o[11]=B*g-T*p,o},d.b8=le,d.b9=Se,d.bA=Nx,d.bB=function(o){return o.message===jt},d.bC=Ho,d.bD=$i,d.ba=function(o){return o*Math.PI/180},d.bb=function(o,r){const{x:l,y:p}=Wh.fromLngLat(r);return!(o<0||o>25||p<0||p>=1||l<0||l>=1)},d.bc=function(o,r){return o[0]=r[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=r[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=r[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},d.bd=class extends D{},d.be=fy,d.bf=dE,d.bh=An,d.bi=function(o,r){qn.REGISTERED_PROTOCOLS[o]=r},d.bj=function(o){delete qn.REGISTERED_PROTOCOLS[o]},d.bk=function(o,r){const l={};for(let g=0;g<o.length;g++){const v=r&&r[o[g].id]||Pp(o[g]);r&&(r[o[g].id]=v);let x=l[v];x||(x=l[v]=[]),x.push(o[g])}const p=[];for(const g in l)p.push(l[g]);return p},d.bl=Ge,d.bm=m1,d.bn=y1,d.bo=Gx,d.bp=function(o){o.bucket.createArrays(),o.bucket.tilePixelRatio=Tn/(512*o.bucket.overscaling),o.bucket.compareText={},o.bucket.iconsNeedLinear=!1;const r=o.bucket.layers[0],l=r.layout,p=r._unevaluatedLayout._values,g={layoutIconSize:p["icon-size"].possiblyEvaluate(new Yt(o.bucket.zoom+1),o.canonical),layoutTextSize:p["text-size"].possiblyEvaluate(new Yt(o.bucket.zoom+1),o.canonical),textMaxSize:p["text-size"].possiblyEvaluate(new Yt(18))};if(o.bucket.textSizeData.kind==="composite"){const{minZoom:I,maxZoom:z}=o.bucket.textSizeData;g.compositeTextSizes=[p["text-size"].possiblyEvaluate(new Yt(I),o.canonical),p["text-size"].possiblyEvaluate(new Yt(z),o.canonical)]}if(o.bucket.iconSizeData.kind==="composite"){const{minZoom:I,maxZoom:z}=o.bucket.iconSizeData;g.compositeIconSizes=[p["icon-size"].possiblyEvaluate(new Yt(I),o.canonical),p["icon-size"].possiblyEvaluate(new Yt(z),o.canonical)]}const v=l.get("text-line-height")*En,x=l.get("text-rotation-alignment")!=="viewport"&&l.get("symbol-placement")!=="point",b=l.get("text-keep-upright"),T=l.get("text-size");for(const I of o.bucket.features){const z=l.get("text-font").evaluate(I,{},o.canonical).join(","),R=T.evaluate(I,{},o.canonical),B=g.layoutTextSize.evaluate(I,{},o.canonical),V=g.layoutIconSize.evaluate(I,{},o.canonical),q={horizontal:{},vertical:void 0},H=I.text;let Q,ie=[0,0];if(H){const me=H.toString(),we=l.get("text-letter-spacing").evaluate(I,{},o.canonical)*En,Ie=Rg(me)?we:0,qe=l.get("text-anchor").evaluate(I,{},o.canonical),lt=I1(r,I,o.canonical);if(!lt){const Ke=l.get("text-radial-offset").evaluate(I,{},o.canonical);ie=Ke?E1(qe,[Ke*En,yy]):l.get("text-offset").evaluate(I,{},o.canonical).map(We=>We*En)}let je=x?"center":l.get("text-justify").evaluate(I,{},o.canonical);const Ve=l.get("symbol-placement")==="point"?l.get("text-max-width").evaluate(I,{},o.canonical)*En:1/0,nt=()=>{o.bucket.allowVerticalPlacement&&Eh(me)&&(q.vertical=Yp(H,o.glyphMap,o.glyphPositions,o.imagePositions,z,Ve,v,qe,"left",Ie,ie,d.ah.vertical,!0,B,R))};if(!x&&lt){const Ke=new Set;if(je==="auto")for(let ke=0;ke<lt.values.length;ke+=2)Ke.add(_y(lt.values[ke]));else Ke.add(je);let We=!1;for(const ke of Ke)if(!q.horizontal[ke])if(We)q.horizontal[ke]=q.horizontal[0];else{const it=Yp(H,o.glyphMap,o.glyphPositions,o.imagePositions,z,Ve,v,"center",ke,Ie,ie,d.ah.horizontal,!1,B,R);it&&(q.horizontal[ke]=it,We=it.positionedLines.length===1)}nt()}else{je==="auto"&&(je=_y(qe));const Ke=Yp(H,o.glyphMap,o.glyphPositions,o.imagePositions,z,Ve,v,qe,je,Ie,ie,d.ah.horizontal,!1,B,R);Ke&&(q.horizontal[je]=Ke),nt(),Eh(me)&&x&&b&&(q.vertical=Yp(H,o.glyphMap,o.glyphPositions,o.imagePositions,z,Ve,v,qe,je,Ie,ie,d.ah.vertical,!1,B,R))}}let ye=!1;if(I.icon&&I.icon.name){const me=o.imageMap[I.icon.name];me&&(Q=GM(o.imagePositions[I.icon.name],l.get("icon-offset").evaluate(I,{},o.canonical),l.get("icon-anchor").evaluate(I,{},o.canonical)),ye=!!me.sdf,o.bucket.sdfIcons===void 0?o.bucket.sdfIcons=ye:o.bucket.sdfIcons!==ye&&dn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(me.pixelRatio!==o.bucket.pixelRatio||l.get("icon-rotate").constantOr(1)!==0)&&(o.bucket.iconsNeedLinear=!0))}const ce=A1(q.horizontal)||q.vertical;o.bucket.iconsInText=!!ce&&ce.iconsInText,(ce||Q)&&uE(o.bucket,I,q,Q,o.imageMap,g,B,V,ie,ye,o.canonical)}o.showCollisionBoxes&&o.bucket.generateCollisionDebugBuffers()},d.bq=ny,d.br=Qg,d.bs=ty,d.bt=la,d.bu=ry,d.bv=class{constructor(o){this._marks={start:[o.url,"start"].join("#"),end:[o.url,"end"].join("#"),measure:o.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let o=performance.getEntriesByName(this._marks.measure);return o.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),o=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),o}},d.bw=function(o,r,l,p,g){return c(this,void 0,void 0,function*(){if(J())try{return yield gt(o,r,l,p,g)}catch{}return function(v,x,b,T,I){const z=v.width,R=v.height;yt&&zt||(yt=new OffscreenCanvas(z,R),zt=yt.getContext("2d",{willReadFrequently:!0})),yt.width=z,yt.height=R,zt.drawImage(v,0,0,z,R);const B=zt.getImageData(x,b,T,I);return zt.clearRect(0,0,z,R),B.data}(o,r,l,p,g)})},d.bx=f1,d.by=w,d.bz=k,d.c=xr,d.d=o=>c(void 0,void 0,void 0,function*(){if(o.byteLength===0)return createImageBitmap(new ImageData(1,1));const r=new Blob([new Uint8Array(o)],{type:"image/png"});try{return createImageBitmap(r)}catch(l){throw new Error(`Could not load image because of ${l.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),d.e=De,d.f=o=>new Promise((r,l)=>{const p=new Image;p.onload=()=>{r(p),URL.revokeObjectURL(p.src),p.onload=null,window.requestAnimationFrame(()=>{p.src=Xe})},p.onerror=()=>l(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const g=new Blob([new Uint8Array(o)],{type:"image/png"});p.src=o.byteLength?URL.createObjectURL(g):Xe}),d.g=_i,d.h=(o,r)=>Ys(De(o,{type:"json"}),r),d.i=vr,d.j=Ps,d.k=Is,d.l=(o,r)=>Ys(De(o,{type:"arrayBuffer"}),r),d.m=Ys,d.n=function(o){return new ry(o).readFields($M,[])},d.o=Bh,d.p=Wx,d.q=_,d.r=zg,d.s=Qs,d.t=Th,d.u=po,d.v=xe,d.w=dn,d.x=function([o,r,l]){return r+=90,r*=Math.PI/180,l*=Math.PI/180,{x:o*Math.cos(r)*Math.sin(l),y:o*Math.sin(r)*Math.sin(l),z:o*Math.cos(l)}},d.y=wi,d.z=Yt}),a("worker",["./shared"],function(d){class c{constructor(N){this.keyCache={},N&&this.replace(N)}replace(N){this._layerConfigs={},this._layers={},this.update(N,[])}update(N,F){for(const ee of N){this._layerConfigs[ee.id]=ee;const ue=this._layers[ee.id]=d.aA(ee);ue._featureFilter=d.a7(ue.filter),this.keyCache[ee.id]&&delete this.keyCache[ee.id]}for(const ee of F)delete this.keyCache[ee],delete this._layerConfigs[ee],delete this._layers[ee];this.familiesBySource={};const W=d.bk(Object.values(this._layerConfigs),this.keyCache);for(const ee of W){const ue=ee.map(ve=>this._layers[ve.id]),pe=ue[0];if(pe.visibility==="none")continue;const ge=pe.source||"";let oe=this.familiesBySource[ge];oe||(oe=this.familiesBySource[ge]={});const be=pe.sourceLayer||"_geojsonTileLayer";let Ce=oe[be];Ce||(Ce=oe[be]=[]),Ce.push(ue)}}}class w{constructor(N){const F={},W=[];for(const ge in N){const oe=N[ge],be=F[ge]={};for(const Ce in oe){const ve=oe[+Ce];if(!ve||ve.bitmap.width===0||ve.bitmap.height===0)continue;const Oe={x:0,y:0,w:ve.bitmap.width+2,h:ve.bitmap.height+2};W.push(Oe),be[Ce]={rect:Oe,metrics:ve.metrics}}}const{w:ee,h:ue}=d.p(W),pe=new d.o({width:ee||1,height:ue||1});for(const ge in N){const oe=N[ge];for(const be in oe){const Ce=oe[+be];if(!Ce||Ce.bitmap.width===0||Ce.bitmap.height===0)continue;const ve=F[ge][be].rect;d.o.copy(Ce.bitmap,pe,{x:0,y:0},{x:ve.x+1,y:ve.y+1},Ce.bitmap)}}this.image=pe,this.positions=F}}d.bl("GlyphAtlas",w);class k{constructor(N){this.tileID=new d.S(N.tileID.overscaledZ,N.tileID.wrap,N.tileID.canonical.z,N.tileID.canonical.x,N.tileID.canonical.y),this.uid=N.uid,this.zoom=N.zoom,this.pixelRatio=N.pixelRatio,this.tileSize=N.tileSize,this.source=N.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=N.showCollisionBoxes,this.collectResourceTiming=!!N.collectResourceTiming,this.returnDependencies=!!N.returnDependencies,this.promoteId=N.promoteId,this.inFlightDependencies=[]}parse(N,F,W,ee){return d._(this,void 0,void 0,function*(){this.status="parsing",this.data=N,this.collisionBoxArray=new d.a5;const ue=new d.bm(Object.keys(N.layers).sort()),pe=new d.bn(this.tileID,this.promoteId);pe.bucketLayerIDs=[];const ge={},oe={featureIndex:pe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:W},be=F.familiesBySource[this.source];for(const St in be){const Ut=N.layers[St];if(!Ut)continue;Ut.version===1&&d.w(`Vector tile source "${this.source}" layer "${St}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const rn=ue.encode(St),zn=[];for(let Nn=0;Nn<Ut.length;Nn++){const oi=Ut.feature(Nn),Ro=pe.getId(oi,St);zn.push({feature:oi,id:Ro,index:Nn,sourceLayerIndex:rn})}for(const Nn of be[St]){const oi=Nn[0];oi.source!==this.source&&d.w(`layer.source = ${oi.source} does not equal this.source = ${this.source}`),oi.minzoom&&this.zoom<Math.floor(oi.minzoom)||oi.maxzoom&&this.zoom>=oi.maxzoom||oi.visibility!=="none"&&(E(Nn,this.zoom,W),(ge[oi.id]=oi.createBucket({index:pe.bucketLayerIDs.length,layers:Nn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:rn,sourceID:this.source})).populate(zn,oe,this.tileID.canonical),pe.bucketLayerIDs.push(Nn.map(Ro=>Ro.id)))}}const Ce=d.aF(oe.glyphDependencies,St=>Object.keys(St).map(Number));this.inFlightDependencies.forEach(St=>St==null?void 0:St.abort()),this.inFlightDependencies=[];let ve=Promise.resolve({});if(Object.keys(Ce).length){const St=new AbortController;this.inFlightDependencies.push(St),ve=ee.sendAsync({type:"GG",data:{stacks:Ce,source:this.source,tileID:this.tileID,type:"glyphs"}},St)}const Oe=Object.keys(oe.iconDependencies);let rt=Promise.resolve({});if(Oe.length){const St=new AbortController;this.inFlightDependencies.push(St),rt=ee.sendAsync({type:"GI",data:{icons:Oe,source:this.source,tileID:this.tileID,type:"icons"}},St)}const at=Object.keys(oe.patternDependencies);let Dt=Promise.resolve({});if(at.length){const St=new AbortController;this.inFlightDependencies.push(St),Dt=ee.sendAsync({type:"GI",data:{icons:at,source:this.source,tileID:this.tileID,type:"patterns"}},St)}const[vt,Rt,Ct]=yield Promise.all([ve,rt,Dt]),Sn=new w(vt),ln=new d.bo(Rt,Ct);for(const St in ge){const Ut=ge[St];Ut instanceof d.a6?(E(Ut.layers,this.zoom,W),d.bp({bucket:Ut,glyphMap:vt,glyphPositions:Sn.positions,imageMap:Rt,imagePositions:ln.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Ut.hasPattern&&(Ut instanceof d.bq||Ut instanceof d.br||Ut instanceof d.bs)&&(E(Ut.layers,this.zoom,W),Ut.addFeatures(oe,this.tileID.canonical,ln.patternPositions))}return this.status="done",{buckets:Object.values(ge).filter(St=>!St.isEmpty()),featureIndex:pe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Sn.image,imageAtlas:ln,glyphMap:this.returnDependencies?vt:null,iconMap:this.returnDependencies?Rt:null,glyphPositions:this.returnDependencies?Sn.positions:null}})}}function E(ne,N,F){const W=new d.z(N);for(const ee of ne)ee.recalculate(W,F)}class P{constructor(N,F,W){this.actor=N,this.layerIndex=F,this.availableImages=W,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(N,F){return d._(this,void 0,void 0,function*(){const W=yield d.l(N.request,F);try{return{vectorTile:new d.bt.VectorTile(new d.bu(W.data)),rawData:W.data,cacheControl:W.cacheControl,expires:W.expires}}catch(ee){const ue=new Uint8Array(W.data);let pe=`Unable to parse the tile at ${N.request.url}, `;throw pe+=ue[0]===31&&ue[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ee.message}`,new Error(pe)}})}loadTile(N){return d._(this,void 0,void 0,function*(){const F=N.uid,W=!!(N&&N.request&&N.request.collectResourceTiming)&&new d.bv(N.request),ee=new k(N);this.loading[F]=ee;const ue=new AbortController;ee.abort=ue;try{const pe=yield this.loadVectorTile(N,ue);if(delete this.loading[F],!pe)return null;const ge=pe.rawData,oe={};pe.expires&&(oe.expires=pe.expires),pe.cacheControl&&(oe.cacheControl=pe.cacheControl);const be={};if(W){const ve=W.finish();ve&&(be.resourceTiming=JSON.parse(JSON.stringify(ve)))}ee.vectorTile=pe.vectorTile;const Ce=ee.parse(pe.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[F]=ee,this.fetching[F]={rawTileData:ge,cacheControl:oe,resourceTiming:be};try{const ve=yield Ce;return d.e({rawTileData:ge.slice(0)},ve,oe,be)}finally{delete this.fetching[F]}}catch(pe){throw delete this.loading[F],ee.status="done",this.loaded[F]=ee,pe}})}reloadTile(N){return d._(this,void 0,void 0,function*(){const F=N.uid;if(!this.loaded||!this.loaded[F])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const W=this.loaded[F];if(W.showCollisionBoxes=N.showCollisionBoxes,W.status==="parsing"){const ee=yield W.parse(W.vectorTile,this.layerIndex,this.availableImages,this.actor);let ue;if(this.fetching[F]){const{rawTileData:pe,cacheControl:ge,resourceTiming:oe}=this.fetching[F];delete this.fetching[F],ue=d.e({rawTileData:pe.slice(0)},ee,ge,oe)}else ue=ee;return ue}if(W.status==="done"&&W.vectorTile)return W.parse(W.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(N){return d._(this,void 0,void 0,function*(){const F=this.loading,W=N.uid;F&&F[W]&&F[W].abort&&(F[W].abort.abort(),delete F[W])})}removeTile(N){return d._(this,void 0,void 0,function*(){this.loaded&&this.loaded[N.uid]&&delete this.loaded[N.uid]})}}class A{constructor(){this.loaded={}}loadTile(N){return d._(this,void 0,void 0,function*(){const{uid:F,encoding:W,rawImageData:ee,redFactor:ue,greenFactor:pe,blueFactor:ge,baseShift:oe}=N,be=ee.width+2,Ce=ee.height+2,ve=d.b(ee)?new d.R({width:be,height:Ce},yield d.bw(ee,-1,-1,be,Ce)):ee,Oe=new d.bx(F,ve,W,ue,pe,ge,oe);return this.loaded=this.loaded||{},this.loaded[F]=Oe,Oe})}removeTile(N){const F=this.loaded,W=N.uid;F&&F[W]&&delete F[W]}}function $(ne,N){if(ne.length!==0){j(ne[0],N);for(var F=1;F<ne.length;F++)j(ne[F],!N)}}function j(ne,N){for(var F=0,W=0,ee=0,ue=ne.length,pe=ue-1;ee<ue;pe=ee++){var ge=(ne[ee][0]-ne[pe][0])*(ne[pe][1]+ne[ee][1]),oe=F+ge;W+=Math.abs(F)>=Math.abs(ge)?F-oe+ge:ge-oe+F,F=oe}F+W>=0!=!!N&&ne.reverse()}var X=d.by(function ne(N,F){var W,ee=N&&N.type;if(ee==="FeatureCollection")for(W=0;W<N.features.length;W++)ne(N.features[W],F);else if(ee==="GeometryCollection")for(W=0;W<N.geometries.length;W++)ne(N.geometries[W],F);else if(ee==="Feature")ne(N.geometry,F);else if(ee==="Polygon")$(N.coordinates,F);else if(ee==="MultiPolygon")for(W=0;W<N.coordinates.length;W++)$(N.coordinates[W],F);return N});const he=d.bt.VectorTileFeature.prototype.toGeoJSON;var K={exports:{}},J=d.bz,le=d.bt.VectorTileFeature,Se=Me;function Me(ne,N){this.options=N||{},this.features=ne,this.length=ne.length}function Ee(ne,N){this.id=typeof ne.id=="number"?ne.id:void 0,this.type=ne.type,this.rawGeometry=ne.type===1?[ne.geometry]:ne.geometry,this.properties=ne.tags,this.extent=N||4096}Me.prototype.feature=function(ne){return new Ee(this.features[ne],this.options.extent)},Ee.prototype.loadGeometry=function(){var ne=this.rawGeometry;this.geometry=[];for(var N=0;N<ne.length;N++){for(var F=ne[N],W=[],ee=0;ee<F.length;ee++)W.push(new J(F[ee][0],F[ee][1]));this.geometry.push(W)}return this.geometry},Ee.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ne=this.geometry,N=1/0,F=-1/0,W=1/0,ee=-1/0,ue=0;ue<ne.length;ue++)for(var pe=ne[ue],ge=0;ge<pe.length;ge++){var oe=pe[ge];N=Math.min(N,oe.x),F=Math.max(F,oe.x),W=Math.min(W,oe.y),ee=Math.max(ee,oe.y)}return[N,W,F,ee]},Ee.prototype.toGeoJSON=le.prototype.toGeoJSON;var De=d.bA,Ze=Se;function tt(ne){var N=new De;return function(F,W){for(var ee in F.layers)W.writeMessage(3,ft,F.layers[ee])}(ne,N),N.finish()}function ft(ne,N){var F;N.writeVarintField(15,ne.version||1),N.writeStringField(1,ne.name||""),N.writeVarintField(5,ne.extent||4096);var W={keys:[],values:[],keycache:{},valuecache:{}};for(F=0;F<ne.length;F++)W.feature=ne.feature(F),N.writeMessage(2,xt,W);var ee=W.keys;for(F=0;F<ee.length;F++)N.writeStringField(3,ee[F]);var ue=W.values;for(F=0;F<ue.length;F++)N.writeMessage(4,Ur,ue[F])}function xt(ne,N){var F=ne.feature;F.id!==void 0&&N.writeVarintField(1,F.id),N.writeMessage(2,tr,ne),N.writeVarintField(3,F.type),N.writeMessage(4,vr,F)}function tr(ne,N){var F=ne.feature,W=ne.keys,ee=ne.values,ue=ne.keycache,pe=ne.valuecache;for(var ge in F.properties){var oe=F.properties[ge],be=ue[ge];if(oe!==null){be===void 0&&(W.push(ge),ue[ge]=be=W.length-1),N.writeVarint(be);var Ce=typeof oe;Ce!=="string"&&Ce!=="boolean"&&Ce!=="number"&&(oe=JSON.stringify(oe));var ve=Ce+":"+oe,Oe=pe[ve];Oe===void 0&&(ee.push(oe),pe[ve]=Oe=ee.length-1),N.writeVarint(Oe)}}}function dn(ne,N){return(N<<3)+(7&ne)}function Pn(ne){return ne<<1^ne>>31}function vr(ne,N){for(var F=ne.loadGeometry(),W=ne.type,ee=0,ue=0,pe=F.length,ge=0;ge<pe;ge++){var oe=F[ge],be=1;W===1&&(be=oe.length),N.writeVarint(dn(1,be));for(var Ce=W===3?oe.length-1:oe.length,ve=0;ve<Ce;ve++){ve===1&&W!==1&&N.writeVarint(dn(2,Ce-1));var Oe=oe[ve].x-ee,rt=oe[ve].y-ue;N.writeVarint(Pn(Oe)),N.writeVarint(Pn(rt)),ee+=Oe,ue+=rt}W===3&&N.writeVarint(dn(7,1))}}function Ur(ne,N){var F=typeof ne;F==="string"?N.writeStringField(1,ne):F==="boolean"?N.writeBooleanField(7,ne):F==="number"&&(ne%1!=0?N.writeDoubleField(3,ne):ne<0?N.writeSVarintField(6,ne):N.writeVarintField(5,ne))}K.exports=tt,K.exports.fromVectorTileJs=tt,K.exports.fromGeojsonVt=function(ne,N){N=N||{};var F={};for(var W in ne)F[W]=new Ze(ne[W].features,N),F[W].name=W,F[W].version=N.version,F[W].extent=N.extent;return tt({layers:F})},K.exports.GeoJSONWrapper=Ze;var yi=d.by(K.exports);const Xe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ne=>ne},gt=Math.fround||(yt=new Float32Array(1),ne=>(yt[0]=+ne,yt[0]));var yt;const zt=3,jt=5,xr=6;class qn{constructor(N){this.options=Object.assign(Object.create(Xe),N),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(N){const{log:F,minZoom:W,maxZoom:ee}=this.options;F&&console.time("total time");const ue=`prepare ${N.length} points`;F&&console.time(ue),this.points=N;const pe=[];for(let oe=0;oe<N.length;oe++){const be=N[oe];if(!be.geometry)continue;const[Ce,ve]=be.geometry.coordinates,Oe=gt(An(Ce)),rt=gt(wr(ve));pe.push(Oe,rt,1/0,oe,-1,1),this.options.reduce&&pe.push(0)}let ge=this.trees[ee+1]=this._createTree(pe);F&&console.timeEnd(ue);for(let oe=ee;oe>=W;oe--){const be=+Date.now();ge=this.trees[oe]=this._createTree(this._cluster(ge,oe)),F&&console.log("z%d: %d clusters in %dms",oe,ge.numItems,+Date.now()-be)}return F&&console.timeEnd("total time"),this}getClusters(N,F){let W=((N[0]+180)%360+360)%360-180;const ee=Math.max(-90,Math.min(90,N[1]));let ue=N[2]===180?180:((N[2]+180)%360+360)%360-180;const pe=Math.max(-90,Math.min(90,N[3]));if(N[2]-N[0]>=360)W=-180,ue=180;else if(W>ue){const ve=this.getClusters([W,ee,180,pe],F),Oe=this.getClusters([-180,ee,ue,pe],F);return ve.concat(Oe)}const ge=this.trees[this._limitZoom(F)],oe=ge.range(An(W),wr(pe),An(ue),wr(ee)),be=ge.data,Ce=[];for(const ve of oe){const Oe=this.stride*ve;Ce.push(be[Oe+jt]>1?_i(be,Oe,this.clusterProps):this.points[be[Oe+zt]])}return Ce}getChildren(N){const F=this._getOriginId(N),W=this._getOriginZoom(N),ee="No cluster with the specified id.",ue=this.trees[W];if(!ue)throw new Error(ee);const pe=ue.data;if(F*this.stride>=pe.length)throw new Error(ee);const ge=this.options.radius/(this.options.extent*Math.pow(2,W-1)),oe=ue.within(pe[F*this.stride],pe[F*this.stride+1],ge),be=[];for(const Ce of oe){const ve=Ce*this.stride;pe[ve+4]===N&&be.push(pe[ve+jt]>1?_i(pe,ve,this.clusterProps):this.points[pe[ve+zt]])}if(be.length===0)throw new Error(ee);return be}getLeaves(N,F,W){const ee=[];return this._appendLeaves(ee,N,F=F||10,W=W||0,0),ee}getTile(N,F,W){const ee=this.trees[this._limitZoom(N)],ue=Math.pow(2,N),{extent:pe,radius:ge}=this.options,oe=ge/pe,be=(W-oe)/ue,Ce=(W+1+oe)/ue,ve={features:[]};return this._addTileFeatures(ee.range((F-oe)/ue,be,(F+1+oe)/ue,Ce),ee.data,F,W,ue,ve),F===0&&this._addTileFeatures(ee.range(1-oe/ue,be,1,Ce),ee.data,ue,W,ue,ve),F===ue-1&&this._addTileFeatures(ee.range(0,be,oe/ue,Ce),ee.data,-1,W,ue,ve),ve.features.length?ve:null}getClusterExpansionZoom(N){let F=this._getOriginZoom(N)-1;for(;F<=this.options.maxZoom;){const W=this.getChildren(N);if(F++,W.length!==1)break;N=W[0].properties.cluster_id}return F}_appendLeaves(N,F,W,ee,ue){const pe=this.getChildren(F);for(const ge of pe){const oe=ge.properties;if(oe&&oe.cluster?ue+oe.point_count<=ee?ue+=oe.point_count:ue=this._appendLeaves(N,oe.cluster_id,W,ee,ue):ue<ee?ue++:N.push(ge),N.length===W)break}return ue}_createTree(N){const F=new d.av(N.length/this.stride|0,this.options.nodeSize,Float32Array);for(let W=0;W<N.length;W+=this.stride)F.add(N[W],N[W+1]);return F.finish(),F.data=N,F}_addTileFeatures(N,F,W,ee,ue,pe){for(const ge of N){const oe=ge*this.stride,be=F[oe+jt]>1;let Ce,ve,Oe;if(be)Ce=vi(F,oe,this.clusterProps),ve=F[oe],Oe=F[oe+1];else{const Dt=this.points[F[oe+zt]];Ce=Dt.properties;const[vt,Rt]=Dt.geometry.coordinates;ve=An(vt),Oe=wr(Rt)}const rt={type:1,geometry:[[Math.round(this.options.extent*(ve*ue-W)),Math.round(this.options.extent*(Oe*ue-ee))]],tags:Ce};let at;at=be||this.options.generateId?F[oe+zt]:this.points[F[oe+zt]].id,at!==void 0&&(rt.id=at),pe.features.push(rt)}}_limitZoom(N){return Math.max(this.options.minZoom,Math.min(Math.floor(+N),this.options.maxZoom+1))}_cluster(N,F){const{radius:W,extent:ee,reduce:ue,minPoints:pe}=this.options,ge=W/(ee*Math.pow(2,F)),oe=N.data,be=[],Ce=this.stride;for(let ve=0;ve<oe.length;ve+=Ce){if(oe[ve+2]<=F)continue;oe[ve+2]=F;const Oe=oe[ve],rt=oe[ve+1],at=N.within(oe[ve],oe[ve+1],ge),Dt=oe[ve+jt];let vt=Dt;for(const Rt of at){const Ct=Rt*Ce;oe[Ct+2]>F&&(vt+=oe[Ct+jt])}if(vt>Dt&&vt>=pe){let Rt,Ct=Oe*Dt,Sn=rt*Dt,ln=-1;const St=((ve/Ce|0)<<5)+(F+1)+this.points.length;for(const Ut of at){const rn=Ut*Ce;if(oe[rn+2]<=F)continue;oe[rn+2]=F;const zn=oe[rn+jt];Ct+=oe[rn]*zn,Sn+=oe[rn+1]*zn,oe[rn+4]=St,ue&&(Rt||(Rt=this._map(oe,ve,!0),ln=this.clusterProps.length,this.clusterProps.push(Rt)),ue(Rt,this._map(oe,rn)))}oe[ve+4]=St,be.push(Ct/vt,Sn/vt,1/0,St,-1,vt),ue&&be.push(ln)}else{for(let Rt=0;Rt<Ce;Rt++)be.push(oe[ve+Rt]);if(vt>1)for(const Rt of at){const Ct=Rt*Ce;if(!(oe[Ct+2]<=F)){oe[Ct+2]=F;for(let Sn=0;Sn<Ce;Sn++)be.push(oe[Ct+Sn])}}}}return be}_getOriginId(N){return N-this.points.length>>5}_getOriginZoom(N){return(N-this.points.length)%32}_map(N,F,W){if(N[F+jt]>1){const pe=this.clusterProps[N[F+xr]];return W?Object.assign({},pe):pe}const ee=this.points[N[F+zt]].properties,ue=this.options.map(ee);return W&&ue===ee?Object.assign({},ue):ue}}function _i(ne,N,F){return{type:"Feature",id:ne[N+zt],properties:vi(ne,N,F),geometry:{type:"Point",coordinates:[(W=ne[N],360*(W-.5)),Ys(ne[N+1])]}};var W}function vi(ne,N,F){const W=ne[N+jt],ee=W>=1e4?`${Math.round(W/1e3)}k`:W>=1e3?Math.round(W/100)/10+"k":W,ue=ne[N+xr],pe=ue===-1?{}:Object.assign({},F[ue]);return Object.assign(pe,{cluster:!0,cluster_id:ne[N+zt],point_count:W,point_count_abbreviated:ee})}function An(ne){return ne/360+.5}function wr(ne){const N=Math.sin(ne*Math.PI/180),F=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return F<0?0:F>1?1:F}function Ys(ne){const N=(180-360*ne)*Math.PI/180;return 360*Math.atan(Math.exp(N))/Math.PI-90}function Qs(ne,N,F,W){let ee=W;const ue=N+(F-N>>1);let pe,ge=F-N;const oe=ne[N],be=ne[N+1],Ce=ne[F],ve=ne[F+1];for(let Oe=N+3;Oe<F;Oe+=3){const rt=Ja(ne[Oe],ne[Oe+1],oe,be,Ce,ve);if(rt>ee)pe=Oe,ee=rt;else if(rt===ee){const at=Math.abs(Oe-ue);at<ge&&(pe=Oe,ge=at)}}ee>W&&(pe-N>3&&Qs(ne,N,pe,W),ne[pe+2]=ee,F-pe>3&&Qs(ne,pe,F,W))}function Ja(ne,N,F,W,ee,ue){let pe=ee-F,ge=ue-W;if(pe!==0||ge!==0){const oe=((ne-F)*pe+(N-W)*ge)/(pe*pe+ge*ge);oe>1?(F=ee,W=ue):oe>0&&(F+=pe*oe,W+=ge*oe)}return pe=ne-F,ge=N-W,pe*pe+ge*ge}function us(ne,N,F,W){const ee={id:ne??null,type:N,geometry:F,tags:W,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(N==="Point"||N==="MultiPoint"||N==="LineString")Is(ee,F);else if(N==="Polygon")Is(ee,F[0]);else if(N==="MultiLineString")for(const ue of F)Is(ee,ue);else if(N==="MultiPolygon")for(const ue of F)Is(ee,ue[0]);return ee}function Is(ne,N){for(let F=0;F<N.length;F+=3)ne.minX=Math.min(ne.minX,N[F]),ne.minY=Math.min(ne.minY,N[F+1]),ne.maxX=Math.max(ne.maxX,N[F]),ne.maxY=Math.max(ne.maxY,N[F+1])}function Ps(ne,N,F,W){if(!N.geometry)return;const ee=N.geometry.coordinates;if(ee&&ee.length===0)return;const ue=N.geometry.type,pe=Math.pow(F.tolerance/((1<<F.maxZoom)*F.extent),2);let ge=[],oe=N.id;if(F.promoteId?oe=N.properties[F.promoteId]:F.generateId&&(oe=W||0),ue==="Point")zo(ee,ge);else if(ue==="MultiPoint")for(const be of ee)zo(be,ge);else if(ue==="LineString")xe(ee,ge,pe,!1);else if(ue==="MultiLineString"){if(F.lineMetrics){for(const be of ee)ge=[],xe(be,ge,pe,!1),ne.push(us(oe,"LineString",ge,N.properties));return}eo(ee,ge,pe,!1)}else if(ue==="Polygon")eo(ee,ge,pe,!0);else{if(ue!=="MultiPolygon"){if(ue==="GeometryCollection"){for(const be of N.geometry.geometries)Ps(ne,{id:oe,geometry:be,properties:N.properties},F,W);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const be of ee){const Ce=[];eo(be,Ce,pe,!0),ge.push(Ce)}}ne.push(us(oe,ue,ge,N.properties))}function zo(ne,N){N.push(Ya(ne[0]),Ft(ne[1]),0)}function xe(ne,N,F,W){let ee,ue,pe=0;for(let oe=0;oe<ne.length;oe++){const be=Ya(ne[oe][0]),Ce=Ft(ne[oe][1]);N.push(be,Ce,0),oe>0&&(pe+=W?(ee*Ce-be*ue)/2:Math.sqrt(Math.pow(be-ee,2)+Math.pow(Ce-ue,2))),ee=be,ue=Ce}const ge=N.length-3;N[2]=1,Qs(N,0,ge,F),N[ge+2]=1,N.size=Math.abs(pe),N.start=0,N.end=N.size}function eo(ne,N,F,W){for(let ee=0;ee<ne.length;ee++){const ue=[];xe(ne[ee],ue,F,W),N.push(ue)}}function Ya(ne){return ne/360+.5}function Ft(ne){const N=Math.sin(ne*Math.PI/180),F=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return F<0?0:F>1?1:F}function an(ne,N,F,W,ee,ue,pe,ge){if(W/=N,ue>=(F/=N)&&pe<W)return ne;if(pe<F||ue>=W)return null;const oe=[];for(const be of ne){const Ce=be.geometry;let ve=be.type;const Oe=ee===0?be.minX:be.minY,rt=ee===0?be.maxX:be.maxY;if(Oe>=F&&rt<W){oe.push(be);continue}if(rt<F||Oe>=W)continue;let at=[];if(ve==="Point"||ve==="MultiPoint")Qa(Ce,at,F,W,ee);else if(ve==="LineString")As(Ce,at,F,W,ee,!1,ge.lineMetrics);else if(ve==="MultiLineString")Do(Ce,at,F,W,ee,!1);else if(ve==="Polygon")Do(Ce,at,F,W,ee,!0);else if(ve==="MultiPolygon")for(const Dt of Ce){const vt=[];Do(Dt,vt,F,W,ee,!0),vt.length&&at.push(vt)}if(at.length){if(ge.lineMetrics&&ve==="LineString"){for(const Dt of at)oe.push(us(be.id,ve,Dt,be.tags));continue}ve!=="LineString"&&ve!=="MultiLineString"||(at.length===1?(ve="LineString",at=at[0]):ve="MultiLineString"),ve!=="Point"&&ve!=="MultiPoint"||(ve=at.length===3?"Point":"MultiPoint"),oe.push(us(be.id,ve,at,be.tags))}}return oe.length?oe:null}function Qa(ne,N,F,W,ee){for(let ue=0;ue<ne.length;ue+=3){const pe=ne[ue+ee];pe>=F&&pe<=W&&nr(N,ne[ue],ne[ue+1],ne[ue+2])}}function As(ne,N,F,W,ee,ue,pe){let ge=hs(ne);const oe=ee===0?el:tl;let be,Ce,ve=ne.start;for(let vt=0;vt<ne.length-3;vt+=3){const Rt=ne[vt],Ct=ne[vt+1],Sn=ne[vt+2],ln=ne[vt+3],St=ne[vt+4],Ut=ee===0?Rt:Ct,rn=ee===0?ln:St;let zn=!1;pe&&(be=Math.sqrt(Math.pow(Rt-ln,2)+Math.pow(Ct-St,2))),Ut<F?rn>F&&(Ce=oe(ge,Rt,Ct,ln,St,F),pe&&(ge.start=ve+be*Ce)):Ut>W?rn<W&&(Ce=oe(ge,Rt,Ct,ln,St,W),pe&&(ge.start=ve+be*Ce)):nr(ge,Rt,Ct,Sn),rn<F&&Ut>=F&&(Ce=oe(ge,Rt,Ct,ln,St,F),zn=!0),rn>W&&Ut<=W&&(Ce=oe(ge,Rt,Ct,ln,St,W),zn=!0),!ue&&zn&&(pe&&(ge.end=ve+be*Ce),N.push(ge),ge=hs(ne)),pe&&(ve+=be)}let Oe=ne.length-3;const rt=ne[Oe],at=ne[Oe+1],Dt=ee===0?rt:at;Dt>=F&&Dt<=W&&nr(ge,rt,at,ne[Oe+2]),Oe=ge.length-3,ue&&Oe>=3&&(ge[Oe]!==ge[0]||ge[Oe+1]!==ge[1])&&nr(ge,ge[0],ge[1],ge[2]),ge.length&&N.push(ge)}function hs(ne){const N=[];return N.size=ne.size,N.start=ne.start,N.end=ne.end,N}function Do(ne,N,F,W,ee,ue){for(const pe of ne)As(pe,N,F,W,ee,ue,!1)}function nr(ne,N,F,W){ne.push(N,F,W)}function el(ne,N,F,W,ee,ue){const pe=(ue-N)/(W-N);return nr(ne,ue,F+(ee-F)*pe,1),pe}function tl(ne,N,F,W,ee,ue){const pe=(ue-F)/(ee-F);return nr(ne,N+(W-N)*pe,ue,1),pe}function ze(ne,N){const F=[];for(let W=0;W<ne.length;W++){const ee=ne[W],ue=ee.type;let pe;if(ue==="Point"||ue==="MultiPoint"||ue==="LineString")pe=qr(ee.geometry,N);else if(ue==="MultiLineString"||ue==="Polygon"){pe=[];for(const ge of ee.geometry)pe.push(qr(ge,N))}else if(ue==="MultiPolygon"){pe=[];for(const ge of ee.geometry){const oe=[];for(const be of ge)oe.push(qr(be,N));pe.push(oe)}}F.push(us(ee.id,ue,pe,ee.tags))}return F}function qr(ne,N){const F=[];F.size=ne.size,ne.start!==void 0&&(F.start=ne.start,F.end=ne.end);for(let W=0;W<ne.length;W+=3)F.push(ne[W]+N,ne[W+1],ne[W+2]);return F}function si(ne,N){if(ne.transformed)return ne;const F=1<<ne.z,W=ne.x,ee=ne.y;for(const ue of ne.features){const pe=ue.geometry,ge=ue.type;if(ue.geometry=[],ge===1)for(let oe=0;oe<pe.length;oe+=2)ue.geometry.push(Hr(pe[oe],pe[oe+1],N,F,W,ee));else for(let oe=0;oe<pe.length;oe++){const be=[];for(let Ce=0;Ce<pe[oe].length;Ce+=2)be.push(Hr(pe[oe][Ce],pe[oe][Ce+1],N,F,W,ee));ue.geometry.push(be)}}return ne.transformed=!0,ne}function Hr(ne,N,F,W,ee,ue){return[Math.round(F*(ne*W-ee)),Math.round(F*(N*W-ue))]}function zs(ne,N,F,W,ee){const ue=N===ee.maxZoom?0:ee.tolerance/((1<<N)*ee.extent),pe={features:[],numPoints:0,numSimplified:0,numFeatures:ne.length,source:null,x:F,y:W,z:N,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ge of ne)Fe(pe,ge,ue,ee);return pe}function Fe(ne,N,F,W){const ee=N.geometry,ue=N.type,pe=[];if(ne.minX=Math.min(ne.minX,N.minX),ne.minY=Math.min(ne.minY,N.minY),ne.maxX=Math.max(ne.maxX,N.maxX),ne.maxY=Math.max(ne.maxY,N.maxY),ue==="Point"||ue==="MultiPoint")for(let ge=0;ge<ee.length;ge+=3)pe.push(ee[ge],ee[ge+1]),ne.numPoints++,ne.numSimplified++;else if(ue==="LineString")bt(pe,ee,ne,F,!1,!1);else if(ue==="MultiLineString"||ue==="Polygon")for(let ge=0;ge<ee.length;ge++)bt(pe,ee[ge],ne,F,ue==="Polygon",ge===0);else if(ue==="MultiPolygon")for(let ge=0;ge<ee.length;ge++){const oe=ee[ge];for(let be=0;be<oe.length;be++)bt(pe,oe[be],ne,F,!0,be===0)}if(pe.length){let ge=N.tags||null;if(ue==="LineString"&&W.lineMetrics){ge={};for(const be in N.tags)ge[be]=N.tags[be];ge.mapbox_clip_start=ee.start/ee.size,ge.mapbox_clip_end=ee.end/ee.size}const oe={geometry:pe,type:ue==="Polygon"||ue==="MultiPolygon"?3:ue==="LineString"||ue==="MultiLineString"?2:1,tags:ge};N.id!==null&&(oe.id=N.id),ne.features.push(oe)}}function bt(ne,N,F,W,ee,ue){const pe=W*W;if(W>0&&N.size<(ee?pe:W))return void(F.numPoints+=N.length/3);const ge=[];for(let oe=0;oe<N.length;oe+=3)(W===0||N[oe+2]>pe)&&(F.numSimplified++,ge.push(N[oe],N[oe+1])),F.numPoints++;ee&&function(oe,be){let Ce=0;for(let ve=0,Oe=oe.length,rt=Oe-2;ve<Oe;rt=ve,ve+=2)Ce+=(oe[ve]-oe[rt])*(oe[ve+1]+oe[rt+1]);if(Ce>0===be)for(let ve=0,Oe=oe.length;ve<Oe/2;ve+=2){const rt=oe[ve],at=oe[ve+1];oe[ve]=oe[Oe-2-ve],oe[ve+1]=oe[Oe-1-ve],oe[Oe-2-ve]=rt,oe[Oe-1-ve]=at}}(ge,ue),ne.push(ge)}const ut={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class xi{constructor(N,F){const W=(F=this.options=function(ue,pe){for(const ge in pe)ue[ge]=pe[ge];return ue}(Object.create(ut),F)).debug;if(W&&console.time("preprocess data"),F.maxZoom<0||F.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(F.promoteId&&F.generateId)throw new Error("promoteId and generateId cannot be used together.");let ee=function(ue,pe){const ge=[];if(ue.type==="FeatureCollection")for(let oe=0;oe<ue.features.length;oe++)Ps(ge,ue.features[oe],pe,oe);else Ps(ge,ue.type==="Feature"?ue:{geometry:ue},pe);return ge}(N,F);this.tiles={},this.tileCoords=[],W&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",F.indexMaxZoom,F.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ee=function(ue,pe){const ge=pe.buffer/pe.extent;let oe=ue;const be=an(ue,1,-1-ge,ge,0,-1,2,pe),Ce=an(ue,1,1-ge,2+ge,0,-1,2,pe);return(be||Ce)&&(oe=an(ue,1,-ge,1+ge,0,-1,2,pe)||[],be&&(oe=ze(be,1).concat(oe)),Ce&&(oe=oe.concat(ze(Ce,-1)))),oe}(ee,F),ee.length&&this.splitTile(ee,0,0,0),W&&(ee.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(N,F,W,ee,ue,pe,ge){const oe=[N,F,W,ee],be=this.options,Ce=be.debug;for(;oe.length;){ee=oe.pop(),W=oe.pop(),F=oe.pop(),N=oe.pop();const ve=1<<F,Oe=br(F,W,ee);let rt=this.tiles[Oe];if(!rt&&(Ce>1&&console.time("creation"),rt=this.tiles[Oe]=zs(N,F,W,ee,be),this.tileCoords.push({z:F,x:W,y:ee}),Ce)){Ce>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",F,W,ee,rt.numFeatures,rt.numPoints,rt.numSimplified),console.timeEnd("creation"));const zn=`z${F}`;this.stats[zn]=(this.stats[zn]||0)+1,this.total++}if(rt.source=N,ue==null){if(F===be.indexMaxZoom||rt.numPoints<=be.indexMaxPoints)continue}else{if(F===be.maxZoom||F===ue)continue;if(ue!=null){const zn=ue-F;if(W!==pe>>zn||ee!==ge>>zn)continue}}if(rt.source=null,N.length===0)continue;Ce>1&&console.time("clipping");const at=.5*be.buffer/be.extent,Dt=.5-at,vt=.5+at,Rt=1+at;let Ct=null,Sn=null,ln=null,St=null,Ut=an(N,ve,W-at,W+vt,0,rt.minX,rt.maxX,be),rn=an(N,ve,W+Dt,W+Rt,0,rt.minX,rt.maxX,be);N=null,Ut&&(Ct=an(Ut,ve,ee-at,ee+vt,1,rt.minY,rt.maxY,be),Sn=an(Ut,ve,ee+Dt,ee+Rt,1,rt.minY,rt.maxY,be),Ut=null),rn&&(ln=an(rn,ve,ee-at,ee+vt,1,rt.minY,rt.maxY,be),St=an(rn,ve,ee+Dt,ee+Rt,1,rt.minY,rt.maxY,be),rn=null),Ce>1&&console.timeEnd("clipping"),oe.push(Ct||[],F+1,2*W,2*ee),oe.push(Sn||[],F+1,2*W,2*ee+1),oe.push(ln||[],F+1,2*W+1,2*ee),oe.push(St||[],F+1,2*W+1,2*ee+1)}}getTile(N,F,W){N=+N,F=+F,W=+W;const ee=this.options,{extent:ue,debug:pe}=ee;if(N<0||N>24)return null;const ge=1<<N,oe=br(N,F=F+ge&ge-1,W);if(this.tiles[oe])return si(this.tiles[oe],ue);pe>1&&console.log("drilling down to z%d-%d-%d",N,F,W);let be,Ce=N,ve=F,Oe=W;for(;!be&&Ce>0;)Ce--,ve>>=1,Oe>>=1,be=this.tiles[br(Ce,ve,Oe)];return be&&be.source?(pe>1&&(console.log("found parent tile z%d-%d-%d",Ce,ve,Oe),console.time("drilling down")),this.splitTile(be.source,Ce,ve,Oe,N,F,W),pe>1&&console.timeEnd("drilling down"),this.tiles[oe]?si(this.tiles[oe],ue):null):null}}function br(ne,N,F){return 32*((1<<ne)*F+N)+ne}function _t(ne,N){return N?ne.properties[N]:ne.id}function Zr(ne,N){if(ne==null)return!0;if(ne.type==="Feature")return _t(ne,N)!=null;if(ne.type==="FeatureCollection"){const F=new Set;for(const W of ne.features){const ee=_t(W,N);if(ee==null||F.has(ee))return!1;F.add(ee)}return!0}return!1}function ds(ne,N){const F=new Map;if(ne!=null)if(ne.type==="Feature")F.set(_t(ne,N),ne);else for(const W of ne.features)F.set(_t(W,N),W);return F}class Ds extends P{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(N,F){return d._(this,void 0,void 0,function*(){const W=N.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ee=this._geoJSONIndex.getTile(W.z,W.x,W.y);if(!ee)return null;const ue=new class{constructor(ge){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=d.X,this.length=ge.length,this._features=ge}feature(ge){return new class{constructor(oe){this._feature=oe,this.extent=d.X,this.type=oe.type,this.properties=oe.tags,"id"in oe&&!isNaN(oe.id)&&(this.id=parseInt(oe.id,10))}loadGeometry(){if(this._feature.type===1){const oe=[];for(const be of this._feature.geometry)oe.push([new d.P(be[0],be[1])]);return oe}{const oe=[];for(const be of this._feature.geometry){const Ce=[];for(const ve of be)Ce.push(new d.P(ve[0],ve[1]));oe.push(Ce)}return oe}}toGeoJSON(oe,be,Ce){return he.call(this,oe,be,Ce)}}(this._features[ge])}}(ee.features);let pe=yi(ue);return pe.byteOffset===0&&pe.byteLength===pe.buffer.byteLength||(pe=new Uint8Array(pe)),{vectorTile:ue,rawData:pe.buffer}})}loadData(N){return d._(this,void 0,void 0,function*(){var F;(F=this._pendingRequest)===null||F===void 0||F.abort();const W=!!(N&&N.request&&N.request.collectResourceTiming)&&new d.bv(N.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(N,this._pendingRequest),this._geoJSONIndex=N.cluster?new qn(function({superclusterOptions:pe,clusterProperties:ge}){if(!ge||!pe)return pe;const oe={},be={},Ce={accumulated:null,zoom:0},ve={properties:null},Oe=Object.keys(ge);for(const rt of Oe){const[at,Dt]=ge[rt],vt=d.bC(Dt),Rt=d.bC(typeof at=="string"?[at,["accumulated"],["get",rt]]:at);oe[rt]=vt.value,be[rt]=Rt.value}return pe.map=rt=>{ve.properties=rt;const at={};for(const Dt of Oe)at[Dt]=oe[Dt].evaluate(Ce,ve);return at},pe.reduce=(rt,at)=>{ve.properties=at;for(const Dt of Oe)Ce.accumulated=rt[Dt],rt[Dt]=be[Dt].evaluate(Ce,ve)},pe}(N)).load((yield this._pendingData).features):(ee=yield this._pendingData,new xi(ee,N.geojsonVtOptions)),this.loaded={};const ue={};if(W){const pe=W.finish();pe&&(ue.resourceTiming={},ue.resourceTiming[N.source]=JSON.parse(JSON.stringify(pe)))}return ue}catch(ue){if(delete this._pendingRequest,d.bB(ue))return{abandoned:!0};throw ue}var ee})}getData(){return d._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(N){const F=this.loaded;return F&&F[N.uid]?super.reloadTile(N):this.loadTile(N)}loadAndProcessGeoJSON(N,F){return d._(this,void 0,void 0,function*(){let W=yield this.loadGeoJSON(N,F);if(delete this._pendingRequest,typeof W!="object")throw new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`);if(X(W,!0),N.filter){const ee=d.bC(N.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ee.result==="error")throw new Error(ee.value.map(pe=>`${pe.key}: ${pe.message}`).join(", "));W={type:"FeatureCollection",features:W.features.filter(pe=>ee.value.evaluate({zoom:0},pe))}}return W})}loadGeoJSON(N,F){return d._(this,void 0,void 0,function*(){const{promoteId:W}=N;if(N.request){const ee=yield d.h(N.request,F);return this._dataUpdateable=Zr(ee.data,W)?ds(ee.data,W):void 0,ee.data}if(typeof N.data=="string")try{const ee=JSON.parse(N.data);return this._dataUpdateable=Zr(ee,W)?ds(ee,W):void 0,ee}catch{throw new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`)}if(!N.dataDiff)throw new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${N.source}`);return function(ee,ue,pe){var ge,oe,be,Ce;if(ue.removeAll&&ee.clear(),ue.remove)for(const ve of ue.remove)ee.delete(ve);if(ue.add)for(const ve of ue.add){const Oe=_t(ve,pe);Oe!=null&&ee.set(Oe,ve)}if(ue.update)for(const ve of ue.update){let Oe=ee.get(ve.id);if(Oe==null)continue;const rt=!ve.removeAllProperties&&(((ge=ve.removeProperties)===null||ge===void 0?void 0:ge.length)>0||((oe=ve.addOrUpdateProperties)===null||oe===void 0?void 0:oe.length)>0);if((ve.newGeometry||ve.removeAllProperties||rt)&&(Oe=Object.assign({},Oe),ee.set(ve.id,Oe),rt&&(Oe.properties=Object.assign({},Oe.properties))),ve.newGeometry&&(Oe.geometry=ve.newGeometry),ve.removeAllProperties)Oe.properties={};else if(((be=ve.removeProperties)===null||be===void 0?void 0:be.length)>0)for(const at of ve.removeProperties)Object.prototype.hasOwnProperty.call(Oe.properties,at)&&delete Oe.properties[at];if(((Ce=ve.addOrUpdateProperties)===null||Ce===void 0?void 0:Ce.length)>0)for(const{key:at,value:Dt}of ve.addOrUpdateProperties)Oe.properties[at]=Dt}}(this._dataUpdateable,N.dataDiff,W),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(N){return d._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(N){return this._geoJSONIndex.getClusterExpansionZoom(N.clusterId)}getClusterChildren(N){return this._geoJSONIndex.getChildren(N.clusterId)}getClusterLeaves(N){return this._geoJSONIndex.getLeaves(N.clusterId,N.limit,N.offset)}}class Wr{constructor(N){this.self=N,this.actor=new d.F(N),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(F,W)=>{if(this.externalWorkerSourceTypes[F])throw new Error(`Worker source with name "${F}" already registered.`);this.externalWorkerSourceTypes[F]=W},this.self.addProtocol=d.bi,this.self.removeProtocol=d.bj,this.self.registerRTLTextPlugin=F=>{if(d.bD.isParsed())throw new Error("RTL text plugin already registered.");d.bD.setMethods(F)},this.actor.registerMessageHandler("LDT",(F,W)=>this._getDEMWorkerSource(F,W.source).loadTile(W)),this.actor.registerMessageHandler("RDT",(F,W)=>d._(this,void 0,void 0,function*(){this._getDEMWorkerSource(F,W.source).removeTile(W)})),this.actor.registerMessageHandler("GCEZ",(F,W)=>d._(this,void 0,void 0,function*(){return this._getWorkerSource(F,W.type,W.source).getClusterExpansionZoom(W)})),this.actor.registerMessageHandler("GCC",(F,W)=>d._(this,void 0,void 0,function*(){return this._getWorkerSource(F,W.type,W.source).getClusterChildren(W)})),this.actor.registerMessageHandler("GCL",(F,W)=>d._(this,void 0,void 0,function*(){return this._getWorkerSource(F,W.type,W.source).getClusterLeaves(W)})),this.actor.registerMessageHandler("LD",(F,W)=>this._getWorkerSource(F,W.type,W.source).loadData(W)),this.actor.registerMessageHandler("GD",(F,W)=>this._getWorkerSource(F,W.type,W.source).getData()),this.actor.registerMessageHandler("LT",(F,W)=>this._getWorkerSource(F,W.type,W.source).loadTile(W)),this.actor.registerMessageHandler("RT",(F,W)=>this._getWorkerSource(F,W.type,W.source).reloadTile(W)),this.actor.registerMessageHandler("AT",(F,W)=>this._getWorkerSource(F,W.type,W.source).abortTile(W)),this.actor.registerMessageHandler("RMT",(F,W)=>this._getWorkerSource(F,W.type,W.source).removeTile(W)),this.actor.registerMessageHandler("RS",(F,W)=>d._(this,void 0,void 0,function*(){if(!this.workerSources[F]||!this.workerSources[F][W.type]||!this.workerSources[F][W.type][W.source])return;const ee=this.workerSources[F][W.type][W.source];delete this.workerSources[F][W.type][W.source],ee.removeSource!==void 0&&ee.removeSource(W)})),this.actor.registerMessageHandler("RM",F=>d._(this,void 0,void 0,function*(){delete this.layerIndexes[F],delete this.availableImages[F],delete this.workerSources[F],delete this.demWorkerSources[F]})),this.actor.registerMessageHandler("SR",(F,W)=>d._(this,void 0,void 0,function*(){this.referrer=W})),this.actor.registerMessageHandler("SRPS",(F,W)=>this._syncRTLPluginState(F,W)),this.actor.registerMessageHandler("IS",(F,W)=>d._(this,void 0,void 0,function*(){this.self.importScripts(W)})),this.actor.registerMessageHandler("SI",(F,W)=>this._setImages(F,W)),this.actor.registerMessageHandler("UL",(F,W)=>d._(this,void 0,void 0,function*(){this._getLayerIndex(F).update(W.layers,W.removedIds)})),this.actor.registerMessageHandler("SL",(F,W)=>d._(this,void 0,void 0,function*(){this._getLayerIndex(F).replace(W)}))}_setImages(N,F){return d._(this,void 0,void 0,function*(){this.availableImages[N]=F;for(const W in this.workerSources[N]){const ee=this.workerSources[N][W];for(const ue in ee)ee[ue].availableImages=F}})}_syncRTLPluginState(N,F){return d._(this,void 0,void 0,function*(){if(d.bD.isParsed())return d.bD.getState();if(F.pluginStatus!=="loading")return d.bD.setState(F),F;const W=F.pluginURL;if(this.self.importScripts(W),d.bD.isParsed()){const ee={pluginStatus:"loaded",pluginURL:W};return d.bD.setState(ee),ee}throw d.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${W}`)})}_getAvailableImages(N){let F=this.availableImages[N];return F||(F=[]),F}_getLayerIndex(N){let F=this.layerIndexes[N];return F||(F=this.layerIndexes[N]=new c),F}_getWorkerSource(N,F,W){if(this.workerSources[N]||(this.workerSources[N]={}),this.workerSources[N][F]||(this.workerSources[N][F]={}),!this.workerSources[N][F][W]){const ee={sendAsync:(ue,pe)=>(ue.targetMapId=N,this.actor.sendAsync(ue,pe))};switch(F){case"vector":this.workerSources[N][F][W]=new P(ee,this._getLayerIndex(N),this._getAvailableImages(N));break;case"geojson":this.workerSources[N][F][W]=new Ds(ee,this._getLayerIndex(N),this._getAvailableImages(N));break;default:this.workerSources[N][F][W]=new this.externalWorkerSourceTypes[F](ee,this._getLayerIndex(N),this._getAvailableImages(N))}}return this.workerSources[N][F][W]}_getDEMWorkerSource(N,F){return this.demWorkerSources[N]||(this.demWorkerSources[N]={}),this.demWorkerSources[N][F]||(this.demWorkerSources[N][F]=new A),this.demWorkerSources[N][F]}}return d.i(self)&&(self.worker=new Wr(self)),Wr}),a("index",["exports","./shared"],function(d,c){var w="4.7.1";let k,E;const P={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:_=>new Promise((i,h)=>{const f=requestAnimationFrame(i);_.signal.addEventListener("abort",()=>{cancelAnimationFrame(f),h(c.c())})}),getImageData(_,i=0){return this.getImageCanvasContext(_).getImageData(-i,-i,_.width+2*i,_.height+2*i)},getImageCanvasContext(_){const i=window.document.createElement("canvas"),h=i.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return i.width=_.width,i.height=_.height,h.drawImage(_,0,0,_.width,_.height),h},resolveURL:_=>(k||(k=document.createElement("a")),k.href=_,k.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(E==null&&(E=matchMedia("(prefers-reduced-motion: reduce)")),E.matches)}};class A{static testProp(i){if(!A.docStyle)return i[0];for(let h=0;h<i.length;h++)if(i[h]in A.docStyle)return i[h];return i[0]}static create(i,h,f){const m=window.document.createElement(i);return h!==void 0&&(m.className=h),f&&f.appendChild(m),m}static createNS(i,h){return window.document.createElementNS(i,h)}static disableDrag(){A.docStyle&&A.selectProp&&(A.userSelect=A.docStyle[A.selectProp],A.docStyle[A.selectProp]="none")}static enableDrag(){A.docStyle&&A.selectProp&&(A.docStyle[A.selectProp]=A.userSelect)}static setTransform(i,h){i.style[A.transformProp]=h}static addEventListener(i,h,f,m={}){i.addEventListener(h,f,"passive"in m?m:m.capture)}static removeEventListener(i,h,f,m={}){i.removeEventListener(h,f,"passive"in m?m:m.capture)}static suppressClickInternal(i){i.preventDefault(),i.stopPropagation(),window.removeEventListener("click",A.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",A.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",A.suppressClickInternal,!0)},0)}static getScale(i){const h=i.getBoundingClientRect();return{x:h.width/i.offsetWidth||1,y:h.height/i.offsetHeight||1,boundingClientRect:h}}static getPoint(i,h,f){const m=h.boundingClientRect;return new c.P((f.clientX-m.left)/h.x-i.clientLeft,(f.clientY-m.top)/h.y-i.clientTop)}static mousePos(i,h){const f=A.getScale(i);return A.getPoint(i,f,h)}static touchPos(i,h){const f=[],m=A.getScale(i);for(let y=0;y<h.length;y++)f.push(A.getPoint(i,m,h[y]));return f}static mouseButton(i){return i.button}static remove(i){i.parentNode&&i.parentNode.removeChild(i)}}A.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,A.selectProp=A.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),A.transformProp=A.testProp(["transform","WebkitTransform"]);const $={supported:!1,testSupport:function(_){!he&&X&&(K?J(_):j=_)}};let j,X,he=!1,K=!1;function J(_){const i=_.createTexture();_.bindTexture(_.TEXTURE_2D,i);try{if(_.texImage2D(_.TEXTURE_2D,0,_.RGBA,_.RGBA,_.UNSIGNED_BYTE,X),_.isContextLost())return;$.supported=!0}catch{}_.deleteTexture(i),he=!0}var le;typeof document<"u"&&(X=document.createElement("img"),X.onload=()=>{j&&J(j),j=null,K=!0},X.onerror=()=>{he=!0,j=null},X.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(_){let i,h,f,m;_.resetRequestQueue=()=>{i=[],h=0,f=0,m={}},_.addThrottleControl=M=>{const D=f++;return m[D]=M,D},_.removeThrottleControl=M=>{delete m[M],S()},_.getImage=(M,D,O=!0)=>new Promise((L,U)=>{$.supported&&(M.headers||(M.headers={}),M.headers.accept="image/webp,*/*"),c.e(M,{type:"image"}),i.push({abortController:D,requestParameters:M,supportImageRefresh:O,state:"queued",onError:Z=>{U(Z)},onSuccess:Z=>{L(Z)}}),S()});const y=M=>c._(this,void 0,void 0,function*(){M.state="running";const{requestParameters:D,supportImageRefresh:O,onError:L,onSuccess:U,abortController:Z}=M,G=O===!1&&!c.i(self)&&!c.g(D.url)&&(!D.headers||Object.keys(D.headers).reduce((se,ae)=>se&&ae==="accept",!0));h++;const te=G?C(D,Z):c.m(D,Z);try{const se=yield te;delete M.abortController,M.state="completed",se.data instanceof HTMLImageElement||c.b(se.data)?U(se):se.data&&U({data:yield(re=se.data,typeof createImageBitmap=="function"?c.d(re):c.f(re)),cacheControl:se.cacheControl,expires:se.expires})}catch(se){delete M.abortController,L(se)}finally{h--,S()}var re}),S=()=>{const M=(()=>{for(const D of Object.keys(m))if(m[D]())return!0;return!1})()?c.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let D=h;D<M&&i.length>0;D++){const O=i.shift();O.abortController.signal.aborted?D--:y(O)}},C=(M,D)=>new Promise((O,L)=>{const U=new Image,Z=M.url,G=M.credentials;G&&G==="include"?U.crossOrigin="use-credentials":(G&&G==="same-origin"||!c.s(Z))&&(U.crossOrigin="anonymous"),D.signal.addEventListener("abort",()=>{U.src="",L(c.c())}),U.fetchPriority="high",U.onload=()=>{U.onerror=U.onload=null,O({data:U})},U.onerror=()=>{U.onerror=U.onload=null,D.signal.aborted||L(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},U.src=Z})}(le||(le={})),le.resetRequestQueue();class Se{constructor(i){this._transformRequestFn=i}transformRequest(i,h){return this._transformRequestFn&&this._transformRequestFn(i,h)||{url:i}}setTransformRequest(i){this._transformRequestFn=i}}function Me(_){var i=new c.A(3);return i[0]=_[0],i[1]=_[1],i[2]=_[2],i}var Ee,De=function(_,i,h){return _[0]=i[0]-h[0],_[1]=i[1]-h[1],_[2]=i[2]-h[2],_};Ee=new c.A(3),c.A!=Float32Array&&(Ee[0]=0,Ee[1]=0,Ee[2]=0);var Ze=function(_){var i=_[0],h=_[1];return i*i+h*h};function tt(_){const i=[];if(typeof _=="string")i.push({id:"default",url:_});else if(_&&_.length>0){const h=[];for(const{id:f,url:m}of _){const y=`${f}${m}`;h.indexOf(y)===-1&&(h.push(y),i.push({id:f,url:m}))}}return i}function ft(_,i,h){const f=_.split("?");return f[0]+=`${i}${h}`,f.join("?")}(function(){var _=new c.A(2);c.A!=Float32Array&&(_[0]=0,_[1]=0)})();class xt{constructor(i,h,f,m){this.context=i,this.format=f,this.texture=i.gl.createTexture(),this.update(h,m)}update(i,h,f){const{width:m,height:y}=i,S=!(this.size&&this.size[0]===m&&this.size[1]===y||f),{context:C}=this,{gl:M}=C;if(this.useMipmap=!!(h&&h.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),C.pixelStoreUnpackFlipY.set(!1),C.pixelStoreUnpack.set(1),C.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!h||h.premultiply!==!1)),S)this.size=[m,y],i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||c.b(i)?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,i):M.texImage2D(M.TEXTURE_2D,0,this.format,m,y,0,this.format,M.UNSIGNED_BYTE,i.data);else{const{x:D,y:O}=f||{x:0,y:0};i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||c.b(i)?M.texSubImage2D(M.TEXTURE_2D,0,D,O,M.RGBA,M.UNSIGNED_BYTE,i):M.texSubImage2D(M.TEXTURE_2D,0,D,O,m,y,M.RGBA,M.UNSIGNED_BYTE,i.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)}bind(i,h,f){const{context:m}=this,{gl:y}=m;y.bindTexture(y.TEXTURE_2D,this.texture),f!==y.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(f=y.LINEAR),i!==this.filter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,i),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,f||i),this.filter=i),h!==this.wrap&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,h),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}function tr(_){const{userImage:i}=_;return!!(i&&i.render&&i.render())&&(_.data.replace(new Uint8Array(i.data.buffer)),!0)}class dn extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:h,promiseResolve:f}of this.requestors)f(this._getImagesForIds(h));this.requestors=[]}}getImage(i){const h=this.images[i];if(h&&!h.data&&h.spriteData){const f=h.spriteData;h.data=new c.R({width:f.width,height:f.height},f.context.getImageData(f.x,f.y,f.width,f.height).data),h.spriteData=null}return h}addImage(i,h){if(this.images[i])throw new Error(`Image id ${i} already exist, use updateImage instead`);this._validate(i,h)&&(this.images[i]=h)}_validate(i,h){let f=!0;const m=h.data||h.spriteData;return this._validateStretch(h.stretchX,m&&m.width)||(this.fire(new c.j(new Error(`Image "${i}" has invalid "stretchX" value`))),f=!1),this._validateStretch(h.stretchY,m&&m.height)||(this.fire(new c.j(new Error(`Image "${i}" has invalid "stretchY" value`))),f=!1),this._validateContent(h.content,h)||(this.fire(new c.j(new Error(`Image "${i}" has invalid "content" value`))),f=!1),f}_validateStretch(i,h){if(!i)return!0;let f=0;for(const m of i){if(m[0]<f||m[1]<m[0]||h<m[1])return!1;f=m[1]}return!0}_validateContent(i,h){if(!i)return!0;if(i.length!==4)return!1;const f=h.spriteData,m=f&&f.width||h.data.width,y=f&&f.height||h.data.height;return!(i[0]<0||m<i[0]||i[1]<0||y<i[1]||i[2]<0||m<i[2]||i[3]<0||y<i[3]||i[2]<i[0]||i[3]<i[1])}updateImage(i,h,f=!0){const m=this.getImage(i);if(f&&(m.data.width!==h.data.width||m.data.height!==h.data.height))throw new Error(`size mismatch between old image (${m.data.width}x${m.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=m.version+1,this.images[i]=h,this.updatedImages[i]=!0}removeImage(i){const h=this.images[i];delete this.images[i],delete this.patterns[i],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i){return new Promise((h,f)=>{let m=!0;if(!this.isLoaded())for(const y of i)this.images[y]||(m=!1);this.isLoaded()||m?h(this._getImagesForIds(i)):this.requestors.push({ids:i,promiseResolve:h})})}_getImagesForIds(i){const h={};for(const f of i){let m=this.getImage(f);m||(this.fire(new c.k("styleimagemissing",{id:f})),m=this.getImage(f)),m?h[f]={data:m.data.clone(),pixelRatio:m.pixelRatio,sdf:m.sdf,version:m.version,stretchX:m.stretchX,stretchY:m.stretchY,content:m.content,textFitWidth:m.textFitWidth,textFitHeight:m.textFitHeight,hasRenderCallback:!!(m.userImage&&m.userImage.render)}:c.w(`Image "${f}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return h}getPixelSize(){const{width:i,height:h}=this.atlasImage;return{width:i,height:h}}getPattern(i){const h=this.patterns[i],f=this.getImage(i);if(!f)return null;if(h&&h.position.version===f.version)return h.position;if(h)h.position.version=f.version;else{const m={w:f.data.width+2,h:f.data.height+2,x:0,y:0},y=new c.I(m,f);this.patterns[i]={bin:m,position:y}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const h=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new xt(i,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const y in this.patterns)i.push(this.patterns[y].bin);const{w:h,h:f}=c.p(i),m=this.atlasImage;m.resize({width:h||1,height:f||1});for(const y in this.patterns){const{bin:S}=this.patterns[y],C=S.x+1,M=S.y+1,D=this.getImage(y).data,O=D.width,L=D.height;c.R.copy(D,m,{x:0,y:0},{x:C,y:M},{width:O,height:L}),c.R.copy(D,m,{x:0,y:L-1},{x:C,y:M-1},{width:O,height:1}),c.R.copy(D,m,{x:0,y:0},{x:C,y:M+L},{width:O,height:1}),c.R.copy(D,m,{x:O-1,y:0},{x:C-1,y:M},{width:1,height:L}),c.R.copy(D,m,{x:0,y:0},{x:C+O,y:M},{width:1,height:L})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const h of i){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const f=this.getImage(h);f||c.w(`Image with ID: "${h}" was not found`),tr(f)&&this.updateImage(h,f)}}}const Pn=1e20;function vr(_,i,h,f,m,y,S,C,M){for(let D=i;D<i+f;D++)Ur(_,h*y+D,y,m,S,C,M);for(let D=h;D<h+m;D++)Ur(_,D*y+i,1,f,S,C,M)}function Ur(_,i,h,f,m,y,S){y[0]=0,S[0]=-Pn,S[1]=Pn,m[0]=_[i];for(let C=1,M=0,D=0;C<f;C++){m[C]=_[i+C*h];const O=C*C;do{const L=y[M];D=(m[C]-m[L]+O-L*L)/(C-L)/2}while(D<=S[M]&&--M>-1);M++,y[M]=C,S[M]=D,S[M+1]=Pn}for(let C=0,M=0;C<f;C++){for(;S[M+1]<C;)M++;const D=y[M],O=C-D;_[i+C*h]=m[D]+O*O}}class yi{constructor(i,h){this.requestManager=i,this.localIdeographFontFamily=h,this.entries={}}setURL(i){this.url=i}getGlyphs(i){return c._(this,void 0,void 0,function*(){const h=[];for(const y in i)for(const S of i[y])h.push(this._getAndCacheGlyphsPromise(y,S));const f=yield Promise.all(h),m={};for(const{stack:y,id:S,glyph:C}of f)m[y]||(m[y]={}),m[y][S]=C&&{id:C.id,bitmap:C.bitmap.clone(),metrics:C.metrics};return m})}_getAndCacheGlyphsPromise(i,h){return c._(this,void 0,void 0,function*(){let f=this.entries[i];f||(f=this.entries[i]={glyphs:{},requests:{},ranges:{}});let m=f.glyphs[h];if(m!==void 0)return{stack:i,id:h,glyph:m};if(m=this._tinySDF(f,i,h),m)return f.glyphs[h]=m,{stack:i,id:h,glyph:m};const y=Math.floor(h/256);if(256*y>65535)throw new Error("glyphs > 65535 not supported");if(f.ranges[y])return{stack:i,id:h,glyph:m};if(!this.url)throw new Error("glyphsUrl is not set");if(!f.requests[y]){const C=yi.loadGlyphRange(i,y,this.url,this.requestManager);f.requests[y]=C}const S=yield f.requests[y];for(const C in S)this._doesCharSupportLocalGlyph(+C)||(f.glyphs[+C]=S[+C]);return f.ranges[y]=!0,{stack:i,id:h,glyph:S[h]||null}})}_doesCharSupportLocalGlyph(i){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(i))}_tinySDF(i,h,f){const m=this.localIdeographFontFamily;if(!m||!this._doesCharSupportLocalGlyph(f))return;let y=i.tinySDF;if(!y){let C="400";/bold/i.test(h)?C="900":/medium/i.test(h)?C="500":/light/i.test(h)&&(C="200"),y=i.tinySDF=new yi.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:m,fontWeight:C})}const S=y.draw(String.fromCharCode(f));return{id:f,bitmap:new c.o({width:S.width||60,height:S.height||60},S.data),metrics:{width:S.glyphWidth/2||24,height:S.glyphHeight/2||24,left:S.glyphLeft/2+.5||0,top:S.glyphTop/2-27.5||-8,advance:S.glyphAdvance/2||24,isDoubleResolution:!0}}}}yi.loadGlyphRange=function(_,i,h,f){return c._(this,void 0,void 0,function*(){const m=256*i,y=m+255,S=f.transformRequest(h.replace("{fontstack}",_).replace("{range}",`${m}-${y}`),"Glyphs"),C=yield c.l(S,new AbortController);if(!C||!C.data)throw new Error(`Could not load glyph range. range: ${i}, ${m}-${y}`);const M={};for(const D of c.n(C.data))M[D.id]=D;return M})},yi.TinySDF=class{constructor({fontSize:_=24,buffer:i=3,radius:h=8,cutoff:f=.25,fontFamily:m="sans-serif",fontWeight:y="normal",fontStyle:S="normal"}={}){this.buffer=i,this.cutoff=f,this.radius=h;const C=this.size=_+4*i,M=this._createCanvas(C),D=this.ctx=M.getContext("2d",{willReadFrequently:!0});D.font=`${S} ${y} ${_}px ${m}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(C*C),this.gridInner=new Float64Array(C*C),this.f=new Float64Array(C),this.z=new Float64Array(C+1),this.v=new Uint16Array(C)}_createCanvas(_){const i=document.createElement("canvas");return i.width=i.height=_,i}draw(_){const{width:i,actualBoundingBoxAscent:h,actualBoundingBoxDescent:f,actualBoundingBoxLeft:m,actualBoundingBoxRight:y}=this.ctx.measureText(_),S=Math.ceil(h),C=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-m))),M=Math.min(this.size-this.buffer,S+Math.ceil(f)),D=C+2*this.buffer,O=M+2*this.buffer,L=Math.max(D*O,0),U=new Uint8ClampedArray(L),Z={data:U,width:D,height:O,glyphWidth:C,glyphHeight:M,glyphTop:S,glyphLeft:0,glyphAdvance:i};if(C===0||M===0)return Z;const{ctx:G,buffer:te,gridInner:re,gridOuter:se}=this;G.clearRect(te,te,C,M),G.fillText(_,te,te+S);const ae=G.getImageData(te,te,C,M);se.fill(Pn,0,L),re.fill(0,0,L);for(let Y=0;Y<M;Y++)for(let de=0;de<C;de++){const fe=ae.data[4*(Y*C+de)+3]/255;if(fe===0)continue;const _e=(Y+te)*D+de+te;if(fe===1)se[_e]=0,re[_e]=Pn;else{const Te=.5-fe;se[_e]=Te>0?Te*Te:0,re[_e]=Te<0?Te*Te:0}}vr(se,0,0,D,O,D,this.f,this.v,this.z),vr(re,te,te,C,M,D,this.f,this.v,this.z);for(let Y=0;Y<L;Y++){const de=Math.sqrt(se[Y])-Math.sqrt(re[Y]);U[Y]=Math.round(255-255*(de/this.radius+this.cutoff))}return Z}};class Xe{constructor(){this.specification=c.v.light.position}possiblyEvaluate(i,h){return c.x(i.expression.evaluate(h))}interpolate(i,h,f){return{x:c.y.number(i.x,h.x,f),y:c.y.number(i.y,h.y,f),z:c.y.number(i.z,h.z,f)}}}let gt;class yt extends c.E{constructor(i){super(),gt=gt||new c.q({anchor:new c.D(c.v.light.anchor),position:new Xe,color:new c.D(c.v.light.color),intensity:new c.D(c.v.light.intensity)}),this._transitionable=new c.T(gt),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,h={}){if(!this._validate(c.r,i,h))for(const f in i){const m=i[f];f.endsWith("-transition")?this._transitionable.setTransition(f.slice(0,-11),m):this._transitionable.setValue(f,m)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,h,f){return(!f||f.validate!==!1)&&c.t(this,i.call(c.u,{value:h,style:{glyphs:!0,sprite:!0},styleSpec:c.v}))}}const zt=new c.q({"sky-color":new c.D(c.v.sky["sky-color"]),"horizon-color":new c.D(c.v.sky["horizon-color"]),"fog-color":new c.D(c.v.sky["fog-color"]),"fog-ground-blend":new c.D(c.v.sky["fog-ground-blend"]),"horizon-fog-blend":new c.D(c.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new c.D(c.v.sky["sky-horizon-blend"]),"atmosphere-blend":new c.D(c.v.sky["atmosphere-blend"])});class jt extends c.E{constructor(i){super(),this._transitionable=new c.T(zt),this.setSky(i),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.z(0))}setSky(i,h={}){if(!this._validate(c.B,i,h)){i||(i={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const f in i){const m=i[f];f.endsWith("-transition")?this._transitionable.setTransition(f.slice(0,-11),m):this._transitionable.setValue(f,m)}}}getSky(){return this._transitionable.serialize()}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,h,f={}){return(f==null?void 0:f.validate)!==!1&&c.t(this,i.call(c.u,c.e({value:h,style:{glyphs:!0,sprite:!0},styleSpec:c.v})))}calculateFogBlendOpacity(i){return i<60?0:i<70?(i-60)/10:1}}class xr{constructor(i,h){this.width=i,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(i,h){const f=i.join(",")+String(h);return this.dashEntry[f]||(this.dashEntry[f]=this.addDash(i,h)),this.dashEntry[f]}getDashRanges(i,h,f){const m=[];let y=i.length%2==1?-i[i.length-1]*f:0,S=i[0]*f,C=!0;m.push({left:y,right:S,isDash:C,zeroLength:i[0]===0});let M=i[0];for(let D=1;D<i.length;D++){C=!C;const O=i[D];y=M*f,M+=O,S=M*f,m.push({left:y,right:S,isDash:C,zeroLength:O===0})}return m}addRoundDash(i,h,f){const m=h/2;for(let y=-f;y<=f;y++){const S=this.width*(this.nextRow+f+y);let C=0,M=i[C];for(let D=0;D<this.width;D++){D/M.right>1&&(M=i[++C]);const O=Math.abs(D-M.left),L=Math.abs(D-M.right),U=Math.min(O,L);let Z;const G=y/f*(m+1);if(M.isDash){const te=m-Math.abs(G);Z=Math.sqrt(U*U+te*te)}else Z=m-Math.sqrt(U*U+G*G);this.data[S+D]=Math.max(0,Math.min(255,Z+128))}}}addRegularDash(i){for(let C=i.length-1;C>=0;--C){const M=i[C],D=i[C+1];M.zeroLength?i.splice(C,1):D&&D.isDash===M.isDash&&(D.left=M.left,i.splice(C,1))}const h=i[0],f=i[i.length-1];h.isDash===f.isDash&&(h.left=f.left-this.width,f.right=h.right+this.width);const m=this.width*this.nextRow;let y=0,S=i[y];for(let C=0;C<this.width;C++){C/S.right>1&&(S=i[++y]);const M=Math.abs(C-S.left),D=Math.abs(C-S.right),O=Math.min(M,D);this.data[m+C]=Math.max(0,Math.min(255,(S.isDash?O:-O)+128))}}addDash(i,h){const f=h?7:0,m=2*f+1;if(this.nextRow+m>this.height)return c.w("LineAtlas out of space"),null;let y=0;for(let C=0;C<i.length;C++)y+=i[C];if(y!==0){const C=this.width/y,M=this.getDashRanges(i,this.width,C);h?this.addRoundDash(M,C,f):this.addRegularDash(M)}const S={y:(this.nextRow+f+.5)/this.height,height:2*f/this.height,width:y};return this.nextRow+=m,this.dirty=!0,S}bind(i){const h=i.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}const qn="maplibre_preloaded_worker_pool";class _i{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<_i.workerCount;)this.workers.push(new Worker(c.a.WORKER_URL));return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[qn]}numActive(){return Object.keys(this.active).length}}const vi=Math.floor(P.hardwareConcurrency/2);let An,wr;function Ys(){return An||(An=new _i),An}_i.workerCount=c.C(globalThis)?Math.max(Math.min(vi,3),1):1;class Qs{constructor(i,h){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=h;const f=this.workerPool.acquire(h);for(let m=0;m<f.length;m++){const y=new c.F(f[m],h);y.name=`Worker ${m}`,this.actors.push(y)}if(!this.actors.length)throw new Error("No actors found")}broadcast(i,h){const f=[];for(const m of this.actors)f.push(m.sendAsync({type:i,data:h}));return Promise.all(f)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(i=!0){this.actors.forEach(h=>{h.remove()}),this.actors=[],i&&this.workerPool.release(this.id)}registerMessageHandler(i,h){for(const f of this.actors)f.registerMessageHandler(i,h)}}function Ja(){return wr||(wr=new Qs(Ys(),c.G),wr.registerMessageHandler("GR",(_,i,h)=>c.m(i,h))),wr}function us(_,i){const h=c.H();return c.J(h,h,[1,1,0]),c.K(h,h,[.5*_.width,.5*_.height,1]),c.L(h,h,_.calculatePosMatrix(i.toUnwrapped()))}function Is(_,i,h,f,m,y){const S=function(L,U,Z){if(L)for(const G of L){const te=U[G];if(te&&te.source===Z&&te.type==="fill-extrusion")return!0}else for(const G in U){const te=U[G];if(te.source===Z&&te.type==="fill-extrusion")return!0}return!1}(m&&m.layers,i,_.id),C=y.maxPitchScaleFactor(),M=_.tilesIn(f,C,S);M.sort(Ps);const D=[];for(const L of M)D.push({wrappedTileID:L.tileID.wrapped().key,queryResults:L.tile.queryRenderedFeatures(i,h,_._state,L.queryGeometry,L.cameraQueryGeometry,L.scale,m,y,C,us(_.transform,L.tileID))});const O=function(L){const U={},Z={};for(const G of L){const te=G.queryResults,re=G.wrappedTileID,se=Z[re]=Z[re]||{};for(const ae in te){const Y=te[ae],de=se[ae]=se[ae]||{},fe=U[ae]=U[ae]||[];for(const _e of Y)de[_e.featureIndex]||(de[_e.featureIndex]=!0,fe.push(_e))}}return U}(D);for(const L in O)O[L].forEach(U=>{const Z=U.feature,G=_.getFeatureState(Z.layer["source-layer"],Z.id);Z.source=Z.layer.source,Z.layer["source-layer"]&&(Z.sourceLayer=Z.layer["source-layer"]),Z.state=G});return O}function Ps(_,i){const h=_.tileID,f=i.tileID;return h.overscaledZ-f.overscaledZ||h.canonical.y-f.canonical.y||h.wrap-f.wrap||h.canonical.x-f.canonical.x}function zo(_,i,h){return c._(this,void 0,void 0,function*(){let f=_;if(_.url?f=(yield c.h(i.transformRequest(_.url,"Source"),h)).data:yield P.frameAsync(h),!f)return null;const m=c.M(c.e(f,_),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in f&&f.vector_layers&&(m.vectorLayerIds=f.vector_layers.map(y=>y.id)),m})}class xe{constructor(i,h){i&&(h?this.setSouthWest(i).setNorthEast(h):Array.isArray(i)&&(i.length===4?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1])))}setNorthEast(i){return this._ne=i instanceof c.N?new c.N(i.lng,i.lat):c.N.convert(i),this}setSouthWest(i){return this._sw=i instanceof c.N?new c.N(i.lng,i.lat):c.N.convert(i),this}extend(i){const h=this._sw,f=this._ne;let m,y;if(i instanceof c.N)m=i,y=i;else{if(!(i instanceof xe))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend(xe.convert(i)):this.extend(c.N.convert(i)):i&&("lng"in i||"lon"in i)&&"lat"in i?this.extend(c.N.convert(i)):this;if(m=i._sw,y=i._ne,!m||!y)return this}return h||f?(h.lng=Math.min(m.lng,h.lng),h.lat=Math.min(m.lat,h.lat),f.lng=Math.max(y.lng,f.lng),f.lat=Math.max(y.lat,f.lat)):(this._sw=new c.N(m.lng,m.lat),this._ne=new c.N(y.lng,y.lat)),this}getCenter(){return new c.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.N(this.getWest(),this.getNorth())}getSouthEast(){return new c.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:h,lat:f}=c.N.convert(i);let m=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&m}static convert(i){return i instanceof xe?i:i&&new xe(i)}static fromLngLat(i,h=0){const f=360*h/40075017,m=f/Math.cos(Math.PI/180*i.lat);return new xe(new c.N(i.lng-m,i.lat-f),new c.N(i.lng+m,i.lat+f))}adjustAntiMeridian(){const i=new c.N(this._sw.lng,this._sw.lat),h=new c.N(this._ne.lng,this._ne.lat);return new xe(i,i.lng>h.lng?new c.N(h.lng+360,h.lat):h)}}class eo{constructor(i,h,f){this.bounds=xe.convert(this.validateBounds(i)),this.minzoom=h||0,this.maxzoom=f||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const h=Math.pow(2,i.z),f=Math.floor(c.O(this.bounds.getWest())*h),m=Math.floor(c.Q(this.bounds.getNorth())*h),y=Math.ceil(c.O(this.bounds.getEast())*h),S=Math.ceil(c.Q(this.bounds.getSouth())*h);return i.x>=f&&i.x<y&&i.y>=m&&i.y<S}}class Ya extends c.E{constructor(i,h,f,m){if(super(),this.id=i,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.M(h,["url","scheme","tileSize","promoteId"])),this._options=c.e({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield zo(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),i&&(c.e(this,i),i.bounds&&(this.tileBounds=new eo(i.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))}catch(i){this._tileJSONRequest=null,this.fire(new c.j(i))}})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}setSourceProperty(i){this._tileJSONRequest&&this._tileJSONRequest.abort(),i(),this.load()}setTiles(i){return this.setSourceProperty(()=>{this._options.tiles=i}),this}setUrl(i){return this.setSourceProperty(()=>{this.url=i,this._options.url=i}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return c.e({},this._options)}loadTile(i){return c._(this,void 0,void 0,function*(){const h=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),f={request:this.map._requestManager.transformRequest(h,"Tile"),uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};f.request.collectResourceTiming=this._collectResourceTiming;let m="RT";if(i.actor&&i.state!=="expired"){if(i.state==="loading")return new Promise((y,S)=>{i.reloadPromise={resolve:y,reject:S}})}else i.actor=this.dispatcher.getActor(),m="LT";i.abortController=new AbortController;try{const y=yield i.actor.sendAsync({type:m,data:f},i.abortController);if(delete i.abortController,i.aborted)return;this._afterTileLoadWorkerResponse(i,y)}catch(y){if(delete i.abortController,i.aborted)return;if(y&&y.status!==404)throw y;this._afterTileLoadWorkerResponse(i,null)}})}_afterTileLoadWorkerResponse(i,h){if(h&&h.resourceTiming&&(i.resourceTiming=h.resourceTiming),h&&this.map._refreshExpiredTiles&&i.setExpiryData(h),i.loadVectorData(h,this.map.painter),i.reloadPromise){const f=i.reloadPromise;i.reloadPromise=null,this.loadTile(i).then(f.resolve).catch(f.reject)}}abortTile(i){return c._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController),i.actor&&(yield i.actor.sendAsync({type:"AT",data:{uid:i.uid,type:this.type,source:this.id}}))})}unloadTile(i){return c._(this,void 0,void 0,function*(){i.unloadVectorData(),i.actor&&(yield i.actor.sendAsync({type:"RMT",data:{uid:i.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Ft extends c.E{constructor(i,h,f,m){super(),this.id=i,this.dispatcher=f,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},h),c.e(this,c.M(h,["url","scheme","tileSize"]))}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield zo(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,i&&(c.e(this,i),i.bounds&&(this.tileBounds=new eo(i.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))}catch(i){this._tileJSONRequest=null,this.fire(new c.j(i))}})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(i){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),i(),this.load()}setTiles(i){return this.setSourceProperty(()=>{this._options.tiles=i}),this}setUrl(i){return this.setSourceProperty(()=>{this.url=i,this._options.url=i}),this}serialize(){return c.e({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i){return c._(this,void 0,void 0,function*(){const h=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);i.abortController=new AbortController;try{const f=yield le.getImage(this.map._requestManager.transformRequest(h,"Tile"),i.abortController,this.map._refreshExpiredTiles);if(delete i.abortController,i.aborted)return void(i.state="unloaded");if(f&&f.data){this.map._refreshExpiredTiles&&f.cacheControl&&f.expires&&i.setExpiryData({cacheControl:f.cacheControl,expires:f.expires});const m=this.map.painter.context,y=m.gl,S=f.data;i.texture=this.map.painter.getTileTexture(S.width),i.texture?i.texture.update(S,{useMipmap:!0}):(i.texture=new xt(m,S,y.RGBA,{useMipmap:!0}),i.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE,y.LINEAR_MIPMAP_NEAREST)),i.state="loaded"}}catch(f){if(delete i.abortController,i.aborted)i.state="unloaded";else if(f)throw i.state="errored",f}})}abortTile(i){return c._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController)})}unloadTile(i){return c._(this,void 0,void 0,function*(){i.texture&&this.map.painter.saveTileTexture(i.texture)})}hasTransition(){return!1}}class an extends Ft{constructor(i,h,f,m){super(i,h,f,m),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox",this.redFactor=h.redFactor,this.greenFactor=h.greenFactor,this.blueFactor=h.blueFactor,this.baseShift=h.baseShift}loadTile(i){return c._(this,void 0,void 0,function*(){const h=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),f=this.map._requestManager.transformRequest(h,"Tile");i.neighboringTiles=this._getNeighboringTiles(i.tileID),i.abortController=new AbortController;try{const m=yield le.getImage(f,i.abortController,this.map._refreshExpiredTiles);if(delete i.abortController,i.aborted)return void(i.state="unloaded");if(m&&m.data){const y=m.data;this.map._refreshExpiredTiles&&m.cacheControl&&m.expires&&i.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const S=c.b(y)&&c.U()?y:yield this.readImageNow(y),C={type:this.type,uid:i.uid,source:this.id,rawImageData:S,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!i.actor||i.state==="expired"){i.actor=this.dispatcher.getActor();const M=yield i.actor.sendAsync({type:"LDT",data:C});i.dem=M,i.needsHillshadePrepare=!0,i.needsTerrainPrepare=!0,i.state="loaded"}}}catch(m){if(delete i.abortController,i.aborted)i.state="unloaded";else if(m)throw i.state="errored",m}})}readImageNow(i){return c._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&c.V()){const h=i.width+2,f=i.height+2;try{return new c.R({width:h,height:f},yield c.W(i,-1,-1,h,f))}catch{}}return P.getImageData(i,1)})}_getNeighboringTiles(i){const h=i.canonical,f=Math.pow(2,h.z),m=(h.x-1+f)%f,y=h.x===0?i.wrap-1:i.wrap,S=(h.x+1+f)%f,C=h.x+1===f?i.wrap+1:i.wrap,M={};return M[new c.S(i.overscaledZ,y,h.z,m,h.y).key]={backfilled:!1},M[new c.S(i.overscaledZ,C,h.z,S,h.y).key]={backfilled:!1},h.y>0&&(M[new c.S(i.overscaledZ,y,h.z,m,h.y-1).key]={backfilled:!1},M[new c.S(i.overscaledZ,i.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},M[new c.S(i.overscaledZ,C,h.z,S,h.y-1).key]={backfilled:!1}),h.y+1<f&&(M[new c.S(i.overscaledZ,y,h.z,m,h.y+1).key]={backfilled:!1},M[new c.S(i.overscaledZ,i.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},M[new c.S(i.overscaledZ,C,h.z,S,h.y+1).key]={backfilled:!1}),M}unloadTile(i){return c._(this,void 0,void 0,function*(){i.demTexture&&this.map.painter.saveTileTexture(i.demTexture),i.fbo&&(i.fbo.destroy(),delete i.fbo),i.dem&&delete i.dem,delete i.neighboringTiles,i.state="unloaded",i.actor&&(yield i.actor.sendAsync({type:"RDT",data:{type:this.type,uid:i.uid,source:this.id}}))})}}class Qa extends c.E{constructor(i,h,f,m){super(),this.id=i,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=f.getActor(),this.setEventedParent(m),this._data=h.data,this._options=c.e({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;const y=c.X/this.tileSize;h.clusterMaxZoom!==void 0&&this.maxzoom<=h.clusterMaxZoom&&c.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${h.clusterMaxZoom}".`),this.workerOptions=c.e({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*y,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*y,extent:c.X,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:c.X,radius:(h.clusterRadius||50)*y,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return c._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(i){this.map=i,this.load()}setData(i){return this._data=i,this._updateWorkerData(),this}updateData(i){return this._updateWorkerData(i),this}getData(){return c._(this,void 0,void 0,function*(){const i=c.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:i})})}setClusterOptions(i){return this.workerOptions.cluster=i.cluster,i&&(i.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=i.clusterRadius),i.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=i.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(i){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:i,source:this.id}})}getClusterChildren(i){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:i,source:this.id}})}getClusterLeaves(i,h,f){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:i,limit:h,offset:f}})}_updateWorkerData(i){return c._(this,void 0,void 0,function*(){const h=c.e({type:this.type},this.workerOptions);i?h.dataDiff=i:typeof this._data=="string"?(h.request=this.map._requestManager.transformRequest(P.resolveURL(this._data),"Source"),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new c.k("dataloading",{dataType:"source"}));try{const f=yield this.actor.sendAsync({type:"LD",data:h});if(this._pendingLoads--,this._removed||f.abandoned)return void this.fire(new c.k("dataabort",{dataType:"source"}));let m=null;f.resourceTiming&&f.resourceTiming[this.id]&&(m=f.resourceTiming[this.id].slice(0));const y={dataType:"source"};this._collectResourceTiming&&m&&m.length>0&&c.e(y,{resourceTiming:m}),this.fire(new c.k("data",Object.assign(Object.assign({},y),{sourceDataType:"metadata"}))),this.fire(new c.k("data",Object.assign(Object.assign({},y),{sourceDataType:"content"})))}catch(f){if(this._pendingLoads--,this._removed)return void this.fire(new c.k("dataabort",{dataType:"source"}));this.fire(new c.j(f))}})}loaded(){return this._pendingLoads===0}loadTile(i){return c._(this,void 0,void 0,function*(){const h=i.actor?"RT":"LT";i.actor=this.actor;const f={type:this.type,uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};i.abortController=new AbortController;const m=yield this.actor.sendAsync({type:h,data:f},i.abortController);delete i.abortController,i.unloadVectorData(),i.aborted||i.loadVectorData(m,this.map.painter,h==="RT")})}abortTile(i){return c._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController),i.aborted=!0})}unloadTile(i){return c._(this,void 0,void 0,function*(){i.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:i.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return c.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var As=c.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class hs extends c.E{constructor(i,h,f,m){super(),this.id=i,this.dispatcher=f,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=h}load(i){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const h=yield le.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,h&&h.data&&(this.image=h.data,i&&(this.coordinates=i),this._finishLoading())}catch(h){this._request=null,this._loaded=!0,this.fire(new c.j(h))}})}loaded(){return this._loaded}updateImage(i){return i.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=i.url,this.load(i.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(i){this.coordinates=i;const h=i.map(c.Z.fromLngLat);this.tileID=function(m){let y=1/0,S=1/0,C=-1/0,M=-1/0;for(const U of m)y=Math.min(y,U.x),S=Math.min(S,U.y),C=Math.max(C,U.x),M=Math.max(M,U.y);const D=Math.max(C-y,M-S),O=Math.max(0,Math.floor(-Math.log(D)/Math.LN2)),L=Math.pow(2,O);return new c.a1(O,Math.floor((y+C)/2*L),Math.floor((S+M)/2*L))}(h),this.minzoom=this.maxzoom=this.tileID.z;const f=h.map(m=>this.tileID.getTilePoint(m)._round());return this._boundsArray=new c.$,this._boundsArray.emplaceBack(f[0].x,f[0].y,0,0),this._boundsArray.emplaceBack(f[1].x,f[1].y,c.X,0),this._boundsArray.emplaceBack(f[3].x,f[3].y,0,c.X),this._boundsArray.emplaceBack(f[2].x,f[2].y,c.X,c.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const i=this.map.painter.context,h=i.gl;this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,As.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new xt(i,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let f=!1;for(const m in this.tiles){const y=this.tiles[m];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,f=!0)}f&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(i){return c._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={}):i.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Do extends hs{constructor(i,h,f,m){super(i,h,f,m),this.roundZoom=!0,this.type="video",this.options=h}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1;const i=this.options;this.urls=[];for(const h of i.urls)this.urls.push(this.map._requestManager.transformRequest(h,"Source").url);try{const h=yield c.a3(this.urls);if(this._loaded=!0,!h)return;this.video=h,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(h){this.fire(new c.j(h))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(i){if(this.video){const h=this.video.seekable;i<h.start(0)||i>h.end(0)?this.fire(new c.j(new c.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=i}}getVideo(){return this.video}onAdd(i){this.map||(this.map=i,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const i=this.map.painter.context,h=i.gl;this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,As.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new xt(i,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let f=!1;for(const m in this.tiles){const y=this.tiles[m];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,f=!0)}f&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class nr extends hs{constructor(i,h,f,m){super(i,h,f,m),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(S=>typeof S!="number"))||this.fire(new c.j(new c.a2(`sources.${i}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.j(new c.a2(`sources.${i}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new c.j(new c.a2(`sources.${i}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new c.j(new c.a2(`sources.${i}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.j(new c.a2(`sources.${i}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){return c._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(i){this.map=i,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let i=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,i=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,i=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,f=h.gl;this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,As.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture?(i||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new xt(h,this.canvas,f.RGBA,{premultiply:!0});let m=!1;for(const y in this.tiles){const S=this.tiles[y];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,m=!0)}m&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const i of[this.canvas.width,this.canvas.height])if(isNaN(i)||i<=0)return!0;return!1}}const el={},tl=_=>{switch(_){case"geojson":return Qa;case"image":return hs;case"raster":return Ft;case"raster-dem":return an;case"vector":return Ya;case"video":return Do;case"canvas":return nr}return el[_]},ze="RTLPluginLoaded";class qr extends c.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Ja()}_syncState(i){return this.status=i,this.dispatcher.broadcast("SRPS",{pluginStatus:i,pluginURL:this.url}).catch(h=>{throw this.status="error",h})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(i){return c._(this,arguments,void 0,function*(h,f=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=P.resolveURL(h),!this.url)throw new Error(`requested url ${h} is invalid`);if(this.status==="unavailable"){if(!f)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return c._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new c.k(ze))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let si=null;function Hr(){return si||(si=new qr),si}class zs{constructor(i,h){this.timeAdded=0,this.fadeEndTime=0,this.tileID=i,this.uid=c.a4(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(i){const h=i+this.timeAdded;h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(i){this.demTexture&&i.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(i,h,f){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(m,y){const S={};if(!y)return S;for(const C of m){const M=C.layerIds.map(D=>y.getLayer(D)).filter(Boolean);if(M.length!==0){C.layers=M,C.stateDependentLayerIds&&(C.stateDependentLayers=C.stateDependentLayerIds.map(D=>M.filter(O=>O.id===D)[0]));for(const D of M)S[D.id]=C}}return S}(i.buckets,h.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const y=this.buckets[m];if(y instanceof c.a6){if(this.hasSymbolBuckets=!0,!f)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const y=this.buckets[m];if(y instanceof c.a6&&y.hasRTLText){this.hasRTLText=!0,Hr().lazyLoad();break}}this.queryPadding=0;for(const m in this.buckets){const y=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(m).queryRadius(y))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage)}else this.collisionBoxArray=new c.a5}unloadVectorData(){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(i){return this.buckets[i.id]}upload(i){for(const f in this.buckets){const m=this.buckets[f];m.uploadPending()&&m.upload(i)}const h=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new xt(i,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new xt(i,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)}queryRenderedFeatures(i,h,f,m,y,S,C,M,D,O){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:y,scale:S,tileSize:this.tileSize,pixelPosMatrix:O,transform:M,params:C,queryPadding:this.queryPadding*D},i,h,f):{}}querySourceFeatures(i,h){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const m=f.loadVTLayers(),y=h&&h.sourceLayer?h.sourceLayer:"",S=m._geojsonTileLayer||m[y];if(!S)return;const C=c.a7(h&&h.filter),{z:M,x:D,y:O}=this.tileID.canonical,L={z:M,x:D,y:O};for(let U=0;U<S.length;U++){const Z=S.feature(U);if(C.needGeometry){const re=c.a8(Z,!0);if(!C.filter(new c.z(this.tileID.overscaledZ),re,this.tileID.canonical))continue}else if(!C.filter(new c.z(this.tileID.overscaledZ),Z))continue;const G=f.getId(Z,y),te=new c.a9(Z,M,D,O,G);te.tile=L,i.push(te)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const h=this.expirationTime;if(i.cacheControl){const f=c.aa(i.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const f=Date.now();let m=!1;if(this.expirationTime>f)m=!1;else if(h)if(this.expirationTime<h)m=!0;else{const y=this.expirationTime-h;y?this.expirationTime=f+Math.max(y,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(i,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(i).length===0)return;const f=this.latestFeatureIndex.loadVTLayers();for(const m in this.buckets){if(!h.style.hasLayer(m))continue;const y=this.buckets[m],S=y.layers[0].sourceLayer||"_geojsonTileLayer",C=f[S],M=i[S];if(!C||!M||Object.keys(M).length===0)continue;y.update(M,C,this.imageAtlas&&this.imageAtlas.patternPositions||{});const D=h&&h.style&&h.style.getLayer(m);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<P.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=P.now()+i}setDependencies(i,h){const f={};for(const m of h)f[m]=!0;this.dependencies[i]=f}hasDependency(i,h){for(const f of i){const m=this.dependencies[f];if(m){for(const y of h)if(m[y])return!0}}return!1}}class Fe{constructor(i,h){this.max=i,this.onRemove=h,this.reset()}reset(){for(const i in this.data)for(const h of this.data[i])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(i,h,f){const m=i.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const y={value:h,timeout:void 0};if(f!==void 0&&(y.timeout=setTimeout(()=>{this.remove(i,y)},f)),this.data[m].push(y),this.order.push(m),this.order.length>this.max){const S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const h=this.data[i].shift();return h.timeout&&clearTimeout(h.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),h.value}getByKey(i){const h=this.data[i];return h?h[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,h){if(!this.has(i))return this;const f=i.wrapped().key,m=h===void 0?0:this.data[f].indexOf(h),y=this.data[f][m];return this.data[f].splice(m,1),y.timeout&&clearTimeout(y.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(y.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(i){const h=[];for(const f in this.data)for(const m of this.data[f])i(m.value)||h.push(m);for(const f of h)this.remove(f.value.tileID,f)}}class bt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,h,f){const m=String(h);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][m]=this.stateChanges[i][m]||{},c.e(this.stateChanges[i][m],f),this.deletedStates[i]===null){this.deletedStates[i]={};for(const y in this.state[i])y!==m&&(this.deletedStates[i][y]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][m]===null){this.deletedStates[i][m]={};for(const y in this.state[i][m])f[y]||(this.deletedStates[i][m][y]=null)}else for(const y in f)this.deletedStates[i]&&this.deletedStates[i][m]&&this.deletedStates[i][m][y]===null&&delete this.deletedStates[i][m][y]}removeFeatureState(i,h,f){if(this.deletedStates[i]===null)return;const m=String(h);if(this.deletedStates[i]=this.deletedStates[i]||{},f&&h!==void 0)this.deletedStates[i][m]!==null&&(this.deletedStates[i][m]=this.deletedStates[i][m]||{},this.deletedStates[i][m][f]=null);else if(h!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][m])for(f in this.deletedStates[i][m]={},this.stateChanges[i][m])this.deletedStates[i][m][f]=null;else this.deletedStates[i][m]=null;else this.deletedStates[i]=null}getState(i,h){const f=String(h),m=c.e({},(this.state[i]||{})[f],(this.stateChanges[i]||{})[f]);if(this.deletedStates[i]===null)return{};if(this.deletedStates[i]){const y=this.deletedStates[i][h];if(y===null)return{};for(const S in y)delete m[S]}return m}initializeTileState(i,h){i.setFeatureState(this.state,h)}coalesceChanges(i,h){const f={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const y={};for(const S in this.stateChanges[m])this.state[m][S]||(this.state[m][S]={}),c.e(this.state[m][S],this.stateChanges[m][S]),y[S]=this.state[m][S];f[m]=y}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const y={};if(this.deletedStates[m]===null)for(const S in this.state[m])y[S]={},this.state[m][S]={};else for(const S in this.deletedStates[m]){if(this.deletedStates[m][S]===null)this.state[m][S]={};else for(const C of Object.keys(this.deletedStates[m][S]))delete this.state[m][S][C];y[S]=this.state[m][S]}f[m]=f[m]||{},c.e(f[m],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(const m in i)i[m].setFeatureState(f,h)}}class ut extends c.E{constructor(i,h,f){super(),this.id=i,this.dispatcher=f,this.on("data",m=>this._dataHandler(m)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((m,y,S,C)=>{const M=new(tl(y.type))(m,y,S,C);if(M.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${M.id}`);return M})(i,h,f,this),this._tiles={},this._cache=new Fe(0,m=>this._unloadTile(m)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new bt,this._didEmitContent=!1,this._updated=!1}onAdd(i){this.map=i,this._maxTileCacheSize=i?i._maxTileCacheSize:null,this._maxTileCacheZoomLevels=i?i._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(i)}onRemove(i){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(i)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const i in this._tiles){const h=this._tiles[i];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(i,h,f){return c._(this,void 0,void 0,function*(){try{yield this._source.loadTile(i),this._tileLoaded(i,h,f)}catch(m){i.state="errored",m.status!==404?this._source.fire(new c.j(m,{tile:i})):this.update(this.transform,this.terrain)}})}_unloadTile(i){this._source.unloadTile&&this._source.unloadTile(i)}_abortTile(i){this._source.abortTile&&this._source.abortTile(i),this._source.fire(new c.k("dataabort",{tile:i,coord:i.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const f=this._tiles[h];f.upload(i),f.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(i=>i.tileID).sort(xi).map(i=>i.key)}getRenderableIds(i){const h=[];for(const f in this._tiles)this._isIdRenderable(f,i)&&h.push(this._tiles[f]);return i?h.sort((f,m)=>{const y=f.tileID,S=m.tileID,C=new c.P(y.canonical.x,y.canonical.y)._rotate(this.transform.angle),M=new c.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle);return y.overscaledZ-S.overscaledZ||M.y-C.y||M.x-C.x}).map(f=>f.tileID.key):h.map(f=>f.tileID).sort(xi).map(f=>f.key)}hasRenderableParent(i){const h=this.findLoadedParent(i,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(i,h){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(h||!this._tiles[i].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)this._tiles[i].state!=="errored"&&this._reloadTile(i,"reloading")}}_reloadTile(i,h){return c._(this,void 0,void 0,function*(){const f=this._tiles[i];f&&(f.state!=="loading"&&(f.state=h),yield this._loadTile(f,i,h))})}_tileLoaded(i,h,f){i.timeAdded=P.now(),f==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(h,i),this.getSource().type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),i.aborted||this._source.fire(new c.k("data",{dataType:"source",tile:i,coord:i.tileID}))}_backfillDEM(i){const h=this.getRenderableIds();for(let m=0;m<h.length;m++){const y=h[m];if(i.neighboringTiles&&i.neighboringTiles[y]){const S=this.getTileByID(y);f(i,S),f(S,i)}}function f(m,y){m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let S=y.tileID.canonical.x-m.tileID.canonical.x;const C=y.tileID.canonical.y-m.tileID.canonical.y,M=Math.pow(2,m.tileID.canonical.z),D=y.tileID.key;S===0&&C===0||Math.abs(C)>1||(Math.abs(S)>1&&(Math.abs(S+M)===1?S+=M:Math.abs(S-M)===1&&(S-=M)),y.dem&&m.dem&&(m.dem.backfillBorder(y.dem,S,C),m.neighboringTiles&&m.neighboringTiles[D]&&(m.neighboringTiles[D].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,h,f,m){for(const y in this._tiles){let S=this._tiles[y];if(m[y]||!S.hasData()||S.tileID.overscaledZ<=h||S.tileID.overscaledZ>f)continue;let C=S.tileID;for(;S&&S.tileID.overscaledZ>h+1;){const D=S.tileID.scaledTo(S.tileID.overscaledZ-1);S=this._tiles[D.key],S&&S.hasData()&&(C=D)}let M=C;for(;M.overscaledZ>h;)if(M=M.scaledTo(M.overscaledZ-1),i[M.key]){m[C.key]=C;break}}}findLoadedParent(i,h){if(i.key in this._loadedParentTiles){const f=this._loadedParentTiles[i.key];return f&&f.tileID.overscaledZ>=h?f:null}for(let f=i.overscaledZ-1;f>=h;f--){const m=i.scaledTo(f),y=this._getLoadedTile(m);if(y)return y}}findLoadedSibling(i){return this._getLoadedTile(i)}_getLoadedTile(i){const h=this._tiles[i.key];return h&&h.hasData()?h:this._cache.getByKey(i.wrapped().key)}updateCacheSize(i){const h=Math.ceil(i.width/this._source.tileSize)+1,f=Math.ceil(i.height/this._source.tileSize)+1,m=Math.floor(h*f*(this._maxTileCacheZoomLevels===null?c.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(y)}handleWrapJump(i){const h=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,h){const f={};for(const m in this._tiles){const y=this._tiles[m];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+h),f[y.tileID.key]=y}this._tiles=f;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(m,this._tiles[m])}}_updateCoveredAndRetainedTiles(i,h,f,m,y,S){const C={},M={},D=Object.keys(i),O=P.now();for(const L of D){const U=i[L],Z=this._tiles[L];if(!Z||Z.fadeEndTime!==0&&Z.fadeEndTime<=O)continue;const G=this.findLoadedParent(U,h),te=this.findLoadedSibling(U),re=G||te||null;re&&(this._addTile(re.tileID),C[re.tileID.key]=re.tileID),M[L]=U}this._retainLoadedChildren(M,m,f,i);for(const L in C)i[L]||(this._coveredTiles[L]=!0,i[L]=C[L]);if(S){const L={},U={};for(const Z of y)this._tiles[Z.key].hasData()?L[Z.key]=Z:U[Z.key]=Z;for(const Z in U){const G=U[Z].children(this._source.maxzoom);this._tiles[G[0].key]&&this._tiles[G[1].key]&&this._tiles[G[2].key]&&this._tiles[G[3].key]&&(L[G[0].key]=i[G[0].key]=G[0],L[G[1].key]=i[G[1].key]=G[1],L[G[2].key]=i[G[2].key]=G[2],L[G[3].key]=i[G[3].key]=G[3],delete U[Z])}for(const Z in U){const G=U[Z],te=this.findLoadedParent(G,this._source.minzoom),re=this.findLoadedSibling(G),se=te||re||null;if(se){L[se.tileID.key]=i[se.tileID.key]=se.tileID;for(const ae in L)L[ae].isChildOf(se.tileID)&&delete L[ae]}}for(const Z in this._tiles)L[Z]||(this._coveredTiles[Z]=!0)}}update(i,h){if(!this._sourceLoaded||this._paused)return;let f;this.transform=i,this.terrain=h,this.updateCacheSize(i),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(O=>new c.S(O.canonical.z,O.wrap,O.canonical.z,O.canonical.x,O.canonical.y)):(f=i.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h}),this._source.hasTile&&(f=f.filter(O=>this._source.hasTile(O)))):f=[];const m=i.coveringZoomLevel(this._source),y=Math.max(m-ut.maxOverzooming,this._source.minzoom),S=Math.max(m+ut.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const O={};for(const L of f)if(L.canonical.z>this._source.minzoom){const U=L.scaledTo(L.canonical.z-1);O[U.key]=U;const Z=L.scaledTo(Math.max(this._source.minzoom,Math.min(L.canonical.z,5)));O[Z.key]=Z}f=f.concat(Object.values(O))}const C=f.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,C&&this.fire(new c.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const M=this._updateRetainedTiles(f,m);br(this._source.type)&&this._updateCoveredAndRetainedTiles(M,y,S,m,f,h);for(const O in M)this._tiles[O].clearFadeHold();const D=c.ab(this._tiles,M);for(const O of D){const L=this._tiles[O];L.hasSymbolBuckets&&!L.holdingForFade()?L.setHoldDuration(this.map._fadeDuration):L.hasSymbolBuckets&&!L.symbolFadeFinished()||this._removeTile(O)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(i)}_updateRetainedTiles(i,h){var f;const m={},y={},S=Math.max(h-ut.maxOverzooming,this._source.minzoom),C=Math.max(h+ut.maxUnderzooming,this._source.minzoom),M={};for(const D of i){const O=this._addTile(D);m[D.key]=D,O.hasData()||h<this._source.maxzoom&&(M[D.key]=D)}this._retainLoadedChildren(M,h,C,m);for(const D of i){let O=this._tiles[D.key];if(O.hasData())continue;if(h+1>this._source.maxzoom){const U=D.children(this._source.maxzoom)[0],Z=this.getTile(U);if(Z&&Z.hasData()){m[U.key]=U;continue}}else{const U=D.children(this._source.maxzoom);if(m[U[0].key]&&m[U[1].key]&&m[U[2].key]&&m[U[3].key])continue}let L=O.wasRequested();for(let U=D.overscaledZ-1;U>=S;--U){const Z=D.scaledTo(U);if(y[Z.key])break;if(y[Z.key]=!0,O=this.getTile(Z),!O&&L&&(O=this._addTile(Z)),O){const G=O.hasData();if((G||!(!((f=this.map)===null||f===void 0)&&f.cancelPendingTileRequestsWhileZooming)||L)&&(m[Z.key]=Z),L=O.wasRequested(),G)break}}}return m}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const h=[];let f,m=this._tiles[i].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){f=this._loadedParentTiles[m.key];break}h.push(m.key);const y=m.scaledTo(m.overscaledZ-1);if(f=this._getLoadedTile(y),f)break;m=y}for(const y of h)this._loadedParentTiles[y]=f}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const i in this._tiles){const h=this._tiles[i].tileID,f=this._getLoadedTile(h);this._loadedSiblingTiles[h.key]=f}}_addTile(i){let h=this._tiles[i.key];if(h)return h;h=this._cache.getAndRemove(i),h&&(this._setTileReloadTimer(i.key,h),h.tileID=i,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,h)));const f=h;return h||(h=new zs(i,this._source.tileSize*i.overscaleFactor()),this._loadTile(h,i.key,h.state)),h.uses++,this._tiles[i.key]=h,f||this._source.fire(new c.k("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(i,h){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const f=h.getExpiryTimeout();f&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},f))}_removeTile(i){const h=this._tiles[i];h&&(h.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}_dataHandler(i){const h=i.sourceDataType;i.dataType==="source"&&h==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&i.dataType==="source"&&h==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(i);this._cache.reset()}tilesIn(i,h,f){const m=[],y=this.transform;if(!y)return m;const S=f?y.getCameraQueryGeometry(i):i,C=i.map(G=>y.pointCoordinate(G,this.terrain)),M=S.map(G=>y.pointCoordinate(G,this.terrain)),D=this.getIds();let O=1/0,L=1/0,U=-1/0,Z=-1/0;for(const G of M)O=Math.min(O,G.x),L=Math.min(L,G.y),U=Math.max(U,G.x),Z=Math.max(Z,G.y);for(let G=0;G<D.length;G++){const te=this._tiles[D[G]];if(te.holdingForFade())continue;const re=te.tileID,se=Math.pow(2,y.zoom-te.tileID.overscaledZ),ae=h*te.queryPadding*c.X/te.tileSize/se,Y=[re.getTilePoint(new c.Z(O,L)),re.getTilePoint(new c.Z(U,Z))];if(Y[0].x-ae<c.X&&Y[0].y-ae<c.X&&Y[1].x+ae>=0&&Y[1].y+ae>=0){const de=C.map(_e=>re.getTilePoint(_e)),fe=M.map(_e=>re.getTilePoint(_e));m.push({tile:te,tileID:re,queryGeometry:de,cameraQueryGeometry:fe,scale:se})}}return m}getVisibleCoordinates(i){const h=this.getRenderableIds(i).map(f=>this._tiles[f].tileID);for(const f of h)f.posMatrix=this.transform.calculatePosMatrix(f.toUnwrapped());return h}hasTransition(){if(this._source.hasTransition())return!0;if(br(this._source.type)){const i=P.now();for(const h in this._tiles)if(this._tiles[h].fadeEndTime>=i)return!0}return!1}setFeatureState(i,h,f){this._state.updateState(i=i||"_geojsonTileLayer",h,f)}removeFeatureState(i,h,f){this._state.removeFeatureState(i=i||"_geojsonTileLayer",h,f)}getFeatureState(i,h){return this._state.getState(i=i||"_geojsonTileLayer",h)}setDependencies(i,h,f){const m=this._tiles[i];m&&m.setDependencies(h,f)}reloadTilesForDependencies(i,h){for(const f in this._tiles)this._tiles[f].hasDependency(i,h)&&this._reloadTile(f,"reloading");this._cache.filter(f=>!f.hasDependency(i,h))}}function xi(_,i){const h=Math.abs(2*_.wrap)-+(_.wrap<0),f=Math.abs(2*i.wrap)-+(i.wrap<0);return _.overscaledZ-i.overscaledZ||f-h||i.canonical.y-_.canonical.y||i.canonical.x-_.canonical.x}function br(_){return _==="raster"||_==="image"||_==="video"}ut.maxOverzooming=10,ut.maxUnderzooming=3;class _t{constructor(i,h){this.reset(i,h)}reset(i,h){this.points=i||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=c.ac(i,0,1);let h=1,f=this._distances[h];const m=i*this.paddedLength+this.padding;for(;f<m&&h<this._distances.length;)f=this._distances[++h];const y=h-1,S=this._distances[y],C=f-S,M=C>0?(m-S)/C:0;return this.points[y].mult(1-M).add(this.points[h].mult(M))}}function Zr(_,i){let h=!0;return _==="always"||_!=="never"&&i!=="never"||(h=!1),h}class ds{constructor(i,h,f){const m=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(i/f),this.yCellCount=Math.ceil(h/f);for(let S=0;S<this.xCellCount*this.yCellCount;S++)m.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=h,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,h,f,m,y){this._forEachCell(h,f,m,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(h),this.bboxes.push(f),this.bboxes.push(m),this.bboxes.push(y)}insertCircle(i,h,f,m){this._forEachCell(h-m,f-m,h+m,f+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(h),this.circles.push(f),this.circles.push(m)}_insertBoxCell(i,h,f,m,y,S){this.boxCells[y].push(S)}_insertCircleCell(i,h,f,m,y,S){this.circleCells[y].push(S)}_query(i,h,f,m,y,S,C){if(f<0||i>this.width||m<0||h>this.height)return[];const M=[];if(i<=0&&h<=0&&this.width<=f&&this.height<=m){if(y)return[{key:null,x1:i,y1:h,x2:f,y2:m}];for(let D=0;D<this.boxKeys.length;D++)M.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(let D=0;D<this.circleKeys.length;D++){const O=this.circles[3*D],L=this.circles[3*D+1],U=this.circles[3*D+2];M.push({key:this.circleKeys[D],x1:O-U,y1:L-U,x2:O+U,y2:L+U})}}else this._forEachCell(i,h,f,m,this._queryCell,M,{hitTest:y,overlapMode:S,seenUids:{box:{},circle:{}}},C);return M}query(i,h,f,m){return this._query(i,h,f,m,!1,null)}hitTest(i,h,f,m,y,S){return this._query(i,h,f,m,!0,y,S).length>0}hitTestCircle(i,h,f,m,y){const S=i-f,C=i+f,M=h-f,D=h+f;if(C<0||S>this.width||D<0||M>this.height)return!1;const O=[];return this._forEachCell(S,M,C,D,this._queryCellCircle,O,{hitTest:!0,overlapMode:m,circle:{x:i,y:h,radius:f},seenUids:{box:{},circle:{}}},y),O.length>0}_queryCell(i,h,f,m,y,S,C,M){const{seenUids:D,hitTest:O,overlapMode:L}=C,U=this.boxCells[y];if(U!==null){const G=this.bboxes;for(const te of U)if(!D.box[te]){D.box[te]=!0;const re=4*te,se=this.boxKeys[te];if(i<=G[re+2]&&h<=G[re+3]&&f>=G[re+0]&&m>=G[re+1]&&(!M||M(se))&&(!O||!Zr(L,se.overlapMode))&&(S.push({key:se,x1:G[re],y1:G[re+1],x2:G[re+2],y2:G[re+3]}),O))return!0}}const Z=this.circleCells[y];if(Z!==null){const G=this.circles;for(const te of Z)if(!D.circle[te]){D.circle[te]=!0;const re=3*te,se=this.circleKeys[te];if(this._circleAndRectCollide(G[re],G[re+1],G[re+2],i,h,f,m)&&(!M||M(se))&&(!O||!Zr(L,se.overlapMode))){const ae=G[re],Y=G[re+1],de=G[re+2];if(S.push({key:se,x1:ae-de,y1:Y-de,x2:ae+de,y2:Y+de}),O)return!0}}}return!1}_queryCellCircle(i,h,f,m,y,S,C,M){const{circle:D,seenUids:O,overlapMode:L}=C,U=this.boxCells[y];if(U!==null){const G=this.bboxes;for(const te of U)if(!O.box[te]){O.box[te]=!0;const re=4*te,se=this.boxKeys[te];if(this._circleAndRectCollide(D.x,D.y,D.radius,G[re+0],G[re+1],G[re+2],G[re+3])&&(!M||M(se))&&!Zr(L,se.overlapMode))return S.push(!0),!0}}const Z=this.circleCells[y];if(Z!==null){const G=this.circles;for(const te of Z)if(!O.circle[te]){O.circle[te]=!0;const re=3*te,se=this.circleKeys[te];if(this._circlesCollide(G[re],G[re+1],G[re+2],D.x,D.y,D.radius)&&(!M||M(se))&&!Zr(L,se.overlapMode))return S.push(!0),!0}}}_forEachCell(i,h,f,m,y,S,C,M){const D=this._convertToXCellCoord(i),O=this._convertToYCellCoord(h),L=this._convertToXCellCoord(f),U=this._convertToYCellCoord(m);for(let Z=D;Z<=L;Z++)for(let G=O;G<=U;G++)if(y.call(this,i,h,f,m,this.xCellCount*G+Z,S,C,M))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,h,f,m,y,S){const C=m-i,M=y-h,D=f+S;return D*D>C*C+M*M}_circleAndRectCollide(i,h,f,m,y,S,C){const M=(S-m)/2,D=Math.abs(i-(m+M));if(D>M+f)return!1;const O=(C-y)/2,L=Math.abs(h-(y+O));if(L>O+f)return!1;if(D<=M||L<=O)return!0;const U=D-M,Z=L-O;return U*U+Z*Z<=f*f}}function Ds(_,i,h,f,m){const y=c.H();return i?(c.K(y,y,[1/m,1/m,1]),h||c.ad(y,y,f.angle)):c.L(y,f.labelPlaneMatrix,_),y}function Wr(_,i,h,f,m){if(i){const y=c.ae(_);return c.K(y,y,[m,m,1]),h||c.ad(y,y,-f.angle),y}return f.glCoordMatrix}function ne(_,i,h,f){let m;f?(m=[_,i,f(_,i),1],c.af(m,m,h)):(m=[_,i,0,1],Dt(m,m,h));const y=m[3];return{point:new c.P(m[0]/y,m[1]/y),signedDistanceFromCamera:y,isOccluded:!1}}function N(_,i){return .5+_/i*.5}function F(_,i){return _.x>=-i[0]&&_.x<=i[0]&&_.y>=-i[1]&&_.y<=i[1]}function W(_,i,h,f,m,y,S,C,M,D,O,L,U,Z,G){const te=f?_.textSizeData:_.iconSizeData,re=c.ag(te,h.transform.zoom),se=[256/h.width*2+1,256/h.height*2+1],ae=f?_.text.dynamicLayoutVertexArray:_.icon.dynamicLayoutVertexArray;ae.clear();const Y=_.lineVertexArray,de=f?_.text.placedSymbolArray:_.icon.placedSymbolArray,fe=h.transform.width/h.transform.height;let _e=!1;for(let Te=0;Te<de.length;Te++){const Pe=de.get(Te);if(Pe.hidden||Pe.writingMode===c.ah.vertical&&!_e){at(Pe.numGlyphs,ae);continue}_e=!1;const $e=ne(Pe.anchorX,Pe.anchorY,i,G);if(!F($e.point,se)){at(Pe.numGlyphs,ae);continue}const He=N(h.transform.cameraToCenterDistance,$e.signedDistanceFromCamera),Be=c.ai(te,re,Pe),Le=S?Be/He:Be*He,Ye={getElevation:G,labelPlaneMatrix:m,lineVertexArray:Y,pitchWithMap:S,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:D,tileAnchorPoint:new c.P(Pe.anchorX,Pe.anchorY),unwrappedTileID:O,width:L,height:U,translation:Z},pt=pe(Ye,Pe,Le,!1,C,i,y,_.glyphOffsetArray,ae,fe,M);_e=pt.useVertical,(pt.notEnoughRoom||_e||pt.needsFlipping&&pe(Ye,Pe,Le,!0,C,i,y,_.glyphOffsetArray,ae,fe,M).notEnoughRoom)&&at(Pe.numGlyphs,ae)}f?_.text.dynamicLayoutVertexBuffer.updateData(ae):_.icon.dynamicLayoutVertexBuffer.updateData(ae)}function ee(_,i,h,f,m,y,S,C){const M=y.glyphStartIndex+y.numGlyphs,D=y.lineStartIndex,O=y.lineStartIndex+y.lineLength,L=i.getoffsetX(y.glyphStartIndex),U=i.getoffsetX(M-1),Z=Oe(_*L,h,f,m,y.segment,D,O,C,S);if(!Z)return null;const G=Oe(_*U,h,f,m,y.segment,D,O,C,S);return G?C.projectionCache.anyProjectionOccluded?null:{first:Z,last:G}:null}function ue(_,i,h,f){return _===c.ah.horizontal&&Math.abs(h.y-i.y)>Math.abs(h.x-i.x)*f?{useVertical:!0}:(_===c.ah.vertical?i.y<h.y:i.x>h.x)?{needsFlipping:!0}:null}function pe(_,i,h,f,m,y,S,C,M,D,O){const L=h/24,U=i.lineOffsetX*L,Z=i.lineOffsetY*L;let G;if(i.numGlyphs>1){const te=i.glyphStartIndex+i.numGlyphs,re=i.lineStartIndex,se=i.lineStartIndex+i.lineLength,ae=ee(L,C,U,Z,f,i,O,_);if(!ae)return{notEnoughRoom:!0};const Y=ne(ae.first.point.x,ae.first.point.y,S,_.getElevation).point,de=ne(ae.last.point.x,ae.last.point.y,S,_.getElevation).point;if(m&&!f){const fe=ue(i.writingMode,Y,de,D);if(fe)return fe}G=[ae.first];for(let fe=i.glyphStartIndex+1;fe<te-1;fe++)G.push(Oe(L*C.getoffsetX(fe),U,Z,f,i.segment,re,se,_,O));G.push(ae.last)}else{if(m&&!f){const re=ne(_.tileAnchorPoint.x,_.tileAnchorPoint.y,y,_.getElevation).point,se=i.lineStartIndex+i.segment+1,ae=new c.P(_.lineVertexArray.getx(se),_.lineVertexArray.gety(se)),Y=ne(ae.x,ae.y,y,_.getElevation),de=Y.signedDistanceFromCamera>0?Y.point:function(_e,Te,Pe,$e,He,Be){return ge(_e,Te,Pe,1,He,Be)}(_.tileAnchorPoint,ae,re,0,y,_),fe=ue(i.writingMode,re,de,D);if(fe)return fe}const te=Oe(L*C.getoffsetX(i.glyphStartIndex),U,Z,f,i.segment,i.lineStartIndex,i.lineStartIndex+i.lineLength,_,O);if(!te||_.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};G=[te]}for(const te of G)c.aj(M,te.point,te.angle);return{}}function ge(_,i,h,f,m,y){const S=_.add(_.sub(i)._unit()),C=m!==void 0?ne(S.x,S.y,m,y.getElevation).point:be(S.x,S.y,y).point,M=h.sub(C);return h.add(M._mult(f/M.mag()))}function oe(_,i,h){const f=i.projectionCache;if(f.projections[_])return f.projections[_];const m=new c.P(i.lineVertexArray.getx(_),i.lineVertexArray.gety(_)),y=be(m.x,m.y,i);if(y.signedDistanceFromCamera>0)return f.projections[_]=y.point,f.anyProjectionOccluded=f.anyProjectionOccluded||y.isOccluded,y.point;const S=_-h.direction;return function(C,M,D,O,L){return ge(C,M,D,O,void 0,L)}(h.distanceFromAnchor===0?i.tileAnchorPoint:new c.P(i.lineVertexArray.getx(S),i.lineVertexArray.gety(S)),m,h.previousVertex,h.absOffsetX-h.distanceFromAnchor+1,i)}function be(_,i,h){const f=_+h.translation[0],m=i+h.translation[1];let y;return!h.pitchWithMap&&h.projection.useSpecialProjectionForSymbols?(y=h.projection.projectTileCoordinates(f,m,h.unwrappedTileID,h.getElevation),y.point.x=(.5*y.point.x+.5)*h.width,y.point.y=(.5*-y.point.y+.5)*h.height):(y=ne(f,m,h.labelPlaneMatrix,h.getElevation),y.isOccluded=!1),y}function Ce(_,i,h){return _._unit()._perp()._mult(i*h)}function ve(_,i,h,f,m,y,S,C,M){if(C.projectionCache.offsets[_])return C.projectionCache.offsets[_];const D=h.add(i);if(_+M.direction<f||_+M.direction>=m)return C.projectionCache.offsets[_]=D,D;const O=oe(_+M.direction,C,M),L=Ce(O.sub(h),S,M.direction),U=h.add(L),Z=O.add(L);return C.projectionCache.offsets[_]=c.ak(y,D,U,Z)||D,C.projectionCache.offsets[_]}function Oe(_,i,h,f,m,y,S,C,M){const D=f?_-i:_+i;let O=D>0?1:-1,L=0;f&&(O*=-1,L=Math.PI),O<0&&(L+=Math.PI);let U,Z=O>0?y+m:y+m+1;C.projectionCache.cachedAnchorPoint?U=C.projectionCache.cachedAnchorPoint:(U=be(C.tileAnchorPoint.x,C.tileAnchorPoint.y,C).point,C.projectionCache.cachedAnchorPoint=U);let G,te,re=U,se=U,ae=0,Y=0;const de=Math.abs(D),fe=[];let _e;for(;ae+Y<=de;){if(Z+=O,Z<y||Z>=S)return null;ae+=Y,se=re,te=G;const $e={absOffsetX:de,direction:O,distanceFromAnchor:ae,previousVertex:se};if(re=oe(Z,C,$e),h===0)fe.push(se),_e=re.sub(se);else{let He;const Be=re.sub(se);He=Be.mag()===0?Ce(oe(Z+O,C,$e).sub(re),h,O):Ce(Be,h,O),te||(te=se.add(He)),G=ve(Z,He,re,y,S,te,h,C,$e),fe.push(te),_e=G.sub(te)}Y=_e.mag()}const Te=_e._mult((de-ae)/Y)._add(te||se),Pe=L+Math.atan2(re.y-se.y,re.x-se.x);return fe.push(Te),{point:Te,angle:M?Pe:0,path:fe}}const rt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function at(_,i){for(let h=0;h<_;h++){const f=i.length;i.resize(f+4),i.float32.set(rt,3*f)}}function Dt(_,i,h){const f=i[0],m=i[1];return _[0]=h[0]*f+h[4]*m+h[12],_[1]=h[1]*f+h[5]*m+h[13],_[3]=h[3]*f+h[7]*m+h[15],_}const vt=100;class Rt{constructor(i,h,f=new ds(i.width+200,i.height+200,25),m=new ds(i.width+200,i.height+200,25)){this.transform=i,this.mapProjection=h,this.grid=f,this.ignoredGrid=m,this.pitchFactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+vt,this.screenBottomBoundary=i.height+vt,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(i,h,f,m,y,S,C,M,D,O,L){const U=i.anchorPointX+M[0],Z=i.anchorPointY+M[1],G=this.projectAndGetPerspectiveRatio(m,U,Z,y,O),te=f*G.perspectiveRatio;let re;if(S||C)re=this._projectCollisionBox(i,te,m,y,S,C,M,G,O,L);else{const fe=G.point.x+(L?L.x*te:0),_e=G.point.y+(L?L.y*te:0);re={allPointsOccluded:!1,box:[fe+i.x1*te,_e+i.y1*te,fe+i.x2*te,_e+i.y2*te]}}const[se,ae,Y,de]=re.box;return this.mapProjection.useSpecialProjectionForSymbols&&(S?re.allPointsOccluded:this.mapProjection.isOccluded(U,Z,y))||G.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(se,ae,Y,de)||h!=="always"&&this.grid.hitTest(se,ae,Y,de,h,D)?{box:[se,ae,Y,de],placeable:!1,offscreen:!1}:{box:[se,ae,Y,de],placeable:!0,offscreen:this.isOffscreen(se,ae,Y,de)}}placeCollisionCircles(i,h,f,m,y,S,C,M,D,O,L,U,Z,G,te,re){const se=[],ae=new c.P(h.anchorX,h.anchorY),Y=this.getPerspectiveRatio(S,ae.x,ae.y,C,re),de=(L?y/Y:y*Y)/c.ap,fe={getElevation:re,labelPlaneMatrix:M,lineVertexArray:f,pitchWithMap:L,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:ae,unwrappedTileID:C,width:this.transform.width,height:this.transform.height,translation:te},_e=ee(de,m,h.lineOffsetX*de,h.lineOffsetY*de,!1,h,!1,fe);let Te=!1,Pe=!1,$e=!0;if(_e){const He=.5*Z*Y+G,Be=new c.P(-100,-100),Le=new c.P(this.screenRightBoundary,this.screenBottomBoundary),Ye=new _t,pt=_e.first,Ne=_e.last;let Ue=[];for(let wt=pt.path.length-1;wt>=1;wt--)Ue.push(pt.path[wt]);for(let wt=1;wt<Ne.path.length;wt++)Ue.push(Ne.path[wt]);const ht=2.5*He;if(D){const wt=this.projectPathToScreenSpace(Ue,fe,D);Ue=wt.some(Mt=>Mt.signedDistanceFromCamera<=0)?[]:wt.map(Mt=>Mt.point)}let Qt=[];if(Ue.length>0){const wt=Ue[0].clone(),Mt=Ue[0].clone();for(let en=1;en<Ue.length;en++)wt.x=Math.min(wt.x,Ue[en].x),wt.y=Math.min(wt.y,Ue[en].y),Mt.x=Math.max(Mt.x,Ue[en].x),Mt.y=Math.max(Mt.y,Ue[en].y);Qt=wt.x>=Be.x&&Mt.x<=Le.x&&wt.y>=Be.y&&Mt.y<=Le.y?[Ue]:Mt.x<Be.x||wt.x>Le.x||Mt.y<Be.y||wt.y>Le.y?[]:c.al([Ue],Be.x,Be.y,Le.x,Le.y)}for(const wt of Qt){Ye.reset(wt,.25*He);let Mt=0;Mt=Ye.length<=.5*He?1:Math.ceil(Ye.paddedLength/ht)+1;for(let en=0;en<Mt;en++){const Zn=en/Math.max(Mt-1,1),Er=Ye.lerp(Zn),tn=Er.x+vt,Si=Er.y+vt;se.push(tn,Si,He,0);const ai=tn-He,Wn=Si-He,li=tn+He,Jr=Si+He;if($e=$e&&this.isOffscreen(ai,Wn,li,Jr),Pe=Pe||this.isInsideGrid(ai,Wn,li,Jr),i!=="always"&&this.grid.hitTestCircle(tn,Si,He,i,U)&&(Te=!0,!O))return{circles:[],offscreen:!1,collisionDetected:Te}}}}return{circles:!O&&Te||!Pe||Y<this.perspectiveRatioCutoff?[]:se,offscreen:$e,collisionDetected:Te}}projectPathToScreenSpace(i,h,f){return i.map(m=>ne(m.x,m.y,f,h.getElevation))}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let f=1/0,m=1/0,y=-1/0,S=-1/0;for(const O of i){const L=new c.P(O.x+vt,O.y+vt);f=Math.min(f,L.x),m=Math.min(m,L.y),y=Math.max(y,L.x),S=Math.max(S,L.y),h.push(L)}const C=this.grid.query(f,m,y,S).concat(this.ignoredGrid.query(f,m,y,S)),M={},D={};for(const O of C){const L=O.key;if(M[L.bucketInstanceId]===void 0&&(M[L.bucketInstanceId]={}),M[L.bucketInstanceId][L.featureIndex])continue;const U=[new c.P(O.x1,O.y1),new c.P(O.x2,O.y1),new c.P(O.x2,O.y2),new c.P(O.x1,O.y2)];c.am(h,U)&&(M[L.bucketInstanceId][L.featureIndex]=!0,D[L.bucketInstanceId]===void 0&&(D[L.bucketInstanceId]=[]),D[L.bucketInstanceId].push(L.featureIndex))}return D}insertCollisionBox(i,h,f,m,y,S){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:y,collisionGroupID:S,overlapMode:h},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,h,f,m,y,S){const C=f?this.ignoredGrid:this.grid,M={bucketInstanceId:m,featureIndex:y,collisionGroupID:S,overlapMode:h};for(let D=0;D<i.length;D+=4)C.insertCircle(M,i[D],i[D+1],i[D+2])}projectAndGetPerspectiveRatio(i,h,f,m,y){let S;y?(S=[h,f,y(h,f),1],c.af(S,S,i)):(S=[h,f,0,1],Dt(S,S,i));const C=S[3];return{point:new c.P((S[0]/C+1)/2*this.transform.width+vt,(-S[1]/C+1)/2*this.transform.height+vt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/C*.5,isOccluded:!1,signedDistanceFromCamera:C}}getPerspectiveRatio(i,h,f,m,y){const S=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(h,f,m,y):ne(h,f,i,y);return .5+this.transform.cameraToCenterDistance/S.signedDistanceFromCamera*.5}isOffscreen(i,h,f,m){return f<vt||i>=this.screenRightBoundary||m<vt||h>this.screenBottomBoundary}isInsideGrid(i,h,f,m){return f>=0&&i<this.gridRightBoundary&&m>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const i=c.an([]);return c.J(i,i,[-100,-100,0]),i}_projectCollisionBox(i,h,f,m,y,S,C,M,D,O){let L=new c.P(1,0),U=new c.P(0,1);const Z=new c.P(i.anchorPointX+C[0],i.anchorPointY+C[1]);if(S&&!y){const $e=this.projectAndGetPerspectiveRatio(f,Z.x+1,Z.y,m,D).point.sub(M.point).unit(),He=Math.atan($e.y/$e.x)+($e.x<0?Math.PI:0),Be=Math.sin(He),Le=Math.cos(He);L=new c.P(Le,Be),U=new c.P(-Be,Le)}else if(!S&&y){const $e=-this.transform.angle,He=Math.sin($e),Be=Math.cos($e);L=new c.P(Be,He),U=new c.P(-He,Be)}let G=M.point,te=h;if(y){G=Z;const $e=this.transform.zoom-Math.floor(this.transform.zoom);te=Math.pow(2,-$e),te*=this.mapProjection.getPitchedTextCorrection(this.transform,Z,m),O||(te*=c.ac(.5+M.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}O&&(G=G.add(L.mult(O.x*te)).add(U.mult(O.y*te)));const re=i.x1*te,se=i.x2*te,ae=(re+se)/2,Y=i.y1*te,de=i.y2*te,fe=(Y+de)/2,_e=[{offsetX:re,offsetY:Y},{offsetX:ae,offsetY:Y},{offsetX:se,offsetY:Y},{offsetX:se,offsetY:fe},{offsetX:se,offsetY:de},{offsetX:ae,offsetY:de},{offsetX:re,offsetY:de},{offsetX:re,offsetY:fe}];let Te=[];for(const{offsetX:$e,offsetY:He}of _e)Te.push(new c.P(G.x+L.x*$e+U.x*He,G.y+L.y*$e+U.y*He));let Pe=!1;if(y){const $e=Te.map(He=>this.projectAndGetPerspectiveRatio(f,He.x,He.y,m,D));Pe=$e.some(He=>!He.isOccluded),Te=$e.map(He=>He.point)}else Pe=!0;return{box:c.ao(Te),allPointsOccluded:!Pe}}}function Ct(_,i,h){return i*(c.X/(_.tileSize*Math.pow(2,h-_.tileID.overscaledZ)))}class Sn{constructor(i,h,f,m){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?h:-h))):m&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class ln{constructor(i,h,f,m,y){this.text=new Sn(i?i.text:null,h,f,y),this.icon=new Sn(i?i.icon:null,h,m,y)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class St{constructor(i,h,f){this.text=i,this.icon=h,this.skipFade=f}}class Ut{constructor(){this.invProjMatrix=c.H(),this.viewportMatrix=c.H(),this.circles=[]}}class rn{constructor(i,h,f,m,y){this.bucketInstanceId=i,this.featureIndex=h,this.sourceLayerIndex=f,this.bucketIndex=m,this.tileID=y}}class zn{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const h=++this.maxGroupID;this.collisionGroups[i]={ID:h,predicate:f=>f.collisionGroupID===h}}return this.collisionGroups[i]}}function Nn(_,i,h,f,m){const{horizontalAlign:y,verticalAlign:S}=c.au(_);return new c.P(-(y-.5)*i+f[0]*m,-(S-.5)*h+f[1]*m)}class oi{constructor(i,h,f,m,y,S){this.transform=i.clone(),this.terrain=f,this.collisionIndex=new Rt(this.transform,h),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=m,this.retainedQueryData={},this.collisionGroups=new zn(y),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=S,S&&(S.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(i){const h=this.terrain;return h?(f,m)=>h.getElevation(i,f,m):null}getBucketParts(i,h,f,m){const y=f.getBucket(h),S=f.latestFeatureIndex;if(!y||!S||h.id!==y.layerIds[0])return;const C=f.collisionBoxArray,M=y.layers[0].layout,D=y.layers[0].paint,O=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),L=f.tileSize/c.X,U=f.tileID.toUnwrapped(),Z=this.transform.calculatePosMatrix(U),G=M.get("text-pitch-alignment")==="map",te=M.get("text-rotation-alignment")==="map",re=Ct(f,1,this.transform.zoom),se=this.collisionIndex.mapProjection.translatePosition(this.transform,f,D.get("text-translate"),D.get("text-translate-anchor")),ae=this.collisionIndex.mapProjection.translatePosition(this.transform,f,D.get("icon-translate"),D.get("icon-translate-anchor")),Y=Ds(Z,G,te,this.transform,re);let de=null;if(G){const _e=Wr(Z,G,te,this.transform,re);de=c.L([],this.transform.labelPlaneMatrix,_e)}this.retainedQueryData[y.bucketInstanceId]=new rn(y.bucketInstanceId,S,y.sourceLayerIndex,y.index,f.tileID);const fe={bucket:y,layout:M,translationText:se,translationIcon:ae,posMatrix:Z,unwrappedTileID:U,textLabelPlaneMatrix:Y,labelToScreenMatrix:de,scale:O,textPixelRatio:L,holdingForFade:f.holdingForFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:c.ag(y.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(m)for(const _e of y.sortKeyRanges){const{sortKey:Te,symbolInstanceStart:Pe,symbolInstanceEnd:$e}=_e;i.push({sortKey:Te,symbolInstanceStart:Pe,symbolInstanceEnd:$e,parameters:fe})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:fe})}attemptAnchorPlacement(i,h,f,m,y,S,C,M,D,O,L,U,Z,G,te,re,se,ae,Y){const de=c.aq[i.textAnchor],fe=[i.textOffset0,i.textOffset1],_e=Nn(de,f,m,fe,y),Te=this.collisionIndex.placeCollisionBox(h,U,M,D,O,C,S,re,L.predicate,Y,_e);if((!ae||this.collisionIndex.placeCollisionBox(ae,U,M,D,O,C,S,se,L.predicate,Y,_e).placeable)&&Te.placeable){let Pe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID].text&&(Pe=this.prevPlacement.variableOffsets[Z.crossTileID].anchor),Z.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Z.crossTileID]={textOffset:fe,width:f,height:m,anchor:de,textBoxScale:y,prevAnchor:Pe},this.markUsedJustification(G,de,Z,te),G.allowVerticalPlacement&&(this.markUsedOrientation(G,te,Z),this.placedOrientations[Z.crossTileID]=te),{shift:_e,placedGlyphBoxes:Te}}}placeLayerBucketPart(i,h,f){const{bucket:m,layout:y,translationText:S,translationIcon:C,posMatrix:M,unwrappedTileID:D,textLabelPlaneMatrix:O,labelToScreenMatrix:L,textPixelRatio:U,holdingForFade:Z,collisionBoxArray:G,partiallyEvaluatedTextSize:te,collisionGroup:re}=i.parameters,se=y.get("text-optional"),ae=y.get("icon-optional"),Y=c.ar(y,"text-overlap","text-allow-overlap"),de=Y==="always",fe=c.ar(y,"icon-overlap","icon-allow-overlap"),_e=fe==="always",Te=y.get("text-rotation-alignment")==="map",Pe=y.get("text-pitch-alignment")==="map",$e=y.get("icon-text-fit")!=="none",He=y.get("symbol-z-order")==="viewport-y",Be=de&&(_e||!m.hasIconData()||ae),Le=_e&&(de||!m.hasTextData()||se);!m.collisionArrays&&G&&m.deserializeCollisionBoxes(G);const Ye=this._getTerrainElevationFunc(this.retainedQueryData[m.bucketInstanceId].tileID),pt=(Ne,Ue,ht)=>{var Qt,wt;if(h[Ne.crossTileID])return;if(Z)return void(this.placements[Ne.crossTileID]=new St(!1,!1,!1));let Mt=!1,en=!1,Zn=!0,Er=null,tn={box:null,placeable:!1,offscreen:null},Si={box:null,placeable:!1,offscreen:null},ai=null,Wn=null,li=null,Jr=0,na=0,Oc=0;Ue.textFeatureIndex?Jr=Ue.textFeatureIndex:Ne.useRuntimeCollisionCircles&&(Jr=Ne.featureIndex),Ue.verticalTextFeatureIndex&&(na=Ue.verticalTextFeatureIndex);const ia=Ue.textBox;if(ia){const lr=Vn=>{let Gn=c.ah.horizontal;if(m.allowVerticalPlacement&&!Vn&&this.prevPlacement){const ji=this.prevPlacement.placedOrientations[Ne.crossTileID];ji&&(this.placedOrientations[Ne.crossTileID]=ji,Gn=ji,this.markUsedOrientation(m,Gn,Ne))}return Gn},cr=(Vn,Gn)=>{if(m.allowVerticalPlacement&&Ne.numVerticalGlyphVertices>0&&Ue.verticalTextBox){for(const ji of m.writingModes)if(ji===c.ah.vertical?(tn=Gn(),Si=tn):tn=Vn(),tn&&tn.placeable)break}else tn=Vn()},Ls=Ne.textAnchorOffsetStartIndex,Ir=Ne.textAnchorOffsetEndIndex;if(Ir===Ls){const Vn=(Gn,ji)=>{const Pt=this.collisionIndex.placeCollisionBox(Gn,Y,U,M,D,Pe,Te,S,re.predicate,Ye);return Pt&&Pt.placeable&&(this.markUsedOrientation(m,ji,Ne),this.placedOrientations[Ne.crossTileID]=ji),Pt};cr(()=>Vn(ia,c.ah.horizontal),()=>{const Gn=Ue.verticalTextBox;return m.allowVerticalPlacement&&Ne.numVerticalGlyphVertices>0&&Gn?Vn(Gn,c.ah.vertical):{box:null,offscreen:null}}),lr(tn&&tn.placeable)}else{let Vn=c.aq[(wt=(Qt=this.prevPlacement)===null||Qt===void 0?void 0:Qt.variableOffsets[Ne.crossTileID])===null||wt===void 0?void 0:wt.anchor];const Gn=(Pt,fo,ra)=>{const sa=Pt.x2-Pt.x1,Np=Pt.y2-Pt.y1,Ng=Ne.textBoxScale,Vp=$e&&fe==="never"?fo:null;let Bs=null,$p=Y==="never"?1:2,Bc="never";Vn&&$p++;for(let xl=0;xl<$p;xl++){for(let Fc=Ls;Fc<Ir;Fc++){const Nc=m.textAnchorOffsets.get(Fc);if(Vn&&Nc.textAnchor!==Vn)continue;const oa=this.attemptAnchorPlacement(Nc,Pt,sa,Np,Ng,Te,Pe,U,M,D,re,Bc,Ne,m,ra,S,C,Vp,Ye);if(oa&&(Bs=oa.placedGlyphBoxes,Bs&&Bs.placeable))return Mt=!0,Er=oa.shift,Bs}Vn?Vn=null:Bc=Y}return f&&!Bs&&(Bs={box:this.collisionIndex.placeCollisionBox(ia,"always",U,M,D,Pe,Te,S,re.predicate,Ye,new c.P(0,0)).box,offscreen:!1,placeable:!1}),Bs};cr(()=>Gn(ia,Ue.iconBox,c.ah.horizontal),()=>{const Pt=Ue.verticalTextBox;return m.allowVerticalPlacement&&(!tn||!tn.placeable)&&Ne.numVerticalGlyphVertices>0&&Pt?Gn(Pt,Ue.verticalIconBox,c.ah.vertical):{box:null,occluded:!0,offscreen:null}}),tn&&(Mt=tn.placeable,Zn=tn.offscreen);const ji=lr(tn&&tn.placeable);if(!Mt&&this.prevPlacement){const Pt=this.prevPlacement.variableOffsets[Ne.crossTileID];Pt&&(this.variableOffsets[Ne.crossTileID]=Pt,this.markUsedJustification(m,Pt.anchor,Ne,ji))}}}if(ai=tn,Mt=ai&&ai.placeable,Zn=ai&&ai.offscreen,Ne.useRuntimeCollisionCircles){const lr=m.text.placedSymbolArray.get(Ne.centerJustifiedTextSymbolIndex),cr=c.ai(m.textSizeData,te,lr),Ls=y.get("text-padding");Wn=this.collisionIndex.placeCollisionCircles(Y,lr,m.lineVertexArray,m.glyphOffsetArray,cr,M,D,O,L,f,Pe,re.predicate,Ne.collisionCircleDiameter,Ls,S,Ye),Wn.circles.length&&Wn.collisionDetected&&!f&&c.w("Collisions detected, but collision boxes are not shown"),Mt=de||Wn.circles.length>0&&!Wn.collisionDetected,Zn=Zn&&Wn.offscreen}if(Ue.iconFeatureIndex&&(Oc=Ue.iconFeatureIndex),Ue.iconBox){const lr=cr=>this.collisionIndex.placeCollisionBox(cr,fe,U,M,D,Pe,Te,C,re.predicate,Ye,$e&&Er?Er:void 0);Si&&Si.placeable&&Ue.verticalIconBox?(li=lr(Ue.verticalIconBox),en=li.placeable):(li=lr(Ue.iconBox),en=li.placeable),Zn=Zn&&li.offscreen}const ar=se||Ne.numHorizontalGlyphVertices===0&&Ne.numVerticalGlyphVertices===0,Lc=ae||Ne.numIconVertices===0;ar||Lc?Lc?ar||(en=en&&Mt):Mt=en&&Mt:en=Mt=en&&Mt;const Dh=en&&li.placeable;if(Mt&&ai.placeable&&this.collisionIndex.insertCollisionBox(ai.box,Y,y.get("text-ignore-placement"),m.bucketInstanceId,Si&&Si.placeable&&na?na:Jr,re.ID),Dh&&this.collisionIndex.insertCollisionBox(li.box,fe,y.get("icon-ignore-placement"),m.bucketInstanceId,Oc,re.ID),Wn&&Mt&&this.collisionIndex.insertCollisionCircles(Wn.circles,Y,y.get("text-ignore-placement"),m.bucketInstanceId,Jr,re.ID),f&&this.storeCollisionData(m.bucketInstanceId,ht,Ue,ai,li,Wn),Ne.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(m.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ne.crossTileID]=new St(Mt||Be,en||Le,Zn||m.justReloaded),h[Ne.crossTileID]=!0};if(He){if(i.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ne=m.getSortedSymbolIndexes(this.transform.angle);for(let Ue=Ne.length-1;Ue>=0;--Ue){const ht=Ne[Ue];pt(m.symbolInstances.get(ht),m.collisionArrays[ht],ht)}}else for(let Ne=i.symbolInstanceStart;Ne<i.symbolInstanceEnd;Ne++)pt(m.symbolInstances.get(Ne),m.collisionArrays[Ne],Ne);if(f&&m.bucketInstanceId in this.collisionCircleArrays){const Ne=this.collisionCircleArrays[m.bucketInstanceId];c.as(Ne.invProjMatrix,M),Ne.viewportMatrix=this.collisionIndex.getViewportMatrix()}m.justReloaded=!1}storeCollisionData(i,h,f,m,y,S){if(f.textBox||f.iconBox){let C,M;this.collisionBoxArrays.has(i)?C=this.collisionBoxArrays.get(i):(C=new Map,this.collisionBoxArrays.set(i,C)),C.has(h)?M=C.get(h):(M={text:null,icon:null},C.set(h,M)),f.textBox&&(M.text=m.box),f.iconBox&&(M.icon=y.box)}if(S){let C=this.collisionCircleArrays[i];C===void 0&&(C=this.collisionCircleArrays[i]=new Ut);for(let M=0;M<S.circles.length;M+=4)C.circles.push(S.circles[M+0]),C.circles.push(S.circles[M+1]),C.circles.push(S.circles[M+2]),C.circles.push(S.collisionDetected?1:0)}}markUsedJustification(i,h,f,m){let y;y=m===c.ah.vertical?f.verticalPlacedTextSymbolIndex:{left:f.leftJustifiedTextSymbolIndex,center:f.centerJustifiedTextSymbolIndex,right:f.rightJustifiedTextSymbolIndex}[c.at(h)];const S=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex,f.verticalPlacedTextSymbolIndex];for(const C of S)C>=0&&(i.text.placedSymbolArray.get(C).crossTileID=y>=0&&C!==y?0:f.crossTileID)}markUsedOrientation(i,h,f){const m=h===c.ah.horizontal||h===c.ah.horizontalOnly?h:0,y=h===c.ah.vertical?h:0,S=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex];for(const C of S)i.text.placedSymbolArray.get(C).placedOrientation=m;f.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(f.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let f=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const m=h?h.symbolFadeChange(i):1,y=h?h.opacities:{},S=h?h.variableOffsets:{},C=h?h.placedOrientations:{};for(const M in this.placements){const D=this.placements[M],O=y[M];O?(this.opacities[M]=new ln(O,m,D.text,D.icon),f=f||D.text!==O.text.placed||D.icon!==O.icon.placed):(this.opacities[M]=new ln(null,m,D.text,D.icon,D.skipFade),f=f||D.text||D.icon)}for(const M in y){const D=y[M];if(!this.opacities[M]){const O=new ln(D,m,!1,!1);O.isHidden()||(this.opacities[M]=O,f=f||D.text.placed||D.icon.placed)}}for(const M in S)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=S[M]);for(const M in C)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=C[M]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");f?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:i)}updateLayerOpacities(i,h){const f={};for(const m of h){const y=m.getBucket(i);y&&m.latestFeatureIndex&&i.id===y.layerIds[0]&&this.updateBucketOpacities(y,m.tileID,f,m.collisionBoxArray)}}updateBucketOpacities(i,h,f,m){i.hasTextData()&&(i.text.opacityVertexArray.clear(),i.text.hasVisibleVertices=!1),i.hasIconData()&&(i.icon.opacityVertexArray.clear(),i.icon.hasVisibleVertices=!1),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const y=i.layers[0],S=y.layout,C=new ln(null,0,!1,!1,!0),M=S.get("text-allow-overlap"),D=S.get("icon-allow-overlap"),O=y._unevaluatedLayout.hasValue("text-variable-anchor")||y._unevaluatedLayout.hasValue("text-variable-anchor-offset"),L=S.get("text-rotation-alignment")==="map",U=S.get("text-pitch-alignment")==="map",Z=S.get("icon-text-fit")!=="none",G=new ln(null,0,M&&(D||!i.hasIconData()||S.get("icon-optional")),D&&(M||!i.hasTextData()||S.get("text-optional")),!0);!i.collisionArrays&&m&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(m);const te=(se,ae,Y)=>{for(let de=0;de<ae/4;de++)se.opacityVertexArray.emplaceBack(Y);se.hasVisibleVertices=se.hasVisibleVertices||Y!==Oo},re=this.collisionBoxArrays.get(i.bucketInstanceId);for(let se=0;se<i.symbolInstances.length;se++){const ae=i.symbolInstances.get(se),{numHorizontalGlyphVertices:Y,numVerticalGlyphVertices:de,crossTileID:fe}=ae;let _e=this.opacities[fe];f[fe]?_e=C:_e||(_e=G,this.opacities[fe]=_e),f[fe]=!0;const Te=ae.numIconVertices>0,Pe=this.placedOrientations[ae.crossTileID],$e=Pe===c.ah.vertical,He=Pe===c.ah.horizontal||Pe===c.ah.horizontalOnly;if(Y>0||de>0){const Le=Ni(_e.text);te(i.text,Y,$e?Oo:Le),te(i.text,de,He?Oo:Le);const Ye=_e.text.isHidden();[ae.rightJustifiedTextSymbolIndex,ae.centerJustifiedTextSymbolIndex,ae.leftJustifiedTextSymbolIndex].forEach(Ue=>{Ue>=0&&(i.text.placedSymbolArray.get(Ue).hidden=Ye||$e?1:0)}),ae.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get(ae.verticalPlacedTextSymbolIndex).hidden=Ye||He?1:0);const pt=this.variableOffsets[ae.crossTileID];pt&&this.markUsedJustification(i,pt.anchor,ae,Pe);const Ne=this.placedOrientations[ae.crossTileID];Ne&&(this.markUsedJustification(i,"left",ae,Ne),this.markUsedOrientation(i,Ne,ae))}if(Te){const Le=Ni(_e.icon),Ye=!(Z&&ae.verticalPlacedIconSymbolIndex&&$e);ae.placedIconSymbolIndex>=0&&(te(i.icon,ae.numIconVertices,Ye?Le:Oo),i.icon.placedSymbolArray.get(ae.placedIconSymbolIndex).hidden=_e.icon.isHidden()),ae.verticalPlacedIconSymbolIndex>=0&&(te(i.icon,ae.numVerticalIconVertices,Ye?Oo:Le),i.icon.placedSymbolArray.get(ae.verticalPlacedIconSymbolIndex).hidden=_e.icon.isHidden())}const Be=re&&re.has(se)?re.get(se):{text:null,icon:null};if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const Le=i.collisionArrays[se];if(Le){let Ye=new c.P(0,0);if(Le.textBox||Le.verticalTextBox){let pt=!0;if(O){const Ne=this.variableOffsets[fe];Ne?(Ye=Nn(Ne.anchor,Ne.width,Ne.height,Ne.textOffset,Ne.textBoxScale),L&&Ye._rotate(U?this.transform.angle:-this.transform.angle)):pt=!1}if(Le.textBox||Le.verticalTextBox){let Ne;Le.textBox&&(Ne=$e),Le.verticalTextBox&&(Ne=He),Ro(i.textCollisionBox.collisionVertexArray,_e.text.placed,!pt||Ne,Be.text,Ye.x,Ye.y)}}if(Le.iconBox||Le.verticalIconBox){const pt=!!(!He&&Le.verticalIconBox);let Ne;Le.iconBox&&(Ne=pt),Le.verticalIconBox&&(Ne=!pt),Ro(i.iconCollisionBox.collisionVertexArray,_e.icon.placed,Ne,Be.icon,Z?Ye.x:0,Z?Ye.y:0)}}}}if(i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.text.opacityVertexArray.length!==i.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${i.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${i.text.layoutVertexArray.length}) / 4`);if(i.icon.opacityVertexArray.length!==i.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${i.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${i.icon.layoutVertexArray.length}) / 4`);if(i.bucketInstanceId in this.collisionCircleArrays){const se=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=se.invProjMatrix,i.placementViewportMatrix=se.viewportMatrix,i.collisionCircleArray=se.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,h){const f=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*f>i}setStale(){this.stale=!0}}function Ro(_,i,h,f,m,y){f&&f.length!==0||(f=[0,0,0,0]);const S=f[0]-vt,C=f[1]-vt,M=f[2]-vt,D=f[3]-vt;_.emplaceBack(i?1:0,h?1:0,m||0,y||0,S,C),_.emplaceBack(i?1:0,h?1:0,m||0,y||0,M,C),_.emplaceBack(i?1:0,h?1:0,m||0,y||0,M,D),_.emplaceBack(i?1:0,h?1:0,m||0,y||0,S,D)}const qt=Math.pow(2,25),qu=Math.pow(2,24),Hu=Math.pow(2,17),Bi=Math.pow(2,16),Fi=Math.pow(2,9),pg=Math.pow(2,8),ir=Math.pow(2,1);function Ni(_){if(_.opacity===0&&!_.placed)return 0;if(_.opacity===1&&_.placed)return 4294967295;const i=_.placed?1:0,h=Math.floor(127*_.opacity);return h*qt+i*qu+h*Hu+i*Bi+h*Fi+i*pg+h*ir+i}const Oo=0;function to(){return{isOccluded:(_,i,h)=>!1,getPitchedTextCorrection:(_,i,h)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(_,i,h,f){throw new Error("Not implemented.")},translatePosition:(_,i,h,f)=>function(m,y,S,C,M=!1){if(!S[0]&&!S[1])return[0,0];const D=M?C==="map"?m.angle:0:C==="viewport"?-m.angle:0;if(D){const O=Math.sin(D),L=Math.cos(D);S=[S[0]*L-S[1]*O,S[0]*O+S[1]*L]}return[M?S[0]:Ct(y,S[0],m.zoom),M?S[1]:Ct(y,S[1],m.zoom)]}(_,i,h,f),getCircleRadiusCorrection:_=>1}}class kn{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&!i.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(i,h,f,m,y){const S=this._bucketParts;for(;this._currentTileIndex<i.length;)if(h.getBucketParts(S,m,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((C,M)=>C.sortKey-M.sortKey));this._currentPartIndex<S.length;)if(h.placeLayerBucketPart(S[this._currentPartIndex],this._seenCrossTileIDs,f),this._currentPartIndex++,y())return!0;return!1}}class nl{constructor(i,h,f,m,y,S,C,M){this.placement=new oi(i,to(),h,S,C,M),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(i,h,f){const m=P.now(),y=()=>!this._forceFullPlacement&&P.now()-m>2;for(;this._currentPlacementIndex>=0;){const S=h[i[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if(S.type==="symbol"&&(!S.minzoom||S.minzoom<=C)&&(!S.maxzoom||S.maxzoom>C)){if(this._inProgressLayer||(this._inProgressLayer=new kn(S)),this._inProgressLayer.continuePlacement(f[S.source],this.placement,this._showCollisionBoxes,S,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const Sr=512/c.X/2;class _n{constructor(i,h,f){this.tileID=i,this.bucketInstanceId=f,this._symbolsByKey={};const m=new Map;for(let y=0;y<h.length;y++){const S=h.get(y),C=S.key,M=m.get(C);M?M.push(S):m.set(C,[S])}for(const[y,S]of m){const C={positions:S.map(M=>({x:Math.floor(M.anchorX*Sr),y:Math.floor(M.anchorY*Sr)})),crossTileIDs:S.map(M=>M.crossTileID)};if(C.positions.length>128){const M=new c.av(C.positions.length,16,Uint16Array);for(const{x:D,y:O}of C.positions)M.add(D,O);M.finish(),delete C.positions,C.index=M}this._symbolsByKey[y]=C}}getScaledCoordinates(i,h){const{x:f,y:m,z:y}=this.tileID.canonical,{x:S,y:C,z:M}=h.canonical,D=Sr/Math.pow(2,M-y),O=(C*c.X+i.anchorY)*D,L=m*c.X*Sr;return{x:Math.floor((S*c.X+i.anchorX)*D-f*c.X*Sr),y:Math.floor(O-L)}}findMatches(i,h,f){const m=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let y=0;y<i.length;y++){const S=i.get(y);if(S.crossTileID)continue;const C=this._symbolsByKey[S.key];if(!C)continue;const M=this.getScaledCoordinates(S,h);if(C.index){const D=C.index.range(M.x-m,M.y-m,M.x+m,M.y+m).sort();for(const O of D){const L=C.crossTileIDs[O];if(!f[L]){f[L]=!0,S.crossTileID=L;break}}}else if(C.positions)for(let D=0;D<C.positions.length;D++){const O=C.positions[D],L=C.crossTileIDs[D];if(Math.abs(O.x-M.x)<=m&&Math.abs(O.y-M.y)<=m&&!f[L]){f[L]=!0,S.crossTileID=L;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:i})=>i)}}class rc{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class kr{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const h=Math.round((i-this.lng)/360);if(h!==0)for(const f in this.indexes){const m=this.indexes[f],y={};for(const S in m){const C=m[S];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+h),y[C.tileID.key]=C}this.indexes[f]=y}this.lng=i}addBucket(i,h,f){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let y=0;y<h.symbolInstances.length;y++)h.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});const m=this.usedCrossTileIDs[i.overscaledZ];for(const y in this.indexes){const S=this.indexes[y];if(Number(y)>i.overscaledZ)for(const C in S){const M=S[C];M.tileID.isChildOf(i)&&M.findMatches(h.symbolInstances,i,m)}else{const C=S[i.scaledTo(Number(y)).key];C&&C.findMatches(h.symbolInstances,i,m)}}for(let y=0;y<h.symbolInstances.length;y++){const S=h.symbolInstances.get(y);S.crossTileID||(S.crossTileID=f.generate(),m[S.crossTileID]=!0)}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new _n(i,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(i,h){for(const f of h.getCrossTileIDsLists())for(const m of f)delete this.usedCrossTileIDs[i][m]}removeStaleBuckets(i){let h=!1;for(const f in this.indexes){const m=this.indexes[f];for(const y in m)i[m[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,m[y]),delete m[y],h=!0)}return h}}class Zu{constructor(){this.layerIndexes={},this.crossTileIDs=new rc,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,h,f){let m=this.layerIndexes[i.id];m===void 0&&(m=this.layerIndexes[i.id]=new kr);let y=!1;const S={};m.handleWrapJump(f);for(const C of h){const M=C.getBucket(i);M&&i.id===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(C.tileID,M,this.crossTileIDs)&&(y=!0),S[M.bucketInstanceId]=!0)}return m.removeStaleBuckets(S)&&(y=!0),y}pruneUnusedLayers(i){const h={};i.forEach(f=>{h[f]=!0});for(const f in this.layerIndexes)h[f]||delete this.layerIndexes[f]}}const Tr=(_,i)=>c.t(_,i&&i.filter(h=>h.identifier!=="source.canvas")),fg=c.aw();class sc extends c.E{constructor(i,h={}){super(),this._rtlPluginLoaded=()=>{for(const f in this.sourceCaches){const m=this.sourceCaches[f].getSource().type;m!=="vector"&&m!=="geojson"||this.sourceCaches[f].reload()}},this.map=i,this.dispatcher=new Qs(Ys(),i._getMapId()),this.dispatcher.registerMessageHandler("GG",(f,m)=>this.getGlyphs(f,m)),this.dispatcher.registerMessageHandler("GI",(f,m)=>this.getImages(f,m)),this.imageManager=new dn,this.imageManager.setEventedParent(this),this.glyphManager=new yi(i._requestManager,h.localIdeographFontFamily),this.lineAtlas=new xr(256,512),this.crossTileSymbolIndex=new Zu,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new c.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",c.ay()),Hr().on(ze,this._rtlPluginLoaded),this.on("data",f=>{if(f.dataType!=="source"||f.sourceDataType!=="metadata")return;const m=this.sourceCaches[f.sourceId];if(!m)return;const y=m.getSource();if(y&&y.vectorLayerIds)for(const S in this._layers){const C=this._layers[S];C.source===y.id&&this._validateLayer(C)}})}loadURL(i,h={},f){this.fire(new c.k("dataloading",{dataType:"style"})),h.validate=typeof h.validate!="boolean"||h.validate;const m=this.map._requestManager.transformRequest(i,"Style");this._loadStyleRequest=new AbortController;const y=this._loadStyleRequest;c.h(m,this._loadStyleRequest).then(S=>{this._loadStyleRequest=null,this._load(S.data,h,f)}).catch(S=>{this._loadStyleRequest=null,S&&!y.signal.aborted&&this.fire(new c.j(S))})}loadJSON(i,h={},f){this.fire(new c.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,P.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,h.validate=h.validate!==!1,this._load(i,h,f)}).catch(()=>{})}loadEmpty(){this.fire(new c.k("dataloading",{dataType:"style"})),this._load(fg,{validate:!1})}_load(i,h,f){var m;const y=h.transformStyle?h.transformStyle(f,i):i;if(!h.validate||!Tr(this,c.u(y))){this._loaded=!0,this.stylesheet=y;for(const S in y.sources)this.addSource(S,y.sources[S],{validate:!1});y.sprite?this._loadSprite(y.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(y.glyphs),this._createLayers(),this.light=new yt(this.stylesheet.light),this.sky=new jt(this.stylesheet.sky),this.map.setTerrain((m=this.stylesheet.terrain)!==null&&m!==void 0?m:null),this.fire(new c.k("data",{dataType:"style"})),this.fire(new c.k("style.load"))}}_createLayers(){const i=c.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",i),this._order=i.map(h=>h.id),this._layers={},this._serializedLayers=null;for(const h of i){const f=c.aA(h);f.setEventedParent(this,{layer:{id:h.id}}),this._layers[h.id]=f}}_loadSprite(i,h=!1,f=void 0){let m;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(y,S,C,M){return c._(this,void 0,void 0,function*(){const D=tt(y),O=C>1?"@2x":"",L={},U={};for(const{id:Z,url:G}of D){const te=S.transformRequest(ft(G,O,".json"),"SpriteJSON");L[Z]=c.h(te,M);const re=S.transformRequest(ft(G,O,".png"),"SpriteImage");U[Z]=le.getImage(re,M)}return yield Promise.all([...Object.values(L),...Object.values(U)]),function(Z,G){return c._(this,void 0,void 0,function*(){const te={};for(const re in Z){te[re]={};const se=P.getImageCanvasContext((yield G[re]).data),ae=(yield Z[re]).data;for(const Y in ae){const{width:de,height:fe,x:_e,y:Te,sdf:Pe,pixelRatio:$e,stretchX:He,stretchY:Be,content:Le,textFitWidth:Ye,textFitHeight:pt}=ae[Y];te[re][Y]={data:null,pixelRatio:$e,sdf:Pe,stretchX:He,stretchY:Be,content:Le,textFitWidth:Ye,textFitHeight:pt,spriteData:{width:de,height:fe,x:_e,y:Te,context:se}}}}return te})}(L,U)})}(i,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(y=>{if(this._spriteRequest=null,y)for(const S in y){this._spritesImagesIds[S]=[];const C=this._spritesImagesIds[S]?this._spritesImagesIds[S].filter(M=>!(M in y)):[];for(const M of C)this.imageManager.removeImage(M),this._changedImages[M]=!0;for(const M in y[S]){const D=S==="default"?M:`${S}:${M}`;this._spritesImagesIds[S].push(D),D in this.imageManager.images?this.imageManager.updateImage(D,y[S][M],!1):this.imageManager.addImage(D,y[S][M]),h&&(this._changedImages[D]=!0)}}}).catch(y=>{this._spriteRequest=null,m=y,this.fire(new c.j(m))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),h&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"})),f&&f(m)})}_unloadSprite(){for(const i of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(i),this._changedImages[i]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}_validateLayer(i){const h=this.sourceCaches[i.source];if(!h)return;const f=i.sourceLayer;if(!f)return;const m=h.getSource();(m.type==="geojson"||m.vectorLayerIds&&m.vectorLayerIds.indexOf(f)===-1)&&this.fire(new c.j(new Error(`Source layer "${f}" does not exist on source "${m.id}" as specified by style layer "${i.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this.sourceCaches)if(!this.sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(i,h=!1){const f=this._serializedAllLayers();if(!i||i.length===0)return Object.values(h?c.aB(f):f);const m=[];for(const y of i)if(f[y]){const S=h?c.aB(f[y]):f[y];m.push(S)}return m}_serializedAllLayers(){let i=this._serializedLayers;if(i)return i;i=this._serializedLayers={};const h=Object.keys(this._layers);for(const f of h){const m=this._layers[f];m.type!=="custom"&&(i[f]=m.serialize())}return i}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const i in this.sourceCaches)if(this.sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(i){if(!this._loaded)return;const h=this._changed;if(h){const m=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(m.length||y.length)&&this._updateWorkerLayers(m,y);for(const S in this._updatedSources){const C=this._updatedSources[S];if(C==="reload")this._reloadSource(S);else{if(C!=="clear")throw new Error(`Invalid action ${C}`);this._clearSource(S)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const S in this._updatedPaintProps)this._layers[S].updateTransitions(i);this.light.updateTransitions(i),this.sky.updateTransitions(i),this._resetUpdates()}const f={};for(const m in this.sourceCaches){const y=this.sourceCaches[m];f[m]=y.used,y.used=!1}for(const m of this._order){const y=this._layers[m];y.recalculate(i,this._availableImages),!y.isHidden(i.zoom)&&y.source&&(this.sourceCaches[y.source].used=!0)}for(const m in f){const y=this.sourceCaches[m];!!f[m]!=!!y.used&&y.fire(new c.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(i),this.sky.recalculate(i),this.z=i.zoom,h&&this.fire(new c.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const i in this.sourceCaches)this.sourceCaches[i].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(i,h){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(i,!1),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(i,h={}){var f;this._checkLoaded();const m=this.serialize();if(i=h.transformStyle?h.transformStyle(m,i):i,((f=h.validate)===null||f===void 0||f)&&Tr(this,c.u(i)))return!1;(i=c.aB(i)).layers=c.az(i.layers);const y=c.aC(m,i),S=this._getOperationsToPerform(y);if(S.unimplemented.length>0)throw new Error(`Unimplemented: ${S.unimplemented.join(", ")}.`);if(S.operations.length===0)return!1;for(const C of S.operations)C();return this.stylesheet=i,this._serializedLayers=null,!0}_getOperationsToPerform(i){const h=[],f=[];for(const m of i)switch(m.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":h.push(()=>this.addLayer.apply(this,m.args));break;case"removeLayer":h.push(()=>this.removeLayer.apply(this,m.args));break;case"setPaintProperty":h.push(()=>this.setPaintProperty.apply(this,m.args));break;case"setLayoutProperty":h.push(()=>this.setLayoutProperty.apply(this,m.args));break;case"setFilter":h.push(()=>this.setFilter.apply(this,m.args));break;case"addSource":h.push(()=>this.addSource.apply(this,m.args));break;case"removeSource":h.push(()=>this.removeSource.apply(this,m.args));break;case"setLayerZoomRange":h.push(()=>this.setLayerZoomRange.apply(this,m.args));break;case"setLight":h.push(()=>this.setLight.apply(this,m.args));break;case"setGeoJSONSourceData":h.push(()=>this.setGeoJSONSourceData.apply(this,m.args));break;case"setGlyphs":h.push(()=>this.setGlyphs.apply(this,m.args));break;case"setSprite":h.push(()=>this.setSprite.apply(this,m.args));break;case"setSky":h.push(()=>this.setSky.apply(this,m.args));break;case"setTerrain":h.push(()=>this.map.setTerrain.apply(this,m.args));break;case"setTransition":h.push(()=>{});break;default:f.push(m.command)}return{operations:h,unimplemented:f}}addImage(i,h){if(this.getImage(i))return this.fire(new c.j(new Error(`An image named "${i}" already exists.`)));this.imageManager.addImage(i,h),this._afterImageUpdated(i)}updateImage(i,h){this.imageManager.updateImage(i,h)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){if(!this.getImage(i))return this.fire(new c.j(new Error(`An image named "${i}" does not exist.`)));this.imageManager.removeImage(i),this._afterImageUpdated(i)}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(i,h,f={}){if(this._checkLoaded(),this.sourceCaches[i]!==void 0)throw new Error(`Source "${i}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(c.u.source,`sources.${i}`,h,null,f))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const m=this.sourceCaches[i]=new ut(i,h,this.dispatcher);m.style=this,m.setEventedParent(this,()=>({isSourceLoaded:m.loaded(),source:m.serialize(),sourceId:i})),m.onAdd(this.map),this._changed=!0}removeSource(i){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error("There is no source with this ID");for(const f in this._layers)if(this._layers[f].source===i)return this.fire(new c.j(new Error(`Source "${i}" cannot be removed while layer "${f}" is using it.`)));const h=this.sourceCaches[i];delete this.sourceCaches[i],delete this._updatedSources[i],h.fire(new c.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:i})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(i,h){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error(`There is no source with this ID=${i}`);const f=this.sourceCaches[i].getSource();if(f.type!=="geojson")throw new Error(`geojsonSource.type is ${f.type}, which is !== 'geojson`);f.setData(h),this._changed=!0}getSource(i){return this.sourceCaches[i]&&this.sourceCaches[i].getSource()}addLayer(i,h,f={}){this._checkLoaded();const m=i.id;if(this.getLayer(m))return void this.fire(new c.j(new Error(`Layer "${m}" already exists on this map.`)));let y;if(i.type==="custom"){if(Tr(this,c.aD(i)))return;y=c.aA(i)}else{if("source"in i&&typeof i.source=="object"&&(this.addSource(m,i.source),i=c.aB(i),i=c.e(i,{source:m})),this._validate(c.u.layer,`layers.${m}`,i,{arrayIndex:-1},f))return;y=c.aA(i),this._validateLayer(y),y.setEventedParent(this,{layer:{id:m}})}const S=h?this._order.indexOf(h):this._order.length;if(h&&S===-1)this.fire(new c.j(new Error(`Cannot add layer "${m}" before non-existing layer "${h}".`)));else{if(this._order.splice(S,0,m),this._layerOrderChanged=!0,this._layers[m]=y,this._removedLayers[m]&&y.source&&y.type!=="custom"){const C=this._removedLayers[m];delete this._removedLayers[m],C.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",this.sourceCaches[y.source].pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map)}}moveLayer(i,h){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new c.j(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===h)return;const f=this._order.indexOf(i);this._order.splice(f,1);const m=h?this._order.indexOf(h):this._order.length;h&&m===-1?this.fire(new c.j(new Error(`Cannot move layer "${i}" before non-existing layer "${h}".`))):(this._order.splice(m,0,i),this._layerOrderChanged=!0)}removeLayer(i){this._checkLoaded();const h=this._layers[i];if(!h)return void this.fire(new c.j(new Error(`Cannot remove non-existing layer "${i}".`)));h.setEventedParent(null);const f=this._order.indexOf(i);this._order.splice(f,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=h,delete this._layers[i],this._serializedLayers&&delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],h.onRemove&&h.onRemove(this.map)}getLayer(i){return this._layers[i]}getLayersOrder(){return[...this._order]}hasLayer(i){return i in this._layers}setLayerZoomRange(i,h,f){this._checkLoaded();const m=this.getLayer(i);m?m.minzoom===h&&m.maxzoom===f||(h!=null&&(m.minzoom=h),f!=null&&(m.maxzoom=f),this._updateLayer(m)):this.fire(new c.j(new Error(`Cannot set the zoom range of non-existing layer "${i}".`)))}setFilter(i,h,f={}){this._checkLoaded();const m=this.getLayer(i);if(m){if(!c.aE(m.filter,h))return h==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(c.u.filter,`layers.${m.id}.filter`,h,null,f)||(m.filter=c.aB(h),this._updateLayer(m)))}else this.fire(new c.j(new Error(`Cannot filter non-existing layer "${i}".`)))}getFilter(i){return c.aB(this.getLayer(i).filter)}setLayoutProperty(i,h,f,m={}){this._checkLoaded();const y=this.getLayer(i);y?c.aE(y.getLayoutProperty(h),f)||(y.setLayoutProperty(h,f,m),this._updateLayer(y)):this.fire(new c.j(new Error(`Cannot style non-existing layer "${i}".`)))}getLayoutProperty(i,h){const f=this.getLayer(i);if(f)return f.getLayoutProperty(h);this.fire(new c.j(new Error(`Cannot get style of non-existing layer "${i}".`)))}setPaintProperty(i,h,f,m={}){this._checkLoaded();const y=this.getLayer(i);y?c.aE(y.getPaintProperty(h),f)||(y.setPaintProperty(h,f,m)&&this._updateLayer(y),this._changed=!0,this._updatedPaintProps[i]=!0,this._serializedLayers=null):this.fire(new c.j(new Error(`Cannot style non-existing layer "${i}".`)))}getPaintProperty(i,h){return this.getLayer(i).getPaintProperty(h)}setFeatureState(i,h){this._checkLoaded();const f=i.source,m=i.sourceLayer,y=this.sourceCaches[f];if(y===void 0)return void this.fire(new c.j(new Error(`The source '${f}' does not exist in the map's style.`)));const S=y.getSource().type;S==="geojson"&&m?this.fire(new c.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):S!=="vector"||m?(i.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),y.setFeatureState(m,i.id,h)):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(i,h){this._checkLoaded();const f=i.source,m=this.sourceCaches[f];if(m===void 0)return void this.fire(new c.j(new Error(`The source '${f}' does not exist in the map's style.`)));const y=m.getSource().type,S=y==="vector"?i.sourceLayer:void 0;y!=="vector"||S?h&&typeof i.id!="string"&&typeof i.id!="number"?this.fire(new c.j(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(S,i.id,h):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(i){this._checkLoaded();const h=i.source,f=i.sourceLayer,m=this.sourceCaches[h];if(m!==void 0)return m.getSource().type!=="vector"||f?(i.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),m.getFeatureState(f,i.id)):void this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.j(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const i=c.aF(this.sourceCaches,y=>y.serialize()),h=this._serializeByIds(this._order,!0),f=this.map.getTerrain()||void 0,m=this.stylesheet;return c.aG({version:m.version,name:m.name,metadata:m.metadata,light:m.light,sky:m.sky,center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,sprite:m.sprite,glyphs:m.glyphs,transition:m.transition,sources:i,layers:h,terrain:f},y=>y!==void 0)}_updateLayer(i){this._updatedLayers[i.id]=!0,i.source&&!this._updatedSources[i.source]&&this.sourceCaches[i.source].getSource().type!=="raster"&&(this._updatedSources[i.source]="reload",this.sourceCaches[i.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(i){const h=S=>this._layers[S].type==="fill-extrusion",f={},m=[];for(let S=this._order.length-1;S>=0;S--){const C=this._order[S];if(h(C)){f[C]=S;for(const M of i){const D=M[C];if(D)for(const O of D)m.push(O)}}}m.sort((S,C)=>C.intersectionZ-S.intersectionZ);const y=[];for(let S=this._order.length-1;S>=0;S--){const C=this._order[S];if(h(C))for(let M=m.length-1;M>=0;M--){const D=m[M].feature;if(f[D.layer.id]<S)break;y.push(D),m.pop()}else for(const M of i){const D=M[C];if(D)for(const O of D)y.push(O.feature)}}return y}queryRenderedFeatures(i,h,f){h&&h.filter&&this._validate(c.u.filter,"queryRenderedFeatures.filter",h.filter,null,h);const m={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new c.j(new Error("parameters.layers must be an Array."))),[];for(const C of h.layers){const M=this._layers[C];if(!M)return this.fire(new c.j(new Error(`The layer '${C}' does not exist in the map's style and cannot be queried for features.`))),[];m[M.source]=!0}}const y=[];h.availableImages=this._availableImages;const S=this._serializedAllLayers();for(const C in this.sourceCaches)h.layers&&!m[C]||y.push(Is(this.sourceCaches[C],this._layers,S,i,h,f));return this.placement&&y.push(function(C,M,D,O,L,U,Z){const G={},te=U.queryRenderedSymbols(O),re=[];for(const se of Object.keys(te).map(Number))re.push(Z[se]);re.sort(Ps);for(const se of re){const ae=se.featureIndex.lookupSymbolFeatures(te[se.bucketInstanceId],M,se.bucketIndex,se.sourceLayerIndex,L.filter,L.layers,L.availableImages,C);for(const Y in ae){const de=G[Y]=G[Y]||[],fe=ae[Y];fe.sort((_e,Te)=>{const Pe=se.featureSortOrder;if(Pe){const $e=Pe.indexOf(_e.featureIndex);return Pe.indexOf(Te.featureIndex)-$e}return Te.featureIndex-_e.featureIndex});for(const _e of fe)de.push(_e)}}for(const se in G)G[se].forEach(ae=>{const Y=ae.feature,de=D[C[se].source].getFeatureState(Y.layer["source-layer"],Y.id);Y.source=Y.layer.source,Y.layer["source-layer"]&&(Y.sourceLayer=Y.layer["source-layer"]),Y.state=de});return G}(this._layers,S,this.sourceCaches,i,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(i,h){h&&h.filter&&this._validate(c.u.filter,"querySourceFeatures.filter",h.filter,null,h);const f=this.sourceCaches[i];return f?function(m,y){const S=m.getRenderableIds().map(D=>m.getTileByID(D)),C=[],M={};for(let D=0;D<S.length;D++){const O=S[D],L=O.tileID.canonical.key;M[L]||(M[L]=!0,O.querySourceFeatures(C,y))}return C}(f,h):[]}getLight(){return this.light.getLight()}setLight(i,h={}){this._checkLoaded();const f=this.light.getLight();let m=!1;for(const S in i)if(!c.aE(i[S],f[S])){m=!0;break}if(!m)return;const y={now:P.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(i,h),this.light.updateTransitions(y)}getSky(){var i;return(i=this.stylesheet)===null||i===void 0?void 0:i.sky}setSky(i,h={}){const f=this.getSky();let m=!1;if(!i&&!f)return;if(i&&!f)m=!0;else if(!i&&f)m=!0;else for(const S in i)if(!c.aE(i[S],f[S])){m=!0;break}if(!m)return;const y={now:P.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=i,this.sky.setSky(i,h),this.sky.updateTransitions(y)}_validate(i,h,f,m,y={}){return(!y||y.validate!==!1)&&Tr(this,i.call(c.u,c.e({key:h,style:this.serialize(),value:f,styleSpec:c.v},m)))}_remove(i=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Hr().off(ze,this._rtlPluginLoaded);for(const h in this._layers)this._layers[h].setEventedParent(null);for(const h in this.sourceCaches){const f=this.sourceCaches[h];f.setEventedParent(null),f.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),i&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(i)}_clearSource(i){this.sourceCaches[i].clearTiles()}_reloadSource(i){this.sourceCaches[i].resume(),this.sourceCaches[i].reload()}_updateSources(i){for(const h in this.sourceCaches)this.sourceCaches[h].update(i,this.map.terrain)}_generateCollisionBoxes(){for(const i in this.sourceCaches)this._reloadSource(i)}_updatePlacement(i,h,f,m,y=!1){let S=!1,C=!1;const M={};for(const D of this._order){const O=this._layers[D];if(O.type!=="symbol")continue;if(!M[O.source]){const U=this.sourceCaches[O.source];M[O.source]=U.getRenderableIds(!0).map(Z=>U.getTileByID(Z)).sort((Z,G)=>G.tileID.overscaledZ-Z.tileID.overscaledZ||(Z.tileID.isLessThan(G.tileID)?-1:1))}const L=this.crossTileSymbolIndex.addLayer(O,M[O.source],i.center.lng);S=S||L}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((y=y||this._layerOrderChanged||f===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(P.now(),i.zoom))&&(this.pauseablePlacement=new nl(i,this.map.terrain,this._order,y,h,f,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,M),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(P.now()),C=!0),S&&this.pauseablePlacement.placement.setStale()),C||S)for(const D of this._order){const O=this._layers[D];O.type==="symbol"&&this.placement.updateLayerOpacities(O,M[O.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(P.now())}_releaseSymbolFadeTiles(){for(const i in this.sourceCaches)this.sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,h){return c._(this,void 0,void 0,function*(){const f=yield this.imageManager.getImages(h.icons);this._updateTilesForChangedImages();const m=this.sourceCaches[h.source];return m&&m.setDependencies(h.tileID.key,h.type,h.icons),f})}getGlyphs(i,h){return c._(this,void 0,void 0,function*(){const f=yield this.glyphManager.getGlyphs(h.stacks),m=this.sourceCaches[h.source];return m&&m.setDependencies(h.tileID.key,h.type,[""]),f})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(i,h={}){this._checkLoaded(),i&&this._validate(c.u.glyphs,"glyphs",i,null,h)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=i,this.glyphManager.entries={},this.glyphManager.setURL(i))}addSprite(i,h,f={},m){this._checkLoaded();const y=[{id:i,url:h}],S=[...tt(this.stylesheet.sprite),...y];this._validate(c.u.sprite,"sprite",S,null,f)||(this.stylesheet.sprite=S,this._loadSprite(y,!0,m))}removeSprite(i){this._checkLoaded();const h=tt(this.stylesheet.sprite);if(h.find(f=>f.id===i)){if(this._spritesImagesIds[i])for(const f of this._spritesImagesIds[i])this.imageManager.removeImage(f),this._changedImages[f]=!0;h.splice(h.findIndex(f=>f.id===i),1),this.stylesheet.sprite=h.length>0?h:void 0,delete this._spritesImagesIds[i],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}else this.fire(new c.j(new Error(`Sprite "${i}" doesn't exists on this map.`)))}getSprite(){return tt(this.stylesheet.sprite)}setSprite(i,h={},f){this._checkLoaded(),i&&this._validate(c.u.sprite,"sprite",i,null,h)||(this.stylesheet.sprite=i,i?this._loadSprite(i,!0,f):(this._unloadSprite(),f&&f(null)))}}var no=c.Y([{name:"a_pos",type:"Int16",components:2}]);const Rs={prelude:Nt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Nt(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Nt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Nt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Nt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Nt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:Nt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Nt("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Nt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Nt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Nt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Nt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Nt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Nt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Nt(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Nt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Nt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Nt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Nt(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Nt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Nt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Nt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Nt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Nt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Nt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Nt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Nt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Nt("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Nt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:Nt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Nt(_,i){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,f=i.match(/attribute ([\w]+) ([\w]+)/g),m=_.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=i.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=y?y.concat(m):m,C={};return{fragmentSource:_=_.replace(h,(M,D,O,L,U)=>(C[U]=!0,D==="define"?`
#ifndef HAS_UNIFORM_u_${U}
varying ${O} ${L} ${U};
#else
uniform ${O} ${L} u_${U};
#endif
`:`
#ifdef HAS_UNIFORM_u_${U}
    ${O} ${L} ${U} = u_${U};
#endif
`)),vertexSource:i=i.replace(h,(M,D,O,L,U)=>{const Z=L==="float"?"vec2":"vec4",G=U.match(/color/)?"color":Z;return C[U]?D==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
attribute ${O} ${Z} a_${U};
varying ${O} ${L} ${U};
#else
uniform ${O} ${L} u_${U};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = a_${U};
#else
    ${O} ${L} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = unpack_mix_${G}(a_${U}, u_${U}_t);
#else
    ${O} ${L} ${U} = u_${U};
#endif
`:D==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
attribute ${O} ${Z} a_${U};
#else
uniform ${O} ${L} u_${U};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${O} ${L} ${U} = a_${U};
#else
    ${O} ${L} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    ${O} ${L} ${U} = unpack_mix_${G}(a_${U}, u_${U}_t);
#else
    ${O} ${L} ${U} = u_${U};
#endif
`}),staticAttributes:f,staticUniforms:S}}class Wu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(i,h,f,m,y,S,C,M,D){this.context=i;let O=this.boundPaintVertexBuffers.length!==m.length;for(let L=0;!O&&L<m.length;L++)this.boundPaintVertexBuffers[L]!==m[L]&&(O=!0);!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==f||O||this.boundIndexBuffer!==y||this.boundVertexOffset!==S||this.boundDynamicVertexBuffer!==C||this.boundDynamicVertexBuffer2!==M||this.boundDynamicVertexBuffer3!==D?this.freshBind(h,f,m,y,S,C,M,D):(i.bindVertexArray.set(this.vao),C&&C.bind(),y&&y.dynamicDraw&&y.bind(),M&&M.bind(),D&&D.bind())}freshBind(i,h,f,m,y,S,C,M){const D=i.numAttributes,O=this.context,L=O.gl;this.vao&&this.destroy(),this.vao=O.createVertexArray(),O.bindVertexArray.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=m,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=S,this.boundDynamicVertexBuffer2=C,this.boundDynamicVertexBuffer3=M,h.enableAttributes(L,i);for(const U of f)U.enableAttributes(L,i);S&&S.enableAttributes(L,i),C&&C.enableAttributes(L,i),M&&M.enableAttributes(L,i),h.bind(),h.setVertexAttribPointers(L,i,y);for(const U of f)U.bind(),U.setVertexAttribPointers(L,i,y);S&&(S.bind(),S.setVertexAttribPointers(L,i,y)),m&&m.bind(),C&&(C.bind(),C.setVertexAttribPointers(L,i,y)),M&&(M.bind(),M.setVertexAttribPointers(L,i,y)),O.currentNumAttributes=D}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Gu=(_,i,h,f,m)=>({u_matrix:_,u_texture:0,u_ele_delta:i,u_fog_matrix:h,u_fog_color:f?f.properties.get("fog-color"):c.aM.white,u_fog_ground_blend:f?f.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:f?f.calculateFogBlendOpacity(m):0,u_horizon_color:f?f.properties.get("horizon-color"):c.aM.white,u_horizon_fog_blend:f?f.properties.get("horizon-fog-blend"):1});function Lo(_){const i=[];for(let h=0;h<_.length;h++){if(_[h]===null)continue;const f=_[h].split(" ");i.push(f.pop())}return i}class Ku{constructor(i,h,f,m,y,S){const C=i.gl;this.program=C.createProgram();const M=Lo(h.staticAttributes),D=f?f.getBinderAttributes():[],O=M.concat(D),L=Rs.prelude.staticUniforms?Lo(Rs.prelude.staticUniforms):[],U=h.staticUniforms?Lo(h.staticUniforms):[],Z=f?f.getBinderUniforms():[],G=L.concat(U).concat(Z),te=[];for(const _e of G)te.indexOf(_e)<0&&te.push(_e);const re=f?f.defines():[];y&&re.push("#define OVERDRAW_INSPECTOR;"),S&&re.push("#define TERRAIN3D;");const se=re.concat(Rs.prelude.fragmentSource,h.fragmentSource).join(`
`),ae=re.concat(Rs.prelude.vertexSource,h.vertexSource).join(`
`),Y=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);if(C.shaderSource(Y,se),C.compileShader(Y),!C.getShaderParameter(Y,C.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${C.getShaderInfoLog(Y)}`);C.attachShader(this.program,Y);const de=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);if(C.shaderSource(de,ae),C.compileShader(de),!C.getShaderParameter(de,C.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${C.getShaderInfoLog(de)}`);C.attachShader(this.program,de),this.attributes={};const fe={};this.numAttributes=O.length;for(let _e=0;_e<this.numAttributes;_e++)O[_e]&&(C.bindAttribLocation(this.program,_e,O[_e]),this.attributes[O[_e]]=_e);if(C.linkProgram(this.program),!C.getProgramParameter(this.program,C.LINK_STATUS))throw new Error(`Program failed to link: ${C.getProgramInfoLog(this.program)}`);C.deleteShader(de),C.deleteShader(Y);for(let _e=0;_e<te.length;_e++){const Te=te[_e];if(Te&&!fe[Te]){const Pe=C.getUniformLocation(this.program,Te);Pe&&(fe[Te]=Pe)}}this.fixedUniforms=m(i,fe),this.terrainUniforms=((_e,Te)=>({u_depth:new c.aH(_e,Te.u_depth),u_terrain:new c.aH(_e,Te.u_terrain),u_terrain_dim:new c.aI(_e,Te.u_terrain_dim),u_terrain_matrix:new c.aJ(_e,Te.u_terrain_matrix),u_terrain_unpack:new c.aK(_e,Te.u_terrain_unpack),u_terrain_exaggeration:new c.aI(_e,Te.u_terrain_exaggeration)}))(i,fe),this.binderUniforms=f?f.getUniforms(i,fe):[]}draw(i,h,f,m,y,S,C,M,D,O,L,U,Z,G,te,re,se,ae){const Y=i.gl;if(this.failedToCreate)return;if(i.program.set(this.program),i.setDepthMode(f),i.setStencilMode(m),i.setColorMode(y),i.setCullFace(S),M){i.activeTexture.set(Y.TEXTURE2),Y.bindTexture(Y.TEXTURE_2D,M.depthTexture),i.activeTexture.set(Y.TEXTURE3),Y.bindTexture(Y.TEXTURE_2D,M.texture);for(const fe in this.terrainUniforms)this.terrainUniforms[fe].set(M[fe])}for(const fe in this.fixedUniforms)this.fixedUniforms[fe].set(C[fe]);te&&te.setUniforms(i,this.binderUniforms,Z,{zoom:G});let de=0;switch(h){case Y.LINES:de=2;break;case Y.TRIANGLES:de=3;break;case Y.LINE_STRIP:de=1}for(const fe of U.get()){const _e=fe.vaos||(fe.vaos={});(_e[D]||(_e[D]=new Wu)).bind(i,this,O,te?te.getPaintVertexBuffers():[],L,fe.vertexOffset,re,se,ae),Y.drawElements(h,fe.primitiveLength*de,Y.UNSIGNED_SHORT,fe.primitiveOffset*de*2)}}}function oc(_,i,h){const f=1/Ct(h,1,i.transform.tileZoom),m=Math.pow(2,h.tileID.overscaledZ),y=h.tileSize*Math.pow(2,i.transform.tileZoom)/m,S=y*(h.tileID.canonical.x+h.tileID.wrap*m),C=y*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[f,_.fromScale,_.toScale],u_fade:_.t,u_pixel_coord_upper:[S>>16,C>>16],u_pixel_coord_lower:[65535&S,65535&C]}}const il=(_,i,h,f)=>{const m=i.style.light,y=m.properties.get("position"),S=[y.x,y.y,y.z],C=function(){var D=new c.A(9);return c.A!=Float32Array&&(D[1]=0,D[2]=0,D[3]=0,D[5]=0,D[6]=0,D[7]=0),D[0]=1,D[4]=1,D[8]=1,D}();m.properties.get("anchor")==="viewport"&&function(D,O){var L=Math.sin(O),U=Math.cos(O);D[0]=U,D[1]=L,D[2]=0,D[3]=-L,D[4]=U,D[5]=0,D[6]=0,D[7]=0,D[8]=1}(C,-i.transform.angle),function(D,O,L){var U=O[0],Z=O[1],G=O[2];D[0]=U*L[0]+Z*L[3]+G*L[6],D[1]=U*L[1]+Z*L[4]+G*L[7],D[2]=U*L[2]+Z*L[5]+G*L[8]}(S,S,C);const M=m.properties.get("color");return{u_matrix:_,u_lightpos:S,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[M.r,M.g,M.b],u_vertical_gradient:+h,u_opacity:f}},ac=(_,i,h,f,m,y,S)=>c.e(il(_,i,h,f),oc(y,i,S),{u_height_factor:-Math.pow(2,m.overscaledZ)/S.tileSize/8}),Bo=_=>({u_matrix:_}),op=(_,i,h,f)=>c.e(Bo(_),oc(h,i,f)),mg=(_,i)=>({u_matrix:_,u_world:i}),ap=(_,i,h,f,m)=>c.e(op(_,i,h,f),{u_world:m}),gg=(_,i,h,f)=>{const m=_.transform;let y,S;if(f.paint.get("circle-pitch-alignment")==="map"){const C=Ct(h,1,m.zoom);y=!0,S=[C,C]}else y=!1,S=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+(f.paint.get("circle-pitch-scale")==="map"),u_matrix:_.translatePosMatrix(i.posMatrix,h,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_pitch_with_map:+y,u_device_pixel_ratio:_.pixelRatio,u_extrude_scale:S}},io=(_,i,h)=>({u_matrix:_,u_inv_matrix:i,u_camera_to_center_distance:h.cameraToCenterDistance,u_viewport_size:[h.width,h.height]}),rl=(_,i,h=1)=>({u_matrix:_,u_color:i,u_overlay:0,u_overlay_scale:h}),wi=_=>({u_matrix:_}),bi=(_,i,h,f)=>({u_matrix:_,u_extrude_scale:Ct(i,1,h),u_intensity:f}),lc=(_,i,h,f)=>{const m=c.H();c.aP(m,0,_.width,_.height,0,0,1);const y=_.context.gl;return{u_matrix:m,u_world:[y.drawingBufferWidth,y.drawingBufferHeight],u_image:h,u_color_ramp:f,u_opacity:i.paint.get("heatmap-opacity")}};function cc(_,i){const h=Math.pow(2,i.canonical.z),f=i.canonical.y;return[new c.Z(0,f/h).toLngLat().lat,new c.Z(0,(f+1)/h).toLngLat().lat]}const uc=(_,i,h,f)=>{const m=_.transform;return{u_matrix:up(_,i,h,f),u_ratio:1/Ct(i,1,m.zoom),u_device_pixel_ratio:_.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},lp=(_,i,h,f,m)=>c.e(uc(_,i,h,m),{u_image:0,u_image_height:f}),Fo=(_,i,h,f,m)=>{const y=_.transform,S=cp(i,y);return{u_matrix:up(_,i,h,m),u_texsize:i.imageAtlasTexture.size,u_ratio:1/Ct(i,1,y.zoom),u_device_pixel_ratio:_.pixelRatio,u_image:0,u_scale:[S,f.fromScale,f.toScale],u_fade:f.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},yg=(_,i,h,f,m,y)=>{const S=_.lineAtlas,C=cp(i,_.transform),M=h.layout.get("line-cap")==="round",D=S.getDash(f.from,M),O=S.getDash(f.to,M),L=D.width*m.fromScale,U=O.width*m.toScale;return c.e(uc(_,i,h,y),{u_patternscale_a:[C/L,-D.height/2],u_patternscale_b:[C/U,-O.height/2],u_sdfgamma:S.width/(256*Math.min(L,U)*_.pixelRatio)/2,u_image:0,u_tex_y_a:D.y,u_tex_y_b:O.y,u_mix:m.t})};function cp(_,i){return 1/Ct(_,1,i.tileZoom)}function up(_,i,h,f){return _.translatePosMatrix(f?f.posMatrix:i.tileID.posMatrix,i,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const _g=(_,i,h,f,m)=>{return{u_matrix:_,u_tl_parent:i,u_scale_parent:h,u_buffer_scale:1,u_fade_t:f.mix,u_opacity:f.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(S=m.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(y=m.paint.get("raster-contrast"),y>0?1/(1-y):1+y),u_spin_weights:vg(m.paint.get("raster-hue-rotate"))};var y,S};function vg(_){_*=Math.PI/180;const i=Math.sin(_),h=Math.cos(_);return[(2*h+1)/3,(-Math.sqrt(3)*i-h+1)/3,(Math.sqrt(3)*i-h+1)/3]}const hp=(_,i,h,f,m,y,S,C,M,D,O,L,U,Z)=>{const G=S.transform;return{u_is_size_zoom_constant:+(_==="constant"||_==="source"),u_is_size_feature_constant:+(_==="constant"||_==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:G.cameraToCenterDistance,u_pitch:G.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:G.width/G.height,u_fade_change:S.options.fadeDuration?S.symbolFadeChange:1,u_matrix:C,u_label_plane_matrix:M,u_coord_matrix:D,u_is_text:+L,u_pitch_with_map:+f,u_is_along_line:m,u_is_variable_anchor:y,u_texsize:U,u_texture:0,u_translation:O,u_pitched_scale:Z}},sl=(_,i,h,f,m,y,S,C,M,D,O,L,U,Z,G)=>{const te=S.transform;return c.e(hp(_,i,h,f,m,y,S,C,M,D,O,L,U,G),{u_gamma_scale:f?Math.cos(te._pitch)*te.cameraToCenterDistance:1,u_device_pixel_ratio:S.pixelRatio,u_is_halo:+Z})},Xu=(_,i,h,f,m,y,S,C,M,D,O,L,U,Z)=>c.e(sl(_,i,h,f,m,y,S,C,M,D,O,!0,L,!0,Z),{u_texsize_icon:U,u_texture_icon:1}),hc=(_,i,h)=>({u_matrix:_,u_opacity:i,u_color:h}),Ju=(_,i,h,f,m,y)=>c.e(function(S,C,M,D){const O=M.imageManager.getPattern(S.from.toString()),L=M.imageManager.getPattern(S.to.toString()),{width:U,height:Z}=M.imageManager.getPixelSize(),G=Math.pow(2,D.tileID.overscaledZ),te=D.tileSize*Math.pow(2,M.transform.tileZoom)/G,re=te*(D.tileID.canonical.x+D.tileID.wrap*G),se=te*D.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:O.tl,u_pattern_br_a:O.br,u_pattern_tl_b:L.tl,u_pattern_br_b:L.br,u_texsize:[U,Z],u_mix:C.t,u_pattern_size_a:O.displaySize,u_pattern_size_b:L.displaySize,u_scale_a:C.fromScale,u_scale_b:C.toScale,u_tile_units_to_pixels:1/Ct(D,1,M.transform.tileZoom),u_pixel_coord_upper:[re>>16,se>>16],u_pixel_coord_lower:[65535&re,65535&se]}}(f,y,h,m),{u_matrix:_,u_opacity:i}),Yu={fillExtrusion:(_,i)=>({u_matrix:new c.aJ(_,i.u_matrix),u_lightpos:new c.aN(_,i.u_lightpos),u_lightintensity:new c.aI(_,i.u_lightintensity),u_lightcolor:new c.aN(_,i.u_lightcolor),u_vertical_gradient:new c.aI(_,i.u_vertical_gradient),u_opacity:new c.aI(_,i.u_opacity)}),fillExtrusionPattern:(_,i)=>({u_matrix:new c.aJ(_,i.u_matrix),u_lightpos:new c.aN(_,i.u_lightpos),u_lightintensity:new c.aI(_,i.u_lightintensity),u_lightcolor:new c.aN(_,i.u_lightcolor),u_vertical_gradient:new c.aI(_,i.u_vertical_gradient),u_height_factor:new c.aI(_,i.u_height_factor),u_image:new c.aH(_,i.u_image),u_texsize:new c.aO(_,i.u_texsize),u_pixel_coord_upper:new c.aO(_,i.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(_,i.u_pixel_coord_lower),u_scale:new c.aN(_,i.u_scale),u_fade:new c.aI(_,i.u_fade),u_opacity:new c.aI(_,i.u_opacity)}),fill:(_,i)=>({u_matrix:new c.aJ(_,i.u_matrix)}),fillPattern:(_,i)=>({u_matrix:new c.aJ(_,i.u_matrix),u_image:new c.aH(_,i.u_image),u_texsize:new c.aO(_,i.u_texsize),u_pixel_coord_upper:new c.aO(_,i.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(_,i.u_pixel_coord_lower),u_scale:new c.aN(_,i.u_scale),u_fade:new c.aI(_,i.u_fade)}),fillOutline:(_,i)=>({u_matrix:new c.aJ(_,i.u_matrix),u_world:new c.aO(_,i.u_world)}),fillOutlinePattern:(_,i)=>({u_matrix:new c.aJ(_,i.u_matrix),u_world:new c.aO(_,i.u_world),u_image:new c.aH(_,i.u_image),u_texsize:new c.aO(_,i.u_texsize),u_pixel_coord_upper:new c.aO(_,i.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(_,i.u_pixel_coord_lower),u_scale:new c.aN(_,i.u_scale),u_fade:new c.aI(_,i.u_fade)}),circle:(_,i)=>({u_camera_to_center_distance:new c.aI(_,i.u_camera_to_center_distance),u_scale_with_map:new c.aH(_,i.u_scale_with_map),u_pitch_with_map:new c.aH(_,i.u_pitch_with_map),u_extrude_scale:new c.aO(_,i.u_extrude_scale),u_device_pixel_ratio:new c.aI(_,i.u_device_pixel_ratio),u_matrix:new c.aJ(_,i.u_matrix)}),collisionBox:(_,i)=>({u_matrix:new c.aJ(_,i.u_matrix),u_pixel_extrude_scale:new c.aO(_,i.u_pixel_extrude_scale)}),collisionCircle:(_,i)=>({u_matrix:new c.aJ(_,i.u_matrix),u_inv_matrix:new c.aJ(_,i.u_inv_matrix),u_camera_to_center_distance:new c.aI(_,i.u_camera_to_center_distance),u_viewport_size:new c.aO(_,i.u_viewport_size)}),debug:(_,i)=>({u_color:new c.aL(_,i.u_color),u_matrix:new c.aJ(_,i.u_matrix),u_overlay:new c.aH(_,i.u_overlay),u_overlay_scale:new c.aI(_,i.u_overlay_scale)}),clippingMask:(_,i)=>({u_matrix:new c.aJ(_,i.u_matrix)}),heatmap:(_,i)=>({u_extrude_scale:new c.aI(_,i.u_extrude_scale),u_intensity:new c.aI(_,i.u_intensity),u_matrix:new c.aJ(_,i.u_matrix)}),heatmapTexture:(_,i)=>({u_matrix:new c.aJ(_,i.u_matrix),u_world:new c.aO(_,i.u_world),u_image:new c.aH(_,i.u_image),u_color_ramp:new c.aH(_,i.u_color_ramp),u_opacity:new c.aI(_,i.u_opacity)}),hillshade:(_,i)=>({u_matrix:new c.aJ(_,i.u_matrix),u_image:new c.aH(_,i.u_image),u_latrange:new c.aO(_,i.u_latrange),u_light:new c.aO(_,i.u_light),u_shadow:new c.aL(_,i.u_shadow),u_highlight:new c.aL(_,i.u_highlight),u_accent:new c.aL(_,i.u_accent)}),hillshadePrepare:(_,i)=>({u_matrix:new c.aJ(_,i.u_matrix),u_image:new c.aH(_,i.u_image),u_dimension:new c.aO(_,i.u_dimension),u_zoom:new c.aI(_,i.u_zoom),u_unpack:new c.aK(_,i.u_unpack)}),line:(_,i)=>({u_matrix:new c.aJ(_,i.u_matrix),u_ratio:new c.aI(_,i.u_ratio),u_device_pixel_ratio:new c.aI(_,i.u_device_pixel_ratio),u_units_to_pixels:new c.aO(_,i.u_units_to_pixels)}),lineGradient:(_,i)=>({u_matrix:new c.aJ(_,i.u_matrix),u_ratio:new c.aI(_,i.u_ratio),u_device_pixel_ratio:new c.aI(_,i.u_device_pixel_ratio),u_units_to_pixels:new c.aO(_,i.u_units_to_pixels),u_image:new c.aH(_,i.u_image),u_image_height:new c.aI(_,i.u_image_height)}),linePattern:(_,i)=>({u_matrix:new c.aJ(_,i.u_matrix),u_texsize:new c.aO(_,i.u_texsize),u_ratio:new c.aI(_,i.u_ratio),u_device_pixel_ratio:new c.aI(_,i.u_device_pixel_ratio),u_image:new c.aH(_,i.u_image),u_units_to_pixels:new c.aO(_,i.u_units_to_pixels),u_scale:new c.aN(_,i.u_scale),u_fade:new c.aI(_,i.u_fade)}),lineSDF:(_,i)=>({u_matrix:new c.aJ(_,i.u_matrix),u_ratio:new c.aI(_,i.u_ratio),u_device_pixel_ratio:new c.aI(_,i.u_device_pixel_ratio),u_units_to_pixels:new c.aO(_,i.u_units_to_pixels),u_patternscale_a:new c.aO(_,i.u_patternscale_a),u_patternscale_b:new c.aO(_,i.u_patternscale_b),u_sdfgamma:new c.aI(_,i.u_sdfgamma),u_image:new c.aH(_,i.u_image),u_tex_y_a:new c.aI(_,i.u_tex_y_a),u_tex_y_b:new c.aI(_,i.u_tex_y_b),u_mix:new c.aI(_,i.u_mix)}),raster:(_,i)=>({u_matrix:new c.aJ(_,i.u_matrix),u_tl_parent:new c.aO(_,i.u_tl_parent),u_scale_parent:new c.aI(_,i.u_scale_parent),u_buffer_scale:new c.aI(_,i.u_buffer_scale),u_fade_t:new c.aI(_,i.u_fade_t),u_opacity:new c.aI(_,i.u_opacity),u_image0:new c.aH(_,i.u_image0),u_image1:new c.aH(_,i.u_image1),u_brightness_low:new c.aI(_,i.u_brightness_low),u_brightness_high:new c.aI(_,i.u_brightness_high),u_saturation_factor:new c.aI(_,i.u_saturation_factor),u_contrast_factor:new c.aI(_,i.u_contrast_factor),u_spin_weights:new c.aN(_,i.u_spin_weights)}),symbolIcon:(_,i)=>({u_is_size_zoom_constant:new c.aH(_,i.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(_,i.u_is_size_feature_constant),u_size_t:new c.aI(_,i.u_size_t),u_size:new c.aI(_,i.u_size),u_camera_to_center_distance:new c.aI(_,i.u_camera_to_center_distance),u_pitch:new c.aI(_,i.u_pitch),u_rotate_symbol:new c.aH(_,i.u_rotate_symbol),u_aspect_ratio:new c.aI(_,i.u_aspect_ratio),u_fade_change:new c.aI(_,i.u_fade_change),u_matrix:new c.aJ(_,i.u_matrix),u_label_plane_matrix:new c.aJ(_,i.u_label_plane_matrix),u_coord_matrix:new c.aJ(_,i.u_coord_matrix),u_is_text:new c.aH(_,i.u_is_text),u_pitch_with_map:new c.aH(_,i.u_pitch_with_map),u_is_along_line:new c.aH(_,i.u_is_along_line),u_is_variable_anchor:new c.aH(_,i.u_is_variable_anchor),u_texsize:new c.aO(_,i.u_texsize),u_texture:new c.aH(_,i.u_texture),u_translation:new c.aO(_,i.u_translation),u_pitched_scale:new c.aI(_,i.u_pitched_scale)}),symbolSDF:(_,i)=>({u_is_size_zoom_constant:new c.aH(_,i.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(_,i.u_is_size_feature_constant),u_size_t:new c.aI(_,i.u_size_t),u_size:new c.aI(_,i.u_size),u_camera_to_center_distance:new c.aI(_,i.u_camera_to_center_distance),u_pitch:new c.aI(_,i.u_pitch),u_rotate_symbol:new c.aH(_,i.u_rotate_symbol),u_aspect_ratio:new c.aI(_,i.u_aspect_ratio),u_fade_change:new c.aI(_,i.u_fade_change),u_matrix:new c.aJ(_,i.u_matrix),u_label_plane_matrix:new c.aJ(_,i.u_label_plane_matrix),u_coord_matrix:new c.aJ(_,i.u_coord_matrix),u_is_text:new c.aH(_,i.u_is_text),u_pitch_with_map:new c.aH(_,i.u_pitch_with_map),u_is_along_line:new c.aH(_,i.u_is_along_line),u_is_variable_anchor:new c.aH(_,i.u_is_variable_anchor),u_texsize:new c.aO(_,i.u_texsize),u_texture:new c.aH(_,i.u_texture),u_gamma_scale:new c.aI(_,i.u_gamma_scale),u_device_pixel_ratio:new c.aI(_,i.u_device_pixel_ratio),u_is_halo:new c.aH(_,i.u_is_halo),u_translation:new c.aO(_,i.u_translation),u_pitched_scale:new c.aI(_,i.u_pitched_scale)}),symbolTextAndIcon:(_,i)=>({u_is_size_zoom_constant:new c.aH(_,i.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(_,i.u_is_size_feature_constant),u_size_t:new c.aI(_,i.u_size_t),u_size:new c.aI(_,i.u_size),u_camera_to_center_distance:new c.aI(_,i.u_camera_to_center_distance),u_pitch:new c.aI(_,i.u_pitch),u_rotate_symbol:new c.aH(_,i.u_rotate_symbol),u_aspect_ratio:new c.aI(_,i.u_aspect_ratio),u_fade_change:new c.aI(_,i.u_fade_change),u_matrix:new c.aJ(_,i.u_matrix),u_label_plane_matrix:new c.aJ(_,i.u_label_plane_matrix),u_coord_matrix:new c.aJ(_,i.u_coord_matrix),u_is_text:new c.aH(_,i.u_is_text),u_pitch_with_map:new c.aH(_,i.u_pitch_with_map),u_is_along_line:new c.aH(_,i.u_is_along_line),u_is_variable_anchor:new c.aH(_,i.u_is_variable_anchor),u_texsize:new c.aO(_,i.u_texsize),u_texsize_icon:new c.aO(_,i.u_texsize_icon),u_texture:new c.aH(_,i.u_texture),u_texture_icon:new c.aH(_,i.u_texture_icon),u_gamma_scale:new c.aI(_,i.u_gamma_scale),u_device_pixel_ratio:new c.aI(_,i.u_device_pixel_ratio),u_is_halo:new c.aH(_,i.u_is_halo),u_translation:new c.aO(_,i.u_translation),u_pitched_scale:new c.aI(_,i.u_pitched_scale)}),background:(_,i)=>({u_matrix:new c.aJ(_,i.u_matrix),u_opacity:new c.aI(_,i.u_opacity),u_color:new c.aL(_,i.u_color)}),backgroundPattern:(_,i)=>({u_matrix:new c.aJ(_,i.u_matrix),u_opacity:new c.aI(_,i.u_opacity),u_image:new c.aH(_,i.u_image),u_pattern_tl_a:new c.aO(_,i.u_pattern_tl_a),u_pattern_br_a:new c.aO(_,i.u_pattern_br_a),u_pattern_tl_b:new c.aO(_,i.u_pattern_tl_b),u_pattern_br_b:new c.aO(_,i.u_pattern_br_b),u_texsize:new c.aO(_,i.u_texsize),u_mix:new c.aI(_,i.u_mix),u_pattern_size_a:new c.aO(_,i.u_pattern_size_a),u_pattern_size_b:new c.aO(_,i.u_pattern_size_b),u_scale_a:new c.aI(_,i.u_scale_a),u_scale_b:new c.aI(_,i.u_scale_b),u_pixel_coord_upper:new c.aO(_,i.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(_,i.u_pixel_coord_lower),u_tile_units_to_pixels:new c.aI(_,i.u_tile_units_to_pixels)}),terrain:(_,i)=>({u_matrix:new c.aJ(_,i.u_matrix),u_texture:new c.aH(_,i.u_texture),u_ele_delta:new c.aI(_,i.u_ele_delta),u_fog_matrix:new c.aJ(_,i.u_fog_matrix),u_fog_color:new c.aL(_,i.u_fog_color),u_fog_ground_blend:new c.aI(_,i.u_fog_ground_blend),u_fog_ground_blend_opacity:new c.aI(_,i.u_fog_ground_blend_opacity),u_horizon_color:new c.aL(_,i.u_horizon_color),u_horizon_fog_blend:new c.aI(_,i.u_horizon_fog_blend)}),terrainDepth:(_,i)=>({u_matrix:new c.aJ(_,i.u_matrix),u_ele_delta:new c.aI(_,i.u_ele_delta)}),terrainCoords:(_,i)=>({u_matrix:new c.aJ(_,i.u_matrix),u_texture:new c.aH(_,i.u_texture),u_terrain_coords_id:new c.aI(_,i.u_terrain_coords_id),u_ele_delta:new c.aI(_,i.u_ele_delta)}),sky:(_,i)=>({u_sky_color:new c.aL(_,i.u_sky_color),u_horizon_color:new c.aL(_,i.u_horizon_color),u_horizon:new c.aI(_,i.u_horizon),u_sky_horizon_blend:new c.aI(_,i.u_sky_horizon_blend)})};class Gr{constructor(i,h,f){this.context=i;const m=i.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const xg={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Qu{constructor(i,h,f,m){this.length=h.length,this.attributes=f,this.itemSize=h.bytesPerElement,this.dynamicDraw=m,this.context=i;const y=i.gl;this.buffer=y.createBuffer(),i.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){if(i.length!==this.length)throw new Error(`Length of new data is ${i.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,h){for(let f=0;f<this.attributes.length;f++){const m=h.attributes[this.attributes[f].name];m!==void 0&&i.enableVertexAttribArray(m)}}setVertexAttribPointers(i,h,f){for(let m=0;m<this.attributes.length;m++){const y=this.attributes[m],S=h.attributes[y.name];S!==void 0&&i.vertexAttribPointer(S,y.components,i[xg[y.type]],!1,this.itemSize,y.offset+this.itemSize*(f||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ro=new WeakMap;function Os(_){var i;if(ro.has(_))return ro.get(_);{const h=(i=_.getParameter(_.VERSION))===null||i===void 0?void 0:i.startsWith("WebGL 2.0");return ro.set(_,h),h}}class Vt{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class dc extends Vt{getDefault(){return c.aM.transparent}set(i){const h=this.current;(i.r!==h.r||i.g!==h.g||i.b!==h.b||i.a!==h.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class wg extends Vt{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class No extends Vt{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class bg extends Vt{getDefault(){return[!0,!0,!0,!0]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||i[2]!==h[2]||i[3]!==h[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class dp extends Vt{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class Sg extends Vt{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class pp extends Vt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const h=this.current;(i.func!==h.func||i.ref!==h.ref||i.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class eh extends Vt{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||i[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class fp extends Vt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;i?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=i,this.dirty=!1}}class mp extends Vt{getDefault(){return[0,1]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class gp extends Vt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;i?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=i,this.dirty=!1}}class yp extends Vt{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class so extends Vt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;i?h.enable(h.BLEND):h.disable(h.BLEND),this.current=i,this.dirty=!1}}class _p extends Vt{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class kg extends Vt{getDefault(){return c.aM.transparent}set(i){const h=this.current;(i.r!==h.r||i.g!==h.g||i.b!==h.b||i.a!==h.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class vp extends Vt{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class ol extends Vt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;i?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=i,this.dirty=!1}}class Tg extends Vt{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class pc extends Vt{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}class Cg extends Vt{getDefault(){return null}set(i){(i!==this.current||this.dirty)&&(this.gl.useProgram(i),this.current=i,this.dirty=!1)}}class Mg extends Vt{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class xp extends Vt{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||i[2]!==h[2]||i[3]!==h[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class wp extends Vt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class bp extends Vt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class th extends Vt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class Sp extends Vt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class fc extends Vt{getDefault(){return null}set(i){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class ps extends Vt{getDefault(){return null}set(i){var h;if(i===this.current&&!this.dirty)return;const f=this.gl;Os(f)?f.bindVertexArray(i):(h=f.getExtension("OES_vertex_array_object"))===null||h===void 0||h.bindVertexArrayOES(i),this.current=i,this.dirty=!1}}class nh extends Vt{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class ih extends Vt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class rh extends Vt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class mc extends Vt{constructor(i,h){super(i),this.context=i,this.parent=h}getDefault(){return null}}class sh extends mc{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class oo extends mc{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class oh extends mc{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Eg{constructor(i,h,f,m,y){this.context=i,this.width=h,this.height=f;const S=i.gl,C=this.framebuffer=S.createFramebuffer();if(this.colorAttachment=new sh(i,C),m)this.depthAttachment=y?new oh(i,C):new oo(i,C);else if(y)throw new Error("Stencil cannot be set without depth");if(S.checkFramebufferStatus(S.FRAMEBUFFER)!==S.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const i=this.context.gl,h=this.colorAttachment.get();if(h&&i.deleteTexture(h),this.depthAttachment){const f=this.depthAttachment.get();f&&i.deleteRenderbuffer(f)}i.deleteFramebuffer(this.framebuffer)}}class pn{constructor(i,h,f){this.blendFunction=i,this.blendColor=h,this.mask=f}}pn.Replace=[1,0],pn.disabled=new pn(pn.Replace,c.aM.transparent,[!1,!1,!1,!1]),pn.unblended=new pn(pn.Replace,c.aM.transparent,[!0,!0,!0,!0]),pn.alphaBlended=new pn([1,771],c.aM.transparent,[!0,!0,!0,!0]);class Ig{constructor(i){var h,f;if(this.gl=i,this.clearColor=new dc(this),this.clearDepth=new wg(this),this.clearStencil=new No(this),this.colorMask=new bg(this),this.depthMask=new dp(this),this.stencilMask=new Sg(this),this.stencilFunc=new pp(this),this.stencilOp=new eh(this),this.stencilTest=new fp(this),this.depthRange=new mp(this),this.depthTest=new gp(this),this.depthFunc=new yp(this),this.blend=new so(this),this.blendFunc=new _p(this),this.blendColor=new kg(this),this.blendEquation=new vp(this),this.cullFace=new ol(this),this.cullFaceSide=new Tg(this),this.frontFace=new pc(this),this.program=new Cg(this),this.activeTexture=new Mg(this),this.viewport=new xp(this),this.bindFramebuffer=new wp(this),this.bindRenderbuffer=new bp(this),this.bindTexture=new th(this),this.bindVertexBuffer=new Sp(this),this.bindElementBuffer=new fc(this),this.bindVertexArray=new ps(this),this.pixelStoreUnpack=new nh(this),this.pixelStoreUnpackPremultiplyAlpha=new ih(this),this.pixelStoreUnpackFlipY=new rh(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),Os(i)){this.HALF_FLOAT=i.HALF_FLOAT;const m=i.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(h=i.RGBA16F)!==null&&h!==void 0?h:m==null?void 0:m.RGBA16F_EXT,this.RGB16F=(f=i.RGB16F)!==null&&f!==void 0?f:m==null?void 0:m.RGB16F_EXT,i.getExtension("EXT_color_buffer_float")}else{i.getExtension("EXT_color_buffer_half_float"),i.getExtension("OES_texture_half_float_linear");const m=i.getExtension("OES_texture_half_float");this.HALF_FLOAT=m==null?void 0:m.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,h){return new Gr(this,i,h)}createVertexBuffer(i,h,f){return new Qu(this,i,h,f)}createRenderbuffer(i,h,f){const m=this.gl,y=m.createRenderbuffer();return this.bindRenderbuffer.set(y),m.renderbufferStorage(m.RENDERBUFFER,i,h,f),this.bindRenderbuffer.set(null),y}createFramebuffer(i,h,f,m){return new Eg(this,i,h,f,m)}clear({color:i,depth:h,stencil:f}){const m=this.gl;let y=0;i&&(y|=m.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(y|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),f!==void 0&&(y|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),m.clear(y)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){c.aE(i.blendFunction,pn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}createVertexArray(){var i;return Os(this.gl)?this.gl.createVertexArray():(i=this.gl.getExtension("OES_vertex_array_object"))===null||i===void 0?void 0:i.createVertexArrayOES()}deleteVertexArray(i){var h;return Os(this.gl)?this.gl.deleteVertexArray(i):(h=this.gl.getExtension("OES_vertex_array_object"))===null||h===void 0?void 0:h.deleteVertexArrayOES(i)}unbindVAO(){this.bindVertexArray.set(null)}}class Tt{constructor(i,h,f){this.func=i,this.mask=h,this.range=f}}Tt.ReadOnly=!1,Tt.ReadWrite=!0,Tt.disabled=new Tt(519,Tt.ReadOnly,[0,1]);const gc=7680;class Kt{constructor(i,h,f,m,y,S){this.test=i,this.ref=h,this.mask=f,this.fail=m,this.depthFail=y,this.pass=S}}Kt.disabled=new Kt({func:519,mask:0},0,0,gc,gc,gc);class Ht{constructor(i,h,f){this.enable=i,this.mode=h,this.frontFace=f}}let ao;function al(_,i,h,f,m){const y=_.context,S=y.gl,C=_.useProgram("collisionBox"),M=[];let D=0,O=0;for(let se=0;se<f.length;se++){const ae=f[se],Y=i.getTile(ae).getBucket(h);if(!Y)continue;const de=m?Y.textCollisionBox:Y.iconCollisionBox,fe=Y.collisionCircleArray;if(fe.length>0){const _e=c.H();c.aQ(_e,Y.placementInvProjMatrix,_.transform.glCoordMatrix),c.aQ(_e,_e,Y.placementViewportMatrix),M.push({circleArray:fe,circleOffset:O,transform:ae.posMatrix,invTransform:_e,coord:ae}),D+=fe.length/4,O=D}de&&C.draw(y,S.LINES,Tt.disabled,Kt.disabled,_.colorModeForRenderPass(),Ht.disabled,{u_matrix:ae.posMatrix,u_pixel_extrude_scale:[1/(L=_.transform).width,1/L.height]},_.style.map.terrain&&_.style.map.terrain.getTerrainData(ae),h.id,de.layoutVertexBuffer,de.indexBuffer,de.segments,null,_.transform.zoom,null,null,de.collisionVertexBuffer)}var L;if(!m||!M.length)return;const U=_.useProgram("collisionCircle"),Z=new c.aR;Z.resize(4*D),Z._trim();let G=0;for(const se of M)for(let ae=0;ae<se.circleArray.length/4;ae++){const Y=4*ae,de=se.circleArray[Y+0],fe=se.circleArray[Y+1],_e=se.circleArray[Y+2],Te=se.circleArray[Y+3];Z.emplace(G++,de,fe,_e,Te,0),Z.emplace(G++,de,fe,_e,Te,1),Z.emplace(G++,de,fe,_e,Te,2),Z.emplace(G++,de,fe,_e,Te,3)}(!ao||ao.length<2*D)&&(ao=function(se){const ae=2*se,Y=new c.aT;Y.resize(ae),Y._trim();for(let de=0;de<ae;de++){const fe=6*de;Y.uint16[fe+0]=4*de+0,Y.uint16[fe+1]=4*de+1,Y.uint16[fe+2]=4*de+2,Y.uint16[fe+3]=4*de+2,Y.uint16[fe+4]=4*de+3,Y.uint16[fe+5]=4*de+0}return Y}(D));const te=y.createIndexBuffer(ao,!0),re=y.createVertexBuffer(Z,c.aS.members,!0);for(const se of M){const ae=io(se.transform,se.invTransform,_.transform);U.draw(y,S.TRIANGLES,Tt.disabled,Kt.disabled,_.colorModeForRenderPass(),Ht.disabled,ae,_.style.map.terrain&&_.style.map.terrain.getTerrainData(se.coord),h.id,re,te,c.a0.simpleSegment(0,2*se.circleOffset,se.circleArray.length,se.circleArray.length/2),null,_.transform.zoom,null,null,null)}re.destroy(),te.destroy()}Ht.disabled=new Ht(!1,1029,2305),Ht.backCCW=new Ht(!0,1029,2305);const ll=c.an(new Float32Array(16));function ah(_,i,h,f,m,y){const{horizontalAlign:S,verticalAlign:C}=c.au(_);return new c.P((-(S-.5)*i/m+f[0])*y,(-(C-.5)*h/m+f[1])*y)}function lo(_,i,h,f,m,y){const S=i.tileAnchorPoint.add(new c.P(i.translation[0],i.translation[1]));if(i.pitchWithMap){let C=f.mult(y);h||(C=C.rotate(-m));const M=S.add(C);return ne(M.x,M.y,i.labelPlaneMatrix,i.getElevation).point}if(h){const C=be(i.tileAnchorPoint.x+1,i.tileAnchorPoint.y,i).point.sub(_),M=Math.atan(C.y/C.x)+(C.x<0?Math.PI:0);return _.add(f.rotate(M))}return _.add(f)}function Vo(_,i,h,f,m,y,S,C,M,D,O,L,U,Z){const G=_.text.placedSymbolArray,te=_.text.dynamicLayoutVertexArray,re=_.icon.dynamicLayoutVertexArray,se={};te.clear();for(let ae=0;ae<G.length;ae++){const Y=G.get(ae),de=Y.hidden||!Y.crossTileID||_.allowVerticalPlacement&&!Y.placedOrientation?null:f[Y.crossTileID];if(de){const fe=new c.P(Y.anchorX,Y.anchorY),_e={getElevation:Z,width:m.width,height:m.height,labelPlaneMatrix:y,lineVertexArray:null,pitchWithMap:h,projection:O,projectionCache:null,tileAnchorPoint:fe,translation:L,unwrappedTileID:U},Te=h?ne(fe.x,fe.y,S,Z):be(fe.x,fe.y,_e),Pe=N(m.cameraToCenterDistance,Te.signedDistanceFromCamera);let $e=c.ai(_.textSizeData,M,Y)*Pe/c.ap;h&&($e*=_.tilePixelRatio/C);const{width:He,height:Be,anchor:Le,textOffset:Ye,textBoxScale:pt}=de,Ne=ah(Le,He,Be,Ye,pt,$e),Ue=O.getPitchedTextCorrection(m,fe.add(new c.P(L[0],L[1])),U),ht=lo(Te.point,_e,i,Ne,m.angle,Ue),Qt=_.allowVerticalPlacement&&Y.placedOrientation===c.ah.vertical?Math.PI/2:0;for(let wt=0;wt<Y.numGlyphs;wt++)c.aj(te,ht,Qt);D&&Y.associatedIconIndex>=0&&(se[Y.associatedIconIndex]={shiftedAnchor:ht,angle:Qt})}else at(Y.numGlyphs,te)}if(D){re.clear();const ae=_.icon.placedSymbolArray;for(let Y=0;Y<ae.length;Y++){const de=ae.get(Y);if(de.hidden)at(de.numGlyphs,re);else{const fe=se[Y];if(fe)for(let _e=0;_e<de.numGlyphs;_e++)c.aj(re,fe.shiftedAnchor,fe.angle);else at(de.numGlyphs,re)}}_.icon.dynamicLayoutVertexBuffer.updateData(re)}_.text.dynamicLayoutVertexBuffer.updateData(te)}function rr(_,i,h){return h.iconsInText&&i?"symbolTextAndIcon":_?"symbolSDF":"symbolIcon"}function lh(_,i,h,f,m,y,S,C,M,D,O,L){const U=_.context,Z=U.gl,G=_.transform,te=to(),re=C==="map",se=M==="map",ae=C!=="viewport"&&h.layout.get("symbol-placement")!=="point",Y=re&&!se&&!ae,de=!se&&ae,fe=!h.layout.get("symbol-sort-key").isConstant();let _e=!1;const Te=_.depthModeForSublayer(0,Tt.ReadOnly),Pe=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),$e=[],He=te.getCircleRadiusCorrection(G);for(const Be of f){const Le=i.getTile(Be),Ye=Le.getBucket(h);if(!Ye)continue;const pt=m?Ye.text:Ye.icon;if(!pt||!pt.segments.get().length||!pt.hasVisibleVertices)continue;const Ne=pt.programConfigurations.get(h.id),Ue=m||Ye.sdfIcons,ht=m?Ye.textSizeData:Ye.iconSizeData,Qt=se||G.pitch!==0,wt=_.useProgram(rr(Ue,m,Ye),Ne),Mt=c.ag(ht,G.zoom),en=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Be);let Zn,Er,tn,Si,ai=[0,0],Wn=null;if(m)Er=Le.glyphAtlasTexture,tn=Z.LINEAR,Zn=Le.glyphAtlasTexture.size,Ye.iconsInText&&(ai=Le.imageAtlasTexture.size,Wn=Le.imageAtlasTexture,Si=Qt||_.options.rotating||_.options.zooming||ht.kind==="composite"||ht.kind==="camera"?Z.LINEAR:Z.NEAREST);else{const Pt=h.layout.get("icon-size").constantOr(0)!==1||Ye.iconsNeedLinear;Er=Le.imageAtlasTexture,tn=Ue||_.options.rotating||_.options.zooming||Pt||Qt?Z.LINEAR:Z.NEAREST,Zn=Le.imageAtlasTexture.size}const li=Ct(Le,1,_.transform.zoom),Jr=de?Be.posMatrix:ll,na=Ds(Jr,se,re,_.transform,li),Oc=Wr(Jr,se,re,_.transform,li),ia=Wr(Be.posMatrix,se,re,_.transform,li),ar=te.translatePosition(_.transform,Le,y,S),Lc=Pe&&Ye.hasTextData(),Dh=h.layout.get("icon-text-fit")!=="none"&&Lc&&Ye.hasIconData();if(ae){const Pt=_.style.map.terrain?(ra,sa)=>_.style.map.terrain.getElevation(Be,ra,sa):null,fo=h.layout.get("text-rotation-alignment")==="map";W(Ye,Be.posMatrix,_,m,na,ia,se,D,fo,te,Be.toUnwrapped(),G.width,G.height,ar,Pt)}const lr=Be.posMatrix,cr=m&&Pe||Dh,Ls=ae||cr?ll:na,Ir=Oc,Vn=Ue&&h.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Gn;Gn=Ue?Ye.iconsInText?Xu(ht.kind,Mt,Y,se,ae,cr,_,lr,Ls,Ir,ar,Zn,ai,He):sl(ht.kind,Mt,Y,se,ae,cr,_,lr,Ls,Ir,ar,m,Zn,!0,He):hp(ht.kind,Mt,Y,se,ae,cr,_,lr,Ls,Ir,ar,m,Zn,He);const ji={program:wt,buffers:pt,uniformValues:Gn,atlasTexture:Er,atlasTextureIcon:Wn,atlasInterpolation:tn,atlasInterpolationIcon:Si,isSDF:Ue,hasHalo:Vn};if(fe&&Ye.canOverlap){_e=!0;const Pt=pt.segments.get();for(const fo of Pt)$e.push({segments:new c.a0([fo]),sortKey:fo.sortKey,state:ji,terrainData:en})}else $e.push({segments:pt.segments,sortKey:0,state:ji,terrainData:en})}_e&&$e.sort((Be,Le)=>Be.sortKey-Le.sortKey);for(const Be of $e){const Le=Be.state;if(U.activeTexture.set(Z.TEXTURE0),Le.atlasTexture.bind(Le.atlasInterpolation,Z.CLAMP_TO_EDGE),Le.atlasTextureIcon&&(U.activeTexture.set(Z.TEXTURE1),Le.atlasTextureIcon&&Le.atlasTextureIcon.bind(Le.atlasInterpolationIcon,Z.CLAMP_TO_EDGE)),Le.isSDF){const Ye=Le.uniformValues;Le.hasHalo&&(Ye.u_is_halo=1,ch(Le.buffers,Be.segments,h,_,Le.program,Te,O,L,Ye,Be.terrainData)),Ye.u_is_halo=0}ch(Le.buffers,Be.segments,h,_,Le.program,Te,O,L,Le.uniformValues,Be.terrainData)}}function ch(_,i,h,f,m,y,S,C,M,D){const O=f.context;m.draw(O,O.gl.TRIANGLES,y,S,C,Ht.disabled,M,D,h.id,_.layoutVertexBuffer,_.indexBuffer,i,h.paint,f.transform.zoom,_.programConfigurations.get(h.id),_.dynamicLayoutVertexBuffer,_.opacityVertexBuffer)}function uh(_,i,h,f){const m=_.context,y=m.gl,S=Kt.disabled,C=new pn([y.ONE,y.ONE],c.aM.transparent,[!0,!0,!0,!0]),M=i.getBucket(h);if(!M)return;const D=f.key;let O=h.heatmapFbos.get(D);O||(O=cl(m,i.tileSize,i.tileSize),h.heatmapFbos.set(D,O)),m.bindFramebuffer.set(O.framebuffer),m.viewport.set([0,0,i.tileSize,i.tileSize]),m.clear({color:c.aM.transparent});const L=M.programConfigurations.get(h.id),U=_.useProgram("heatmap",L),Z=_.style.map.terrain.getTerrainData(f);U.draw(m,y.TRIANGLES,Tt.disabled,S,C,Ht.disabled,bi(f.posMatrix,i,_.transform.zoom,h.paint.get("heatmap-intensity")),Z,h.id,M.layoutVertexBuffer,M.indexBuffer,M.segments,h.paint,_.transform.zoom,L)}function co(_,i,h){const f=_.context,m=f.gl;f.setColorMode(_.colorModeForRenderPass());const y=ul(f,i),S=h.key,C=i.heatmapFbos.get(S);C&&(f.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,C.colorAttachment.get()),f.activeTexture.set(m.TEXTURE1),y.bind(m.LINEAR,m.CLAMP_TO_EDGE),_.useProgram("heatmapTexture").draw(f,m.TRIANGLES,Tt.disabled,Kt.disabled,_.colorModeForRenderPass(),Ht.disabled,lc(_,i,0,1),null,i.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments,i.paint,_.transform.zoom),C.destroy(),i.heatmapFbos.delete(S))}function cl(_,i,h){var f,m;const y=_.gl,S=y.createTexture();y.bindTexture(y.TEXTURE_2D,S),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,y.LINEAR),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,y.LINEAR);const C=(f=_.HALF_FLOAT)!==null&&f!==void 0?f:y.UNSIGNED_BYTE,M=(m=_.RGBA16F)!==null&&m!==void 0?m:y.RGBA;y.texImage2D(y.TEXTURE_2D,0,M,i,h,0,y.RGBA,C,null);const D=_.createFramebuffer(i,h,!1,!1);return D.colorAttachment.set(S),D}function ul(_,i){return i.colorRampTexture||(i.colorRampTexture=new xt(_,i.colorRamp,_.gl.RGBA)),i.colorRampTexture}function $o(_,i,h,f,m){if(!h||!f||!f.imageAtlas)return;const y=f.imageAtlas.patternPositions;let S=y[h.to.toString()],C=y[h.from.toString()];if(!S&&C&&(S=C),!C&&S&&(C=S),!S||!C){const M=m.getPaintProperty(i);S=y[M],C=y[M]}S&&C&&_.setConstantPatternPositions(S,C)}function hl(_,i,h,f,m,y,S){const C=_.context.gl,M="fill-pattern",D=h.paint.get(M),O=D&&D.constantOr(1),L=h.getCrossfadeParameters();let U,Z,G,te,re;S?(Z=O&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",U=C.LINES):(Z=O?"fillPattern":"fill",U=C.TRIANGLES);const se=D.constantOr(null);for(const ae of f){const Y=i.getTile(ae);if(O&&!Y.patternsLoaded())continue;const de=Y.getBucket(h);if(!de)continue;const fe=de.programConfigurations.get(h.id),_e=_.useProgram(Z,fe),Te=_.style.map.terrain&&_.style.map.terrain.getTerrainData(ae);O&&(_.context.activeTexture.set(C.TEXTURE0),Y.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),fe.updatePaintBuffers(L)),$o(fe,M,se,Y,h);const Pe=Te?ae:null,$e=_.translatePosMatrix(Pe?Pe.posMatrix:ae.posMatrix,Y,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(S){te=de.indexBuffer2,re=de.segments2;const He=[C.drawingBufferWidth,C.drawingBufferHeight];G=Z==="fillOutlinePattern"&&O?ap($e,_,L,Y,He):mg($e,He)}else te=de.indexBuffer,re=de.segments,G=O?op($e,_,L,Y):Bo($e);_e.draw(_.context,U,m,_.stencilModeForClipping(ae),y,Ht.disabled,G,Te,h.id,de.layoutVertexBuffer,te,re,h.paint,_.transform.zoom,fe)}}function yc(_,i,h,f,m,y,S){const C=_.context,M=C.gl,D="fill-extrusion-pattern",O=h.paint.get(D),L=O.constantOr(1),U=h.getCrossfadeParameters(),Z=h.paint.get("fill-extrusion-opacity"),G=O.constantOr(null);for(const te of f){const re=i.getTile(te),se=re.getBucket(h);if(!se)continue;const ae=_.style.map.terrain&&_.style.map.terrain.getTerrainData(te),Y=se.programConfigurations.get(h.id),de=_.useProgram(L?"fillExtrusionPattern":"fillExtrusion",Y);L&&(_.context.activeTexture.set(M.TEXTURE0),re.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),Y.updatePaintBuffers(U)),$o(Y,D,G,re,h);const fe=_.translatePosMatrix(te.posMatrix,re,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),_e=h.paint.get("fill-extrusion-vertical-gradient"),Te=L?ac(fe,_,_e,Z,te,U,re):il(fe,_,_e,Z);de.draw(C,C.gl.TRIANGLES,m,y,S,Ht.backCCW,Te,ae,h.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,h.paint,_.transform.zoom,Y,_.style.map.terrain&&se.centroidVertexBuffer)}}function jo(_,i,h,f,m,y,S){const C=_.context,M=C.gl,D=h.fbo;if(!D)return;const O=_.useProgram("hillshade"),L=_.style.map.terrain&&_.style.map.terrain.getTerrainData(i);C.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,D.colorAttachment.get()),O.draw(C,M.TRIANGLES,m,y,S,Ht.disabled,((U,Z,G,te)=>{const re=G.paint.get("hillshade-shadow-color"),se=G.paint.get("hillshade-highlight-color"),ae=G.paint.get("hillshade-accent-color");let Y=G.paint.get("hillshade-illumination-direction")*(Math.PI/180);G.paint.get("hillshade-illumination-anchor")==="viewport"&&(Y-=U.transform.angle);const de=!U.options.moving;return{u_matrix:te?te.posMatrix:U.transform.calculatePosMatrix(Z.tileID.toUnwrapped(),de),u_image:0,u_latrange:cc(0,Z.tileID),u_light:[G.paint.get("hillshade-exaggeration"),Y],u_shadow:re,u_highlight:se,u_accent:ae}})(_,h,f,L?i:null),L,f.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments)}function Uo(_,i,h,f,m,y){const S=_.context,C=S.gl,M=i.dem;if(M&&M.data){const D=M.dim,O=M.stride,L=M.getPixels();if(S.activeTexture.set(C.TEXTURE1),S.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||_.getTileTexture(O),i.demTexture){const Z=i.demTexture;Z.update(L,{premultiply:!1}),Z.bind(C.NEAREST,C.CLAMP_TO_EDGE)}else i.demTexture=new xt(S,L,C.RGBA,{premultiply:!1}),i.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE);S.activeTexture.set(C.TEXTURE0);let U=i.fbo;if(!U){const Z=new xt(S,{width:D,height:D,data:null},C.RGBA);Z.bind(C.LINEAR,C.CLAMP_TO_EDGE),U=i.fbo=S.createFramebuffer(D,D,!0,!1),U.colorAttachment.set(Z.texture)}S.bindFramebuffer.set(U.framebuffer),S.viewport.set([0,0,D,D]),_.useProgram("hillshadePrepare").draw(S,C.TRIANGLES,f,m,y,Ht.disabled,((Z,G)=>{const te=G.stride,re=c.H();return c.aP(re,0,c.X,-c.X,0,0,1),c.J(re,re,[0,-c.X,0]),{u_matrix:re,u_image:1,u_dimension:[te,te],u_zoom:Z.overscaledZ,u_unpack:G.getUnpackVector()}})(i.tileID,M),null,h.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments),i.needsHillshadePrepare=!1}}function kp(_,i,h,f,m,y){const S=f.paint.get("raster-fade-duration");if(!y&&S>0){const C=P.now(),M=(C-_.timeAdded)/S,D=i?(C-i.timeAdded)/S:-1,O=h.getSource(),L=m.coveringZoomLevel({tileSize:O.tileSize,roundZoom:O.roundZoom}),U=!i||Math.abs(i.tileID.overscaledZ-L)>Math.abs(_.tileID.overscaledZ-L),Z=U&&_.refreshedUponExpiration?1:c.ac(U?M:1-D,0,1);return _.refreshedUponExpiration&&M>=1&&(_.refreshedUponExpiration=!1),i?{opacity:1,mix:1-Z}:{opacity:Z,mix:0}}return{opacity:1,mix:0}}const hh=new c.aM(1,0,0,1),Lt=new c.aM(0,1,0,1),_c=new c.aM(0,0,1,1),Pg=new c.aM(1,0,1,1),Tp=new c.aM(0,1,1,1);function qo(_,i,h,f){vc(_,0,i+h/2,_.transform.width,h,f)}function Cp(_,i,h,f){vc(_,i-h/2,0,h,_.transform.height,f)}function vc(_,i,h,f,m,y){const S=_.context,C=S.gl;C.enable(C.SCISSOR_TEST),C.scissor(i*_.pixelRatio,h*_.pixelRatio,f*_.pixelRatio,m*_.pixelRatio),S.clear({color:y}),C.disable(C.SCISSOR_TEST)}function Mp(_,i,h){const f=_.context,m=f.gl,y=h.posMatrix,S=_.useProgram("debug"),C=Tt.disabled,M=Kt.disabled,D=_.colorModeForRenderPass(),O="$debug",L=_.style.map.terrain&&_.style.map.terrain.getTerrainData(h);f.activeTexture.set(m.TEXTURE0);const U=i.getTileByID(h.key).latestRawTileData,Z=Math.floor((U&&U.byteLength||0)/1024),G=i.getTile(h).tileSize,te=512/Math.min(G,512)*(h.overscaledZ/_.transform.zoom)*.5;let re=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(re+=` => ${h.overscaledZ}`),function(se,ae){se.initDebugOverlayCanvas();const Y=se.debugOverlayCanvas,de=se.context.gl,fe=se.debugOverlayCanvas.getContext("2d");fe.clearRect(0,0,Y.width,Y.height),fe.shadowColor="white",fe.shadowBlur=2,fe.lineWidth=1.5,fe.strokeStyle="white",fe.textBaseline="top",fe.font="bold 36px Open Sans, sans-serif",fe.fillText(ae,5,5),fe.strokeText(ae,5,5),se.debugOverlayTexture.update(Y),se.debugOverlayTexture.bind(de.LINEAR,de.CLAMP_TO_EDGE)}(_,`${re} ${Z}kB`),S.draw(f,m.TRIANGLES,C,M,pn.alphaBlended,Ht.disabled,rl(y,c.aM.transparent,te),null,O,_.debugBuffer,_.quadTriangleIndexBuffer,_.debugSegments),S.draw(f,m.LINE_STRIP,C,M,D,Ht.disabled,rl(y,c.aM.red),L,O,_.debugBuffer,_.tileBorderIndexBuffer,_.debugSegments)}function Ep(_,i,h){const f=_.context,m=f.gl,y=_.colorModeForRenderPass(),S=new Tt(m.LEQUAL,Tt.ReadWrite,_.depthRangeFor3D),C=_.useProgram("terrain"),M=i.getTerrainMesh();f.bindFramebuffer.set(null),f.viewport.set([0,0,_.width,_.height]);for(const D of h){const O=_.renderToTexture.getTexture(D),L=i.getTerrainData(D.tileID);f.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,O.texture);const U=_.transform.calculatePosMatrix(D.tileID.toUnwrapped()),Z=i.getMeshFrameDelta(_.transform.zoom),G=_.transform.calculateFogMatrix(D.tileID.toUnwrapped()),te=Gu(U,Z,G,_.style.sky,_.transform.pitch);C.draw(f,m.TRIANGLES,S,Kt.disabled,y,Ht.backCCW,te,L,"terrain",M.vertexBuffer,M.indexBuffer,M.segments)}}class xc{constructor(i,h,f){this.vertexBuffer=i,this.indexBuffer=h,this.segments=f}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class wc{constructor(i,h){this.context=new Ig(i),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=ut.maxUnderzooming+ut.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Zu}resize(i,h,f){if(this.width=Math.floor(i*f),this.height=Math.floor(h*f),this.pixelRatio=f,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style._order)this.style._layers[m].resize()}setup(){const i=this.context,h=new c.aX;h.emplaceBack(0,0),h.emplaceBack(c.X,0),h.emplaceBack(0,c.X),h.emplaceBack(c.X,c.X),this.tileExtentBuffer=i.createVertexBuffer(h,no.members),this.tileExtentSegments=c.a0.simpleSegment(0,0,4,2);const f=new c.aX;f.emplaceBack(0,0),f.emplaceBack(c.X,0),f.emplaceBack(0,c.X),f.emplaceBack(c.X,c.X),this.debugBuffer=i.createVertexBuffer(f,no.members),this.debugSegments=c.a0.simpleSegment(0,0,4,5);const m=new c.$;m.emplaceBack(0,0,0,0),m.emplaceBack(c.X,0,c.X,0),m.emplaceBack(0,c.X,0,c.X),m.emplaceBack(c.X,c.X,c.X,c.X),this.rasterBoundsBuffer=i.createVertexBuffer(m,As.members),this.rasterBoundsSegments=c.a0.simpleSegment(0,0,4,2);const y=new c.aX;y.emplaceBack(0,0),y.emplaceBack(1,0),y.emplaceBack(0,1),y.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(y,no.members),this.viewportSegments=c.a0.simpleSegment(0,0,4,2);const S=new c.aZ;S.emplaceBack(0),S.emplaceBack(1),S.emplaceBack(3),S.emplaceBack(2),S.emplaceBack(0),this.tileBorderIndexBuffer=i.createIndexBuffer(S);const C=new c.aY;C.emplaceBack(0,1,2),C.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(C);const M=this.context.gl;this.stencilClearMode=new Kt({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO)}clearStencil(){const i=this.context,h=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const f=c.H();c.aP(f,0,this.width,this.height,0,0,1),c.K(f,f,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(i,h.TRIANGLES,Tt.disabled,this.stencilClearMode,pn.disabled,Ht.disabled,wi(f),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(i,h){if(this.currentStencilSource===i.source||!i.isTileClipped()||!h||!h.length)return;this.currentStencilSource=i.source;const f=this.context,m=f.gl;this.nextStencilID+h.length>256&&this.clearStencil(),f.setColorMode(pn.disabled),f.setDepthMode(Tt.disabled);const y=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of h){const C=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,M=this.style.map.terrain&&this.style.map.terrain.getTerrainData(S);y.draw(f,m.TRIANGLES,Tt.disabled,new Kt({func:m.ALWAYS,mask:0},C,255,m.KEEP,m.KEEP,m.REPLACE),pn.disabled,Ht.disabled,wi(S.posMatrix),M,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,h=this.context.gl;return new Kt({func:h.NOTEQUAL,mask:255},i,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(i){const h=this.context.gl;return new Kt({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(i){const h=this.context.gl,f=i.sort((S,C)=>C.overscaledZ-S.overscaledZ),m=f[f.length-1].overscaledZ,y=f[0].overscaledZ-m+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const S={};for(let C=0;C<y;C++)S[C+m]=new Kt({func:h.GEQUAL,mask:255},C+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=y,[S,f]}return[{[m]:Kt.disabled},f]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new pn([i.CONSTANT_COLOR,i.ONE],new c.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?pn.unblended:pn.alphaBlended}depthModeForSublayer(i,h,f){if(!this.opaquePassEnabledForLayer())return Tt.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new Tt(f||this.context.gl.LEQUAL,h,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,h){this.style=i,this.options=h,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(P.now()),this.imageManager.beginFrame();const f=this.style._order,m=this.style.sourceCaches,y={},S={},C={};for(const M in m){const D=m[M];D.used&&D.prepare(this.context),y[M]=D.getVisibleCoordinates(),S[M]=y[M].slice().reverse(),C[M]=D.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let M=0;M<f.length;M++)if(this.style._layers[f[M]].is3D()){this.opaquePassCutoff=M;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const M of f){const D=this.style._layers[M];if(!D.hasOffscreenPass()||D.isHidden(this.transform.zoom))continue;const O=S[D.source];(D.type==="custom"||O.length)&&this.renderLayer(this,m[D.source],D,O)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?c.aM.black:c.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(M,D){const O=M.context,L=O.gl,U=((se,ae,Y)=>({u_sky_color:se.properties.get("sky-color"),u_horizon_color:se.properties.get("horizon-color"),u_horizon:(ae.height/2+ae.getHorizon())*Y,u_sky_horizon_blend:se.properties.get("sky-horizon-blend")*ae.height/2*Y}))(D,M.style.map.transform,M.pixelRatio),Z=new Tt(L.LEQUAL,Tt.ReadWrite,[0,1]),G=Kt.disabled,te=M.colorModeForRenderPass(),re=M.useProgram("sky");if(!D.mesh){const se=new c.aX;se.emplaceBack(-1,-1),se.emplaceBack(1,-1),se.emplaceBack(1,1),se.emplaceBack(-1,1);const ae=new c.aY;ae.emplaceBack(0,1,2),ae.emplaceBack(0,2,3),D.mesh=new xc(O.createVertexBuffer(se,no.members),O.createIndexBuffer(ae),c.a0.simpleSegment(0,0,se.length,ae.length))}re.draw(O,L.TRIANGLES,Z,G,te,Ht.disabled,U,void 0,"sky",D.mesh.vertexBuffer,D.mesh.indexBuffer,D.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(i._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=f.length-1;this.currentLayer>=0;this.currentLayer--){const M=this.style._layers[f[this.currentLayer]],D=m[M.source],O=y[M.source];this._renderTileClippingMasks(M,O),this.renderLayer(this,D,M,O)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<f.length;this.currentLayer++){const M=this.style._layers[f[this.currentLayer]],D=m[M.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(M))continue;const O=(M.type==="symbol"?C:S)[M.source];this._renderTileClippingMasks(M,y[M.source]),this.renderLayer(this,D,M,O)}if(this.options.showTileBoundaries){const M=function(D,O){let L=null;const U=Object.values(D._layers).flatMap(re=>re.source&&!re.isHidden(O)?[D.sourceCaches[re.source]]:[]),Z=U.filter(re=>re.getSource().type==="vector"),G=U.filter(re=>re.getSource().type!=="vector"),te=re=>{(!L||L.getSource().maxzoom<re.getSource().maxzoom)&&(L=re)};return Z.forEach(re=>te(re)),L||G.forEach(re=>te(re)),L}(this.style,this.transform.zoom);M&&function(D,O,L){for(let U=0;U<L.length;U++)Mp(D,O,L[U])}(this,M,M.getVisibleCoordinates())}this.options.showPadding&&function(M){const D=M.transform.padding;qo(M,M.transform.height-(D.top||0),3,hh),qo(M,D.bottom||0,3,Lt),Cp(M,D.left||0,3,_c),Cp(M,M.transform.width-(D.right||0),3,Pg);const O=M.transform.centerPoint;(function(L,U,Z,G){vc(L,U-1,Z-10,2,20,G),vc(L,U-10,Z-1,20,2,G)})(M,O.x,M.transform.height-O.y,Tp)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(i){if(!this.style||!this.style.map||!this.style.map.terrain)return;const h=this.terrainFacilitator.matrix,f=this.transform.modelViewProjectionMatrix;let m=this.terrainFacilitator.dirty;m||(m=i?!c.a_(h,f):!c.a$(h,f)),m||(m=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),m&&(c.b0(h,f),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(y,S){const C=y.context,M=C.gl,D=pn.unblended,O=new Tt(M.LEQUAL,Tt.ReadWrite,[0,1]),L=S.getTerrainMesh(),U=S.sourceCache.getRenderableTiles(),Z=y.useProgram("terrainDepth");C.bindFramebuffer.set(S.getFramebuffer("depth").framebuffer),C.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),C.clear({color:c.aM.transparent,depth:1});for(const G of U){const te=S.getTerrainData(G.tileID),re={u_matrix:y.transform.calculatePosMatrix(G.tileID.toUnwrapped()),u_ele_delta:S.getMeshFrameDelta(y.transform.zoom)};Z.draw(C,M.TRIANGLES,O,Kt.disabled,D,Ht.backCCW,re,te,"terrain",L.vertexBuffer,L.indexBuffer,L.segments)}C.bindFramebuffer.set(null),C.viewport.set([0,0,y.width,y.height])}(this,this.style.map.terrain),function(y,S){const C=y.context,M=C.gl,D=pn.unblended,O=new Tt(M.LEQUAL,Tt.ReadWrite,[0,1]),L=S.getTerrainMesh(),U=S.getCoordsTexture(),Z=S.sourceCache.getRenderableTiles(),G=y.useProgram("terrainCoords");C.bindFramebuffer.set(S.getFramebuffer("coords").framebuffer),C.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),C.clear({color:c.aM.transparent,depth:1}),S.coordsIndex=[];for(const te of Z){const re=S.getTerrainData(te.tileID);C.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,U.texture);const se={u_matrix:y.transform.calculatePosMatrix(te.tileID.toUnwrapped()),u_terrain_coords_id:(255-S.coordsIndex.length)/255,u_texture:0,u_ele_delta:S.getMeshFrameDelta(y.transform.zoom)};G.draw(C,M.TRIANGLES,O,Kt.disabled,D,Ht.backCCW,se,re,"terrain",L.vertexBuffer,L.indexBuffer,L.segments),S.coordsIndex.push(te.tileID.key)}C.bindFramebuffer.set(null),C.viewport.set([0,0,y.width,y.height])}(this,this.style.map.terrain))}renderLayer(i,h,f,m){if(!f.isHidden(this.transform.zoom)&&(f.type==="background"||f.type==="custom"||(m||[]).length))switch(this.id=f.id,f.type){case"symbol":(function(y,S,C,M,D){if(y.renderPass!=="translucent")return;const O=Kt.disabled,L=y.colorModeForRenderPass();(C._unevaluatedLayout.hasValue("text-variable-anchor")||C._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(U,Z,G,te,re,se,ae,Y,de){const fe=Z.transform,_e=to(),Te=re==="map",Pe=se==="map";for(const $e of U){const He=te.getTile($e),Be=He.getBucket(G);if(!Be||!Be.text||!Be.text.segments.get().length)continue;const Le=c.ag(Be.textSizeData,fe.zoom),Ye=Ct(He,1,Z.transform.zoom),pt=Ds($e.posMatrix,Pe,Te,Z.transform,Ye),Ne=G.layout.get("icon-text-fit")!=="none"&&Be.hasIconData();if(Le){const Ue=Math.pow(2,fe.zoom-He.tileID.overscaledZ),ht=Z.style.map.terrain?(wt,Mt)=>Z.style.map.terrain.getElevation($e,wt,Mt):null,Qt=_e.translatePosition(fe,He,ae,Y);Vo(Be,Te,Pe,de,fe,pt,$e.posMatrix,Ue,Le,Ne,_e,Qt,$e.toUnwrapped(),ht)}}}(M,y,C,S,C.layout.get("text-rotation-alignment"),C.layout.get("text-pitch-alignment"),C.paint.get("text-translate"),C.paint.get("text-translate-anchor"),D),C.paint.get("icon-opacity").constantOr(1)!==0&&lh(y,S,C,M,!1,C.paint.get("icon-translate"),C.paint.get("icon-translate-anchor"),C.layout.get("icon-rotation-alignment"),C.layout.get("icon-pitch-alignment"),C.layout.get("icon-keep-upright"),O,L),C.paint.get("text-opacity").constantOr(1)!==0&&lh(y,S,C,M,!0,C.paint.get("text-translate"),C.paint.get("text-translate-anchor"),C.layout.get("text-rotation-alignment"),C.layout.get("text-pitch-alignment"),C.layout.get("text-keep-upright"),O,L),S.map.showCollisionBoxes&&(al(y,S,C,M,!0),al(y,S,C,M,!1))})(i,h,f,m,this.style.placement.variableOffsets);break;case"circle":(function(y,S,C,M){if(y.renderPass!=="translucent")return;const D=C.paint.get("circle-opacity"),O=C.paint.get("circle-stroke-width"),L=C.paint.get("circle-stroke-opacity"),U=!C.layout.get("circle-sort-key").isConstant();if(D.constantOr(1)===0&&(O.constantOr(1)===0||L.constantOr(1)===0))return;const Z=y.context,G=Z.gl,te=y.depthModeForSublayer(0,Tt.ReadOnly),re=Kt.disabled,se=y.colorModeForRenderPass(),ae=[];for(let Y=0;Y<M.length;Y++){const de=M[Y],fe=S.getTile(de),_e=fe.getBucket(C);if(!_e)continue;const Te=_e.programConfigurations.get(C.id),Pe=y.useProgram("circle",Te),$e=_e.layoutVertexBuffer,He=_e.indexBuffer,Be=y.style.map.terrain&&y.style.map.terrain.getTerrainData(de),Le={programConfiguration:Te,program:Pe,layoutVertexBuffer:$e,indexBuffer:He,uniformValues:gg(y,de,fe,C),terrainData:Be};if(U){const Ye=_e.segments.get();for(const pt of Ye)ae.push({segments:new c.a0([pt]),sortKey:pt.sortKey,state:Le})}else ae.push({segments:_e.segments,sortKey:0,state:Le})}U&&ae.sort((Y,de)=>Y.sortKey-de.sortKey);for(const Y of ae){const{programConfiguration:de,program:fe,layoutVertexBuffer:_e,indexBuffer:Te,uniformValues:Pe,terrainData:$e}=Y.state;fe.draw(Z,G.TRIANGLES,te,re,se,Ht.disabled,Pe,$e,C.id,_e,Te,Y.segments,C.paint,y.transform.zoom,de)}})(i,h,f,m);break;case"heatmap":(function(y,S,C,M){if(C.paint.get("heatmap-opacity")===0)return;const D=y.context;if(y.style.map.terrain){for(const O of M){const L=S.getTile(O);S.hasRenderableParent(O)||(y.renderPass==="offscreen"?uh(y,L,C,O):y.renderPass==="translucent"&&co(y,C,O))}D.viewport.set([0,0,y.width,y.height])}else y.renderPass==="offscreen"?function(O,L,U,Z){const G=O.context,te=G.gl,re=Kt.disabled,se=new pn([te.ONE,te.ONE],c.aM.transparent,[!0,!0,!0,!0]);(function(ae,Y,de){const fe=ae.gl;ae.activeTexture.set(fe.TEXTURE1),ae.viewport.set([0,0,Y.width/4,Y.height/4]);let _e=de.heatmapFbos.get(c.aU);_e?(fe.bindTexture(fe.TEXTURE_2D,_e.colorAttachment.get()),ae.bindFramebuffer.set(_e.framebuffer)):(_e=cl(ae,Y.width/4,Y.height/4),de.heatmapFbos.set(c.aU,_e))})(G,O,U),G.clear({color:c.aM.transparent});for(let ae=0;ae<Z.length;ae++){const Y=Z[ae];if(L.hasRenderableParent(Y))continue;const de=L.getTile(Y),fe=de.getBucket(U);if(!fe)continue;const _e=fe.programConfigurations.get(U.id),Te=O.useProgram("heatmap",_e),{zoom:Pe}=O.transform;Te.draw(G,te.TRIANGLES,Tt.disabled,re,se,Ht.disabled,bi(Y.posMatrix,de,Pe,U.paint.get("heatmap-intensity")),null,U.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,U.paint,O.transform.zoom,_e)}G.viewport.set([0,0,O.width,O.height])}(y,S,C,M):y.renderPass==="translucent"&&function(O,L){const U=O.context,Z=U.gl;U.setColorMode(O.colorModeForRenderPass());const G=L.heatmapFbos.get(c.aU);G&&(U.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_2D,G.colorAttachment.get()),U.activeTexture.set(Z.TEXTURE1),ul(U,L).bind(Z.LINEAR,Z.CLAMP_TO_EDGE),O.useProgram("heatmapTexture").draw(U,Z.TRIANGLES,Tt.disabled,Kt.disabled,O.colorModeForRenderPass(),Ht.disabled,lc(O,L,0,1),null,L.id,O.viewportBuffer,O.quadTriangleIndexBuffer,O.viewportSegments,L.paint,O.transform.zoom))}(y,C)})(i,h,f,m);break;case"line":(function(y,S,C,M){if(y.renderPass!=="translucent")return;const D=C.paint.get("line-opacity"),O=C.paint.get("line-width");if(D.constantOr(1)===0||O.constantOr(1)===0)return;const L=y.depthModeForSublayer(0,Tt.ReadOnly),U=y.colorModeForRenderPass(),Z=C.paint.get("line-dasharray"),G=C.paint.get("line-pattern"),te=G.constantOr(1),re=C.paint.get("line-gradient"),se=C.getCrossfadeParameters(),ae=te?"linePattern":Z?"lineSDF":re?"lineGradient":"line",Y=y.context,de=Y.gl;let fe=!0;for(const _e of M){const Te=S.getTile(_e);if(te&&!Te.patternsLoaded())continue;const Pe=Te.getBucket(C);if(!Pe)continue;const $e=Pe.programConfigurations.get(C.id),He=y.context.program.get(),Be=y.useProgram(ae,$e),Le=fe||Be.program!==He,Ye=y.style.map.terrain&&y.style.map.terrain.getTerrainData(_e),pt=G.constantOr(null);if(pt&&Te.imageAtlas){const ht=Te.imageAtlas,Qt=ht.patternPositions[pt.to.toString()],wt=ht.patternPositions[pt.from.toString()];Qt&&wt&&$e.setConstantPatternPositions(Qt,wt)}const Ne=Ye?_e:null,Ue=te?Fo(y,Te,C,se,Ne):Z?yg(y,Te,C,Z,se,Ne):re?lp(y,Te,C,Pe.lineClipsArray.length,Ne):uc(y,Te,C,Ne);if(te)Y.activeTexture.set(de.TEXTURE0),Te.imageAtlasTexture.bind(de.LINEAR,de.CLAMP_TO_EDGE),$e.updatePaintBuffers(se);else if(Z&&(Le||y.lineAtlas.dirty))Y.activeTexture.set(de.TEXTURE0),y.lineAtlas.bind(Y);else if(re){const ht=Pe.gradients[C.id];let Qt=ht.texture;if(C.gradientVersion!==ht.version){let wt=256;if(C.stepInterpolant){const Mt=S.getSource().maxzoom,en=_e.canonical.z===Mt?Math.ceil(1<<y.transform.maxZoom-_e.canonical.z):1;wt=c.ac(c.aV(Pe.maxLineLength/c.X*1024*en),256,Y.maxTextureSize)}ht.gradient=c.aW({expression:C.gradientExpression(),evaluationKey:"lineProgress",resolution:wt,image:ht.gradient||void 0,clips:Pe.lineClipsArray}),ht.texture?ht.texture.update(ht.gradient):ht.texture=new xt(Y,ht.gradient,de.RGBA),ht.version=C.gradientVersion,Qt=ht.texture}Y.activeTexture.set(de.TEXTURE0),Qt.bind(C.stepInterpolant?de.NEAREST:de.LINEAR,de.CLAMP_TO_EDGE)}Be.draw(Y,de.TRIANGLES,L,y.stencilModeForClipping(_e),U,Ht.disabled,Ue,Ye,C.id,Pe.layoutVertexBuffer,Pe.indexBuffer,Pe.segments,C.paint,y.transform.zoom,$e,Pe.layoutVertexBuffer2),fe=!1}})(i,h,f,m);break;case"fill":(function(y,S,C,M){const D=C.paint.get("fill-color"),O=C.paint.get("fill-opacity");if(O.constantOr(1)===0)return;const L=y.colorModeForRenderPass(),U=C.paint.get("fill-pattern"),Z=y.opaquePassEnabledForLayer()&&!U.constantOr(1)&&D.constantOr(c.aM.transparent).a===1&&O.constantOr(0)===1?"opaque":"translucent";if(y.renderPass===Z){const G=y.depthModeForSublayer(1,y.renderPass==="opaque"?Tt.ReadWrite:Tt.ReadOnly);hl(y,S,C,M,G,L,!1)}if(y.renderPass==="translucent"&&C.paint.get("fill-antialias")){const G=y.depthModeForSublayer(C.getPaintProperty("fill-outline-color")?2:0,Tt.ReadOnly);hl(y,S,C,M,G,L,!0)}})(i,h,f,m);break;case"fill-extrusion":(function(y,S,C,M){const D=C.paint.get("fill-extrusion-opacity");if(D!==0&&y.renderPass==="translucent"){const O=new Tt(y.context.gl.LEQUAL,Tt.ReadWrite,y.depthRangeFor3D);if(D!==1||C.paint.get("fill-extrusion-pattern").constantOr(1))yc(y,S,C,M,O,Kt.disabled,pn.disabled),yc(y,S,C,M,O,y.stencilModeFor3D(),y.colorModeForRenderPass());else{const L=y.colorModeForRenderPass();yc(y,S,C,M,O,Kt.disabled,L)}}})(i,h,f,m);break;case"hillshade":(function(y,S,C,M){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent")return;const D=y.context,O=y.depthModeForSublayer(0,Tt.ReadOnly),L=y.colorModeForRenderPass(),[U,Z]=y.renderPass==="translucent"?y.stencilConfigForOverlap(M):[{},M];for(const G of Z){const te=S.getTile(G);te.needsHillshadePrepare!==void 0&&te.needsHillshadePrepare&&y.renderPass==="offscreen"?Uo(y,te,C,O,Kt.disabled,L):y.renderPass==="translucent"&&jo(y,G,te,C,O,U[G.overscaledZ],L)}D.viewport.set([0,0,y.width,y.height])})(i,h,f,m);break;case"raster":(function(y,S,C,M){if(y.renderPass!=="translucent"||C.paint.get("raster-opacity")===0||!M.length)return;const D=y.context,O=D.gl,L=S.getSource(),U=y.useProgram("raster"),Z=y.colorModeForRenderPass(),[G,te]=L instanceof hs?[{},M]:y.stencilConfigForOverlap(M),re=te[te.length-1].overscaledZ,se=!y.options.moving;for(const ae of te){const Y=y.depthModeForSublayer(ae.overscaledZ-re,C.paint.get("raster-opacity")===1?Tt.ReadWrite:Tt.ReadOnly,O.LESS),de=S.getTile(ae);de.registerFadeDuration(C.paint.get("raster-fade-duration"));const fe=S.findLoadedParent(ae,0),_e=S.findLoadedSibling(ae),Te=kp(de,fe||_e||null,S,C,y.transform,y.style.map.terrain);let Pe,$e;const He=C.paint.get("raster-resampling")==="nearest"?O.NEAREST:O.LINEAR;D.activeTexture.set(O.TEXTURE0),de.texture.bind(He,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST),D.activeTexture.set(O.TEXTURE1),fe?(fe.texture.bind(He,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST),Pe=Math.pow(2,fe.tileID.overscaledZ-de.tileID.overscaledZ),$e=[de.tileID.canonical.x*Pe%1,de.tileID.canonical.y*Pe%1]):de.texture.bind(He,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST),de.texture.useMipmap&&D.extTextureFilterAnisotropic&&y.transform.pitch>20&&O.texParameterf(O.TEXTURE_2D,D.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,D.extTextureFilterAnisotropicMax);const Be=y.style.map.terrain&&y.style.map.terrain.getTerrainData(ae),Le=Be?ae:null,Ye=Le?Le.posMatrix:y.transform.calculatePosMatrix(ae.toUnwrapped(),se),pt=_g(Ye,$e||[0,0],Pe||1,Te,C);L instanceof hs?U.draw(D,O.TRIANGLES,Y,Kt.disabled,Z,Ht.disabled,pt,Be,C.id,L.boundsBuffer,y.quadTriangleIndexBuffer,L.boundsSegments):U.draw(D,O.TRIANGLES,Y,G[ae.overscaledZ],Z,Ht.disabled,pt,Be,C.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}})(i,h,f,m);break;case"background":(function(y,S,C,M){const D=C.paint.get("background-color"),O=C.paint.get("background-opacity");if(O===0)return;const L=y.context,U=L.gl,Z=y.transform,G=Z.tileSize,te=C.paint.get("background-pattern");if(y.isPatternMissing(te))return;const re=!te&&D.a===1&&O===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==re)return;const se=Kt.disabled,ae=y.depthModeForSublayer(0,re==="opaque"?Tt.ReadWrite:Tt.ReadOnly),Y=y.colorModeForRenderPass(),de=y.useProgram(te?"backgroundPattern":"background"),fe=M||Z.coveringTiles({tileSize:G,terrain:y.style.map.terrain});te&&(L.activeTexture.set(U.TEXTURE0),y.imageManager.bind(y.context));const _e=C.getCrossfadeParameters();for(const Te of fe){const Pe=M?Te.posMatrix:y.transform.calculatePosMatrix(Te.toUnwrapped()),$e=te?Ju(Pe,O,y,te,{tileID:Te,tileSize:G},_e):hc(Pe,O,D),He=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Te);de.draw(L,U.TRIANGLES,ae,se,Y,Ht.disabled,$e,He,C.id,y.tileExtentBuffer,y.quadTriangleIndexBuffer,y.tileExtentSegments)}})(i,0,f,m);break;case"custom":(function(y,S,C){const M=y.context,D=C.implementation;if(y.renderPass==="offscreen"){const O=D.prerender;O&&(y.setCustomLayerDefaults(),M.setColorMode(y.colorModeForRenderPass()),O.call(D,M.gl,y.transform.customLayerMatrix()),M.setDirty(),y.setBaseState())}else if(y.renderPass==="translucent"){y.setCustomLayerDefaults(),M.setColorMode(y.colorModeForRenderPass()),M.setStencilMode(Kt.disabled);const O=D.renderingMode==="3d"?new Tt(y.context.gl.LEQUAL,Tt.ReadWrite,y.depthRangeFor3D):y.depthModeForSublayer(0,Tt.ReadOnly);M.setDepthMode(O),D.render(M.gl,y.transform.customLayerMatrix(),{farZ:y.transform.farZ,nearZ:y.transform.nearZ,fov:y.transform._fov,modelViewProjectionMatrix:y.transform.modelViewProjectionMatrix,projectionMatrix:y.transform.projectionMatrix}),M.setDirty(),y.setBaseState(),M.bindFramebuffer.set(null)}})(i,0,f)}}translatePosMatrix(i,h,f,m,y){if(!f[0]&&!f[1])return i;const S=y?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(S){const D=Math.sin(S),O=Math.cos(S);f=[f[0]*O-f[1]*D,f[0]*D+f[1]*O]}const C=[y?f[0]:Ct(h,f[0],this.transform.zoom),y?f[1]:Ct(h,f[1],this.transform.zoom),0],M=new Float32Array(16);return c.J(M,i,C),M}saveTileTexture(i){const h=this._tileTextures[i.size[0]];h?h.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const h=this._tileTextures[i];return h&&h.length>0?h.pop():null}isPatternMissing(i){if(!i)return!1;if(!i.from||!i.to)return!0;const h=this.imageManager.getPattern(i.from.toString()),f=this.imageManager.getPattern(i.to.toString());return!h||!f}useProgram(i,h){this.cache=this.cache||{};const f=i+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[f]||(this.cache[f]=new Ku(this.context,Rs[i],h,Yu[i],this._showOverdrawInspector,this.style.map.terrain)),this.cache[f]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new xt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:i,drawingBufferHeight:h}=this.context.gl;return this.width!==i||this.height!==h}}class Ho{constructor(i,h){this.points=i,this.planes=h}static fromInvProjectionMatrix(i,h,f){const m=Math.pow(2,f),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(C=>{const M=1/(C=c.af([],C,i))[3]/h*m;return c.b1(C,C,[M,M,1/C[3],M])}),S=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(C=>{const M=function(U,Z){var G=Z[0],te=Z[1],re=Z[2],se=G*G+te*te+re*re;return se>0&&(se=1/Math.sqrt(se)),U[0]=Z[0]*se,U[1]=Z[1]*se,U[2]=Z[2]*se,U}([],function(U,Z,G){var te=Z[0],re=Z[1],se=Z[2],ae=G[0],Y=G[1],de=G[2];return U[0]=re*de-se*Y,U[1]=se*ae-te*de,U[2]=te*Y-re*ae,U}([],De([],y[C[0]],y[C[1]]),De([],y[C[2]],y[C[1]]))),D=-((O=M)[0]*(L=y[C[1]])[0]+O[1]*L[1]+O[2]*L[2]);var O,L;return M.concat(D)});return new Ho(y,S)}}class Zo{constructor(i,h){this.min=i,this.max=h,this.center=function(f,m,y){return f[0]=.5*m[0],f[1]=.5*m[1],f[2]=.5*m[2],f}([],function(f,m,y){return f[0]=m[0]+y[0],f[1]=m[1]+y[1],f[2]=m[2]+y[2],f}([],this.min,this.max))}quadrant(i){const h=[i%2==0,i<2],f=Me(this.min),m=Me(this.max);for(let y=0;y<h.length;y++)f[y]=h[y]?this.min[y]:this.center[y],m[y]=h[y]?this.center[y]:this.max[y];return m[2]=this.max[2],new Zo(f,m)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}intersects(i){const h=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let f=!0;for(let m=0;m<i.planes.length;m++){const y=i.planes[m];let S=0;for(let C=0;C<h.length;C++)c.b2(y,h[C])>=0&&S++;if(S===0)return 0;S!==h.length&&(f=!1)}if(f)return 2;for(let m=0;m<3;m++){let y=Number.MAX_VALUE,S=-Number.MAX_VALUE;for(let C=0;C<i.points.length;C++){const M=i.points[C][m]-this.min[m];y=Math.min(y,M),S=Math.max(S,M)}if(S<0||y>this.max[m]-this.min[m])return 0}return 1}}class Wo{constructor(i=0,h=0,f=0,m=0){if(isNaN(i)||i<0||isNaN(h)||h<0||isNaN(f)||f<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=h,this.left=f,this.right=m}interpolate(i,h,f){return h.top!=null&&i.top!=null&&(this.top=c.y.number(i.top,h.top,f)),h.bottom!=null&&i.bottom!=null&&(this.bottom=c.y.number(i.bottom,h.bottom,f)),h.left!=null&&i.left!=null&&(this.left=c.y.number(i.left,h.left,f)),h.right!=null&&i.right!=null&&(this.right=c.y.number(i.right,h.right,f)),this}getCenter(i,h){const f=c.ac((this.left+i-this.right)/2,0,i),m=c.ac((this.top+h-this.bottom)/2,0,h);return new c.P(f,m)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new Wo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const dh=85.051129;class Go{constructor(i,h,f,m,y){this.tileSize=512,this._renderWorldCopies=y===void 0||!!y,this._minZoom=i||0,this._maxZoom=h||22,this._minPitch=f??0,this._maxPitch=m??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new c.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Wo,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const i=new Go(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return i.apply(this),i}apply(i){this.tileSize=i.tileSize,this.latRange=i.latRange,this.lngRange=i.lngRange,this.width=i.width,this.height=i.height,this._center=i._center,this._elevation=i._elevation,this.minElevationForCurrentTile=i.minElevationForCurrentTile,this.zoom=i.zoom,this.angle=i.angle,this._fov=i._fov,this._pitch=i._pitch,this._unmodified=i._unmodified,this._edgeInsets=i._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(i){const h=-c.b3(i,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=function(){var f=new c.A(4);return c.A!=Float32Array&&(f[1]=0,f[2]=0),f[0]=1,f[3]=1,f}(),function(f,m,y){var S=m[0],C=m[1],M=m[2],D=m[3],O=Math.sin(y),L=Math.cos(y);f[0]=S*L+M*O,f[1]=C*L+D*O,f[2]=S*-O+M*L,f[3]=C*-O+D*L}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const h=c.ac(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=i/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(i){const h=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.tileZoom=Math.max(0,Math.floor(h)),this.scale=this.zoomScale(h),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(i){i!==this._elevation&&(this._elevation=i,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,h,f){this._unmodified=!1,this._edgeInsets.interpolate(i,h,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const h=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(i){const h=[new c.b4(0,i)];if(this._renderWorldCopies){const f=this.pointCoordinate(new c.P(0,0)),m=this.pointCoordinate(new c.P(this.width,0)),y=this.pointCoordinate(new c.P(this.width,this.height)),S=this.pointCoordinate(new c.P(0,this.height)),C=Math.floor(Math.min(f.x,m.x,y.x,S.x)),M=Math.floor(Math.max(f.x,m.x,y.x,S.x)),D=1;for(let O=C-D;O<=M+D;O++)O!==0&&h.push(new c.b4(O,i))}return h}coveringTiles(i){var h,f;let m=this.coveringZoomLevel(i);const y=m;if(i.minzoom!==void 0&&m<i.minzoom)return[];i.maxzoom!==void 0&&m>i.maxzoom&&(m=i.maxzoom);const S=this.pointCoordinate(this.getCameraPoint()),C=c.Z.fromLngLat(this.center),M=Math.pow(2,m),D=[M*S.x,M*S.y,0],O=[M*C.x,M*C.y,0],L=Ho.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,m);let U=i.minzoom||0;!i.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(U=m);const Z=i.terrain?2/Math.min(this.tileSize,i.tileSize)*this.tileSize:3,G=Y=>({aabb:new Zo([Y*M,0,0],[(Y+1)*M,M,0]),zoom:0,x:0,y:0,wrap:Y,fullyVisible:!1}),te=[],re=[],se=m,ae=i.reparseOverscaled?y:m;if(this._renderWorldCopies)for(let Y=1;Y<=3;Y++)te.push(G(-Y)),te.push(G(Y));for(te.push(G(0));te.length>0;){const Y=te.pop(),de=Y.x,fe=Y.y;let _e=Y.fullyVisible;if(!_e){const Be=Y.aabb.intersects(L);if(Be===0)continue;_e=Be===2}const Te=i.terrain?D:O,Pe=Y.aabb.distanceX(Te),$e=Y.aabb.distanceY(Te),He=Math.max(Math.abs(Pe),Math.abs($e));if(Y.zoom===se||He>Z+(1<<se-Y.zoom)-2&&Y.zoom>=U){const Be=se-Y.zoom,Le=D[0]-.5-(de<<Be),Ye=D[1]-.5-(fe<<Be);re.push({tileID:new c.S(Y.zoom===se?ae:Y.zoom,Y.wrap,Y.zoom,de,fe),distanceSq:Ze([O[0]-.5-de,O[1]-.5-fe]),tileDistanceToCamera:Math.sqrt(Le*Le+Ye*Ye)})}else for(let Be=0;Be<4;Be++){const Le=(de<<1)+Be%2,Ye=(fe<<1)+(Be>>1),pt=Y.zoom+1;let Ne=Y.aabb.quadrant(Be);if(i.terrain){const Ue=new c.S(pt,Y.wrap,pt,Le,Ye),ht=i.terrain.getMinMaxElevation(Ue),Qt=(h=ht.minElevation)!==null&&h!==void 0?h:this.elevation,wt=(f=ht.maxElevation)!==null&&f!==void 0?f:this.elevation;Ne=new Zo([Ne.min[0],Ne.min[1],Qt],[Ne.max[0],Ne.max[1],wt])}te.push({aabb:Ne,zoom:pt,x:Le,y:Ye,wrap:Y.wrap,fullyVisible:_e})}}return re.sort((Y,de)=>Y.distanceSq-de.distanceSq).map(Y=>Y.tileID)}resize(i,h){this.width=i,this.height=h,this.pixelsToGLUnits=[2/i,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const h=c.ac(i.lat,-85.051129,dh);return new c.P(c.O(i.lng)*this.worldSize,c.Q(h)*this.worldSize)}unproject(i){return new c.Z(i.x/this.worldSize,i.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(i){const h=this.elevation,f=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,m=this.pointLocation(this.centerPoint,i),y=i.getElevationForLngLatZoom(m,this.tileZoom);if(!(this.elevation-y))return;const S=f+h-y,C=Math.cos(this._pitch)*this.cameraToCenterDistance/S/c.b5(1,m.lat),M=this.scaleZoom(C/this.tileSize);this._elevation=y,this._center=m,this.zoom=M}setLocationAtPoint(i,h){const f=this.pointCoordinate(h),m=this.pointCoordinate(this.centerPoint),y=this.locationCoordinate(i),S=new c.Z(y.x-(f.x-m.x),y.y-(f.y-m.y));this.center=this.coordinateLocation(S),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(i,h){return h?this.coordinatePoint(this.locationCoordinate(i),h.getElevationForLngLatZoom(i,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(i))}pointLocation(i,h){return this.coordinateLocation(this.pointCoordinate(i,h))}locationCoordinate(i){return c.Z.fromLngLat(i)}coordinateLocation(i){return i&&i.toLngLat()}pointCoordinate(i,h){if(h){const U=h.pointCoordinate(i);if(U!=null)return U}const f=[i.x,i.y,0,1],m=[i.x,i.y,1,1];c.af(f,f,this.pixelMatrixInverse),c.af(m,m,this.pixelMatrixInverse);const y=f[3],S=m[3],C=f[1]/y,M=m[1]/S,D=f[2]/y,O=m[2]/S,L=D===O?0:(0-D)/(O-D);return new c.Z(c.y.number(f[0]/y,m[0]/S,L)/this.worldSize,c.y.number(C,M,L)/this.worldSize)}coordinatePoint(i,h=0,f=this.pixelMatrix){const m=[i.x*this.worldSize,i.y*this.worldSize,h,1];return c.af(m,m,f),new c.P(m[0]/m[3],m[1]/m[3])}getBounds(){const i=Math.max(0,this.height/2-this.getHorizon());return new xe().extend(this.pointLocation(new c.P(0,i))).extend(this.pointLocation(new c.P(this.width,i))).extend(this.pointLocation(new c.P(this.width,this.height))).extend(this.pointLocation(new c.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new xe([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(i){i?(this.lngRange=[i.getWest(),i.getEast()],this.latRange=[i.getSouth(),i.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,dh])}calculateTileMatrix(i){const h=i.canonical,f=this.worldSize/this.zoomScale(h.z),m=h.x+Math.pow(2,h.z)*i.wrap,y=c.an(new Float64Array(16));return c.J(y,y,[m*f,h.y*f,0]),c.K(y,y,[f/c.X,f/c.X,1]),y}calculatePosMatrix(i,h=!1){const f=i.key,m=h?this._alignedPosMatrixCache:this._posMatrixCache;if(m[f])return m[f];const y=this.calculateTileMatrix(i);return c.L(y,h?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,y),m[f]=new Float32Array(y),m[f]}calculateFogMatrix(i){const h=i.key,f=this._fogMatrixCache;if(f[h])return f[h];const m=this.calculateTileMatrix(i);return c.L(m,this.fogMatrix,m),f[h]=new Float32Array(m),f[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(i,h){h=c.ac(+h,this.minZoom,this.maxZoom);const f={center:new c.N(i.lng,i.lat),zoom:h};let m=this.lngRange;if(!this._renderWorldCopies&&m===null){const Y=179.9999999999;m=[-Y,Y]}const y=this.tileSize*this.zoomScale(f.zoom);let S=0,C=y,M=0,D=y,O=0,L=0;const{x:U,y:Z}=this.size;if(this.latRange){const Y=this.latRange;S=c.Q(Y[1])*y,C=c.Q(Y[0])*y,C-S<Z&&(O=Z/(C-S))}m&&(M=c.b3(c.O(m[0])*y,0,y),D=c.b3(c.O(m[1])*y,0,y),D<M&&(D+=y),D-M<U&&(L=U/(D-M)));const{x:G,y:te}=this.project.call({worldSize:y},i);let re,se;const ae=Math.max(L||0,O||0);if(ae){const Y=new c.P(L?(D+M)/2:G,O?(C+S)/2:te);return f.center=this.unproject.call({worldSize:y},Y).wrap(),f.zoom+=this.scaleZoom(ae),f}if(this.latRange){const Y=Z/2;te-Y<S&&(se=S+Y),te+Y>C&&(se=C-Y)}if(m){const Y=(M+D)/2;let de=G;this._renderWorldCopies&&(de=c.b3(G,Y-y/2,Y+y/2));const fe=U/2;de-fe<M&&(re=M+fe),de+fe>D&&(re=D-fe)}if(re!==void 0||se!==void 0){const Y=new c.P(re??G,se??te);f.center=this.unproject.call({worldSize:y},Y).wrap()}return f}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i=this._unmodified,{center:h,zoom:f}=this.getConstrained(this.center,this.zoom);this.center=h,this.zoom=f,this._unmodified=i,this._constraining=!1}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,h=this.point.x,f=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=c.b5(1,this.center.lat)*this.worldSize;let m=c.an(new Float64Array(16));c.K(m,m,[this.width/2,-this.height/2,1]),c.J(m,m,[1,-1,0]),this.labelPlaneMatrix=m,m=c.an(new Float64Array(16)),c.K(m,m,[1,-1,1]),c.J(m,m,[-1,-1,0]),c.K(m,m,[2/this.width,2/this.height,1]),this.glCoordMatrix=m;const y=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),S=Math.min(this.elevation,this.minElevationForCurrentTile),C=y-S*this._pixelPerMeter/Math.cos(this._pitch),M=S<0?C:y,D=Math.PI/2+this._pitch,O=this._fov*(.5+i.y/this.height),L=Math.sin(O)*M/Math.sin(c.ac(Math.PI-D-O,.01,Math.PI-.01)),U=this.getHorizon(),Z=2*Math.atan(U/this.cameraToCenterDistance)*(.5+i.y/(2*U)),G=Math.sin(Z)*M/Math.sin(c.ac(Math.PI-D-Z,.01,Math.PI-.01)),te=Math.min(L,G);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*te+M),this.nearZ=this.height/50,m=new Float64Array(16),c.b6(m,this._fov,this.width/this.height,this.nearZ,this.farZ),m[8]=2*-i.x/this.width,m[9]=2*i.y/this.height,this.projectionMatrix=c.ae(m),c.K(m,m,[1,-1,1]),c.J(m,m,[0,0,-this.cameraToCenterDistance]),c.b7(m,m,this._pitch),c.ad(m,m,this.angle),c.J(m,m,[-h,-f,0]),this.mercatorMatrix=c.K([],m,[this.worldSize,this.worldSize,this.worldSize]),c.K(m,m,[1,1,this._pixelPerMeter]),this.pixelMatrix=c.L(new Float64Array(16),this.labelPlaneMatrix,m),c.J(m,m,[0,0,-this.elevation]),this.modelViewProjectionMatrix=m,this.invModelViewProjectionMatrix=c.as([],m),this.fogMatrix=new Float64Array(16),c.b6(this.fogMatrix,this._fov,this.width/this.height,y,this.farZ),this.fogMatrix[8]=2*-i.x/this.width,this.fogMatrix[9]=2*i.y/this.height,c.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),c.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),c.b7(this.fogMatrix,this.fogMatrix,this._pitch),c.ad(this.fogMatrix,this.fogMatrix,this.angle),c.J(this.fogMatrix,this.fogMatrix,[-h,-f,0]),c.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),c.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=c.L(new Float64Array(16),this.labelPlaneMatrix,m);const re=this.width%2/2,se=this.height%2/2,ae=Math.cos(this.angle),Y=Math.sin(this.angle),de=h-Math.round(h)+ae*re+Y*se,fe=f-Math.round(f)+ae*se+Y*re,_e=new Float64Array(m);if(c.J(_e,_e,[de>.5?de-1:de,fe>.5?fe-1:fe,0]),this.alignedModelViewProjectionMatrix=_e,m=c.as(new Float64Array(16),this.pixelMatrix),!m)throw new Error("failed to invert matrix");this.pixelMatrixInverse=m,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const i=this.pointCoordinate(new c.P(0,0)),h=[i.x*this.worldSize,i.y*this.worldSize,0,1];return c.af(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(0,i))}getCameraQueryGeometry(i){const h=this.getCameraPoint();if(i.length===1)return[i[0],h];{let f=h.x,m=h.y,y=h.x,S=h.y;for(const C of i)f=Math.min(f,C.x),m=Math.min(m,C.y),y=Math.max(y,C.x),S=Math.max(S,C.y);return[new c.P(f,m),new c.P(y,m),new c.P(y,S),new c.P(f,S),new c.P(f,m)]}}lngLatToCameraDepth(i,h){const f=this.locationCoordinate(i),m=[f.x*this.worldSize,f.y*this.worldSize,h,1];return c.af(m,m,this.modelViewProjectionMatrix),m[2]/m[3]}}function dl(_,i){let h,f=!1,m=null,y=null;const S=()=>{m=null,f&&(_.apply(y,h),m=setTimeout(S,i),f=!1)};return(...C)=>(f=!0,y=this,h=C,m||S(),m)}class bc{constructor(i){this._getCurrentHash=()=>{const h=window.location.hash.replace("#","");if(this._hashName){let f;return h.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(f=m)}),(f&&f[1]||"").split("/")}return h.split("/")},this._onHashChange=()=>{const h=this._getCurrentHash();if(h.length>=3&&!h.some(f=>isNaN(f))){const f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:f,pitch:+(h[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const h=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,h)},this._removeHash=()=>{const h=this._getCurrentHash();if(h.length===0)return;const f=h.join("/");let m=f;m.split("&").length>0&&(m=m.split("&")[0]),this._hashName&&(m=`${this._hashName}=${f}`);let y=window.location.hash.replace(m,"");y.startsWith("#&")?y=y.slice(0,1)+y.slice(2):y==="#"&&(y="");let S=window.location.href.replace(/(#.+)?$/,y);S=S.replace("&&","&"),window.history.replaceState(window.history.state,null,S)},this._updateHash=dl(this._updateHashUnthrottled,300),this._hashName=i&&encodeURIComponent(i)}addTo(i){return this._map=i,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(i){const h=this._map.getCenter(),f=Math.round(100*this._map.getZoom())/100,m=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,m),S=Math.round(h.lng*y)/y,C=Math.round(h.lat*y)/y,M=this._map.getBearing(),D=this._map.getPitch();let O="";if(O+=i?`/${S}/${C}/${f}`:`${f}/${C}/${S}`,(M||D)&&(O+="/"+Math.round(10*M)/10),D&&(O+=`/${Math.round(D)}`),this._hashName){const L=this._hashName;let U=!1;const Z=window.location.hash.slice(1).split("&").map(G=>{const te=G.split("=")[0];return te===L?(U=!0,`${te}=${O}`):G}).filter(G=>G);return U||Z.push(`${L}=${O}`),`#${Z.join("&")}`}return`#${O}`}}const Sc={linearity:.3,easing:c.b8(0,0,.3,1)},ph=c.e({deceleration:2500,maxSpeed:1400},Sc),Ag=c.e({deceleration:20,maxSpeed:1400},Sc),Ip=c.e({deceleration:1e3,maxSpeed:360},Sc),kc=c.e({deceleration:1e3,maxSpeed:90},Sc);class fh{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:P.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,h=P.now();for(;i.length>0&&h-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)h.zoom+=y.zoomDelta||0,h.bearing+=y.bearingDelta||0,h.pitch+=y.pitchDelta||0,y.panDelta&&h.pan._add(y.panDelta),y.around&&(h.around=y.around),y.pinchAround&&(h.pinchAround=y.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(h.pan.mag()){const y=fl(h.pan.mag(),f,c.e({},ph,i||{}));m.offset=h.pan.mult(y.amount/h.pan.mag()),m.center=this._map.transform.center,pl(m,y)}if(h.zoom){const y=fl(h.zoom,f,Ag);m.zoom=this._map.transform.zoom+y.amount,pl(m,y)}if(h.bearing){const y=fl(h.bearing,f,Ip);m.bearing=this._map.transform.bearing+c.ac(y.amount,-179,179),pl(m,y)}if(h.pitch){const y=fl(h.pitch,f,kc);m.pitch=this._map.transform.pitch+y.amount,pl(m,y)}if(m.zoom||m.bearing){const y=h.pinchAround===void 0?h.around:h.pinchAround;m.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),c.e(m,{noMoveStart:!0})}}function pl(_,i){(!_.duration||_.duration<i.duration)&&(_.duration=i.duration,_.easing=i.easing)}function fl(_,i,h){const{maxSpeed:f,linearity:m,deceleration:y}=h,S=c.ac(_*m/(i/1e3),-f,f),C=Math.abs(S)/(y*m);return{easing:h.easing,duration:1e3*C,amount:S*(C/2)}}class Hn extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,h,f,m={}){const y=A.mousePos(h.getCanvas(),f),S=h.unproject(y);super(i,c.e({point:y,lngLat:S,originalEvent:f},m)),this._defaultPrevented=!1,this.target=h}}class uo extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,h,f){const m=i==="touchend"?f.changedTouches:f.touches,y=A.touchPos(h.getCanvasContainer(),m),S=y.map(M=>h.unproject(M)),C=y.reduce((M,D,O,L)=>M.add(D.div(L.length)),new c.P(0,0));super(i,{points:y,point:C,lngLats:S,lngLat:h.unproject(C),originalEvent:f}),this._defaultPrevented=!1}}class Pp extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,h,f){super(i,{originalEvent:f}),this._defaultPrevented=!1}}class Ap{constructor(i,h){this._map=i,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(i){return this._firePreventable(new Pp(i.type,this._map,i))}mousedown(i,h){return this._mousedownPos=h,this._firePreventable(new Hn(i.type,this._map,i))}mouseup(i){this._map.fire(new Hn(i.type,this._map,i))}click(i,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new Hn(i.type,this._map,i))}dblclick(i){return this._firePreventable(new Hn(i.type,this._map,i))}mouseover(i){this._map.fire(new Hn(i.type,this._map,i))}mouseout(i){this._map.fire(new Hn(i.type,this._map,i))}touchstart(i){return this._firePreventable(new uo(i.type,this._map,i))}touchmove(i){this._map.fire(new uo(i.type,this._map,i))}touchend(i){this._map.fire(new uo(i.type,this._map,i))}touchcancel(i){this._map.fire(new uo(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class fn{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(i){this._map.fire(new Hn(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Hn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._ignoreContextMenu||this._map.fire(new Hn(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Cr{constructor(i){this._map=i}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(i){return this.transform.pointLocation(c.P.convert(i),this._map.terrain)}}class Vi{constructor(i,h){this._map=i,this._tr=new Cr(i),this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,h){this.isEnabled()&&i.shiftKey&&i.button===0&&(A.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(i,h){if(!this._active)return;const f=h;if(this._lastPos.equals(f)||!this._box&&f.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=f,this._box||(this._box=A.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",i));const y=Math.min(m.x,f.x),S=Math.max(m.x,f.x),C=Math.min(m.y,f.y),M=Math.max(m.y,f.y);A.setTransform(this._box,`translate(${y}px,${C}px)`),this._box.style.width=S-y+"px",this._box.style.height=M-C+"px"}mouseupWindow(i,h){if(!this._active||i.button!==0)return;const f=this._startPos,m=h;if(this.reset(),A.suppressClick(),f.x!==m.x||f.y!==m.y)return this._map.fire(new c.k("boxzoomend",{originalEvent:i})),{cameraAnimation:y=>y.fitScreenCoordinates(f,m,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",i)}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(A.remove(this._box),this._box=null),A.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(i,h){return this._map.fire(new c.k(i,{originalEvent:h}))}}function ml(_,i){if(_.length!==i.length)throw new Error(`The number of touches and points are not equal - touches ${_.length}, points ${i.length}`);const h={};for(let f=0;f<_.length;f++)h[_[f].identifier]=i[f];return h}class mh{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(i,h,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=i.timeStamp),f.length===this.numTouches&&(this.centroid=function(m){const y=new c.P(0,0);for(const S of m)y._add(S);return y.div(m.length)}(h),this.touches=ml(f,h)))}touchmove(i,h,f){if(this.aborted||!this.centroid)return;const m=ml(f,h);for(const y in this.touches){const S=m[y];(!S||S.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(i,h,f){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class Tc{constructor(i){this.singleTap=new mh(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(i,h,f){this.singleTap.touchstart(i,h,f)}touchmove(i,h,f){this.singleTap.touchmove(i,h,f)}touchend(i,h,f){const m=this.singleTap.touchend(i,h,f);if(m){const y=i.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(m)<30;if(y&&S||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class Ko{constructor(i){this._tr=new Cr(i),this._zoomIn=new Tc({numTouches:1,numTaps:2}),this._zoomOut=new Tc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,h,f){this._zoomIn.touchstart(i,h,f),this._zoomOut.touchstart(i,h,f)}touchmove(i,h,f){this._zoomIn.touchmove(i,h,f),this._zoomOut.touchmove(i,h,f)}touchend(i,h,f){const m=this._zoomIn.touchend(i,h,f),y=this._zoomOut.touchend(i,h,f),S=this._tr;return m?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:S.zoom+1,around:S.unproject(m)},{originalEvent:i})}):y?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:S.zoom-1,around:S.unproject(y)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class fs{constructor(i){this._enabled=!!i.enable,this._moveStateManager=i.moveStateManager,this._clickTolerance=i.clickTolerance||1,this._moveFunction=i.move,this._activateOnStart=!!i.activateOnStart,i.assignEvents(this),this.reset()}reset(i){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(i)}_move(...i){const h=this._moveFunction(...i);if(h.bearingDelta||h.pitchDelta||h.around||h.panDelta)return this._active=!0,h}dragStart(i,h){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(i)&&(this._moveStateManager.startMove(i),this._lastPoint=h.length?h[0]:h,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(i,h){if(!this.isEnabled())return;const f=this._lastPoint;if(!f)return;if(i.preventDefault(),!this._moveStateManager.isValidMoveEvent(i))return void this.reset(i);const m=h.length?h[0]:h;return!this._moved&&m.dist(f)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=m,this._move(f,m))}dragEnd(i){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(i)&&(this._moved&&A.suppressClick(),this.reset(i))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const gh={0:1,2:2};class Cc{constructor(i){this._correctEvent=i.checkCorrectEvent}startMove(i){const h=A.mouseButton(i);this._eventButton=h}endMove(i){delete this._eventButton}isValidStartEvent(i){return this._correctEvent(i)}isValidMoveEvent(i){return!function(h,f){const m=gh[f];return h.buttons===void 0||(h.buttons&m)!==m}(i,this._eventButton)}isValidEndEvent(i){return A.mouseButton(i)===this._eventButton}}class yh{constructor(){this._firstTouch=void 0}_isOneFingerTouch(i){return i.targetTouches.length===1}_isSameTouchEvent(i){return i.targetTouches[0].identifier===this._firstTouch}startMove(i){this._firstTouch=i.targetTouches[0].identifier}endMove(i){delete this._firstTouch}isValidStartEvent(i){return this._isOneFingerTouch(i)}isValidMoveEvent(i){return this._isOneFingerTouch(i)&&this._isSameTouchEvent(i)}isValidEndEvent(i){return this._isOneFingerTouch(i)&&this._isSameTouchEvent(i)}}const Mc=_=>{_.mousedown=_.dragStart,_.mousemoveWindow=_.dragMove,_.mouseup=_.dragEnd,_.contextmenu=i=>{i.preventDefault()}},_h=({enable:_,clickTolerance:i,bearingDegreesPerPixelMoved:h=.8})=>{const f=new Cc({checkCorrectEvent:m=>A.mouseButton(m)===0&&m.ctrlKey||A.mouseButton(m)===2});return new fs({clickTolerance:i,move:(m,y)=>({bearingDelta:(y.x-m.x)*h}),moveStateManager:f,enable:_,assignEvents:Mc})},vh=({enable:_,clickTolerance:i,pitchDegreesPerPixelMoved:h=-.5})=>{const f=new Cc({checkCorrectEvent:m=>A.mouseButton(m)===0&&m.ctrlKey||A.mouseButton(m)===2});return new fs({clickTolerance:i,move:(m,y)=>({pitchDelta:(y.y-m.y)*h}),moveStateManager:f,enable:_,assignEvents:Mc})};class ho{constructor(i,h){this._clickTolerance=i.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}_shouldBePrevented(i){return i<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(i,h,f){return this._calculateTransform(i,h,f)}touchmove(i,h,f){if(this._active){if(!this._shouldBePrevented(f.length))return i.preventDefault(),this._calculateTransform(i,h,f);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",i)}}touchend(i,h,f){this._calculateTransform(i,h,f),this._active&&this._shouldBePrevented(f.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,h,f){f.length>0&&(this._active=!0);const m=ml(f,h),y=new c.P(0,0),S=new c.P(0,0);let C=0;for(const D in m){const O=m[D],L=this._touches[D];L&&(y._add(O),S._add(O.sub(L)),C++,m[D]=O)}if(this._touches=m,this._shouldBePrevented(C)||!S.mag())return;const M=S.div(C);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(C),panDelta:M}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ec{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(i,h,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([h[0],h[1]]))}touchmove(i,h,f){if(!this._firstTwoTouches)return;i.preventDefault();const[m,y]=this._firstTwoTouches,S=gl(f,h,m),C=gl(f,h,y);if(!S||!C)return;const M=this._aroundCenter?null:S.add(C).div(2);return this._move([S,C],M,i)}touchend(i,h,f){if(!this._firstTwoTouches)return;const[m,y]=this._firstTwoTouches,S=gl(f,h,m),C=gl(f,h,y);S&&C||(this._active&&A.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function gl(_,i,h){for(let f=0;f<_.length;f++)if(_[f].identifier===h)return i[f]}function xh(_,i){return Math.log(_/i)/Math.LN2}class wh extends Ec{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,h){const f=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(xh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:xh(this._distance,f),pinchAround:h}}}function bh(_,i){return 180*_.angleWith(i)/Math.PI}class Sh extends Ec{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,h,f){const m=this._vector;if(this._vector=i[0].sub(i[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:bh(this._vector,m),pinchAround:h}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const h=25/(Math.PI*this._minDiameter)*360,f=bh(i,this._startVector);return Math.abs(f)<h}}function Ic(_){return Math.abs(_.y)>Math.abs(_.x)}class Xo extends Ec{constructor(i){super(),this._currentTouchCount=0,this._map=i}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(i,h,f){super.touchstart(i,h,f),this._currentTouchCount=f.length}_start(i){this._lastPoints=i,Ic(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,h,f){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const m=i[0].sub(this._lastPoints[0]),y=i[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,y,f.timeStamp),this._valid?(this._lastPoints=i,this._active=!0,{pitchDelta:(m.y+y.y)/2*-.5}):void 0}gestureBeginsVertically(i,h,f){if(this._valid!==void 0)return this._valid;const m=i.mag()>=2,y=h.mag()>=2;if(!m&&!y)return;if(!m||!y)return this._firstMove===void 0&&(this._firstMove=f),f-this._firstMove<100&&void 0;const S=i.y>0==h.y>0;return Ic(i)&&Ic(h)&&S}}const zp={panStep:100,bearingStep:15,pitchStep:10};class sr{constructor(i){this._tr=new Cr(i);const h=zp;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let h=0,f=0,m=0,y=0,S=0;switch(i.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:i.shiftKey?f=-1:(i.preventDefault(),y=-1);break;case 39:i.shiftKey?f=1:(i.preventDefault(),y=1);break;case 38:i.shiftKey?m=1:(i.preventDefault(),S=-1);break;case 40:i.shiftKey?m=-1:(i.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(f=0,m=0),{cameraAnimation:C=>{const M=this._tr;C.easeTo({duration:300,easeId:"keyboardHandler",easing:Kr,zoom:h?Math.round(M.zoom)+h*(i.shiftKey?2:1):M.zoom,bearing:M.bearing+f*this._bearingStep,pitch:M.pitch+m*this._pitchStep,offset:[-y*this._panStep,-S*this._panStep],center:M.center},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Kr(_){return _*(2-_)}const kh=4.000244140625;class Mr{constructor(i,h){this._onTimeout=f=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(f)},this._map=i,this._tr=new Cr(i),this._triggerRenderFrame=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(i){return!!this._map.cooperativeGestures.isEnabled()&&!(i.ctrlKey||this._map.cooperativeGestures.isBypassed(i))}wheel(i){if(!this.isEnabled())return;if(this._shouldBePrevented(i))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",i);let h=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const f=P.now(),m=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,h!==0&&h%kh==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(m*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),i.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=i,this._delta-=h,this._active||this._start(i)),i.preventDefault()}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=A.mousePos(this._map.getCanvas(),i),f=this._tr;this._around=h.y>f.transform.height/2-f.transform.getHorizon()?c.N.convert(this._aroundCenter?f.center:f.unproject(h)):c.N.convert(f.center),this._aroundPoint=f.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._tr.transform;if(this._delta!==0){const M=this._type==="wheel"&&Math.abs(this._delta)>kh?this._wheelZoomRate:this._defaultZoomRate;let D=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&D!==0&&(D=1/D);const O=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):i.scale;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(O*D))),this._type==="wheel"&&(this._startZoom=i.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:i.zoom,f=this._startZoom,m=this._easing;let y,S=!1;const C=P.now()-this._lastWheelEventTime;if(this._type==="wheel"&&f&&m&&C){const M=Math.min(C/200,1),D=m(M);y=c.y.number(f,h,D),M<1?this._frameId||(this._frameId=!0):S=!0}else y=h,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!S,zoomDelta:y-i.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let h=c.b9;if(this._prevEase){const f=this._prevEase,m=(P.now()-f.start)/f.duration,y=f.easing(m+.01)-f.easing(m),S=.27/Math.sqrt(y*y+1e-4)*.01,C=Math.sqrt(.0729-S*S);h=c.b8(S,C,.25,1)}return this._prevEase={start:P.now(),duration:i,easing:h},h}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class po{constructor(i,h){this._clickZoom=i,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class zg{constructor(i){this._tr=new Cr(i),this.reset()}reset(){this._active=!1}dblclick(i,h){return i.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:this._tr.zoom+(i.shiftKey?-1:1),around:this._tr.unproject(h)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Dg{constructor(){this._tap=new Tc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(i,h,f){if(!this._swipePoint)if(this._tapTime){const m=h[0],y=i.timeStamp-this._tapTime<500,S=this._tapPoint.dist(m)<30;y&&S?f.length>0&&(this._swipePoint=m,this._swipeTouch=f[0].identifier):this.reset()}else this._tap.touchstart(i,h,f)}touchmove(i,h,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const m=h[0],y=m.y-this._swipePoint.y;return this._swipePoint=m,i.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(i,h,f)}touchend(i,h,f){if(this._tapTime)this._swipePoint&&f.length===0&&this.reset();else{const m=this._tap.touchend(i,h,f);m&&(this._tapTime=i.timeStamp,this._tapPoint=m)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Dp{constructor(i,h,f){this._el=i,this._mousePan=h,this._touchPan=f}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Rp{constructor(i,h,f){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=h,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Th{constructor(i,h,f,m){this._el=i,this._touchZoom=h,this._touchRotate=f,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Jo{constructor(i,h){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=i,this._options=h,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const i=this._map.getCanvasContainer();i.classList.add("maplibregl-cooperative-gestures"),this._container=A.create("div","maplibregl-cooperative-gesture-screen",i);let h=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(h=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const f=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),m=document.createElement("div");m.className="maplibregl-desktop-message",m.textContent=h,this._container.appendChild(m);const y=document.createElement("div");y.className="maplibregl-mobile-message",y.textContent=f,this._container.appendChild(y),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(A.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(i){return i[this._bypassKey]}notifyGestureBlocked(i,h){this._enabled&&(this._map.fire(new c.k("cooperativegestureprevented",{gestureType:i,originalEvent:h})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const or=_=>_.zoom||_.drag||_.pitch||_.rotate;class Ge extends c.k{}function Pc(_){return _.panDelta&&_.panDelta.mag()||_.zoomDelta||_.bearingDelta||_.pitchDelta}class Ch{constructor(i,h){this.handleWindowEvent=m=>{this.handleEvent(m,`${m.type}Window`)},this.handleEvent=(m,y)=>{if(m.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const S=m.type==="renderFrame"?void 0:m,C={needsRenderFrame:!1},M={},D={},O=m.touches,L=O?this._getMapTouches(O):void 0,U=L?A.touchPos(this._map.getCanvas(),L):A.mousePos(this._map.getCanvas(),m);for(const{handlerName:te,handler:re,allowed:se}of this._handlers){if(!re.isEnabled())continue;let ae;this._blockedByActive(D,se,te)?re.reset():re[y||m.type]&&(ae=re[y||m.type](m,U,L),this.mergeHandlerResult(C,M,ae,te,S),ae&&ae.needsRenderFrame&&this._triggerRenderFrame()),(ae||re.isActive())&&(D[te]=re)}const Z={};for(const te in this._previousActiveHandlers)D[te]||(Z[te]=S);this._previousActiveHandlers=D,(Object.keys(Z).length||Pc(C))&&(this._changes.push([C,M,Z]),this._triggerRenderFrame()),(Object.keys(D).length||Pc(C))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:G}=C;G&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],G(this._map))},this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new fh(i),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,y,S]of this._listeners)A.addEventListener(m,y,m===document?this.handleWindowEvent:this.handleEvent,S)}destroy(){for(const[i,h,f]of this._listeners)A.removeEventListener(i,h,i===document?this.handleWindowEvent:this.handleEvent,f)}_addDefaultHandlers(i){const h=this._map,f=h.getCanvasContainer();this._add("mapEvent",new Ap(h,i));const m=h.boxZoom=new Vi(h,i);this._add("boxZoom",m),i.interactive&&i.boxZoom&&m.enable();const y=h.cooperativeGestures=new Jo(h,i.cooperativeGestures);this._add("cooperativeGestures",y),i.cooperativeGestures&&y.enable();const S=new Ko(h),C=new zg(h);h.doubleClickZoom=new po(C,S),this._add("tapZoom",S),this._add("clickZoom",C),i.interactive&&i.doubleClickZoom&&h.doubleClickZoom.enable();const M=new Dg;this._add("tapDragZoom",M);const D=h.touchPitch=new Xo(h);this._add("touchPitch",D),i.interactive&&i.touchPitch&&h.touchPitch.enable(i.touchPitch);const O=_h(i),L=vh(i);h.dragRotate=new Rp(i,O,L),this._add("mouseRotate",O,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]),i.interactive&&i.dragRotate&&h.dragRotate.enable();const U=(({enable:ae,clickTolerance:Y})=>{const de=new Cc({checkCorrectEvent:fe=>A.mouseButton(fe)===0&&!fe.ctrlKey});return new fs({clickTolerance:Y,move:(fe,_e)=>({around:_e,panDelta:_e.sub(fe)}),activateOnStart:!0,moveStateManager:de,enable:ae,assignEvents:Mc})})(i),Z=new ho(i,h);h.dragPan=new Dp(f,U,Z),this._add("mousePan",U),this._add("touchPan",Z,["touchZoom","touchRotate"]),i.interactive&&i.dragPan&&h.dragPan.enable(i.dragPan);const G=new Sh,te=new wh;h.touchZoomRotate=new Th(f,te,G,M),this._add("touchRotate",G,["touchPan","touchZoom"]),this._add("touchZoom",te,["touchPan","touchRotate"]),i.interactive&&i.touchZoomRotate&&h.touchZoomRotate.enable(i.touchZoomRotate);const re=h.scrollZoom=new Mr(h,()=>this._triggerRenderFrame());this._add("scrollZoom",re,["mousePan"]),i.interactive&&i.scrollZoom&&h.scrollZoom.enable(i.scrollZoom);const se=h.keyboard=new sr(h);this._add("keyboard",se),i.interactive&&i.keyboard&&h.keyboard.enable(),this._add("blockableMapEvent",new fn(h))}_add(i,h,f){this._handlers.push({handlerName:i,handler:h,allowed:f}),this._handlersById[i]=h}stop(i){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!or(this._eventsInProgress)||this.isZooming()}_blockedByActive(i,h,f){for(const m in i)if(m!==f&&(!h||h.indexOf(m)<0))return!0;return!1}_getMapTouches(i){const h=[];for(const f of i)this._el.contains(f.target)&&h.push(f);return h}mergeHandlerResult(i,h,f,m,y){if(!f)return;c.e(i,f);const S={handlerName:m,originalEvent:f.originalEvent||y};f.zoomDelta!==void 0&&(h.zoom=S),f.panDelta!==void 0&&(h.drag=S),f.pitchDelta!==void 0&&(h.pitch=S),f.bearingDelta!==void 0&&(h.rotate=S)}_applyChanges(){const i={},h={},f={};for(const[m,y,S]of this._changes)m.panDelta&&(i.panDelta=(i.panDelta||new c.P(0,0))._add(m.panDelta)),m.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(i.around=m.around),m.pinchAround!==void 0&&(i.pinchAround=m.pinchAround),m.noInertia&&(i.noInertia=m.noInertia),c.e(h,y),c.e(f,S);this._updateMapTransform(i,h,f),this._changes=[]}_updateMapTransform(i,h,f){const m=this._map,y=m._getTransformForUpdate(),S=m.terrain;if(!(Pc(i)||S&&this._terrainMovement))return this._fireEvents(h,f,!0);let{panDelta:C,zoomDelta:M,bearingDelta:D,pitchDelta:O,around:L,pinchAround:U}=i;U!==void 0&&(L=U),m._stop(!0),L=L||m.transform.centerPoint;const Z=y.pointLocation(C?L.sub(C):L);D&&(y.bearing+=D),O&&(y.pitch+=O),M&&(y.zoom+=M),S?this._terrainMovement||!h.drag&&!h.zoom?h.drag&&this._terrainMovement?y.center=y.pointLocation(y.centerPoint.sub(C)):y.setLocationAtPoint(Z,L):(this._terrainMovement=!0,this._map._elevationFreeze=!0,y.setLocationAtPoint(Z,L)):y.setLocationAtPoint(Z,L),m._applyUpdatedTransform(y),this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(h,f,!0)}_fireEvents(i,h,f){const m=or(this._eventsInProgress),y=or(i),S={};for(const L in i){const{originalEvent:U}=i[L];this._eventsInProgress[L]||(S[`${L}start`]=U),this._eventsInProgress[L]=i[L]}!m&&y&&this._fireEvent("movestart",y.originalEvent);for(const L in S)this._fireEvent(L,S[L]);y&&this._fireEvent("move",y.originalEvent);for(const L in i){const{originalEvent:U}=i[L];this._fireEvent(L,U)}const C={};let M;for(const L in this._eventsInProgress){const{handlerName:U,originalEvent:Z}=this._eventsInProgress[L];this._handlersById[U].isActive()||(delete this._eventsInProgress[L],M=h[U]||Z,C[`${L}end`]=M)}for(const L in C)this._fireEvent(L,C[L]);const D=or(this._eventsInProgress),O=(m||y)&&!D;if(O&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const L=this._map._getTransformForUpdate();L.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(L)}if(f&&O){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=Z=>Z!==0&&-this._bearingSnap<Z&&Z<this._bearingSnap;!L||!L.essential&&P.prefersReducedMotion?(this._map.fire(new c.k("moveend",{originalEvent:M})),U(this._map.getBearing())&&this._map.resetNorth()):(U(L.bearing||this._map.getBearing())&&(L.bearing=0),L.freezeElevation=!0,this._map.easeTo(L,{originalEvent:M})),this._updatingCamera=!1}}_fireEvent(i,h){this._map.fire(new c.k(i,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{delete this._frameId,this.handleEvent(new Ge("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Op extends c.E{constructor(i,h){super(),this._renderFrameCallback=()=>{const f=Math.min((P.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(f)),f<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=h.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new c.N(this.transform.center.lng,this.transform.center.lat)}setCenter(i,h){return this.jumpTo({center:i},h)}panBy(i,h,f){return i=c.P.convert(i).mult(-1),this.panTo(this.transform.center,c.e({offset:i},h),f)}panTo(i,h,f){return this.easeTo(c.e({center:i},h),f)}getZoom(){return this.transform.zoom}setZoom(i,h){return this.jumpTo({zoom:i},h),this}zoomTo(i,h,f){return this.easeTo(c.e({zoom:i},h),f)}zoomIn(i,h){return this.zoomTo(this.getZoom()+1,i,h),this}zoomOut(i,h){return this.zoomTo(this.getZoom()-1,i,h),this}getBearing(){return this.transform.bearing}setBearing(i,h){return this.jumpTo({bearing:i},h),this}getPadding(){return this.transform.padding}setPadding(i,h){return this.jumpTo({padding:i},h),this}rotateTo(i,h,f){return this.easeTo(c.e({bearing:i},h),f)}resetNorth(i,h){return this.rotateTo(0,c.e({duration:1e3},i),h),this}resetNorthPitch(i,h){return this.easeTo(c.e({bearing:0,pitch:0,duration:1e3},i),h),this}snapToNorth(i,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,h):this}getPitch(){return this.transform.pitch}setPitch(i,h){return this.jumpTo({pitch:i},h),this}cameraForBounds(i,h){i=xe.convert(i).adjustAntiMeridian();const f=h&&h.bearing||0;return this._cameraForBoxAndBearing(i.getNorthWest(),i.getSouthEast(),f,h)}_cameraForBoxAndBearing(i,h,f,m){const y={top:0,bottom:0,right:0,left:0};if(typeof(m=c.e({padding:y,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding=="number"){const Be=m.padding;m.padding={top:Be,bottom:Be,right:Be,left:Be}}m.padding=c.e(y,m.padding);const S=this.transform,C=S.padding,M=new xe(i,h),D=S.project(M.getNorthWest()),O=S.project(M.getNorthEast()),L=S.project(M.getSouthEast()),U=S.project(M.getSouthWest()),Z=c.ba(-f),G=D.rotate(Z),te=O.rotate(Z),re=L.rotate(Z),se=U.rotate(Z),ae=new c.P(Math.max(G.x,te.x,se.x,re.x),Math.max(G.y,te.y,se.y,re.y)),Y=new c.P(Math.min(G.x,te.x,se.x,re.x),Math.min(G.y,te.y,se.y,re.y)),de=ae.sub(Y),fe=(S.width-(C.left+C.right+m.padding.left+m.padding.right))/de.x,_e=(S.height-(C.top+C.bottom+m.padding.top+m.padding.bottom))/de.y;if(_e<0||fe<0)return void c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Te=Math.min(S.scaleZoom(S.scale*Math.min(fe,_e)),m.maxZoom),Pe=c.P.convert(m.offset),$e=new c.P((m.padding.left-m.padding.right)/2,(m.padding.top-m.padding.bottom)/2).rotate(c.ba(f)),He=Pe.add($e).mult(S.scale/S.zoomScale(Te));return{center:S.unproject(D.add(L).div(2).sub(He)),zoom:Te,bearing:f}}fitBounds(i,h,f){return this._fitInternal(this.cameraForBounds(i,h),h,f)}fitScreenCoordinates(i,h,f,m,y){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(c.P.convert(i)),this.transform.pointLocation(c.P.convert(h)),f,m),m,y)}_fitInternal(i,h,f){return i?(delete(h=c.e(i,h)).padding,h.linear?this.easeTo(h,f):this.flyTo(h,f)):this}jumpTo(i,h){this.stop();const f=this._getTransformForUpdate();let m=!1,y=!1,S=!1;return"zoom"in i&&f.zoom!==+i.zoom&&(m=!0,f.zoom=+i.zoom),i.center!==void 0&&(f.center=c.N.convert(i.center)),"bearing"in i&&f.bearing!==+i.bearing&&(y=!0,f.bearing=+i.bearing),"pitch"in i&&f.pitch!==+i.pitch&&(S=!0,f.pitch=+i.pitch),i.padding==null||f.isPaddingEqual(i.padding)||(f.padding=i.padding),this._applyUpdatedTransform(f),this.fire(new c.k("movestart",h)).fire(new c.k("move",h)),m&&this.fire(new c.k("zoomstart",h)).fire(new c.k("zoom",h)).fire(new c.k("zoomend",h)),y&&this.fire(new c.k("rotatestart",h)).fire(new c.k("rotate",h)).fire(new c.k("rotateend",h)),S&&this.fire(new c.k("pitchstart",h)).fire(new c.k("pitch",h)).fire(new c.k("pitchend",h)),this.fire(new c.k("moveend",h))}calculateCameraOptionsFromTo(i,h,f,m=0){const y=c.Z.fromLngLat(i,h),S=c.Z.fromLngLat(f,m),C=S.x-y.x,M=S.y-y.y,D=S.z-y.z,O=Math.hypot(C,M,D);if(O===0)throw new Error("Can't calculate camera options with same From and To");const L=Math.hypot(C,M),U=this.transform.scaleZoom(this.transform.cameraToCenterDistance/O/this.transform.tileSize),Z=180*Math.atan2(C,-M)/Math.PI;let G=180*Math.acos(L/O)/Math.PI;return G=D<0?90-G:90+G,{center:S.toLngLat(),zoom:U,pitch:G,bearing:Z}}easeTo(i,h){var f;this._stop(!1,i.easeId),((i=c.e({offset:[0,0],duration:500,easing:c.b9},i)).animate===!1||!i.essential&&P.prefersReducedMotion)&&(i.duration=0);const m=this._getTransformForUpdate(),y=m.zoom,S=m.bearing,C=m.pitch,M=m.padding,D="bearing"in i?this._normalizeBearing(i.bearing,S):S,O="pitch"in i?+i.pitch:C,L="padding"in i?i.padding:m.padding,U=c.P.convert(i.offset);let Z=m.centerPoint.add(U);const G=m.pointLocation(Z),{center:te,zoom:re}=m.getConstrained(c.N.convert(i.center||G),(f=i.zoom)!==null&&f!==void 0?f:y);this._normalizeCenter(te,m);const se=m.project(G),ae=m.project(te).sub(se),Y=m.zoomScale(re-y);let de,fe;i.around&&(de=c.N.convert(i.around),fe=m.locationPoint(de));const _e={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||re!==y,this._rotating=this._rotating||S!==D,this._pitching=this._pitching||O!==C,this._padding=!m.isPaddingEqual(L),this._easeId=i.easeId,this._prepareEase(h,i.noMoveStart,_e),this.terrain&&this._prepareElevation(te),this._ease(Te=>{if(this._zooming&&(m.zoom=c.y.number(y,re,Te)),this._rotating&&(m.bearing=c.y.number(S,D,Te)),this._pitching&&(m.pitch=c.y.number(C,O,Te)),this._padding&&(m.interpolatePadding(M,L,Te),Z=m.centerPoint.add(U)),this.terrain&&!i.freezeElevation&&this._updateElevation(Te),de)m.setLocationAtPoint(de,fe);else{const Pe=m.zoomScale(m.zoom-y),$e=re>y?Math.min(2,Y):Math.max(.5,Y),He=Math.pow($e,1-Te),Be=m.unproject(se.add(ae.mult(Te*He)).mult(Pe));m.setLocationAtPoint(m.renderWorldCopies?Be.wrap():Be,Z)}this._applyUpdatedTransform(m),this._fireMoveEvents(h)},Te=>{this.terrain&&i.freezeElevation&&this._finalizeElevation(),this._afterEase(h,Te)},i),this}_prepareEase(i,h,f={}){this._moving=!0,h||f.moving||this.fire(new c.k("movestart",i)),this._zooming&&!f.zooming&&this.fire(new c.k("zoomstart",i)),this._rotating&&!f.rotating&&this.fire(new c.k("rotatestart",i)),this._pitching&&!f.pitching&&this.fire(new c.k("pitchstart",i))}_prepareElevation(i){this._elevationCenter=i,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(i,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(i){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const h=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(i<1&&h!==this._elevationTarget){const f=this._elevationTarget-this._elevationStart;this._elevationStart+=i*(f-(h-(f*i+this._elevationStart))/(1-i)),this._elevationTarget=h}this.transform.elevation=c.y.number(this._elevationStart,this._elevationTarget,i)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(i){const h=i.getCameraPosition(),f=this.terrain.getElevationForLngLatZoom(h.lngLat,i.zoom);if(h.altitude<f){const m=this.calculateCameraOptionsFromTo(h.lngLat,f,i.center,i.elevation);return{pitch:m.pitch,zoom:m.zoom}}return{}}_applyUpdatedTransform(i){const h=[];if(this.terrain&&h.push(m=>this._elevateCameraIfInsideTerrain(m)),this.transformCameraUpdate&&h.push(m=>this.transformCameraUpdate(m)),!h.length)return;const f=i.clone();for(const m of h){const y=f.clone(),{center:S,zoom:C,pitch:M,bearing:D,elevation:O}=m(y);S&&(y.center=S),C!==void 0&&(y.zoom=C),M!==void 0&&(y.pitch=M),D!==void 0&&(y.bearing=D),O!==void 0&&(y.elevation=O),f.apply(y)}this.transform.apply(f)}_fireMoveEvents(i){this.fire(new c.k("move",i)),this._zooming&&this.fire(new c.k("zoom",i)),this._rotating&&this.fire(new c.k("rotate",i)),this._pitching&&this.fire(new c.k("pitch",i))}_afterEase(i,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId;const f=this._zooming,m=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new c.k("zoomend",i)),m&&this.fire(new c.k("rotateend",i)),y&&this.fire(new c.k("pitchend",i)),this.fire(new c.k("moveend",i))}flyTo(i,h){var f;if(!i.essential&&P.prefersReducedMotion){const Ue=c.M(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ue,h)}this.stop(),i=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.b9},i);const m=this._getTransformForUpdate(),y=m.zoom,S=m.bearing,C=m.pitch,M=m.padding,D="bearing"in i?this._normalizeBearing(i.bearing,S):S,O="pitch"in i?+i.pitch:C,L="padding"in i?i.padding:m.padding,U=c.P.convert(i.offset);let Z=m.centerPoint.add(U);const G=m.pointLocation(Z),{center:te,zoom:re}=m.getConstrained(c.N.convert(i.center||G),(f=i.zoom)!==null&&f!==void 0?f:y);this._normalizeCenter(te,m);const se=m.zoomScale(re-y),ae=m.project(G),Y=m.project(te).sub(ae);let de=i.curve;const fe=Math.max(m.width,m.height),_e=fe/se,Te=Y.mag();if("minZoom"in i){const Ue=c.ac(Math.min(i.minZoom,y,re),m.minZoom,m.maxZoom),ht=fe/m.zoomScale(Ue-y);de=Math.sqrt(ht/Te*2)}const Pe=de*de;function $e(Ue){const ht=(_e*_e-fe*fe+(Ue?-1:1)*Pe*Pe*Te*Te)/(2*(Ue?_e:fe)*Pe*Te);return Math.log(Math.sqrt(ht*ht+1)-ht)}function He(Ue){return(Math.exp(Ue)-Math.exp(-Ue))/2}function Be(Ue){return(Math.exp(Ue)+Math.exp(-Ue))/2}const Le=$e(!1);let Ye=function(Ue){return Be(Le)/Be(Le+de*Ue)},pt=function(Ue){return fe*((Be(Le)*(He(ht=Le+de*Ue)/Be(ht))-He(Le))/Pe)/Te;var ht},Ne=($e(!0)-Le)/de;if(Math.abs(Te)<1e-6||!isFinite(Ne)){if(Math.abs(fe-_e)<1e-6)return this.easeTo(i,h);const Ue=_e<fe?-1:1;Ne=Math.abs(Math.log(_e/fe))/de,pt=()=>0,Ye=ht=>Math.exp(Ue*de*ht)}return i.duration="duration"in i?+i.duration:1e3*Ne/("screenSpeed"in i?+i.screenSpeed/de:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0),this._zooming=!0,this._rotating=S!==D,this._pitching=O!==C,this._padding=!m.isPaddingEqual(L),this._prepareEase(h,!1),this.terrain&&this._prepareElevation(te),this._ease(Ue=>{const ht=Ue*Ne,Qt=1/Ye(ht);m.zoom=Ue===1?re:y+m.scaleZoom(Qt),this._rotating&&(m.bearing=c.y.number(S,D,Ue)),this._pitching&&(m.pitch=c.y.number(C,O,Ue)),this._padding&&(m.interpolatePadding(M,L,Ue),Z=m.centerPoint.add(U)),this.terrain&&!i.freezeElevation&&this._updateElevation(Ue);const wt=Ue===1?te:m.unproject(ae.add(Y.mult(pt(ht))).mult(Qt));m.setLocationAtPoint(m.renderWorldCopies?wt.wrap():wt,Z),this._applyUpdatedTransform(m),this._fireMoveEvents(h)},()=>{this.terrain&&i.freezeElevation&&this._finalizeElevation(),this._afterEase(h)},i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,h){var f;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const m=this._onEaseEnd;delete this._onEaseEnd,m.call(this,h)}return i||(f=this.handlers)===null||f===void 0||f.stop(!1),this}_ease(i,h,f){f.animate===!1||f.duration===0?(i(1),h()):(this._easeStart=P.now(),this._easeOptions=f,this._onEaseFrame=i,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(i,h){i=c.b3(i,-180,180);const f=Math.abs(i-h);return Math.abs(i-360-h)<f&&(i-=360),Math.abs(i+360-h)<f&&(i+=360),i}_normalizeCenter(i,h){if(!h.renderWorldCopies||h.lngRange)return;const f=i.lng-h.center.lng;i.lng+=f>180?-360:f<-180?360:0}queryTerrainElevation(i){return this.terrain?this.terrain.getElevationForLngLatZoom(c.N.convert(i),this.transform.tileZoom)-this.transform.elevation:null}}const Yo={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Qo{constructor(i=Yo){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=h=>{!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"&&h.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=i}getDefaultPosition(){return"bottom-right"}onAdd(i){return this._map=i,this._compact=this.options.compact,this._container=A.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=A.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=A.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){A.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(i,h){const f=this._map._getUIString(`AttributionControl.${h}`);i.title=f,i.setAttribute("aria-label",f)}_updateAttributions(){if(!this._map.style)return;let i=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=i.concat(this.options.customAttribution.map(m=>typeof m!="string"?"":m)):typeof this.options.customAttribution=="string"&&i.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const h=this._map.style.sourceCaches;for(const m in h){const y=h[m];if(y.used||y.usedForTerrain){const S=y.getSource();S.attribution&&i.indexOf(S.attribution)<0&&i.push(S.attribution)}}i=i.filter(m=>String(m).trim()),i.sort((m,y)=>m.length-y.length),i=i.filter((m,y)=>{for(let S=y+1;S<i.length;S++)if(i[S].indexOf(m)>=0)return!1;return!0});const f=i.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,i.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Mh{constructor(i={}){this._updateCompact=()=>{const h=this._container.children;if(h.length){const f=h[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&f.classList.add("maplibregl-compact"):f.classList.remove("maplibregl-compact")}},this.options=i}getDefaultPosition(){return"bottom-left"}onAdd(i){this._map=i,this._compact=this.options&&this.options.compact,this._container=A.create("div","maplibregl-ctrl");const h=A.create("a","maplibregl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){A.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class It{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const h=++this._id;return this._queue.push({callback:i,id:h,cancelled:!1}),h}remove(i){const h=this._currentlyRunning,f=h?this._queue.concat(h):this._queue;for(const m of f)if(m.id===i)return void(m.cancelled=!0)}run(i=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const f of h)if(!f.cancelled&&(f.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Eh=c.Y([{name:"a_pos3d",type:"Int16",components:3}]);class Rg extends c.E{constructor(i){super(),this.sourceCache=i,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,i.usedForTerrain=!0,i.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(i,h){this.sourceCache.update(i,h),this._renderableTilesKeys=[];const f={};for(const m of i.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h}))f[m.key]=!0,this._renderableTilesKeys.push(m.key),this._tiles[m.key]||(m.posMatrix=new Float64Array(16),c.aP(m.posMatrix,0,c.X,0,c.X,0,1),this._tiles[m.key]=new zs(m,this.tileSize));for(const m in this._tiles)f[m]||delete this._tiles[m]}freeRtt(i){for(const h in this._tiles){const f=this._tiles[h];(!i||f.tileID.equals(i)||f.tileID.isChildOf(i)||i.isChildOf(f.tileID))&&(f.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(i=>this.getTileByID(i))}getTileByID(i){return this._tiles[i]}getTerrainCoords(i){const h={};for(const f of this._renderableTilesKeys){const m=this._tiles[f].tileID;if(m.canonical.equals(i.canonical)){const y=i.clone();y.posMatrix=new Float64Array(16),c.aP(y.posMatrix,0,c.X,0,c.X,0,1),h[f]=y}else if(m.canonical.isChildOf(i.canonical)){const y=i.clone();y.posMatrix=new Float64Array(16);const S=m.canonical.z-i.canonical.z,C=m.canonical.x-(m.canonical.x>>S<<S),M=m.canonical.y-(m.canonical.y>>S<<S),D=c.X>>S;c.aP(y.posMatrix,0,D,0,D,0,1),c.J(y.posMatrix,y.posMatrix,[-C*D,-M*D,0]),h[f]=y}else if(i.canonical.isChildOf(m.canonical)){const y=i.clone();y.posMatrix=new Float64Array(16);const S=i.canonical.z-m.canonical.z,C=i.canonical.x-(i.canonical.x>>S<<S),M=i.canonical.y-(i.canonical.y>>S<<S),D=c.X>>S;c.aP(y.posMatrix,0,c.X,0,c.X,0,1),c.J(y.posMatrix,y.posMatrix,[C*D,M*D,0]),c.K(y.posMatrix,y.posMatrix,[1/2**S,1/2**S,0]),h[f]=y}}return h}getSourceTile(i,h){const f=this.sourceCache._source;let m=i.overscaledZ-this.deltaZoom;if(m>f.maxzoom&&(m=f.maxzoom),m<f.minzoom)return null;this._sourceTileCache[i.key]||(this._sourceTileCache[i.key]=i.scaledTo(m).key);let y=this.sourceCache.getTileByID(this._sourceTileCache[i.key]);if((!y||!y.dem)&&h)for(;m>=f.minzoom&&(!y||!y.dem);)y=this.sourceCache.getTileByID(i.scaledTo(m--).key);return y}tilesAfterTime(i=Date.now()){return Object.values(this._tiles).filter(h=>h.timeAdded>=i)}}class Ih{constructor(i,h,f){this.painter=i,this.sourceCache=new Rg(h),this.options=f,this.exaggeration=typeof f.exaggeration=="number"?f.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(i,h,f,m=c.X){var y;if(!(h>=0&&h<m&&f>=0&&f<m))return 0;const S=this.getTerrainData(i),C=(y=S.tile)===null||y===void 0?void 0:y.dem;if(!C)return 0;const M=function(G,te,re){var se=te[0],ae=te[1];return G[0]=re[0]*se+re[4]*ae+re[12],G[1]=re[1]*se+re[5]*ae+re[13],G}([],[h/m*c.X,f/m*c.X],S.u_terrain_matrix),D=[M[0]*C.dim,M[1]*C.dim],O=Math.floor(D[0]),L=Math.floor(D[1]),U=D[0]-O,Z=D[1]-L;return C.get(O,L)*(1-U)*(1-Z)+C.get(O+1,L)*U*(1-Z)+C.get(O,L+1)*(1-U)*Z+C.get(O+1,L+1)*U*Z}getElevationForLngLatZoom(i,h){if(!c.bb(h,i.wrap()))return 0;const{tileID:f,mercatorX:m,mercatorY:y}=this._getOverscaledTileIDFromLngLatZoom(i,h);return this.getElevation(f,m%c.X,y%c.X,c.X)}getElevation(i,h,f,m=c.X){return this.getDEMElevation(i,h,f,m)*this.exaggeration}getTerrainData(i){if(!this._emptyDemTexture){const m=this.painter.context,y=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new xt(m,y,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new xt(m,new c.R({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.an([])}const h=this.sourceCache.getSourceTile(i,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const m=this.painter.context;h.demTexture=this.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new xt(m,h.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),h.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const f=h&&h+h.tileID.key+i.key;if(f&&!this._demMatrixCache[f]){const m=this.sourceCache.sourceCache._source.maxzoom;let y=i.canonical.z-h.tileID.canonical.z;i.overscaledZ>i.canonical.z&&(i.canonical.z>=m?y=i.canonical.z-m:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const S=i.canonical.x-(i.canonical.x>>y<<y),C=i.canonical.y-(i.canonical.y>>y<<y),M=c.bc(new Float64Array(16),[1/(c.X<<y),1/(c.X<<y),0]);c.J(M,M,[S*c.X,C*c.X,0]),this._demMatrixCache[i.key]={matrix:M,coord:i}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:f?this._demMatrixCache[i.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getFramebuffer(i){const h=this.painter,f=h.width/devicePixelRatio,m=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===f&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new xt(h.context,{width:f,height:m,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new xt(h.context,{width:f,height:m,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(f,m,!0,!1),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,f,m))),this._fbo.colorAttachment.set(i==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const i=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let y=0,S=0;y<this._coordsTextureSize;y++)for(let C=0;C<this._coordsTextureSize;C++,S+=4)h[S+0]=255&C,h[S+1]=255&y,h[S+2]=C>>8<<4|y>>8,h[S+3]=0;const f=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),m=new xt(i,f,i.gl.RGBA,{premultiply:!1});return m.bind(i.gl.NEAREST,i.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(i){this.painter.maybeDrawDepthAndCoords(!0);const h=new Uint8Array(4),f=this.painter.context,m=f.gl,y=Math.round(i.x*this.painter.pixelRatio/devicePixelRatio),S=Math.round(i.y*this.painter.pixelRatio/devicePixelRatio),C=Math.round(this.painter.height/devicePixelRatio);f.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),m.readPixels(y,C-S-1,1,1,m.RGBA,m.UNSIGNED_BYTE,h),f.bindFramebuffer.set(null);const M=h[0]+(h[2]>>4<<8),D=h[1]+((15&h[2])<<8),O=this.coordsIndex[255-h[3]],L=O&&this.sourceCache.getTileByID(O);if(!L)return null;const U=this._coordsTextureSize,Z=(1<<L.tileID.canonical.z)*U;return new c.Z((L.tileID.canonical.x*U+M)/Z+L.tileID.wrap,(L.tileID.canonical.y*U+D)/Z,this.getElevation(L.tileID,M,D,U))}depthAtPoint(i){const h=new Uint8Array(4),f=this.painter.context,m=f.gl;return f.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),m.readPixels(i.x,this.painter.height/devicePixelRatio-i.y-1,1,1,m.RGBA,m.UNSIGNED_BYTE,h),f.bindFramebuffer.set(null),(h[0]/16777216+h[1]/65536+h[2]/256+h[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const i=this.painter.context,h=new c.bd,f=new c.aY,m=this.meshSize,y=c.X/m,S=m*m;for(let L=0;L<=m;L++)for(let U=0;U<=m;U++)h.emplaceBack(U*y,L*y,0);for(let L=0;L<S;L+=m+1)for(let U=0;U<m;U++)f.emplaceBack(U+L,m+U+L+1,m+U+L+2),f.emplaceBack(U+L,m+U+L+2,U+L+1);const C=h.length,M=C+2*(m+1);for(const L of[0,1])for(let U=0;U<=m;U++)for(const Z of[0,1])h.emplaceBack(U*y,L*c.X,Z);for(let L=0;L<2*m;L+=2)f.emplaceBack(M+L,M+L+1,M+L+3),f.emplaceBack(M+L,M+L+3,M+L+2),f.emplaceBack(C+L,C+L+3,C+L+1),f.emplaceBack(C+L,C+L+2,C+L+3);const D=h.length,O=D+2*(m+1);for(const L of[0,1])for(let U=0;U<=m;U++)for(const Z of[0,1])h.emplaceBack(L*c.X,U*y,Z);for(let L=0;L<2*m;L+=2)f.emplaceBack(D+L,D+L+1,D+L+3),f.emplaceBack(D+L,D+L+3,D+L+2),f.emplaceBack(O+L,O+L+3,O+L+1),f.emplaceBack(O+L,O+L+2,O+L+3);return this._mesh=new xc(i.createVertexBuffer(h,Eh.members),i.createIndexBuffer(f),c.a0.simpleSegment(0,0,h.length,f.length)),this._mesh}getMeshFrameDelta(i){return 2*Math.PI*c.be/Math.pow(2,i)/5}getMinTileElevationForLngLatZoom(i,h){var f;const{tileID:m}=this._getOverscaledTileIDFromLngLatZoom(i,h);return(f=this.getMinMaxElevation(m).minElevation)!==null&&f!==void 0?f:0}getMinMaxElevation(i){const h=this.getTerrainData(i).tile,f={minElevation:null,maxElevation:null};return h&&h.dem&&(f.minElevation=h.dem.min*this.exaggeration,f.maxElevation=h.dem.max*this.exaggeration),f}_getOverscaledTileIDFromLngLatZoom(i,h){const f=c.Z.fromLngLat(i.wrap()),m=(1<<h)*c.X,y=f.x*m,S=f.y*m,C=Math.floor(y/c.X),M=Math.floor(S/c.X);return{tileID:new c.S(h,0,h,C,M),mercatorX:y,mercatorY:S}}}class Og{constructor(i,h,f){this._context=i,this._size=h,this._tileSize=f,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const i of this._objects)i.texture.destroy(),i.fbo.destroy()}_createObject(i){const h=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),f=new xt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return f.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),h.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),h.colorAttachment.set(f.texture),{id:i,fbo:h,texture:f,stamp:-1,inUse:!1}}getObjectForId(i){return this._objects[i]}useObject(i){i.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(h=>i.id!==h),this._recentlyUsed.push(i.id)}stampObject(i){i.stamp=++this._stamp}getOrCreateFreeObject(){for(const h of this._recentlyUsed)if(!this._objects[h].inUse)return this._objects[h];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const i=this._createObject(this._objects.length);return this._objects.push(i),i}freeObject(i){i.inUse=!1}freeAllObjects(){for(const i of this._objects)this.freeObject(i)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(i=>!i.inUse)===!1}}const ea={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Lp{constructor(i,h){this.painter=i,this.terrain=h,this.pool=new Og(i.context,30,h.sourceCache.tileSize*h.qualityFactor)}destruct(){this.pool.destruct()}getTexture(i){return this.pool.getObjectForId(i.rtt[this._stacks.length-1].id).texture}prepareForRender(i,h){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=i._order.filter(f=>!i._layers[f].isHidden(h)),this._coordsDescendingInv={};for(const f in i.sourceCaches){this._coordsDescendingInv[f]={};const m=i.sourceCaches[f].getVisibleCoordinates();for(const y of m){const S=this.terrain.sourceCache.getTerrainCoords(y);for(const C in S)this._coordsDescendingInv[f][C]||(this._coordsDescendingInv[f][C]=[]),this._coordsDescendingInv[f][C].push(S[C])}}this._coordsDescendingInvStr={};for(const f of i._order){const m=i._layers[f],y=m.source;if(ea[m.type]&&!this._coordsDescendingInvStr[y]){this._coordsDescendingInvStr[y]={};for(const S in this._coordsDescendingInv[y])this._coordsDescendingInvStr[y][S]=this._coordsDescendingInv[y][S].map(C=>C.key).sort().join()}}for(const f of this._renderableTiles)for(const m in this._coordsDescendingInvStr){const y=this._coordsDescendingInvStr[m][f.tileID.key];y&&y!==f.rttCoords[m]&&(f.rtt=[])}}renderLayer(i){if(i.isHidden(this.painter.transform.zoom))return!1;const h=i.type,f=this.painter,m=this._renderableLayerIds[this._renderableLayerIds.length-1]===i.id;if(ea[h]&&(this._prevType&&ea[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(i.id),!m))return!0;if(ea[this._prevType]||ea[h]&&m){this._prevType=h;const y=this._stacks.length-1,S=this._stacks[y]||[];for(const C of this._renderableTiles){if(this.pool.isFull()&&(Ep(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(C),C.rtt[y]){const D=this.pool.getObjectForId(C.rtt[y].id);if(D.stamp===C.rtt[y].stamp){this.pool.useObject(D);continue}}const M=this.pool.getOrCreateFreeObject();this.pool.useObject(M),this.pool.stampObject(M),C.rtt[y]={id:M.id,stamp:M.stamp},f.context.bindFramebuffer.set(M.fbo.framebuffer),f.context.clear({color:c.aM.transparent,stencil:0}),f.currentStencilSource=void 0;for(let D=0;D<S.length;D++){const O=f.style._layers[S[D]],L=O.source?this._coordsDescendingInv[O.source][C.tileID.key]:[C.tileID];f.context.viewport.set([0,0,M.fbo.width,M.fbo.height]),f._renderTileClippingMasks(O,L),f.renderLayer(f,f.style.sourceCaches[O.source],O,L),O.source&&(C.rttCoords[O.source]=this._coordsDescendingInvStr[O.source][C.tileID.key])}}return Ep(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),ea[h]}return!1}}const Ph={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Bp=w,Lg={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Yo,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},Ah=_=>{_.touchstart=_.dragStart,_.touchmoveWindow=_.dragMove,_.touchend=_.dragEnd},Bg={showCompass:!0,showZoom:!0,visualizePitch:!1};class Fg{constructor(i,h,f=!1){this.mousedown=S=>{this.startMouse(c.e({},S,{ctrlKey:!0,preventDefault:()=>S.preventDefault()}),A.mousePos(this.element,S)),A.addEventListener(window,"mousemove",this.mousemove),A.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=S=>{this.moveMouse(S,A.mousePos(this.element,S))},this.mouseup=S=>{this.mouseRotate.dragEnd(S),this.mousePitch&&this.mousePitch.dragEnd(S),this.offTemp()},this.touchstart=S=>{S.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=A.touchPos(this.element,S.targetTouches)[0],this.startTouch(S,this._startPos),A.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),A.addEventListener(window,"touchend",this.touchend))},this.touchmove=S=>{S.targetTouches.length!==1?this.reset():(this._lastPos=A.touchPos(this.element,S.targetTouches)[0],this.moveTouch(S,this._lastPos))},this.touchend=S=>{S.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const m=i.dragRotate._mouseRotate.getClickTolerance(),y=i.dragRotate._mousePitch.getClickTolerance();this.element=h,this.mouseRotate=_h({clickTolerance:m,enable:!0}),this.touchRotate=(({enable:S,clickTolerance:C,bearingDegreesPerPixelMoved:M=.8})=>{const D=new yh;return new fs({clickTolerance:C,move:(O,L)=>({bearingDelta:(L.x-O.x)*M}),moveStateManager:D,enable:S,assignEvents:Ah})})({clickTolerance:m,enable:!0}),this.map=i,f&&(this.mousePitch=vh({clickTolerance:y,enable:!0}),this.touchPitch=(({enable:S,clickTolerance:C,pitchDegreesPerPixelMoved:M=-.5})=>{const D=new yh;return new fs({clickTolerance:C,move:(O,L)=>({pitchDelta:(L.y-O.y)*M}),moveStateManager:D,enable:S,assignEvents:Ah})})({clickTolerance:y,enable:!0})),A.addEventListener(h,"mousedown",this.mousedown),A.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),A.addEventListener(h,"touchcancel",this.reset)}startMouse(i,h){this.mouseRotate.dragStart(i,h),this.mousePitch&&this.mousePitch.dragStart(i,h),A.disableDrag()}startTouch(i,h){this.touchRotate.dragStart(i,h),this.touchPitch&&this.touchPitch.dragStart(i,h),A.disableDrag()}moveMouse(i,h){const f=this.map,{bearingDelta:m}=this.mouseRotate.dragMove(i,h)||{};if(m&&f.setBearing(f.getBearing()+m),this.mousePitch){const{pitchDelta:y}=this.mousePitch.dragMove(i,h)||{};y&&f.setPitch(f.getPitch()+y)}}moveTouch(i,h){const f=this.map,{bearingDelta:m}=this.touchRotate.dragMove(i,h)||{};if(m&&f.setBearing(f.getBearing()+m),this.touchPitch){const{pitchDelta:y}=this.touchPitch.dragMove(i,h)||{};y&&f.setPitch(f.getPitch()+y)}}off(){const i=this.element;A.removeEventListener(i,"mousedown",this.mousedown),A.removeEventListener(i,"touchstart",this.touchstart,{passive:!1}),A.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),A.removeEventListener(window,"touchend",this.touchend),A.removeEventListener(i,"touchcancel",this.reset),this.offTemp()}offTemp(){A.enableDrag(),A.removeEventListener(window,"mousemove",this.mousemove),A.removeEventListener(window,"mouseup",this.mouseup),A.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),A.removeEventListener(window,"touchend",this.touchend)}}let $i;function Yt(_,i,h){const f=new c.N(_.lng,_.lat);if(_=new c.N(_.lng,_.lat),i){const m=new c.N(_.lng-360,_.lat),y=new c.N(_.lng+360,_.lat),S=h.locationPoint(_).distSqr(i);h.locationPoint(m).distSqr(i)<S?_=m:h.locationPoint(y).distSqr(i)<S&&(_=y)}for(;Math.abs(_.lng-h.center.lng)>180;){const m=h.locationPoint(_);if(m.x>=0&&m.y>=0&&m.x<=h.width&&m.y<=h.height)break;_.lng>h.center.lng?_.lng-=360:_.lng+=360}return _.lng!==f.lng&&h.locationPoint(_).y>h.height/2-h.getHorizon()?_:f}const ta={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ac(_,i,h){const f=_.classList;for(const m in ta)f.remove(`maplibregl-${h}-anchor-${m}`);f.add(`maplibregl-${h}-anchor-${i}`)}class zc extends c.E{constructor(i){if(super(),this._onKeyPress=h=>{const f=h.code,m=h.charCode||h.keyCode;f!=="Space"&&f!=="Enter"&&m!==32&&m!==13||this.togglePopup()},this._onMapClick=h=>{const f=h.originalEvent.target,m=this._element;this._popup&&(f===m||m.contains(f))&&this.togglePopup()},this._update=h=>{var f;if(!this._map)return;const m=this._map.loaded()&&!this._map.isMoving();((h==null?void 0:h.type)==="terrain"||(h==null?void 0:h.type)==="render"&&!m)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Yt(this._lngLat,this._flatPos,this._map.transform):(f=this._lngLat)===null||f===void 0?void 0:f.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let y="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?y=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(y=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let S="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?S="rotateX(0deg)":this._pitchAlignment==="map"&&(S=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||h&&h.type!=="moveend"||(this._pos=this._pos.round()),A.setTransform(this._element,`${ta[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${S} ${y}`),P.frameAsync(new AbortController).then(()=>{this._updateOpacity(h&&h.type==="moveend")}).catch(()=>{})},this._onMove=h=>{if(!this._isDragging){const f=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=f}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.k("dragstart"))),this.fire(new c.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.k("dragend")),this._state="inactive"},this._addDragHandler=h=>{this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._subpixelPositioning=i&&i.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment!=="auto"?i.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(i==null?void 0:i.opacity,i==null?void 0:i.opacityWhenCovered),i&&i.element)this._element=i.element,this._offset=c.P.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=A.create("div");const h=A.createNS("http://www.w3.org/2000/svg","svg"),f=41,m=27;h.setAttributeNS(null,"display","block"),h.setAttributeNS(null,"height",`${f}px`),h.setAttributeNS(null,"width",`${m}px`),h.setAttributeNS(null,"viewBox",`0 0 ${m} ${f}`);const y=A.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"stroke","none"),y.setAttributeNS(null,"stroke-width","1"),y.setAttributeNS(null,"fill","none"),y.setAttributeNS(null,"fill-rule","evenodd");const S=A.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"fill-rule","nonzero");const C=A.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"transform","translate(3.0, 29.0)"),C.setAttributeNS(null,"fill","#000000");const M=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const se of M){const ae=A.createNS("http://www.w3.org/2000/svg","ellipse");ae.setAttributeNS(null,"opacity","0.04"),ae.setAttributeNS(null,"cx","10.5"),ae.setAttributeNS(null,"cy","5.80029008"),ae.setAttributeNS(null,"rx",se.rx),ae.setAttributeNS(null,"ry",se.ry),C.appendChild(ae)}const D=A.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"fill",this._color);const O=A.createNS("http://www.w3.org/2000/svg","path");O.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),D.appendChild(O);const L=A.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"opacity","0.25"),L.setAttributeNS(null,"fill","#000000");const U=A.createNS("http://www.w3.org/2000/svg","path");U.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),L.appendChild(U);const Z=A.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Z.setAttributeNS(null,"fill","#FFFFFF");const G=A.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(8.0, 8.0)");const te=A.createNS("http://www.w3.org/2000/svg","circle");te.setAttributeNS(null,"fill","#000000"),te.setAttributeNS(null,"opacity","0.25"),te.setAttributeNS(null,"cx","5.5"),te.setAttributeNS(null,"cy","5.5"),te.setAttributeNS(null,"r","5.4999962");const re=A.createNS("http://www.w3.org/2000/svg","circle");re.setAttributeNS(null,"fill","#FFFFFF"),re.setAttributeNS(null,"cx","5.5"),re.setAttributeNS(null,"cy","5.5"),re.setAttributeNS(null,"r","5.4999962"),G.appendChild(te),G.appendChild(re),S.appendChild(C),S.appendChild(D),S.appendChild(L),S.appendChild(Z),S.appendChild(G),h.appendChild(S),h.setAttributeNS(null,"height",f*this._scale+"px"),h.setAttributeNS(null,"width",m*this._scale+"px"),this._element.appendChild(h),this._offset=c.P.convert(i&&i.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",h=>{h.preventDefault()}),this._element.addEventListener("mousedown",h=>{h.preventDefault()}),Ac(this._element,this._anchor,"marker"),i&&i.className)for(const h of i.className.split(" "))this._element.classList.add(h);this._popup=null}addTo(i){return this.remove(),this._map=i,this._element.setAttribute("aria-label",i._getUIString("Marker.Title")),i.getCanvasContainer().appendChild(this._element),i.on("move",this._update),i.on("moveend",this._update),i.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),A.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=c.N.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const m=Math.abs(13.5)/Math.SQRT2;i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(i){return this._subpixelPositioning=i,this}getPopup(){return this._popup}togglePopup(){const i=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:i?(i.isOpen()?i.remove():(i.setLngLat(this._lngLat),i.addTo(this._map)),this):this}_updateOpacity(i=!1){var h,f;if(!(!((h=this._map)===null||h===void 0)&&h.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(i)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const m=this._map,y=m.terrain.depthAtPoint(this._pos),S=m.terrain.getElevationForLngLatZoom(this._lngLat,m.transform.tileZoom);if(m.transform.lngLatToCameraDepth(this._lngLat,S)-y<.006)return void(this._element.style.opacity=this._opacity);const C=-this._offset.y/m.transform._pixelPerMeter,M=Math.sin(m.getPitch()*Math.PI/180)*C,D=m.terrain.depthAtPoint(new c.P(this._pos.x,this._pos.y-this._offset.y)),O=m.transform.lngLatToCameraDepth(this._lngLat,S+M)-D>.006;!((f=this._popup)===null||f===void 0)&&f.isOpen()&&O&&this._popup.remove(),this._element.style.opacity=O?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(i){return this._offset=c.P.convert(i),this._update(),this}addClassName(i){this._element.classList.add(i)}removeClassName(i){this._element.classList.remove(i)}toggleClassName(i){return this._element.classList.toggle(i)}setDraggable(i){return this._draggable=!!i,this._map&&(i?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i&&i!=="auto"?i:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(i,h){return i===void 0&&h===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),i!==void 0&&(this._opacity=i),h!==void 0&&(this._opacityWhenCovered=h),this._map&&this._updateOpacity(!0),this}}const Fp={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let yl=0,_l=!1;const Xr={maxWidth:100,unit:"metric"};function vl(_,i,h){const f=h&&h.maxWidth||100,m=_._container.clientHeight/2,y=_.unproject([0,m]),S=_.unproject([f,m]),C=y.distanceTo(S);if(h&&h.unit==="imperial"){const M=3.2808*C;M>5280?Je(i,f,M/5280,_._getUIString("ScaleControl.Miles")):Je(i,f,M,_._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?Je(i,f,C/1852,_._getUIString("ScaleControl.NauticalMiles")):C>=1e3?Je(i,f,C/1e3,_._getUIString("ScaleControl.Kilometers")):Je(i,f,C,_._getUIString("ScaleControl.Meters"))}function Je(_,i,h,f){const m=function(y){const S=Math.pow(10,`${Math.floor(y)}`.length-1);let C=y/S;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(M){const D=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*D)/D}(C),S*C}(h);_.style.width=i*(m/h)+"px",_.innerHTML=`${m}&nbsp;${f}`}const ct={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Dc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Rc(_){if(_){if(typeof _=="number"){const i=Math.round(Math.abs(_)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,_),"top-left":new c.P(i,i),"top-right":new c.P(-i,i),bottom:new c.P(0,-_),"bottom-left":new c.P(i,-i),"bottom-right":new c.P(-i,-i),left:new c.P(_,0),right:new c.P(-_,0)}}if(_ instanceof c.P||Array.isArray(_)){const i=c.P.convert(_);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:c.P.convert(_.center||[0,0]),top:c.P.convert(_.top||[0,0]),"top-left":c.P.convert(_["top-left"]||[0,0]),"top-right":c.P.convert(_["top-right"]||[0,0]),bottom:c.P.convert(_.bottom||[0,0]),"bottom-left":c.P.convert(_["bottom-left"]||[0,0]),"bottom-right":c.P.convert(_["bottom-right"]||[0,0]),left:c.P.convert(_.left||[0,0]),right:c.P.convert(_.right||[0,0])}}return Rc(new c.P(0,0))}const zh=w;d.AJAXError=c.bh,d.Evented=c.E,d.LngLat=c.N,d.MercatorCoordinate=c.Z,d.Point=c.P,d.addProtocol=c.bi,d.config=c.a,d.removeProtocol=c.bj,d.AttributionControl=Qo,d.BoxZoomHandler=Vi,d.CanvasSource=nr,d.CooperativeGesturesHandler=Jo,d.DoubleClickZoomHandler=po,d.DragPanHandler=Dp,d.DragRotateHandler=Rp,d.EdgeInsets=Wo,d.FullscreenControl=class extends c.E{constructor(_={}){super(),this._onFullscreenChange=()=>{var i;let h=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((i=h==null?void 0:h.shadowRoot)===null||i===void 0)&&i.fullscreenElement;)h=h.shadowRoot.fullscreenElement;h===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,_&&_.container&&(_.container instanceof HTMLElement?this._container=_.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(_){return this._map=_,this._container||(this._container=this._map.getContainer()),this._controlContainer=A.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){A.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const _=this._fullscreenButton=A.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);A.create("span","maplibregl-ctrl-icon",_).setAttribute("aria-hidden","true"),_.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const _=this._getTitle();this._fullscreenButton.setAttribute("aria-label",_),this._fullscreenButton.title=_}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new c.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},d.GeoJSONSource=Qa,d.GeolocateControl=class extends c.E{constructor(_){super(),this._onSuccess=i=>{if(this._map){if(this._isOutOfMapMaxBounds(i))return this._setErrorState(),this.fire(new c.k("outofmaxbounds",i)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=i,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(i),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(i),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new c.k("geolocate",i)),this._finish()}},this._updateCamera=i=>{const h=new c.N(i.coords.longitude,i.coords.latitude),f=i.coords.accuracy,m=this._map.getBearing(),y=c.e({bearing:m},this.options.fitBoundsOptions),S=xe.fromLngLat(h,f);this._map.fitBounds(S,y,{geolocateSource:!0})},this._updateMarker=i=>{if(i){const h=new c.N(i.coords.longitude,i.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=i.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=i=>{if(this._map){if(this.options.trackUserLocation)if(i.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(i.code===3&&_l)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new c.k("error",i)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=A.create("button","maplibregl-ctrl-geolocate",this._container),A.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=i=>{if(this._map){if(i===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}else{const h=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=A.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new zc({element:this._dotElement}),this._circleElement=A.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new zc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",h=>{h.geolocateSource||this._watchState!=="ACTIVE_LOCK"||h.originalEvent&&h.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new c.k("trackuserlocationend")),this.fire(new c.k("userlocationlostfocus")))})}},this.options=c.e({},Fp,_)}onAdd(_){return this._map=_,this._container=A.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return c._(this,arguments,void 0,function*(i=!1){if($i!==void 0&&!i)return $i;if(window.navigator.permissions===void 0)return $i=!!window.navigator.geolocation,$i;try{$i=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{$i=!!window.navigator.geolocation}return $i})}().then(i=>this._finishSetupUI(i)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),A.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,yl=0,_l=!1}_isOutOfMapMaxBounds(_){const i=this._map.getMaxBounds(),h=_.coords;return i&&(h.longitude<i.getWest()||h.longitude>i.getEast()||h.latitude<i.getSouth()||h.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const _=this._map.getBounds(),i=_.getSouthEast(),h=_.getNorthEast(),f=i.distanceTo(h),m=Math.ceil(this._accuracy/(f/this._map._container.clientHeight)*2);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":yl--,_l=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new c.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.k("trackuserlocationstart")),this.fire(new c.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let _;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),yl++,yl>1?(_={maximumAge:6e5,timeout:0},_l=!0):(_=this.options.positionOptions,_l=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,_)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},d.Hash=bc,d.ImageSource=hs,d.KeyboardHandler=sr,d.LngLatBounds=xe,d.LogoControl=Mh,d.Map=class extends Op{constructor(_){c.bf.mark(c.bg.create);const i=Object.assign(Object.assign({},Lg),_);if(i.minZoom!=null&&i.maxZoom!=null&&i.minZoom>i.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(i.minPitch!=null&&i.maxPitch!=null&&i.minPitch>i.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(i.minPitch!=null&&i.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(i.maxPitch!=null&&i.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Go(i.minZoom,i.maxZoom,i.minPitch,i.maxPitch,i.renderWorldCopies),{bearingSnap:i.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new It,this._controls=[],this._mapId=c.a4(),this._contextLost=h=>{h.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new c.k("webglcontextlost",{originalEvent:h}))},this._contextRestored=h=>{this._setupPainter(),this.resize(),this._update(),this.fire(new c.k("webglcontextrestored",{originalEvent:h}))},this._onMapScroll=h=>{if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=i.interactive,this._maxTileCacheSize=i.maxTileCacheSize,this._maxTileCacheZoomLevels=i.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=i.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=i.preserveDrawingBuffer===!0,this._antialias=i.antialias===!0,this._trackResize=i.trackResize===!0,this._bearingSnap=i.bearingSnap,this._refreshExpiredTiles=i.refreshExpiredTiles===!0,this._fadeDuration=i.fadeDuration,this._crossSourceCollisions=i.crossSourceCollisions===!0,this._collectResourceTiming=i.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Ph),i.locale),this._clickTolerance=i.clickTolerance,this._overridePixelRatio=i.pixelRatio,this._maxCanvasSize=i.maxCanvasSize,this.transformCameraUpdate=i.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=i.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=le.addThrottleControl(()=>this.isMoving()),this._requestManager=new Se(i.transformRequest),typeof i.container=="string"){if(this._container=document.getElementById(i.container),!this._container)throw new Error(`Container '${i.container}' not found.`)}else{if(!(i.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=i.container}if(i.maxBounds&&this.setMaxBounds(i.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let h=!1;const f=dl(m=>{this._trackResize&&!this._removed&&(this.resize(m),this.redraw())},50);this._resizeObserver=new ResizeObserver(m=>{h?f(m):h=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Ch(this,i),this._hash=i.hash&&new bc(typeof i.hash=="string"&&i.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:i.center,zoom:i.zoom,bearing:i.bearing,pitch:i.pitch}),i.bounds&&(this.resize(),this.fitBounds(i.bounds,c.e({},i.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=i.localIdeographFontFamily,this._validateStyle=i.validateStyle,i.style&&this.setStyle(i.style,{localIdeographFontFamily:i.localIdeographFontFamily}),i.attributionControl&&this.addControl(new Qo(typeof i.attributionControl=="boolean"?void 0:i.attributionControl)),i.maplibreLogo&&this.addControl(new Mh,i.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new c.k(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new c.k(`${h.dataType}dataloading`,h))}),this.on("dataabort",h=>{this.fire(new c.k("sourcedataabort",h))})}_getMapId(){return this._mapId}addControl(_,i){if(i===void 0&&(i=_.getDefaultPosition?_.getDefaultPosition():"top-right"),!_||!_.onAdd)return this.fire(new c.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=_.onAdd(this);this._controls.push(_);const f=this._controlPositions[i];return i.indexOf("bottom")!==-1?f.insertBefore(h,f.firstChild):f.appendChild(h),this}removeControl(_){if(!_||!_.onRemove)return this.fire(new c.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(_);return i>-1&&this._controls.splice(i,1),_.onRemove(this),this}hasControl(_){return this._controls.indexOf(_)>-1}calculateCameraOptionsFromTo(_,i,h,f){return f==null&&this.terrain&&(f=this.terrain.getElevationForLngLatZoom(h,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(_,i,h,f)}resize(_){var i;const h=this._containerDimensions(),f=h[0],m=h[1],y=this._getClampedPixelRatio(f,m);if(this._resizeCanvas(f,m,y),this.painter.resize(f,m,y),this.painter.overLimit()){const C=this.painter.context.gl;this._maxCanvasSize=[C.drawingBufferWidth,C.drawingBufferHeight];const M=this._getClampedPixelRatio(f,m);this._resizeCanvas(f,m,M),this.painter.resize(f,m,M)}this.transform.resize(f,m),(i=this._requestedCameraState)===null||i===void 0||i.resize(f,m);const S=!this._moving;return S&&(this.stop(),this.fire(new c.k("movestart",_)).fire(new c.k("move",_))),this.fire(new c.k("resize",_)),S&&this.fire(new c.k("moveend",_)),this}_getClampedPixelRatio(_,i){const{0:h,1:f}=this._maxCanvasSize,m=this.getPixelRatio(),y=_*m,S=i*m;return Math.min(y>h?h/y:1,S>f?f/S:1)*m}getPixelRatio(){var _;return(_=this._overridePixelRatio)!==null&&_!==void 0?_:devicePixelRatio}setPixelRatio(_){this._overridePixelRatio=_,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(_){return this.transform.setMaxBounds(xe.convert(_)),this._update()}setMinZoom(_){if((_=_??-2)>=-2&&_<=this.transform.maxZoom)return this.transform.minZoom=_,this._update(),this.getZoom()<_&&this.setZoom(_),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(_){if((_=_??22)>=this.transform.minZoom)return this.transform.maxZoom=_,this._update(),this.getZoom()>_&&this.setZoom(_),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(_){if((_=_??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(_>=0&&_<=this.transform.maxPitch)return this.transform.minPitch=_,this._update(),this.getPitch()<_&&this.setPitch(_),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(_){if((_=_??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(_>=this.transform.minPitch)return this.transform.maxPitch=_,this._update(),this.getPitch()>_&&this.setPitch(_),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(_){return this.transform.renderWorldCopies=_,this._update()}project(_){return this.transform.locationPoint(c.N.convert(_),this.style&&this.terrain)}unproject(_){return this.transform.pointLocation(c.P.convert(_),this.terrain)}isMoving(){var _;return this._moving||((_=this.handlers)===null||_===void 0?void 0:_.isMoving())}isZooming(){var _;return this._zooming||((_=this.handlers)===null||_===void 0?void 0:_.isZooming())}isRotating(){var _;return this._rotating||((_=this.handlers)===null||_===void 0?void 0:_.isRotating())}_createDelegatedListener(_,i,h){if(_==="mouseenter"||_==="mouseover"){let f=!1;return{layers:i,listener:h,delegates:{mousemove:y=>{const S=i.filter(M=>this.getLayer(M)),C=S.length!==0?this.queryRenderedFeatures(y.point,{layers:S}):[];C.length?f||(f=!0,h.call(this,new Hn(_,this,y.originalEvent,{features:C}))):f=!1},mouseout:()=>{f=!1}}}}if(_==="mouseleave"||_==="mouseout"){let f=!1;return{layers:i,listener:h,delegates:{mousemove:S=>{const C=i.filter(M=>this.getLayer(M));(C.length!==0?this.queryRenderedFeatures(S.point,{layers:C}):[]).length?f=!0:f&&(f=!1,h.call(this,new Hn(_,this,S.originalEvent)))},mouseout:S=>{f&&(f=!1,h.call(this,new Hn(_,this,S.originalEvent)))}}}}{const f=m=>{const y=i.filter(C=>this.getLayer(C)),S=y.length!==0?this.queryRenderedFeatures(m.point,{layers:y}):[];S.length&&(m.features=S,h.call(this,m),delete m.features)};return{layers:i,listener:h,delegates:{[_]:f}}}}_saveDelegatedListener(_,i){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[_]=this._delegatedListeners[_]||[],this._delegatedListeners[_].push(i)}_removeDelegatedListener(_,i,h){if(!this._delegatedListeners||!this._delegatedListeners[_])return;const f=this._delegatedListeners[_];for(let m=0;m<f.length;m++){const y=f[m];if(y.listener===h&&y.layers.length===i.length&&y.layers.every(S=>i.includes(S))){for(const S in y.delegates)this.off(S,y.delegates[S]);return void f.splice(m,1)}}}on(_,i,h){if(h===void 0)return super.on(_,i);const f=this._createDelegatedListener(_,typeof i=="string"?[i]:i,h);this._saveDelegatedListener(_,f);for(const m in f.delegates)this.on(m,f.delegates[m]);return this}once(_,i,h){if(h===void 0)return super.once(_,i);const f=typeof i=="string"?[i]:i,m=this._createDelegatedListener(_,f,h);for(const y in m.delegates){const S=m.delegates[y];m.delegates[y]=(...C)=>{this._removeDelegatedListener(_,f,h),S(...C)}}this._saveDelegatedListener(_,m);for(const y in m.delegates)this.once(y,m.delegates[y]);return this}off(_,i,h){return h===void 0?super.off(_,i):(this._removeDelegatedListener(_,typeof i=="string"?[i]:i,h),this)}queryRenderedFeatures(_,i){if(!this.style)return[];let h;const f=_ instanceof c.P||Array.isArray(_),m=f?_:[[0,0],[this.transform.width,this.transform.height]];if(i=i||(f?{}:_)||{},m instanceof c.P||typeof m[0]=="number")h=[c.P.convert(m)];else{const y=c.P.convert(m[0]),S=c.P.convert(m[1]);h=[y,new c.P(S.x,y.y),S,new c.P(y.x,S.y),y]}return this.style.queryRenderedFeatures(h,i,this.transform)}querySourceFeatures(_,i){return this.style.querySourceFeatures(_,i)}setStyle(_,i){return(i=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},i)).diff!==!1&&i.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&_?(this._diffStyle(_,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._updateStyle(_,i))}setTransformRequest(_){return this._requestManager.setTransformRequest(_),this}_getUIString(_){const i=this._locale[_];if(i==null)throw new Error(`Missing UI string '${_}'`);return i}_updateStyle(_,i){if(i.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(_,i));const h=this.style&&i.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!_)),_?(this.style=new sc(this,i||{}),this.style.setEventedParent(this,{style:this.style}),typeof _=="string"?this.style.loadURL(_,i,h):this.style.loadJSON(_,i,h),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new sc(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(_,i){if(typeof _=="string"){const h=this._requestManager.transformRequest(_,"Style");c.h(h,new AbortController).then(f=>{this._updateDiff(f.data,i)}).catch(f=>{f&&this.fire(new c.j(f))})}else typeof _=="object"&&this._updateDiff(_,i)}_updateDiff(_,i){try{this.style.setState(_,i)&&this._update(!0)}catch(h){c.w(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(_,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(_,i){return this._lazyInitEmptyStyle(),this.style.addSource(_,i),this._update(!0)}isSourceLoaded(_){const i=this.style&&this.style.sourceCaches[_];if(i!==void 0)return i.loaded();this.fire(new c.j(new Error(`There is no source with ID '${_}'`)))}setTerrain(_){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),_){const i=this.style.sourceCaches[_.source];if(!i)throw new Error(`cannot load terrain, because there exists no source with ID: ${_.source}`);this.terrain===null&&i.reload();for(const h in this.style._layers){const f=this.style._layers[h];f.type==="hillshade"&&f.source===_.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Ih(this.painter,i,_),this.painter.renderToTexture=new Lp(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=h=>{h.dataType==="style"?this.terrain.sourceCache.freeRtt():h.dataType==="source"&&h.tile&&(h.sourceId!==_.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(h.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new c.k("terrain",{terrain:_})),this}getTerrain(){var _,i;return(i=(_=this.terrain)===null||_===void 0?void 0:_.options)!==null&&i!==void 0?i:null}areTilesLoaded(){const _=this.style&&this.style.sourceCaches;for(const i in _){const h=_[i]._tiles;for(const f in h){const m=h[f];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}removeSource(_){return this.style.removeSource(_),this._update(!0)}getSource(_){return this.style.getSource(_)}addImage(_,i,h={}){const{pixelRatio:f=1,sdf:m=!1,stretchX:y,stretchY:S,content:C,textFitWidth:M,textFitHeight:D}=h;if(this._lazyInitEmptyStyle(),!(i instanceof HTMLImageElement||c.b(i))){if(i.width===void 0||i.height===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:O,height:L,data:U}=i,Z=i;return this.style.addImage(_,{data:new c.R({width:O,height:L},new Uint8Array(U)),pixelRatio:f,stretchX:y,stretchY:S,content:C,textFitWidth:M,textFitHeight:D,sdf:m,version:0,userImage:Z}),Z.onAdd&&Z.onAdd(this,_),this}}{const{width:O,height:L,data:U}=P.getImageData(i);this.style.addImage(_,{data:new c.R({width:O,height:L},U),pixelRatio:f,stretchX:y,stretchY:S,content:C,textFitWidth:M,textFitHeight:D,sdf:m,version:0})}}updateImage(_,i){const h=this.style.getImage(_);if(!h)return this.fire(new c.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const f=i instanceof HTMLImageElement||c.b(i)?P.getImageData(i):i,{width:m,height:y,data:S}=f;if(m===void 0||y===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==h.data.width||y!==h.data.height)return this.fire(new c.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const C=!(i instanceof HTMLImageElement||c.b(i));return h.data.replace(S,C),this.style.updateImage(_,h),this}getImage(_){return this.style.getImage(_)}hasImage(_){return _?!!this.style.getImage(_):(this.fire(new c.j(new Error("Missing required image id"))),!1)}removeImage(_){this.style.removeImage(_)}loadImage(_){return le.getImage(this._requestManager.transformRequest(_,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(_,i){return this._lazyInitEmptyStyle(),this.style.addLayer(_,i),this._update(!0)}moveLayer(_,i){return this.style.moveLayer(_,i),this._update(!0)}removeLayer(_){return this.style.removeLayer(_),this._update(!0)}getLayer(_){return this.style.getLayer(_)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(_,i,h){return this.style.setLayerZoomRange(_,i,h),this._update(!0)}setFilter(_,i,h={}){return this.style.setFilter(_,i,h),this._update(!0)}getFilter(_){return this.style.getFilter(_)}setPaintProperty(_,i,h,f={}){return this.style.setPaintProperty(_,i,h,f),this._update(!0)}getPaintProperty(_,i){return this.style.getPaintProperty(_,i)}setLayoutProperty(_,i,h,f={}){return this.style.setLayoutProperty(_,i,h,f),this._update(!0)}getLayoutProperty(_,i){return this.style.getLayoutProperty(_,i)}setGlyphs(_,i={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(_,i),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(_,i,h={}){return this._lazyInitEmptyStyle(),this.style.addSprite(_,i,h,f=>{f||this._update(!0)}),this}removeSprite(_){return this._lazyInitEmptyStyle(),this.style.removeSprite(_),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(_,i={}){return this._lazyInitEmptyStyle(),this.style.setSprite(_,i,h=>{h||this._update(!0)}),this}setLight(_,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(_,i),this._update(!0)}getLight(){return this.style.getLight()}setSky(_){return this._lazyInitEmptyStyle(),this.style.setSky(_),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(_,i){return this.style.setFeatureState(_,i),this._update()}removeFeatureState(_,i){return this.style.removeFeatureState(_,i),this._update()}getFeatureState(_){return this.style.getFeatureState(_)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let _=0,i=0;return this._container&&(_=this._container.clientWidth||400,i=this._container.clientHeight||300),[_,i]}_setupContainer(){const _=this._container;_.classList.add("maplibregl-map");const i=this._canvasContainer=A.create("div","maplibregl-canvas-container",_);this._interactive&&i.classList.add("maplibregl-interactive"),this._canvas=A.create("canvas","maplibregl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const h=this._containerDimensions(),f=this._getClampedPixelRatio(h[0],h[1]);this._resizeCanvas(h[0],h[1],f);const m=this._controlContainer=A.create("div","maplibregl-control-container",_),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(S=>{y[S]=A.create("div",`maplibregl-ctrl-${S} `,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(_,i,h){this._canvas.width=Math.floor(h*_),this._canvas.height=Math.floor(h*i),this._canvas.style.width=`${_}px`,this._canvas.style.height=`${i}px`}_setupPainter(){const _={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let i=null;this._canvas.addEventListener("webglcontextcreationerror",f=>{i={requestedAttributes:_},f&&(i.statusMessage=f.statusMessage,i.type=f.type)},{once:!0});const h=this._canvas.getContext("webgl2",_)||this._canvas.getContext("webgl",_);if(!h){const f="Failed to initialize WebGL";throw i?(i.message=f,new Error(JSON.stringify(i))):new Error(f)}this.painter=new wc(h,this.transform),$.testSupport(h)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(_){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||_,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(_){return this._update(),this._renderTaskQueue.add(_)}_cancelRenderFrame(_){this._renderTaskQueue.remove(_)}_render(_){const i=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(_),this._removed)return;let h=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const m=this.transform.zoom,y=P.now();this.style.zoomHistory.update(m,y);const S=new c.z(m,{now:y,fadeDuration:i,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),C=S.crossFadingFactor();C===1&&C===this._crossFadingFactor||(h=!0,this._crossFadingFactor=C),this.style.update(S)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,i,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:i,showPadding:this.showPadding}),this.fire(new c.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.bf.mark(c.bg.load),this.fire(new c.k("load"))),this.style&&(this.style.hasTransitions()||h)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const f=this._sourcesDirty||this._styleDirty||this._placementDirty;return f||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.k("idle")),!this._loaded||this._fullyLoaded||f||(this._fullyLoaded=!0,c.bf.mark(c.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var _;this._hash&&this._hash.remove();for(const h of this._controls)h.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),le.removeThrottleControl(this._imageQueueHandle),(_=this._resizeObserver)===null||_===void 0||_.disconnect();const i=this.painter.context.gl.getExtension("WEBGL_lose_context");i!=null&&i.loseContext&&i.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),A.remove(this._canvasContainer),A.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),c.bf.clearMetrics(),this._removed=!0,this.fire(new c.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,P.frameAsync(this._frameRequest).then(_=>{c.bf.frame(_),this._frameRequest=null,this._render(_)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(_){this._showTileBoundaries!==_&&(this._showTileBoundaries=_,this._update())}get showPadding(){return!!this._showPadding}set showPadding(_){this._showPadding!==_&&(this._showPadding=_,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(_){this._showCollisionBoxes!==_&&(this._showCollisionBoxes=_,_?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(_){this._showOverdrawInspector!==_&&(this._showOverdrawInspector=_,this._update())}get repaint(){return!!this._repaint}set repaint(_){this._repaint!==_&&(this._repaint=_,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(_){this._vertices=_,this._update()}get version(){return Bp}getCameraTargetElevation(){return this.transform.elevation}},d.MapMouseEvent=Hn,d.MapTouchEvent=uo,d.MapWheelEvent=Pp,d.Marker=zc,d.NavigationControl=class{constructor(_){this._updateZoomButtons=()=>{const i=this._map.getZoom(),h=i===this._map.getMaxZoom(),f=i===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())},this._rotateCompassArrow=()=>{const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=i},this._setButtonTitle=(i,h)=>{const f=this._map._getUIString(`NavigationControl.${h}`);i.title=f,i.setAttribute("aria-label",f)},this.options=c.e({},Bg,_),this._container=A.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",i=>this._map.zoomIn({},{originalEvent:i})),A.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",i=>this._map.zoomOut({},{originalEvent:i})),A.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",i=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:i}):this._map.resetNorth({},{originalEvent:i})}),this._compassIcon=A.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(_){return this._map=_,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Fg(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){A.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(_,i){const h=A.create("button",_,this._container);return h.type="button",h.addEventListener("click",i),h}},d.Popup=class extends c.E{constructor(_){super(),this.remove=()=>(this._content&&A.remove(this._content),this._container&&(A.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new c.k("close"))),this),this._onMouseUp=i=>{this._update(i.point)},this._onMouseMove=i=>{this._update(i.point)},this._onDrag=i=>{this._update(i.point)},this._update=i=>{var h;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=A.create("div","maplibregl-popup",this._map.getContainer()),this._tip=A.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const C of this.options.className.split(" "))this._container.classList.add(C);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Yt(this._lngLat,this._flatPos,this._map.transform):(h=this._lngLat)===null||h===void 0?void 0:h.wrap(),this._trackPointer&&!i)return;const f=this._flatPos=this._pos=this._trackPointer&&i?i:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&i?i:this._map.transform.locationPoint(this._lngLat));let m=this.options.anchor;const y=Rc(this.options.offset);if(!m){const C=this._container.offsetWidth,M=this._container.offsetHeight;let D;D=f.y+y.bottom.y<M?["top"]:f.y>this._map.transform.height-M?["bottom"]:[],f.x<C/2?D.push("left"):f.x>this._map.transform.width-C/2&&D.push("right"),m=D.length===0?"bottom":D.join("-")}let S=f.add(y[m]);this.options.subpixelPositioning||(S=S.round()),A.setTransform(this._container,`${ta[m]} translate(${S.x}px,${S.y}px)`),Ac(this._container,m,"popup")},this._onClose=()=>{this.remove()},this.options=c.e(Object.create(ct),_)}addTo(_){return this._map&&this.remove(),this._map=_,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new c.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(_){return this._lngLat=c.N.convert(_),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(_){return this.setDOMContent(document.createTextNode(_))}setHTML(_){const i=document.createDocumentFragment(),h=document.createElement("body");let f;for(h.innerHTML=_;f=h.firstChild,f;)i.appendChild(f);return this.setDOMContent(i)}getMaxWidth(){var _;return(_=this._container)===null||_===void 0?void 0:_.style.maxWidth}setMaxWidth(_){return this.options.maxWidth=_,this._update(),this}setDOMContent(_){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=A.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(_),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(_){return this._container&&this._container.classList.add(_),this}removeClassName(_){return this._container&&this._container.classList.remove(_),this}setOffset(_){return this.options.offset=_,this._update(),this}toggleClassName(_){if(this._container)return this._container.classList.toggle(_)}setSubpixelPositioning(_){this.options.subpixelPositioning=_}_createCloseButton(){this.options.closeButton&&(this._closeButton=A.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const _=this._container.querySelector(Dc);_&&_.focus()}},d.RasterDEMTileSource=an,d.RasterTileSource=Ft,d.ScaleControl=class{constructor(_){this._onMove=()=>{vl(this._map,this._container,this.options)},this.setUnit=i=>{this.options.unit=i,vl(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Xr),_)}getDefaultPosition(){return"bottom-left"}onAdd(_){return this._map=_,this._container=A.create("div","maplibregl-ctrl maplibregl-ctrl-scale",_.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){A.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},d.ScrollZoomHandler=Mr,d.Style=sc,d.TerrainControl=class{constructor(_){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=_}onAdd(_){return this._map=_,this._container=A.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=A.create("button","maplibregl-ctrl-terrain",this._container),A.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){A.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},d.TwoFingersTouchPitchHandler=Xo,d.TwoFingersTouchRotateHandler=Sh,d.TwoFingersTouchZoomHandler=wh,d.TwoFingersTouchZoomRotateHandler=Th,d.VectorTileSource=Ya,d.VideoSource=Do,d.addSourceType=(_,i)=>c._(void 0,void 0,void 0,function*(){if(tl(_))throw new Error(`A source type called "${_}" already exists.`);((h,f)=>{el[h]=f})(_,i)}),d.clearPrewarmedResources=function(){const _=An;_&&(_.isPreloaded()&&_.numActive()===1?(_.release(qn),An=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},d.getMaxParallelImageRequests=function(){return c.a.MAX_PARALLEL_IMAGE_REQUESTS},d.getRTLTextPluginStatus=function(){return Hr().getRTLTextPluginStatus()},d.getVersion=function(){return zh},d.getWorkerCount=function(){return _i.workerCount},d.getWorkerUrl=function(){return c.a.WORKER_URL},d.importScriptInWorkers=function(_){return Ja().broadcast("IS",_)},d.prewarm=function(){Ys().acquire(qn)},d.setMaxParallelImageRequests=function(_){c.a.MAX_PARALLEL_IMAGE_REQUESTS=_},d.setRTLTextPlugin=function(_,i){return Hr().setRTLTextPlugin(_,i)},d.setWorkerCount=function(_){_i.workerCount=_},d.setWorkerUrl=function(_){c.a.WORKER_URL=_}});var u=n;return u})})(pC);var mC=pC.exports;const cS=Bm(mC);function wB(e,t){e.getLayer(t.layerId)&&e.removeLayer(t.layerId),e.getSource(t.sourceId)&&e.removeSource(t.sourceId)}function bB({itinerary_chunks:e}){const t=gn.useRef(null),n=gn.useRef(null),s=gn.useRef([]),a=gn.useRef([]),u=["#FF0000","#00FF00","#0000FF"],d=c=>u[c%u.length];return gn.useEffect(()=>{n.current||(n.current=new cS.Map({container:t.current,center:[-.127,51.507],zoom:7,style:"https://tiles.stadiamaps.com/styles/alidade_smooth.json"}))},[]),gn.useEffect(()=>{if(s.current.forEach(c=>{c.remove()}),s.current=[],a.current.forEach(c=>{wB(n.current,c)}),a.current=[],e.forEach((c,w)=>{c.pins.map(k=>{const E=new cS.Marker({color:d(w)}).setLngLat([k.location.lon,k.location.lat]).setPopup(new mC.Popup().setText(`I Chunk ${w}`)).addTo(n.current);s.current.push(E)}),c.routes.map((k,E)=>{const P=`${w}-${E}`,A={type:"geojson",data:k.route},$={id:P,type:"line",source:P,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":d(w),"line-width":6}},j={sourceId:P,layerId:P,source:A,layer:$};n.current.addSource(P,A),n.current.addLayer($),a.current.push(j)})}),s.current.length>0){const c=s.current.reduce((k,E)=>k+E.getLngLat().lat,0)/s.current.length,w=s.current.reduce((k,E)=>k+E.getLngLat().lng,0)/s.current.length;console.log(c,w),n.current.flyTo({center:[w,c],speed:.6})}},[e]),hr.jsx("div",{className:"map-wrap",children:hr.jsx("div",{ref:t,className:"map"})})}const SB="https://api.stadiamaps.com".replace(/\/+$/,"");class kB{constructor(t={}){this.configuration=t}set config(t){this.configuration=t}get basePath(){return this.configuration.basePath!=null?this.configuration.basePath:SB}get fetchApi(){return this.configuration.fetchApi}get middleware(){return this.configuration.middleware||[]}get queryParamsStringify(){return this.configuration.queryParamsStringify||_C}get username(){return this.configuration.username}get password(){return this.configuration.password}get apiKey(){const t=this.configuration.apiKey;if(t)return typeof t=="function"?t:()=>t}get accessToken(){const t=this.configuration.accessToken;if(t)return typeof t=="function"?t:async()=>t}get headers(){return this.configuration.headers}get credentials(){return this.configuration.credentials}}const TB=new kB,gC=class yC{constructor(t=TB){this.configuration=t,this.fetchApi=async(n,s)=>{let a={url:n,init:s};for(const d of this.middleware)d.pre&&(a=await d.pre({fetch:this.fetchApi,...a})||a);let u;try{u=await(this.configuration.fetchApi||fetch)(a.url,a.init)}catch(d){for(const c of this.middleware)c.onError&&(u=await c.onError({fetch:this.fetchApi,url:a.url,init:a.init,error:d,response:u?u.clone():void 0})||u);if(u===void 0)throw d instanceof Error?new PB(d,"The request failed and the interceptors did not return an alternative response"):d}for(const d of this.middleware)d.post&&(u=await d.post({fetch:this.fetchApi,url:a.url,init:a.init,response:u.clone()})||u);return u},this.middleware=t.middleware}withMiddleware(...t){const n=this.clone();return n.middleware=n.middleware.concat(...t),n}withPreMiddleware(...t){const n=t.map(s=>({pre:s}));return this.withMiddleware(...n)}withPostMiddleware(...t){const n=t.map(s=>({post:s}));return this.withMiddleware(...n)}isJsonMime(t){return t?yC.jsonRegex.test(t):!1}async request(t,n){const{url:s,init:a}=await this.createFetchParams(t,n),u=await this.fetchApi(s,a);if(u&&u.status>=200&&u.status<300)return u;throw new IB(u,"Response returned an error code")}async createFetchParams(t,n){let s=this.configuration.basePath+t.path;t.query!==void 0&&Object.keys(t.query).length!==0&&(s+="?"+this.configuration.queryParamsStringify(t.query));const a=Object.assign({},this.configuration.headers,t.headers);Object.keys(a).forEach(E=>a[E]===void 0?delete a[E]:{});const u=typeof n=="function"?n:async()=>n,d={method:t.method,headers:a,body:t.body,credentials:this.configuration.credentials},c={...d,...await u({init:d,context:t})};let w;EB(c.body)||c.body instanceof URLSearchParams||MB(c.body)?w=c.body:this.isJsonMime(a["Content-Type"])?w=JSON.stringify(c.body):w=c.body;const k={...c,body:w};return{url:s,init:k}}clone(){const t=this.constructor,n=new t(this.configuration);return n.middleware=this.middleware.slice(),n}};gC.jsonRegex=new RegExp("^(:?application/json|[^;/ 	]+/[^;/ 	]+[+]json)[ 	]*(:?;.*)?$","i");let CB=gC;function MB(e){return typeof Blob<"u"&&e instanceof Blob}function EB(e){return typeof FormData<"u"&&e instanceof FormData}class IB extends Error{constructor(t,n){super(n),this.response=t,this.name="ResponseError"}}class PB extends Error{constructor(t,n){super(n),this.cause=t,this.name="FetchError"}}function _C(e,t=""){return Object.keys(e).map(n=>vC(n,e[n],t)).filter(n=>n.length>0).join("&")}function vC(e,t,n=""){const s=n+(n.length?`[${e}]`:e);if(t instanceof Array){const a=t.map(u=>encodeURIComponent(String(u))).join(`&${encodeURIComponent(s)}=`);return`${encodeURIComponent(s)}=${a}`}if(t instanceof Set){const a=Array.from(t);return vC(e,a,n)}return t instanceof Date?`${encodeURIComponent(s)}=${encodeURIComponent(t.toISOString())}`:t instanceof Object?_C(t,s):`${encodeURIComponent(s)}=${encodeURIComponent(String(t))}`}class El{constructor(t,n=s=>s){this.raw=t,this.transformer=n}async value(){return this.transformer(await this.raw.json())}}function AB(e){return zB(e)}function zB(e,t){return e==null?e:{golfCart:e.golf_cart==null?void 0:e.golf_cart,wheelchair:e.wheelchair==null?void 0:e.wheelchair,taxi:e.taxi==null?void 0:e.taxi,hOV:e.HOV==null?void 0:e.HOV,truck:e.truck==null?void 0:e.truck,emergency:e.emergency==null?void 0:e.emergency,pedestrian:e.pedestrian==null?void 0:e.pedestrian,car:e.car==null?void 0:e.car,bus:e.bus==null?void 0:e.bus,bicycle:e.bicycle==null?void 0:e.bicycle,motorcycle:e.motorcycle==null?void 0:e.motorcycle,moped:e.moped==null?void 0:e.moped}}function xC(e){return DB(e)}function DB(e,t){return e==null?e:{countryCode:e.country_code==null?void 0:e.country_code,countryText:e.country_text==null?void 0:e.country_text,stateCode:e.state_code==null?void 0:e.state_code,stateText:e.state_text==null?void 0:e.state_text}}function RB(e){return OB(e)}function OB(e,t){return e==null?e:{iso31661:e["iso_3166-1"]==null?void 0:e["iso_3166-1"],country:e.country==null?void 0:e.country,iso31662:e["iso_3166-2"]==null?void 0:e["iso_3166-2"],state:e.state==null?void 0:e.state}}function Yv(e){return e==null?e:{action:e.action,attributes:e.attributes}}function b_(e){return e==null?e:{maneuver_penalty:e.maneuverPenalty,gate_cost:e.gateCost,gate_penalty:e.gatePenalty,country_crossing_cost:e.countryCrossingCost,country_crossing_penalty:e.countryCrossingPenalty,service_penalty:e.servicePenalty,service_factor:e.serviceFactor,use_living_streets:e.useLivingStreets,use_ferry:e.useFerry,ignore_restrictions:e.ignoreRestrictions,ignore_non_vehicular_restrictions:e.ignoreNonVehicularRestrictions,ignore_oneways:e.ignoreOneways,height:e.height,width:e.width,toll_booth_cost:e.tollBoothCost,toll_booth_penalty:e.tollBoothPenalty,ferry_cost:e.ferryCost,use_highways:e.useHighways,use_tolls:e.useTolls,use_tracks:e.useTracks,top_speed:e.topSpeed,shortest:e.shortest,ignore_closures:e.ignoreClosures,include_hov2:e.includeHov2,include_hov3:e.includeHov3,include_hot:e.includeHot,alley_factor:e.alleyFactor}}function LB(e){return e==null?e:{maneuver_penalty:e.maneuverPenalty,gate_cost:e.gateCost,gate_penalty:e.gatePenalty,country_crossing_cost:e.countryCrossingCost,country_crossing_penalty:e.countryCrossingPenalty,service_penalty:e.servicePenalty,service_factor:e.serviceFactor,use_living_streets:e.useLivingStreets,use_ferry:e.useFerry,ignore_restrictions:e.ignoreRestrictions,ignore_non_vehicular_restrictions:e.ignoreNonVehicularRestrictions,ignore_oneways:e.ignoreOneways,height:e.height,width:e.width,toll_booth_cost:e.tollBoothCost,toll_booth_penalty:e.tollBoothPenalty,ferry_cost:e.ferryCost,use_highways:e.useHighways,use_tolls:e.useTolls,use_tracks:e.useTracks,top_speed:e.topSpeed,shortest:e.shortest,ignore_closures:e.ignoreClosures,include_hov2:e.includeHov2,include_hov3:e.includeHov3,include_hot:e.includeHot,alley_factor:e.alleyFactor,use_primary:e.usePrimary,use_hills:e.useHills}}function BB(e){return e==null?e:{walking_speed:e.walkingSpeed,walkway_factor:e.walkwayFactor,sidewalk_factor:e.sidewalkFactor,alley_factor:e.alleyFactor,driveway_factor:e.drivewayFactor,step_penalty:e.stepPenalty,use_ferry:e.useFerry,use_living_streets:e.useLivingStreets,use_tracks:e.useTracks,use_hills:e.useHills,use_lit:e.useLit,service_penalty:e.servicePenalty,service_factor:e.serviceFactor,max_hiking_difficulty:e.maxHikingDifficulty,bss_rent_cost:e.bssRentCost,bss_rent_penalty:e.bssRentPenalty}}function FB(e){return e==null?e:{maneuver_penalty:e.maneuverPenalty,gate_cost:e.gateCost,gate_penalty:e.gatePenalty,country_crossing_cost:e.countryCrossingCost,country_crossing_penalty:e.countryCrossingPenalty,service_penalty:e.servicePenalty,service_factor:e.serviceFactor,use_living_streets:e.useLivingStreets,use_ferry:e.useFerry,ignore_restrictions:e.ignoreRestrictions,ignore_non_vehicular_restrictions:e.ignoreNonVehicularRestrictions,ignore_oneways:e.ignoreOneways,height:e.height,width:e.width,toll_booth_cost:e.tollBoothCost,toll_booth_penalty:e.tollBoothPenalty,ferry_cost:e.ferryCost,use_highways:e.useHighways,use_tolls:e.useTolls,use_tracks:e.useTracks,top_speed:e.topSpeed,shortest:e.shortest,ignore_closures:e.ignoreClosures,include_hov2:e.includeHov2,include_hov3:e.includeHov3,include_hot:e.includeHot,alley_factor:e.alleyFactor,length:e.length,weight:e.weight,axle_load:e.axleLoad,hazmat:e.hazmat}}function NB(e){return e==null?e:{maneuver_penalty:e.maneuverPenalty,gate_cost:e.gateCost,gate_penalty:e.gatePenalty,country_crossing_cost:e.countryCrossingCost,country_crossing_penalty:e.countryCrossingPenalty,service_penalty:e.servicePenalty,service_factor:e.serviceFactor,use_living_streets:e.useLivingStreets,use_ferry:e.useFerry,ignore_restrictions:e.ignoreRestrictions,ignore_non_vehicular_restrictions:e.ignoreNonVehicularRestrictions,ignore_oneways:e.ignoreOneways,bicycle_type:e.bicycleType,cycling_speed:e.cyclingSpeed,use_roads:e.useRoads,use_hills:e.useHills,avoid_bad_surfaces:e.avoidBadSurfaces,bss_return_cost:e.bssReturnCost,bss_return_penalty:e.bssReturnPenalty}}function VB(e){return e==null?e:{maneuver_penalty:e.maneuverPenalty,gate_cost:e.gateCost,gate_penalty:e.gatePenalty,country_crossing_cost:e.countryCrossingCost,country_crossing_penalty:e.countryCrossingPenalty,service_penalty:e.servicePenalty,service_factor:e.serviceFactor,use_living_streets:e.useLivingStreets,use_ferry:e.useFerry,ignore_restrictions:e.ignoreRestrictions,ignore_non_vehicular_restrictions:e.ignoreNonVehicularRestrictions,ignore_oneways:e.ignoreOneways,vehicle_type:e.vehicleType,top_speed:e.topSpeed,max_allowed_speed_limit:e.maxAllowedSpeedLimit}}function $B(e){return e==null?e:{maneuver_penalty:e.maneuverPenalty,gate_cost:e.gateCost,gate_penalty:e.gatePenalty,country_crossing_cost:e.countryCrossingCost,country_crossing_penalty:e.countryCrossingPenalty,service_penalty:e.servicePenalty,service_factor:e.serviceFactor,use_living_streets:e.useLivingStreets,use_ferry:e.useFerry,ignore_restrictions:e.ignoreRestrictions,ignore_non_vehicular_restrictions:e.ignoreNonVehicularRestrictions,ignore_oneways:e.ignoreOneways,height:e.height,width:e.width,toll_booth_cost:e.tollBoothCost,toll_booth_penalty:e.tollBoothPenalty,ferry_cost:e.ferryCost,use_highways:e.useHighways,use_tolls:e.useTolls,use_tracks:e.useTracks,top_speed:e.topSpeed,shortest:e.shortest,ignore_closures:e.ignoreClosures,include_hov2:e.includeHov2,include_hov3:e.includeHov3,include_hot:e.includeHot,alley_factor:e.alleyFactor,use_trails:e.useTrails}}function ic(e){return e==null?e:{auto:b_(e.auto),bus:b_(e.bus),taxi:b_(e.taxi),truck:FB(e.truck),bicycle:NB(e.bicycle),motor_scooter:LB(e.motorScooter),motorcycle:$B(e.motorcycle),pedestrian:BB(e.pedestrian),low_speed_vehicle:VB(e.lowSpeedVehicle)}}function jB(e){return UB(e)}function UB(e,t){return e}function wC(e){return e==null?e:{lat:e.lat,lon:e.lon,type:e.type,time:e.time}}function qB(e){return HB(e)}function HB(e,t){return e==null?e:{mountain:e.mountain==null?void 0:e.mountain,local:e.local==null?void 0:e.local,regional:e.regional==null?void 0:e.regional,national:e.national==null?void 0:e.national}}function ZB(e){return e==null?e:{time:e.time,distance:e.distance,color:e.color}}function uS(e){return WB(e)}function WB(e,t){return e==null?e:{lat:e.lat,lon:e.lon}}function Qv(e){return e==null?e:{lat:e.lat,lon:e.lon}}const GB={Auto:"auto",Bus:"bus",Taxi:"taxi",Truck:"truck",Bicycle:"bicycle",Bikeshare:"bikeshare",MotorScooter:"motor_scooter",Motorcycle:"motorcycle",Pedestrian:"pedestrian",LowSpeedVehicle:"low_speed_vehicle"};function KB(e){return XB(e)}function XB(e,t){return e==null?e:{exitNumber:e.exit_number==null?void 0:e.exit_number,exitBranch:e.exit_branch==null?void 0:e.exit_branch,exitToward:e.exit_toward==null?void 0:e.exit_toward,exitName:e.exit_name==null?void 0:e.exit_name}}function bC(e){return JB(e)}function JB(e,t){return e}function Xf(e){return YB(e)}function YB(e,t){return e}function SC(e){return QB(e)}function QB(e,t){return e}function eF(e){return tF(e)}function tF(e,t){return e==null?e:{beginHeading:e.begin_heading==null?void 0:e.begin_heading,fromEdgeNameConsistency:e.from_edge_name_consistency==null?void 0:e.from_edge_name_consistency,toEdgeNameConsistency:e.to_edge_name_consistency==null?void 0:e.to_edge_name_consistency,driveability:e.driveability==null?void 0:Xf(e.driveability),cyclability:e.cyclability==null?void 0:Xf(e.cyclability),walkability:e.walkability==null?void 0:Xf(e.walkability),use:e.use==null?void 0:bC(e.use),roadClass:e.road_class==null?void 0:SC(e.road_class)}}function kC(e){return nF(e)}function nF(e,t){return e}function iF(e){return rF(e)}function rF(e,t){return e==null?e:{intersectingEdges:e.intersecting_edges==null?void 0:e.intersecting_edges.map(eF),elapsedTime:e.elapsed_time==null?void 0:e.elapsed_time,adminIndex:e.admin_index==null?void 0:e.admin_index,type:e.type==null?void 0:kC(e.type),fork:e.fork==null?void 0:e.fork,timeZone:e.time_zone==null?void 0:e.time_zone}}function sF(e){return oF(e)}function oF(e,t){return e==null?e:{curvature:e.curvature==null?void 0:e.curvature,maxDownSlope:e.max_down_slope==null?void 0:e.max_down_slope,maxUpSlope:e.max_up_slope==null?void 0:e.max_up_slope,weightedGrade:e.weighted_grade==null?void 0:e.weighted_grade,length:e.length==null?void 0:e.length}}function aF(e){return lF(e)}function lF(e,t){return e==null?e:{internal:e.internal==null?void 0:e.internal,link:e.link==null?void 0:e.link,surface:e.surface==null?void 0:e.surface,use:e.use==null?void 0:e.use,classification:e.classification==null?void 0:e.classification}}function cF(e){return uF(e)}function uF(e,t){return e==null?e:{fillColor:e.fillColor==null?void 0:e.fillColor,opacity:e.opacity==null?void 0:e.opacity,fill:e.fill==null?void 0:e.fill,fillOpacity:e.fillOpacity==null?void 0:e.fillOpacity,color:e.color==null?void 0:e.color,contour:e.contour==null?void 0:e.contour,metric:e.metric==null?void 0:e.metric}}function hF(e){return dF(e)}function dF(e,t){return e==null?e:{properties:e.properties==null?void 0:cF(e.properties),geometry:e.geometry==null?void 0:e.geometry,type:e.type==null?void 0:e.type}}function pF(e){return e==null?e:{id:e.id,locations:e.locations.map(Qv),costing:e.costing,costing_options:ic(e.costingOptions),contours:e.contours.map(ZB),polygons:e.polygons,denoise:e.denoise,generalize:e.generalize,show_locations:e.showLocations}}function fF(e){return mF(e)}function mF(e,t){return e==null?e:{id:e.id==null?void 0:e.id,features:e.features.map(hF),type:e.type}}function gF(e){return yF(e)}function yF(e,t){return e==null?e:{predicted:e.predicted==null?void 0:e.predicted,constrainedFlow:e.constrained_flow==null?void 0:e.constrained_flow,freeFlow:e.free_flow==null?void 0:e.free_flow,type:e.type==null?void 0:e.type,_default:e.default==null?void 0:e.default}}function ex(e){return _F(e)}function _F(e,t){return e==null?e:{id:e.id==null?void 0:e.id,value:e.value==null?void 0:e.value,tileId:e.tile_id==null?void 0:e.tile_id,level:e.level==null?void 0:e.level}}function S_(e){return vF(e)}function vF(e,t){return e==null?e:{golfCart:e.golf_cart==null?void 0:e.golf_cart,truck:e.truck==null?void 0:e.truck,pedestrian:e.pedestrian==null?void 0:e.pedestrian,wheelchair:e.wheelchair==null?void 0:e.wheelchair,taxi:e.taxi==null?void 0:e.taxi,hOV:e.HOV==null?void 0:e.HOV,emergency:e.emergency==null?void 0:e.emergency,motorcycle:e.motorcycle==null?void 0:e.motorcycle,car:e.car==null?void 0:e.car,moped:e.moped==null?void 0:e.moped,bus:e.bus==null?void 0:e.bus,bicycle:e.bicycle==null?void 0:e.bicycle}}function xF(e){return wF(e)}function wF(e,t){return e==null?e:{sidewalkLeft:e.sidewalk_left==null?void 0:e.sidewalk_left,sidewalkRight:e.sidewalk_right==null?void 0:e.sidewalk_right,laneCount:e.lane_count==null?void 0:e.lane_count,stopSign:e.stop_sign==null?void 0:e.stop_sign,sacScale:e.sac_scale==null?void 0:e.sac_scale,yieldSign:e.yield_sign==null?void 0:e.yield_sign,notThru:e.not_thru==null?void 0:e.not_thru,forward:e.forward==null?void 0:e.forward,endNode:e.end_node==null?void 0:ex(e.end_node),truckRoute:e.truck_route==null?void 0:e.truck_route,speeds:e.speeds==null?void 0:gF(e.speeds),bikeNetwork:e.bike_network==null?void 0:e.bike_network,roundAbout:e.round_about==null?void 0:e.round_about,trafficSignal:e.traffic_signal==null?void 0:e.traffic_signal,accessRestriction:e.access_restriction==null?void 0:e.access_restriction,destinationOnly:e.destination_only==null?void 0:e.destination_only,geoAttributes:e.geo_attributes==null?void 0:sF(e.geo_attributes),startRestriction:e.start_restriction==null?void 0:S_(e.start_restriction),cycleLane:e.cycle_lane==null?void 0:e.cycle_lane,endRestriction:e.end_restriction==null?void 0:S_(e.end_restriction),seasonal:e.seasonal==null?void 0:e.seasonal,countryCrossing:e.country_crossing==null?void 0:e.country_crossing,partOfComplexRestriction:e.part_of_complex_restriction==null?void 0:e.part_of_complex_restriction,hasSign:e.has_sign==null?void 0:e.has_sign,access:e.access==null?void 0:S_(e.access),bridge:e.bridge==null?void 0:e.bridge,classification:e.classification==null?void 0:aF(e.classification),toll:e.toll==null?void 0:e.toll,tunnel:e.tunnel==null?void 0:e.tunnel}}function bF(e){return SF(e)}function SF(e,t){return e==null?e:{meanElevation:e.mean_elevation==null?void 0:e.mean_elevation,shape:e.shape,names:e.names==null?void 0:e.names,bikeNetwork:e.bike_network==null?void 0:qB(e.bike_network),wayId:e.way_id}}function kF(e){return TF(e)}function TF(e,t){return e==null?e:{edgeId:e.edge_id==null?void 0:ex(e.edge_id),wayId:e.way_id==null?void 0:e.way_id,correlatedLat:e.correlated_lat,correlatedLon:e.correlated_lon,percentAlong:e.percent_along,sideOfStreet:e.side_of_street,linearReference:e.linear_reference==null?void 0:e.linear_reference,outboundReach:e.outbound_reach==null?void 0:e.outbound_reach,heading:e.heading==null?void 0:e.heading,inboundReach:e.inbound_reach==null?void 0:e.inbound_reach,distance:e.distance==null?void 0:e.distance,predictedSpeeds:e.predicted_speeds==null?void 0:e.predicted_speeds,edgeInfo:e.edge_info==null?void 0:bF(e.edge_info),edge:e.edge==null?void 0:xF(e.edge),warnings:e.warnings==null?void 0:e.warnings}}function CF(e){return MF(e)}function MF(e,t){return e==null?e:{lat:e.lat,lon:e.lon,trafficSignal:e.traffic_signal==null?void 0:e.traffic_signal,type:e.type==null?void 0:kC(e.type),nodeId:e.node_id==null?void 0:ex(e.node_id),access:e.access==null?void 0:AB(e.access),edgeCount:e.edge_count==null?void 0:e.edge_count,administrative:e.administrative==null?void 0:RB(e.administrative),intersectionType:e.intersection_type==null?void 0:e.intersection_type,density:e.density==null?void 0:e.density,localEdgeCount:e.local_edge_count==null?void 0:e.local_edge_count,modeChange:e.mode_change==null?void 0:e.mode_change}}function EF(e){return IF(e)}function IF(e,t){return e==null?e:{id:e.id==null?void 0:e.id,inputLat:e.input_lat==null?void 0:e.input_lat,inputLon:e.input_lon==null?void 0:e.input_lon,nodes:e.nodes==null?void 0:e.nodes.map(CF),edges:e.edges==null?void 0:e.edges.map(kF)}}function Df(e){return PF(e)}function PF(e,t){return e==null?e:{text:e.text,isRouteNumber:e.is_route_number==null?void 0:e.is_route_number,consecutiveCount:e.consecutive_count==null?void 0:e.consecutive_count}}function AF(e){return zF(e)}function zF(e,t){return e==null?e:{exitNumberElements:e.exit_number_elements==null?void 0:e.exit_number_elements.map(Df),exitBranchElements:e.exit_branch_elements==null?void 0:e.exit_branch_elements.map(Df),exitTowardElements:e.exit_toward_elements==null?void 0:e.exit_toward_elements.map(Df),exitNameElements:e.exit_name_elements==null?void 0:e.exit_name_elements.map(Df)}}function DF(e){return e==null?e:{search_radius:e.searchRadius,gps_accuracy:e.gpsAccuracy,breakage_distance:e.breakageDistance,interpolation_distance:e.interpolationDistance,turn_penalty_factor:e.turnPenaltyFactor}}function RF(e){return e==null?e:{id:e.id,shape:e.shape==null?void 0:e.shape.map(wC),encoded_polyline:e.encodedPolyline,costing:e.costing,costing_options:ic(e.costingOptions),shape_match:e.shapeMatch,units:e.units,language:e.language,directions_type:e.directionsType,format:e.format,banner_instructions:e.bannerInstructions,voice_instructions:e.voiceInstructions,filters:Yv(e.filters),begin_time:e.beginTime,durations:e.durations,use_timestamps:e.useTimestamps,trace_options:DF(e.traceOptions),linear_references:e.linearReferences}}const hS={Break:"break",Through:"through",Via:"via",BreakThrough:"break_through"};function OF(e){return LF(e)}function LF(e,t){return e==null?e:{lat:e.lat,lon:e.lon,type:e.type==null?void 0:e.type,originalIndex:e.original_index==null?void 0:e.original_index}}function tx(e){return BF(e)}function BF(e,t){return e}function TC(e){return FF(e)}function FF(e,t){return e==null?e:{time:e.time,length:e.length,minLat:e.min_lat,maxLat:e.max_lat,minLon:e.min_lon,maxLon:e.max_lon}}function CC(e){return NF(e)}function NF(e,t){return e}function VF(e){return $F(e)}function $F(e,t){return e==null?e:{type:e.type,instruction:e.instruction,verbalTransitionAlertInstruction:e.verbal_transition_alert_instruction==null?void 0:e.verbal_transition_alert_instruction,verbalPreTransitionInstruction:e.verbal_pre_transition_instruction==null?void 0:e.verbal_pre_transition_instruction,verbalPostTransitionInstruction:e.verbal_post_transition_instruction==null?void 0:e.verbal_post_transition_instruction,streetNames:e.street_names==null?void 0:e.street_names,beginStreetNames:e.begin_street_names==null?void 0:e.begin_street_names,time:e.time,length:e.length,beginShapeIndex:e.begin_shape_index,endShapeIndex:e.end_shape_index,toll:e.toll==null?void 0:e.toll,rough:e.rough==null?void 0:e.rough,gate:e.gate==null?void 0:e.gate,ferry:e.ferry==null?void 0:e.ferry,sign:e.sign==null?void 0:AF(e.sign),roundaboutExitCount:e.roundabout_exit_count==null?void 0:e.roundabout_exit_count,departInstruction:e.depart_instruction==null?void 0:e.depart_instruction,verbalDepartInstruction:e.verbal_depart_instruction==null?void 0:e.verbal_depart_instruction,arriveInstruction:e.arrive_instruction==null?void 0:e.arrive_instruction,verbalArriveInstruction:e.verbal_arrive_instruction==null?void 0:e.verbal_arrive_instruction,transitInfo:e.transit_info==null?void 0:e.transit_info,verbalMultiCue:e.verbal_multi_cue==null?void 0:e.verbal_multi_cue,travelMode:CC(e.travel_mode),travelType:e.travel_type,bssManeuverType:e.bss_maneuver_type==null?void 0:e.bss_maneuver_type}}function jF(e){return UF(e)}function UF(e,t){return e==null?e:{maneuvers:e.maneuvers.map(VF),shape:e.shape,summary:TC(e.summary),elevationInterval:e.elevation_interval==null?void 0:e.elevation_interval,elevation:e.elevation==null?void 0:e.elevation}}function nx(e){return qF(e)}function qF(e,t){return e==null?e:{status:e.status,statusMessage:e.status_message,units:tx(e.units),language:jB(e.language),locations:e.locations.map(OF),legs:e.legs.map(jF),summary:TC(e.summary)}}function MC(e){return HF(e)}function HF(e,t){return e==null?e:{trip:e.trip==null?void 0:nx(e.trip)}}function ZF(e){return WF(e)}function WF(e,t){return e==null?e:{id:e.id==null?void 0:e.id,trip:nx(e.trip),alternates:e.alternates==null?void 0:e.alternates.map(MC),linearReferences:e.linear_references==null?void 0:e.linear_references}}function EC(e){return GF(e)}function GF(e,t){return e==null?e:{lat:e.lat,lon:e.lon,type:e.type,edgeIndex:e.edge_index==null?void 0:e.edge_index,beginRouteDiscontinuity:e.begin_route_discontinuity==null?void 0:e.begin_route_discontinuity,endRouteDiscontinuity:e.end_route_discontinuity==null?void 0:e.end_route_discontinuity,distanceAlongEdge:e.distance_along_edge==null?void 0:e.distance_along_edge,distanceFromTracePoint:e.distance_from_trace_point==null?void 0:e.distance_from_trace_point}}function dS(e){return e==null?e:{lat:e.lat,lon:e.lon,search_cutoff:e.searchCutoff}}function KF(e){return e==null?e:{units:e.units,language:e.language,directions_type:e.directionsType,id:e.id,sources:e.sources.map(dS),targets:e.targets.map(dS),costing:e.costing,costing_options:ic(e.costingOptions),matrix_locations:e.matrixLocations}}function XF(e){return JF(e)}function JF(e,t){return e==null?e:{text:e.text==null?void 0:e.text,code:e.code==null?void 0:e.code}}function YF(e){return QF(e)}function QF(e,t){return e==null?e:{id:e.id==null?void 0:e.id,sources:e.sources.map(uS),targets:e.targets.map(uS),sourcesToTargets:e.sources_to_targets,warnings:e.warnings==null?void 0:e.warnings.map(XF),units:tx(e.units)}}function eN(e){return e==null?e:{units:e.units,language:e.language,directions_type:e.directionsType,locations:e.locations.map(Qv),costing:e.costing,costing_options:ic(e.costingOptions),verbose:e.verbose}}function tN(e){return e==null?e:{units:e.units,language:e.language,directions_type:e.directionsType,format:e.format,banner_instructions:e.bannerInstructions,voice_instructions:e.voiceInstructions,filters:Yv(e.filters),id:e.id,locations:e.locations.map(Qv),costing:e.costing,costing_options:ic(e.costingOptions)}}function nN(e){return iN(e)}function iN(e,t){return e==null?e:{iso31661:e.iso_3166_1==null?void 0:e.iso_3166_1,iso31661Alpha3:e.iso_3166_1_alpha3==null?void 0:e.iso_3166_1_alpha3}}function rN(e){return sN(e)}function sN(e,t){return e==null?e:{speed:e.speed==null?void 0:e.speed,unit:e.unit==null?void 0:e.unit,unknown:e.unknown==null?void 0:e.unknown,none:e.none==null?void 0:e.none}}function oN(e){return aN(e)}function aN(e,t){return e==null?e:{distance:e.distance==null?void 0:e.distance,duration:e.duration==null?void 0:e.duration,weight:e.weight==null?void 0:e.weight,speed:e.speed==null?void 0:e.speed,maxspeed:e.maxspeed==null?void 0:e.maxspeed.map(rN)}}function lN(e){return cN(e)}function cN(e,t){return e==null?e:{text:e.text==null?void 0:e.text,type:e.type==null?void 0:e.type}}function IC(e){return uN(e)}function uN(e,t){return e}function pS(e){return hN(e)}function hN(e,t){return e==null?e:{text:e.text,type:e.type==null?void 0:e.type,modifier:e.modifier==null?void 0:IC(e.modifier),components:e.components==null?void 0:e.components.map(lN)}}function dN(e){return pN(e)}function pN(e,t){return e==null?e:{distanceAlongGeometry:e.distanceAlongGeometry,primary:pS(e.primary),secondary:e.secondary==null?void 0:pS(e.secondary)}}function fN(e){return mN(e)}function mN(e,t){return e==null?e:{indications:e.indications,valid:e.valid}}function gN(e){return yN(e)}function yN(e,t){return e==null?e:{location:e.location,bearings:e.bearings,classes:e.classes==null?void 0:e.classes,entry:e.entry,_in:e.in==null?void 0:e.in,out:e.out==null?void 0:e.out,lanes:e.lanes==null?void 0:e.lanes.map(fN),adminIndex:e.admin_index==null?void 0:e.admin_index,duration:e.duration==null?void 0:e.duration,turnDuration:e.turn_duration==null?void 0:e.turn_duration,turnWeight:e.turn_weight==null?void 0:e.turn_weight,geometryIndex:e.geometry_index==null?void 0:e.geometry_index,weight:e.weight==null?void 0:e.weight}}function _N(e){return vN(e)}function vN(e,t){return e==null?e:{distanceFromStart:e.distance_from_start,geometryIndex:e.geometry_index,waypointIndex:e.waypoint_index}}function xN(e){return wN(e)}function wN(e,t){return e==null?e:{location:e.location,instruction:e.instruction==null?void 0:e.instruction,bearingBefore:e.bearing_before,bearingAfter:e.bearing_after,type:e.type,modifier:e.modifier==null?void 0:IC(e.modifier),exit:e.exit==null?void 0:e.exit}}function bN(e){return SN(e)}function SN(e,t){return e==null?e:{distanceAlongGeometry:e.distanceAlongGeometry,announcement:e.announcement,ssmlAnnouncement:e.ssmlAnnouncement==null?void 0:e.ssmlAnnouncement}}function kN(e){return TN(e)}function TN(e,t){return e==null?e:{distance:e.distance,duration:e.duration,geometry:e.geometry,weight:e.weight==null?void 0:e.weight,name:e.name==null?void 0:e.name,ref:e.ref==null?void 0:e.ref,pronunciation:e.pronunciation==null?void 0:e.pronunciation,destinations:e.destinations==null?void 0:e.destinations,exits:e.exits==null?void 0:e.exits,mode:e.mode,maneuver:xN(e.maneuver),intersections:e.intersections==null?void 0:e.intersections.map(gN),rotaryName:e.rotary_name==null?void 0:e.rotary_name,rotaryPronunciation:e.rotary_pronunciation==null?void 0:e.rotary_pronunciation,drivingSide:e.driving_side==null?void 0:e.driving_side,voiceInstructions:e.voiceInstructions==null?void 0:e.voiceInstructions.map(bN),bannerInstructions:e.bannerInstructions==null?void 0:e.bannerInstructions.map(dN),speedLimitSign:e.speedLimitSign==null?void 0:e.speedLimitSign,speedLimitUnit:e.speedLimitUnit==null?void 0:e.speedLimitUnit}}function CN(e){return MN(e)}function MN(e,t){return e==null?e:{distance:e.distance,duration:e.duration,weight:e.weight==null?void 0:e.weight,summary:e.summary==null?void 0:e.summary,steps:e.steps.map(kN),annotation:e.annotation==null?void 0:oN(e.annotation),viaWaypoints:e.via_waypoints==null?void 0:e.via_waypoints.map(_N),admins:e.admins==null?void 0:e.admins.map(nN)}}function EN(e){return IN(e)}function IN(e,t){return e==null?e:{distance:e.distance,duration:e.duration,geometry:e.geometry,weight:e.weight==null?void 0:e.weight,weightName:e.weight_name==null?void 0:e.weight_name,legs:e.legs.map(CN)}}function PN(e){return AN(e)}function AN(e,t){return e==null?e:{name:e.name==null?void 0:e.name,location:e.location,distance:e.distance,hint:e.hint==null?void 0:e.hint}}function zN(e){return!(!("code"in e)||e.code===void 0)}function DN(e,t){return e==null?e:{code:e.code,message:e.message==null?void 0:e.message,dataVersion:e.data_version==null?void 0:e.data_version,waypoints:e.waypoints==null?void 0:e.waypoints.map(PN),routes:e.routes==null?void 0:e.routes.map(EN)}}function RN(e){return!(!("trip"in e)||e.trip===void 0)}function ON(e,t){return e==null?e:{id:e.id==null?void 0:e.id,trip:nx(e.trip),alternates:e.alternates==null?void 0:e.alternates.map(MC)}}function fS(e){return LN(e)}function LN(e,t){return e==null?e:zN(e)?DN(e):RN(e)?ON(e):{}}function BN(e){return e==null?e:{exclude_tunnel:e.excludeTunnel,exclude_bridge:e.excludeBridge,exclude_ramp:e.excludeRamp,exclude_closures:e.excludeClosures,min_road_class:e.minRoadClass,max_road_class:e.maxRoadClass}}function mS(e){return e==null?e:{lat:e.lat,lon:e.lon,type:e.type,heading:e.heading,heading_tolerance:e.headingTolerance,minimum_reachability:e.minimumReachability,radius:e.radius,rank_candidates:e.rankCandidates,preferred_side:e.preferredSide,node_snap_tolerance:e.nodeSnapTolerance,street_side_tolerance:e.streetSideTolerance,street_side_max_distance:e.streetSideMaxDistance,search_filter:BN(e.searchFilter)}}function FN(e){return e==null?e:{units:e.units,language:e.language,directions_type:e.directionsType,format:e.format,banner_instructions:e.bannerInstructions,voice_instructions:e.voiceInstructions,filters:Yv(e.filters),id:e.id,locations:e.locations.map(mS),costing:e.costing,costing_options:ic(e.costingOptions),exclude_locations:e.excludeLocations==null?void 0:e.excludeLocations.map(mS),exclude_polygons:e.excludePolygons,alternates:e.alternates,elevation_interval:e.elevationInterval,roundabout_exits:e.roundaboutExits}}function NN(e){return e}function VN(e){return e==null?e:{attributes:e.attributes.map(NN),action:e.action}}function PC(e){return $N(e)}function $N(e,t){return e==null?e:{names:e.names==null?void 0:e.names,length:e.length==null?void 0:e.length,speed:e.speed==null?void 0:e.speed,roadClass:e.road_class==null?void 0:SC(e.road_class),beginHeading:e.begin_heading==null?void 0:e.begin_heading,endHeading:e.end_heading==null?void 0:e.end_heading,beginShapeIndex:e.begin_shape_index==null?void 0:e.begin_shape_index,endShapeIndex:e.end_shape_index==null?void 0:e.end_shape_index,traversability:e.traversability==null?void 0:Xf(e.traversability),use:e.use==null?void 0:bC(e.use),toll:e.toll==null?void 0:e.toll,unpaved:e.unpaved==null?void 0:e.unpaved,tunnel:e.tunnel==null?void 0:e.tunnel,bridge:e.bridge==null?void 0:e.bridge,roundabout:e.roundabout==null?void 0:e.roundabout,internalIntersection:e.internal_intersection==null?void 0:e.internal_intersection,driveOnRight:e.drive_on_right==null?void 0:e.drive_on_right,surface:e.surface==null?void 0:e.surface,sign:e.sign==null?void 0:KB(e.sign),travelMode:e.travel_mode==null?void 0:CC(e.travel_mode),vehicleType:e.vehicle_type==null?void 0:e.vehicle_type,pedestrianType:e.pedestrian_type==null?void 0:e.pedestrian_type,bicycleType:e.bicycle_type==null?void 0:e.bicycle_type,transitType:e.transit_type==null?void 0:e.transit_type,id:e.id==null?void 0:e.id,wayId:e.way_id==null?void 0:e.way_id,weightedGrade:e.weighted_grade==null?void 0:e.weighted_grade,maxUpwardGrade:e.max_upward_grade==null?void 0:e.max_upward_grade,maxDownwardGrade:e.max_downward_grade==null?void 0:e.max_downward_grade,meanElevation:e.mean_elevation==null?void 0:e.mean_elevation,laneCount:e.lane_count==null?void 0:e.lane_count,cycleLane:e.cycle_lane==null?void 0:e.cycle_lane,bicycleNetwork:e.bicycle_network==null?void 0:e.bicycle_network,sacScale:e.sac_scale==null?void 0:e.sac_scale,sidewalk:e.sidewalk==null?void 0:e.sidewalk,density:e.density==null?void 0:e.density,speedLimit:e.speed_limit==null?void 0:e.speed_limit,truckSpeed:e.truck_speed==null?void 0:e.truck_speed,truckRoute:e.truck_route==null?void 0:e.truck_route,endNode:e.end_node==null?void 0:iF(e.end_node)}}function jN(e){return UN(e)}function UN(e,t){return e==null?e:{edges:e.edges==null?void 0:e.edges.map(PC),admins:e.admins==null?void 0:e.admins.map(xC),matchedPoints:e.matched_points==null?void 0:e.matched_points.map(EC),osmChangeset:e.osm_changeset==null?void 0:e.osm_changeset,shape:e.shape==null?void 0:e.shape,confidenceScore:e.confidence_score==null?void 0:e.confidence_score}}function qN(e){return e==null?e:{id:e.id,shape:e.shape==null?void 0:e.shape.map(wC),encoded_polyline:e.encodedPolyline,costing:e.costing,costing_options:ic(e.costingOptions),shape_match:e.shapeMatch,units:e.units,language:e.language,directions_type:e.directionsType,filters:VN(e.filters)}}function HN(e){return ZN(e)}function ZN(e,t){return e==null?e:{edges:e.edges==null?void 0:e.edges.map(PC),admins:e.admins==null?void 0:e.admins.map(xC),matchedPoints:e.matched_points==null?void 0:e.matched_points.map(EC),osmChangeset:e.osm_changeset==null?void 0:e.osm_changeset,shape:e.shape==null?void 0:e.shape,confidenceScore:e.confidence_score==null?void 0:e.confidence_score,id:e.id==null?void 0:e.id,units:e.units==null?void 0:tx(e.units),alternatePaths:e.alternate_paths==null?void 0:e.alternate_paths.map(jN)}}class WN extends CB{async isochroneRaw(t,n){const s={},a={};a["Content-Type"]="application/json",this.configuration&&this.configuration.apiKey&&(s.api_key=await this.configuration.apiKey("api_key"));const u=await this.request({path:"/isochrone/v1",method:"POST",headers:a,query:s,body:pF(t.isochroneRequest)},n);return new El(u,d=>fF(d))}async isochrone(t={},n){return await(await this.isochroneRaw(t,n)).value()}async mapMatchRaw(t,n){const s={},a={};a["Content-Type"]="application/json",this.configuration&&this.configuration.apiKey&&(s.api_key=await this.configuration.apiKey("api_key"));const u=await this.request({path:"/map_match/v1",method:"POST",headers:a,query:s,body:RF(t.mapMatchRequest)},n);return new El(u,d=>ZF(d))}async mapMatch(t={},n){return await(await this.mapMatchRaw(t,n)).value()}async nearestRoadsRaw(t,n){const s={},a={};a["Content-Type"]="application/json",this.configuration&&this.configuration.apiKey&&(s.api_key=await this.configuration.apiKey("api_key"));const u=await this.request({path:"/nearest_roads/v1",method:"POST",headers:a,query:s,body:eN(t.nearestRoadsRequest)},n);return new El(u,d=>d.map(EF))}async nearestRoads(t={},n){return await(await this.nearestRoadsRaw(t,n)).value()}async optimizedRouteRaw(t,n){const s={},a={};a["Content-Type"]="application/json",this.configuration&&this.configuration.apiKey&&(s.api_key=await this.configuration.apiKey("api_key"));const u=await this.request({path:"/optimized_route/v1",method:"POST",headers:a,query:s,body:tN(t.optimizedRouteRequest)},n);return new El(u,d=>fS(d))}async optimizedRoute(t={},n){return await(await this.optimizedRouteRaw(t,n)).value()}async routeRaw(t,n){const s={},a={};a["Content-Type"]="application/json",this.configuration&&this.configuration.apiKey&&(s.api_key=await this.configuration.apiKey("api_key"));const u=await this.request({path:"/route/v1",method:"POST",headers:a,query:s,body:FN(t.routeRequest)},n);return new El(u,d=>fS(d))}async route(t={},n){return await(await this.routeRaw(t,n)).value()}async timeDistanceMatrixRaw(t,n){const s={},a={};a["Content-Type"]="application/json",this.configuration&&this.configuration.apiKey&&(s.api_key=await this.configuration.apiKey("api_key"));const u=await this.request({path:"/matrix/v1",method:"POST",headers:a,query:s,body:KF(t.matrixRequest)},n);return new El(u,d=>YF(d))}async timeDistanceMatrix(t={},n){return await(await this.timeDistanceMatrixRaw(t,n)).value()}async traceAttributesRaw(t,n){const s={},a={};a["Content-Type"]="application/json",this.configuration&&this.configuration.apiKey&&(s.api_key=await this.configuration.apiKey("api_key"));const u=await this.request({path:"/trace_attributes/v1",method:"POST",headers:a,query:s,body:qN(t.traceAttributesRequest)},n);return new El(u,d=>HN(d))}async traceAttributes(t={},n){return await(await this.traceAttributesRaw(t,n)).value()}}var AC={exports:{}};(function(e){var t={};function n(u){return Math.floor(Math.abs(u)+.5)*(u>=0?1:-1)}function s(u,d,c){u=n(u*c),d=n(d*c);var w=(u-d)*2;w<0&&(w=-w-1);for(var k="";w>=32;)k+=String.fromCharCode((32|w&31)+63),w/=32;return k+=String.fromCharCode((w|0)+63),k}t.decode=function(u,d){for(var c=0,w=0,k=0,E=[],P=0,A=0,$=null,j,X,he=Math.pow(10,Number.isInteger(d)?d:5);c<u.length;){$=null,P=1,A=0;do $=u.charCodeAt(c++)-63,A+=($&31)*P,P*=32;while($>=32);j=A&1?(-A-1)/2:A/2,P=1,A=0;do $=u.charCodeAt(c++)-63,A+=($&31)*P,P*=32;while($>=32);X=A&1?(-A-1)/2:A/2,w+=j,k+=X,E.push([w/he,k/he])}return E},t.encode=function(u,d){if(!u.length)return"";for(var c=Math.pow(10,Number.isInteger(d)?d:5),w=s(u[0][0],0,c)+s(u[0][1],0,c),k=1;k<u.length;k++){var E=u[k],P=u[k-1];w+=s(E[0],P[0],c),w+=s(E[1],P[1],c)}return w};function a(u){for(var d=[],c=0;c<u.length;c++){var w=u[c].slice();d.push([w[1],w[0]])}return d}t.fromGeoJSON=function(u,d){if(u&&u.type==="Feature"&&(u=u.geometry),!u||u.type!=="LineString")throw new Error("Input must be a GeoJSON LineString");return t.encode(a(u.coordinates),d)},t.toGeoJSON=function(u,d){var c=t.decode(u,d);return{type:"LineString",coordinates:a(c)}},e.exports&&(e.exports=t)})(AC);var GN=AC.exports;const KN=Bm(GN),XN=e=>{const t=/@([^@]+)@/g;let n;const s=[];for(;(n=t.exec(e))!==null;)s.push(n[1]);return s},JN=e=>{const t=/~([^~]+)~/g;let n;const s=[];for(;(n=t.exec(e))!==null;)s.push(n[1]);return s.length==0&&s.push(e),s};async function YN(e,t,n){const s={locations:[{lon:t.location.lon,lat:t.location.lat,type:hS.Break},{lon:e.location.lon,lat:e.location.lat,type:hS.Break}],costing:GB.Auto};return console.log(s),console.log(JSON.stringify(s)),n.route({routeRequest:s})}async function QN(e){const t=new Headers,n=`https://nominatim.openstreetmap.org/search?format=jsonv2&q=${e}`;console.log(n);const s=new Request(n,{method:"GET",headers:t});return fetch(s)}async function e3(e,t,n){let s=JN(e);return console.log(s),console.warn(t),await Promise.all(s.map(async a=>{const u=await Promise.all(XN(a).map(async w=>{let k;if(t.has(w))k=t.get(w);else{const P=await(await QN(w)).json();console.warn(`Querying api for ${w}!`);const A=[P[0].lon,P[0].lat];k={text:w,lat:A[1],lon:A[0]},t.set(w,k),console.log(t),console.log(t.size),console.error(t)}return{location:k,datetime_utc:new Date}}));console.warn(n);const c=(await Promise.all(u.map(async(w,k,E)=>{if(k==0)return null;const P=E[k-1],A=JSON.stringify([P.location.text,w.location.text]);if(console.warn(A),console.warn(n.has(A)),n.has(A))return n.get(A);const $=await YN(w,P,new WN),j=KN.toGeoJSON($.trip.legs[0].shape,6);return console.warn(`Adding ${A}, ${j}`),n.set(A,j),j}))).filter(w=>w!=null).map((w,k)=>({start_pin_idx:k,end_pin_idx:k+1,route:w}));return{pins:u,routes:c}}))}function t3(){const[e,t]=gn.useState([]);let n=gn.useRef(new Map),s=gn.useRef(new Map);const a=u=>{e3(u,n.current,s.current).then(d=>{t(d)})};return hr.jsx(hr.Fragment,{children:hr.jsxs("div",{className:"w-full h-full block grid grid-cols-2",children:[hr.jsx("div",{className:"w-50% h-full block bg-white text-black",children:hr.jsx(xB,{onTextChange:a})}),hr.jsx("div",{className:"w-50% h-full block bg-black",children:hr.jsx(bB,{itinerary_chunks:e})})]})})}I2(document.getElementById("root")).render(hr.jsx(gn.StrictMode,{children:hr.jsx(t3,{})}));
